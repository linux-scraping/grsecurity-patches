commit c1d1304b9eaa06371b390d94d82dbaefa1a576f5
Author: Daniel Borkmann <dborkman@redhat.com>
Date:   Fri Feb 8 03:04:35 2013 +0000

    Upstream commit: b5c37fe6e24eec194bb29d22fdd55d73bcc709bf
    
    net: sctp: sctp_endpoint_free: zero out secret key data
    
    On sctp_endpoint_destroy, previously used sensitive keying material
    should be zeroed out before the memory is returned, as we already do
    with e.g. auth keys when released.
    
    Signed-off-by: Daniel Borkmann <dborkman@redhat.com>
    Acked-by: Vlad Yasevich <vyasevic@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/sctp/endpointola.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

commit 28ae01f80560dc816f9f4be847c70db5a9d394a0
Author: Daniel Borkmann <dborkman@redhat.com>
Date:   Fri Feb 8 03:04:34 2013 +0000

    Upstream commit: 6ba542a291a5e558603ac51cda9bded347ce7627
    
    net: sctp: sctp_setsockopt_auth_key: use kzfree instead of kfree
    
    In sctp_setsockopt_auth_key, we create a temporary copy of the user
    passed shared auth key for the endpoint or association and after
    internal setup, we free it right away. Since it's sensitive data, we
    should zero out the key before returning the memory back to the
    allocator. Thus, use kzfree instead of kfree, just as we do in
    sctp_auth_key_put().
    
    Signed-off-by: Daniel Borkmann <dborkman@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/sctp/socket.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 8f2a256673b25c3440b90f0715cb0858ea63bb2b
Author: Bjørn Mork <bjorn@mork.no>
Date:   Mon Jan 28 23:51:28 2013 +0000

    Upstream commit: 70c37bf97f2a91accba76080db69144f3b69f736
    
    net: usbnet: prevent buggy devices from killing us
    
    A device sending 0 length frames as fast as it can has been
    observed killing the host system due to the resulting memory
    pressure.
    
    Temporarily disable RX skb allocation and URB submission when
    the current error ratio is high, preventing us from trying to
    allocate an infinite number of skbs.  Reenable as soon as we
    are finished processing the done queue, allowing the device
    to continue working after short error bursts.
    
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Acked-by: Oliver Neukum <oneukum@suse.de>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	include/linux/usb/usbnet.h
    
    Conflicts:
    
    	drivers/net/usb/usbnet.c
    	include/linux/usb/usbnet.h
    
    Conflicts:
    
    	drivers/net/usb/usbnet.c
    	include/linux/usb/usbnet.h

 drivers/net/usb/usbnet.c   |   25 +++++++++++++++++++++++++
 include/linux/usb/usbnet.h |    2 ++
 2 files changed, 27 insertions(+), 0 deletions(-)

commit ecb65d5d8d6cc1f79eacffb5e10cbc36ca96795c
Author: Daniel Borkmann <dborkman@redhat.com>
Date:   Thu Feb 7 00:55:37 2013 +0000

    Upstream commit: 586c31f3bf04c290dc0a0de7fc91d20aa9a5ee53
    
    net: sctp: sctp_auth_key_put: use kzfree instead of kfree
    
    For sensitive data like keying material, it is common practice to zero
    out keys before returning the memory back to the allocator. Thus, use
    kzfree instead of kfree.
    
    Signed-off-by: Daniel Borkmann <dborkman@redhat.com>
    Acked-by: Neil Horman <nhorman@tuxdriver.com>
    Acked-by: Vlad Yasevich <vyasevich@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/sctp/auth.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 1a9dc7ba7ec6ba84a09cc4eced951f51216d444d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 11 21:13:18 2013 -0500

    Revert "Upstream commit: 9067ac85d533651b98c2ff903182a20cbb361fcb"
    Causes warnings on 2.6.32
    
    This reverts commit 468095f6523a4945bb93d33bf3823706728a8696.

 kernel/sched.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

commit 220e11d602ef58f9aeeeeadfe402efefbe1ba169
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 9 21:32:53 2013 -0500

    Deny all sysctl writes without CAP_SYS_ADMIN as we do in newer kernels

 fs/proc/proc_sysctl.c |    6 ++++++
 kernel/sysctl.c       |    3 +++
 2 files changed, 9 insertions(+), 0 deletions(-)

commit 9badd330db85e05cd55cbba145c37802fb21b9b9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 9 20:17:36 2013 -0500

    add missing offsets for check_heap_stack_gap

 mm/mmap.c |   14 ++++++++------
 1 files changed, 8 insertions(+), 6 deletions(-)

commit a1d033a7d59c75e59ceaa4ce83caecbf1df5bb54
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 7 17:47:47 2013 -0500

    It was "suggested by" Kees Cook to rewrite my previous patch
    in exactly and only the ways in which I pasted code for.  Include these
    changes!

 arch/x86/mm/fault.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

commit a5b50e724c31c66531cb2f329520b3d50a86aa3c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 7 17:39:27 2013 -0500

    Allow printing of symbols in kernel backtraces
    
    Conflicts:
    
    	arch/arm/kernel/traps.c

 arch/arm/kernel/process.c |    4 ++--
 arch/arm/kernel/traps.c   |    5 +----
 2 files changed, 3 insertions(+), 6 deletions(-)

commit c1a0a973986a3b5b91ca415f0b7b56195d81434b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Feb 6 18:14:13 2013 -0500

    Kill yet another useless technique from Dan Rosenberg
    (already unaffected due to GRKERNSEC_DMESG)

 arch/x86/mm/fault.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

commit af56fcfe9cc8bcafdb75a7ef000e516aa238d578
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 4 20:38:36 2013 -0500

    remove unused gr_handle_chroot_rawio(), its functionality is in
    gr_handle_rawio()

 grsecurity/grsec_chroot.c |   11 -----------
 security/Kconfig          |    6 ++++++
 2 files changed, 6 insertions(+), 11 deletions(-)

commit a8984ccfd5a0bee5b17728e20cb3f5e665aa9a46
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 31 18:06:01 2013 -0500

    when GRKERNSEC_KMEM is enabled, X86_MSR should be disabled

 arch/x86/Kconfig   |    1 +
 grsecurity/Kconfig |   10 ++++++++--
 2 files changed, 9 insertions(+), 2 deletions(-)

commit a8f5cc94115bfa0d08ed05bd82eb0d8151bf3623
Author: Alan Cox <alan@linux.intel.com>
Date:   Thu Nov 15 13:06:22 2012 +0000

    Upstream commit: c903f0456bc69176912dee6dd25c6a66ee1aed00
    
    x86/msr: Add capabilities check
    
    At the moment the MSR driver only relies upon file system
    checks. This means that anything as root with any capability set
    can write to MSRs. Historically that wasn't very interesting but
    on modern processors the MSRs are such that writing to them
    provides several ways to execute arbitary code in kernel space.
    Sample code and documentation on doing this is circulating and
    MSR attacks are used on Windows 64bit rootkits already.
    
    In the Linux case you still need to be able to open the device
    file so the impact is fairly limited and reduces the security of
    some capability and security model based systems down towards
    that of a generic "root owns the box" setup.
    
    Therefore they should require CAP_SYS_RAWIO to prevent an
    elevation of capabilities. The impact of this is fairly minimal
    on most setups because they don't have heavy use of
    capabilities. Those using SELinux, SMACK or AppArmor rules might
    want to consider if their rulesets on the MSR driver could be
    tighter.
    
    Signed-off-by: Alan Cox <alan@linux.intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Cc: Horses <stable@kernel.org>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    
    Conflicts:
    
    	arch/x86/kernel/msr.c

 arch/x86/kernel/msr.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit 78a3b4105f5c21910f7441d402f0944a09cc699c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 29 18:29:41 2013 -0500

    Update config help based on report from tgs3 on #grsecurity
    GRKERNSEC_AUDIT_GROUP never applied to mount/unmount logging, which
    were always logged unconditionally

 grsecurity/Kconfig |   10 +++++-----
 1 files changed, 5 insertions(+), 5 deletions(-)

commit 33cb334c8cd3ff6e6b6210e353a42f4ef9951aef
Author: Steven Rostedt <srostedt@redhat.com>
Date:   Fri Dec 14 09:48:15 2012 -0500

    Upstream commit: c1bf08ac26e92122faab9f6c32ea8aba94612dae
    
    ftrace: Be first to run code modification on modules
    
    If some other kernel subsystem has a module notifier, and adds a kprobe
    to a ftrace mcount point (now that kprobes work on ftrace points),
    when the ftrace notifier runs it will fail and disable ftrace, as well
    as kprobes that are attached to ftrace points.
    
    Here's the error:
    
     WARNING: at kernel/trace/ftrace.c:1618 ftrace_bug+0x239/0x280()
     Hardware name: Bochs
     Modules linked in: fat(+) stap_56d28a51b3fe546293ca0700b10bcb29__8059(F) nfsv4 auth_rpcgss nfs dns_resolver fscache xt_nat iptable_nat nf_conntrack_ipv4 nf_defrag_ipv4 nf_nat_ipv4 nf_nat nf_conntrack lockd sunrpc ppdev parport_pc parport microcode virtio_net i2c_piix4 drm_kms_helper ttm drm i2c_core [last unloaded: bid_shared]
     Pid: 8068, comm: modprobe Tainted: GF            3.7.0-0.rc8.git0.1.fc19.x86_64 #1
     Call Trace:
      [<ffffffff8105e70f>] warn_slowpath_common+0x7f/0xc0
      [<ffffffff81134106>] ? __probe_kernel_read+0x46/0x70
      [<ffffffffa0180000>] ? 0xffffffffa017ffff
      [<ffffffffa0180000>] ? 0xffffffffa017ffff
      [<ffffffff8105e76a>] warn_slowpath_null+0x1a/0x20
      [<ffffffff810fd189>] ftrace_bug+0x239/0x280
      [<ffffffff810fd626>] ftrace_process_locs+0x376/0x520
      [<ffffffff810fefb7>] ftrace_module_notify+0x47/0x50
      [<ffffffff8163912d>] notifier_call_chain+0x4d/0x70
      [<ffffffff810882f8>] __blocking_notifier_call_chain+0x58/0x80
      [<ffffffff81088336>] blocking_notifier_call_chain+0x16/0x20
      [<ffffffff810c2a23>] sys_init_module+0x73/0x220
      [<ffffffff8163d719>] system_call_fastpath+0x16/0x1b
     ---[ end trace 9ef46351e53bbf80 ]---
     ftrace failed to modify [<ffffffffa0180000>] init_once+0x0/0x20 [fat]
      actual: cc:bb:d2:4b:e1
    
    A kprobe was added to the init_once() function in the fat module on load.
    But this happened before ftrace could have touched the code. As ftrace
    didn't run yet, the kprobe system had no idea it was a ftrace point and
    simply added a breakpoint to the code (0xcc in the cc:bb:d2:4b:e1).
    
    Then when ftrace went to modify the location from a call to mcount/fentry
    into a nop, it didn't see a call op, but instead it saw the breakpoint op
    and not knowing what to do with it, ftrace shut itself down.
    
    The solution is to simply give the ftrace module notifier the max priority.
    This should have been done regardless, as the core code ftrace modification
    also happens very early on in boot up. This makes the module modification
    closer to core modification.
    
    Link: http://lkml.kernel.org/r/20130107140333.593683061@goodmis.org
    
    Cc: stable@vger.kernel.org
    Acked-by: Masami Hiramatsu <masami.hiramatsu.pt@hitachi.com>
    Reported-by: Frank Ch. Eigler <fche@redhat.com>
    Signed-off-by: Steven Rostedt <rostedt@goodmis.org>

 kernel/trace/ftrace.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 468095f6523a4945bb93d33bf3823706728a8696
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 28 18:52:04 2013 -0500

    Upstream commit: 9067ac85d533651b98c2ff903182a20cbb361fcb
    
    wake_up_process() should be never used to wakeup a TASK_STOPPED/TRACED task
    author	Oleg Nesterov <oleg@redhat.com>
    Mon, 21 Jan 2013 19:48:17 +0000 (20:48 +0100)
    committer	Linus Torvalds <torvalds@linux-foundation.org>
    Tue, 22 Jan 2013 18:08:17 +0000 (10:08 -0800)
    wake_up_process() should never wakeup a TASK_STOPPED/TRACED task.
    Change it to use TASK_NORMAL and add the WARN_ON().
    
    TASK_ALL has no other users, probably can be killed.
    
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 kernel/sched.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit d63c2d8f36cd308414fa56561442d6ae00fd17dc
Merge: bb7c34f f1a5a7a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 28 18:42:13 2013 -0500

    Merge branch 'pax-stable' into grsec-stable

commit f1a5a7a36efa8c351573e38893c7ecd50d24aa07
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 28 18:41:54 2013 -0500

    Update to pax-linux-2.6.32.60-test213.patch:
    - added countermeasure against attacks that reduce ASLR by exhausting the address space on 32 bit userland
      see kingcope's post for the windows version
      http://kingcope.wordpress.com/2013/01/24/attacking-the-windows-78-address-space-randomization/

 fs/binfmt_elf.c |    2 +-
 fs/exec.c       |   22 ++++++++++++++++++++++
 2 files changed, 23 insertions(+), 1 deletions(-)

commit bb7c34f0da96284d9fd006febc7b9bcb90ce8faa
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 28 06:08:12 2013 -0500

    make kmemleak user-readonly

 mm/kmemleak.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 08265dbba5a1b8692d012a7efcc0123e1a7563ed
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 28 06:06:43 2013 -0500

    allow kmemleak, it's a debugfs-only file marked user-readonly

 mm/kmemleak.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 2345c729e8e3834142bcf6bb21de6e4f7bbacfea
Merge: 8b8dbf7 2335d74
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 22 22:11:21 2013 -0500

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	security/Kconfig

commit 2335d7449f1973dfb22913584ec90322c5c6664f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 22 22:10:01 2013 -0500

    Update to pax-linux-2.6.32.60-test212.patch:
     more constification based on stats supplied by Larry H of Subreption
    - ported USERCOPY to ia64 based on the discussion with Dennis Schridde at https://bugs.gentoo.org/show_bug.cgi?id=432100
    - simplified the latent entropy code a bit
    - added some list handling wrappers for KERNEXEC/LIST_DEBUG to minimize the exposure of an open kernel
    - some constification work
      - smarter plugin allowed the removal of many no_const attrs
      - function pointer array fields are recognized as well
    - new size overflow plugin from Emese to fix some false positives (http://forums.grsecurity.net/viewtopic.php?f=3&t=3208)
    - fixed some more constification fallout (e.g., https://bugs.gentoo.org/show_bug.cgi?id=453216)
    - fixed a pointless alloca in Xen that interfered with STACKLEAK

 arch/arm/include/asm/pgalloc.h                     |    1 -
 arch/arm/include/asm/ptrace.h                      |    2 +-
 arch/arm/kernel/head.S                             |    4 +-
 arch/arm/kernel/setup.c                            |    8 +-
 arch/arm/mm/fault.c                                |   34 --------
 arch/ia64/include/asm/uaccess.h                    |   28 ++++++-
 arch/x86/include/asm/io.h                          |    2 +-
 arch/x86/include/asm/paravirt_types.h              |   12 ++--
 arch/x86/include/asm/reboot.h                      |    2 +-
 arch/x86/include/asm/smp.h                         |    2 +-
 arch/x86/include/asm/x86_init.h                    |   18 ++--
 arch/x86/kernel/apic/numaq_32.c                    |   14 ++--
 arch/x86/kernel/cpu/intel_cacheinfo.c              |   13 +++-
 arch/x86/kernel/cpu/mcheck/mce.c                   |    2 +-
 arch/x86/kernel/cpu/perf_event.c                   |    2 +-
 arch/x86/kernel/cpu/vmware.c                       |    2 +-
 arch/x86/kernel/efi.c                              |    4 +-
 arch/x86/kernel/head32.c                           |    6 +-
 arch/x86/kernel/kvm.c                              |    2 +-
 arch/x86/kernel/kvmclock.c                         |   16 ++--
 arch/x86/kernel/mrst.c                             |    4 +-
 arch/x86/kernel/paravirt.c                         |    8 +-
 arch/x86/kernel/vmi_32.c                           |   28 ++++----
 arch/x86/kernel/vsmp_64.c                          |    2 +-
 arch/x86/lguest/boot.c                             |   52 ++++++------
 arch/x86/mm/ioremap.c                              |    2 +-
 arch/x86/mm/mmio-mod.c                             |    4 +-
 arch/x86/xen/enlighten.c                           |   42 +++++-----
 arch/x86/xen/irq.c                                 |    2 +-
 arch/x86/xen/mmu.c                                 |    4 +-
 arch/x86/xen/smp.c                                 |    2 +-
 arch/x86/xen/spinlock.c                            |   12 ++--
 drivers/cdrom/cdrom.c                              |    9 +-
 drivers/cdrom/gdrom.c                              |    1 -
 drivers/char/random.c                              |   11 ---
 drivers/gpu/drm/i915/i915_drv.h                    |    2 +-
 drivers/gpu/drm/radeon/r100.c                      |    6 +-
 drivers/gpu/drm/radeon/r300.c                      |    6 +-
 drivers/gpu/drm/radeon/radeon.h                    |    2 +-
 drivers/gpu/drm/radeon/radeon_device.c             |   18 +++--
 drivers/isdn/hardware/eicon/divasync.h             |    2 +-
 drivers/isdn/hardware/eicon/xdi_adapter.h          |    2 +-
 drivers/media/dvb/dvb-core/dvb_demux.h             |    2 +-
 drivers/media/video/pvrusb2/pvrusb2-hdw-internal.h |    2 +-
 drivers/net/e1000e/82571.c                         |   27 +++----
 drivers/net/e1000e/es2lan.c                        |   13 ++--
 drivers/net/e1000e/hw.h                            |    9 +--
 drivers/net/igb/e1000_hw.h                         |   12 +--
 drivers/net/igbvf/vf.h                             |    6 +-
 drivers/net/ixgbe/ixgbe_type.h                     |    9 +--
 drivers/net/macvlan.c                              |    2 +-
 drivers/net/vxge/vxge-config.c                     |   12 ++-
 drivers/net/vxge/vxge-config.h                     |    2 +-
 drivers/net/vxge/vxge-traffic.h                    |    2 +-
 drivers/pci/hotplug/cpci_hotplug.h                 |    2 +-
 drivers/pci/hotplug/cpcihp_generic.c               |    6 +-
 drivers/pci/hotplug/cpcihp_zt5550.c                |   14 ++-
 drivers/power/bq27x00_battery.c                    |   22 +----
 drivers/scsi/aacraid/aacraid.h                     |    2 +-
 drivers/scsi/ips.h                                 |    2 +-
 drivers/scsi/qla2xxx/qla_def.h                     |    2 +-
 drivers/scsi/qla2xxx/qla_os.c                      |    6 +-
 drivers/staging/usbip/usbip_common.h               |    2 +-
 drivers/staging/wlan-ng/hfa384x_usb.c              |    2 +-
 drivers/watchdog/hpwdt.c                           |    7 +-
 drivers/xen/balloon.c                              |    5 +-
 fs/exec.c                                          |    2 +-
 fs/seq_file.c                                      |    2 +-
 include/acpi/acpi_bus.h                            |    2 +-
 include/crypto/algapi.h                            |    2 +-
 include/drm/drm_crtc_helper.h                      |    2 +-
 include/linux/cdrom.h                              |    1 -
 include/linux/fsnotify_backend.h                   |    1 -
 include/linux/if_pppox.h                           |    2 +-
 include/linux/intel-iommu.h                        |    2 +-
 include/linux/kobject.h                            |    2 +-
 include/linux/list.h                               |    3 +
 include/linux/memory.h                             |    2 +-
 include/linux/mmiotrace.h                          |    4 +-
 include/linux/module.h                             |    1 +
 include/linux/netfilter/nfnetlink.h                |    2 +-
 include/linux/notifier.h                           |    3 +-
 include/linux/preempt.h                            |    2 +-
 include/linux/proc_fs.h                            |    2 +-
 include/linux/random.h                             |    4 -
 include/linux/regset.h                             |    2 +-
 include/linux/rfkill.h                             |    1 -
 include/linux/slab.h                               |    2 +-
 include/linux/sysrq.h                              |    2 +-
 include/linux/tty_driver.h                         |    2 +-
 include/media/saa7146_vv.h                         |    2 +-
 include/media/v4l2-dev.h                           |    1 -
 include/media/v4l2-ioctl.h                         |    1 -
 include/net/inet_connection_sock.h                 |    2 +-
 include/net/irda/ircomm_core.h                     |    2 +-
 include/net/netfilter/nf_queue.h                   |    2 +-
 include/net/protocol.h                             |    4 +-
 include/net/sctp/structs.h                         |    4 +-
 include/net/tcp.h                                  |    4 +-
 include/net/udp.h                                  |    4 +-
 include/net/xfrm.h                                 |    2 +-
 include/sound/ak4xxx-adda.h                        |    2 +-
 include/sound/hwdep.h                              |    2 +-
 include/sound/info.h                               |    2 +-
 include/sound/pcm.h                                |    1 -
 include/sound/sb16_csp.h                           |    2 +-
 init/main.c                                        |    8 ++-
 kernel/notifier.c                                  |   17 +++-
 kernel/timer.c                                     |    2 +-
 kernel/trace/ftrace.c                              |    7 +-
 kernel/trace/trace_output.c                        |   10 ++-
 lib/Makefile                                       |    2 +-
 lib/dma-debug.c                                    |    2 +-
 lib/list_debug.c                                   |   63 ++++++++++++++-
 mm/slab.c                                          |    2 +-
 mm/slob.c                                          |    2 +-
 mm/slub.c                                          |    2 +-
 net/8021q/vlan.c                                   |    2 +-
 net/atm/mpc.h                                      |    2 +-
 net/can/af_can.c                                   |    2 +-
 net/core/rtnetlink.c                               |   14 ++-
 net/sctp/ipv6.c                                    |    2 +-
 net/sctp/protocol.c                                |    8 +-
 net/tipc/eth_media.c                               |    8 +-
 net/wireless/core.h                                |    2 +-
 net/xfrm/xfrm_state.c                              |    4 +-
 security/Kconfig                                   |    2 +-
 sound/isa/cmi8330.c                                |    2 +-
 sound/pci/hda/hda_codec.h                          |    7 +-
 sound/pci/ice1712/ice1712.h                        |    4 +-
 sound/soc/soc-core.c                               |   18 +++--
 tools/gcc/constify_plugin.c                        |   82 ++++++++++++--------
 tools/gcc/size_overflow_plugin.c                   |   82 +++++++++++--------
 virt/kvm/kvm_main.c                                |   10 ++-
 134 files changed, 553 insertions(+), 467 deletions(-)

commit 8b8dbf798ca9a85f2bcc8532b70c844a5919de65
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jan 19 17:37:10 2013 -0500

    fix typo

 grsecurity/Kconfig |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit dc74e58ca0a1467cde31eb739ad95c10b619b700
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jan 19 10:56:50 2013 -0500

    fix typo in documentation

 grsecurity/Kconfig |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 1e374c7c60492005d2317c1d908169d15c493780
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jan 19 02:31:15 2013 -0500

    Choose "between" wording to cover both topdown and bottom-up allocators

 grsecurity/Kconfig |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 687f8d075e9c92668e0b42dfbf7bd2eede407e6d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 18 19:30:40 2013 -0500

    compile fixes

 arch/x86/kernel/sys_x86_64.c |    2 +-
 fs/stat.c                    |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

commit 66eb1615e15d77e5178df7ceb4b651d8d6b5a8cb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 18 19:26:55 2013 -0500

    compile fix

 include/linux/sched.h |    4 ++--
 mm/mmap.c             |    1 +
 2 files changed, 3 insertions(+), 2 deletions(-)

commit 7be3be1c689f487b104c554cfb16fbe368654c3d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 18 19:09:04 2013 -0500

    add CONFIG_GRKERNSEC_RAND_THREADSTACK
    
    Conflicts:
    
    	arch/arm/mm/mmap.c
    	arch/x86/kernel/sys_x86_64.c
    	arch/x86/mm/hugetlbpage.c
    
    Conflicts:
    
    	arch/arm/mm/mmap.c
    	arch/mips/mm/mmap.c
    	grsecurity/Kconfig
    	include/linux/sched.h

 arch/alpha/kernel/osf_sys.c      |   14 +++++++-------
 arch/arm/mm/mmap.c               |    6 +++---
 arch/frv/mm/elf-fdpic.c          |    7 ++++---
 arch/ia64/kernel/sys_ia64.c      |    3 ++-
 arch/ia64/mm/hugetlbpage.c       |    3 ++-
 arch/parisc/kernel/sys_parisc.c  |   19 +++++++++++--------
 arch/powerpc/mm/slice.c          |    8 ++++----
 arch/sh/mm/mmap.c                |   14 ++++++++------
 arch/sparc/kernel/sys_sparc_32.c |    3 ++-
 arch/sparc/kernel/sys_sparc_64.c |   14 ++++++++------
 arch/sparc/mm/hugetlbpage.c      |   13 ++++++++-----
 arch/x86/kernel/sys_i386_32.c    |   14 ++++++++------
 arch/x86/kernel/sys_x86_64.c     |   12 +++++++-----
 arch/x86/mm/hugetlbpage.c        |   11 +++++++----
 grsecurity/Kconfig               |   20 ++++++++++++++++++++
 include/linux/sched.h            |    9 +++++++++
 mm/mmap.c                        |   26 ++++++++++++++++++++++----
 17 files changed, 132 insertions(+), 64 deletions(-)

commit b4700813e358d7c1613f287fe0c98d2a242d5b7c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Dec 16 11:14:17 2012 -0500

    Fix compilation error reported on forums

 grsecurity/gracl.c    |   32 ++++++++++++++++----------------
 include/linux/gracl.h |    8 ++++----
 2 files changed, 20 insertions(+), 20 deletions(-)

commit 2cc87c571325d95c32154b7a5486454f4ffe81ab
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 18 16:24:58 2013 -0500

    Add GRKERNSEC_DEVICE_SIDECHANNEL
    
    Conflicts:
    
    	include/linux/fs.h
    
    Conflicts:
    
    	fs/stat.c

 fs/stat.c                |   20 ++++++++++++++++----
 grsecurity/Kconfig       |   13 +++++++++++++
 include/linux/fs.h       |   10 ++++++++++
 include/linux/fsnotify.h |    6 ++++++
 4 files changed, 45 insertions(+), 4 deletions(-)

commit b21251551beb3472237771154bb51b69ebafc86a
Merge: f48fcd3 13bc999
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 17 20:53:26 2013 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 13bc999d595e4b22303af958a77a8585ce26201d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 17 20:53:11 2013 -0500

    Revert "backport native_set_pgd_batched() fix from PaX"
    
    This reverts commit 19c7c072a96314cb5ec28b2a4bd32debbd578587.

 arch/x86/include/asm/pgtable_64.h |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

commit f48fcd3ca4971fbe2fe0bb7cebcfee9034ffa4db
Merge: 448e54e 19c7c07
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 16 19:22:45 2013 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 19c7c072a96314cb5ec28b2a4bd32debbd578587
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 16 19:22:28 2013 -0500

    backport native_set_pgd_batched() fix from PaX

 arch/x86/include/asm/pgtable_64.h |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 448e54e1cab8afe1c6b93440202ef2b807464f44
Author: Eric Dumazet <edumazet@google.com>
Date:   Tue Jul 17 12:29:30 2012 +0000

    tcp: refine SYN handling in tcp_validate_incoming
    
    [ Upstream commit e371589917011efe6ff8c7dfb4e9e81934ac5855 ]
    
    Followup of commit 0c24604b68fc (tcp: implement RFC 5961 4.2)
    
    As reported by Vijay Subramanian, we should send a challenge ACK
    instead of a dup ack if a SYN flag is set on a packet received out of
    window.
    
    This permits the ratelimiting to work as intended, and to increase
    correct SNMP counters.
    
    Suggested-by: Vijay Subramanian <subramanian.vijay@gmail.com>
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Acked-by: Vijay Subramanian <subramanian.vijay@gmail.com>
    Cc: Kiran Kumar Kella <kkiran@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Ben Hutchings <ben@decadent.org.uk>

 net/ipv4/tcp_input.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

commit 2c700bec2d7318a2fdfd611010cd56fa3ef7aa03
Author: Eric Dumazet <edumazet@google.com>
Date:   Tue Nov 13 05:37:18 2012 +0000

    tcp: tcp_replace_ts_recent() should not be called from tcp_validate_incoming()
    
    [ Upstream commit bd090dfc634ddd711a5fbd0cadc6e0ab4977bcaf ]
    
    We added support for RFC 5961 in latest kernels but TCP fails
    to perform exhaustive check of ACK sequence.
    
    We can update our view of peer tsval from a frame that is
    later discarded by tcp_ack()
    
    This makes timestamps enabled sessions vulnerable to injection of
    a high tsval : peers start an ACK storm, since the victim
    sends a dupack each time it receives an ACK from the other peer.
    
    As tcp_validate_incoming() is called before tcp_ack(), we should
    not peform tcp_replace_ts_recent() from it, and let callers do it
    at the right time.
    
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Neal Cardwell <ncardwell@google.com>
    Cc: Yuchung Cheng <ycheng@google.com>
    Cc: Nandita Dukkipati <nanditad@google.com>
    Cc: H.K. Jerry Chu <hkchu@google.com>
    Cc: Romain Francoise <romain@orebokech.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Ben Hutchings <ben@decadent.org.uk>

 net/ipv4/tcp_input.c |   15 ++++++++++-----
 1 files changed, 10 insertions(+), 5 deletions(-)

commit 50ce3ac553fa8438759fc6459fbb9380fba22d0a
Author: Xi Wang <xi.wang@gmail.com>
Date:   Fri Jan 11 14:31:48 2013 -0800

    Upstream commit: 6d92d4f6a74766cc885b18218268e0c47fbca399
    
    fs/exec.c: work around icc miscompilation
    
    The tricky problem is this check:
    
    	if (i++ >= max)
    
    icc (mis)optimizes this check as:
    
    	if (++i > max)
    
    The check now becomes a no-op since max is MAX_ARG_STRINGS (0x7FFFFFFF).
    
    This is "allowed" by the C standard, assuming i++ never overflows,
    because signed integer overflow is undefined behavior.  This
    optimization effectively reverts the previous commit 362e6663ef23
    ("exec.c, compat.c: fix count(), compat_count() bounds checking") that
    tries to fix the check.
    
    This patch simply moves ++ after the check.
    
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Cc: Jason Baron <jbaron@redhat.com>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/exec.c

 fs/exec.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 69cf9778d4ff036ca67127e550ee026d039ee65d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 14 23:13:34 2013 -0500

    Fix dup_mm() OOPS caused by exec_file refcnt imbalance, as reported at:
    http://forums.grsecurity.net/viewtopic.php?f=3&t=3230

 fs/fs_struct.c        |    4 ----
 grsecurity/gracl_fs.c |   10 ++--------
 kernel/exit.c         |    1 +
 kernel/fork.c         |    8 +++++---
 4 files changed, 8 insertions(+), 15 deletions(-)

commit 7afe1f2129faf59dfd6985554d126208e03a3b95
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jan 5 13:47:47 2013 -0500

    Add a feature from Willy Tarreau to disable TCP Simultaneous Connect.
    I've eliminated the sysctl and enabled the feature by default
    in all automatic configurations.
    
    Willy's original commit message is below:
    
    >From 61abc5ef6c3bc210c63036b5f36cc96a7802b605 Mon Sep 17 00:00:00 2001
    From: Willy Tarreau <w@1wt.eu>
    Date: Wed, 8 Oct 2008 10:00:42 +0200
    Subject: [PATCH] TCP: add a sysctl to disable simultaneous connection opening.
    
    Strict implementation of RFC793 (TCP) requires support for a feature
    called "simultaneous connect", which allows two clients to connect to
    each other without anyone entering a listening state.  While almost
    never used, and supported by few OSes, Linux supports this feature.
    
    However, it introduces a weakness in the protocol which makes it very
    easy for an attacker to prevent a client from connecting to a known
    server. The attacker only has to guess the source port to shut down
    the client connection during its establishment. The impact is limited,
    but it may be used to prevent an antivirus or IPS from fetching updates
    and not detecting an attack, or to prevent an SSL gateway from fetching
    a CRL for example.
    
    This patch provides a new sysctl "tcp_simult_connect" to enable or disable
    support for this useless feature. It comes disabled by default.
    
    Hundreds of systems running with that feature disabled for more than 4 years
    have never encountered an application which requires it. It is almost never
    supported by firewalls BTW.
    
    Signed-off-by: Willy Tarreau <w@1wt.eu>

 grsecurity/Kconfig   |   18 ++++++++++++++++++
 net/ipv4/tcp_input.c |    2 ++
 2 files changed, 20 insertions(+), 0 deletions(-)

commit 573324df745861de18aa154a12225931323bb527
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 3 18:30:42 2013 -0500

    GR_NESTED is an outdated flag -- nested subjects don't exist in hash tables
    these days and are directly attached to objects.  Remove it.

 grsecurity/gracl.c     |   17 -----------------
 include/linux/grdefs.h |    2 +-
 2 files changed, 1 insertions(+), 18 deletions(-)

commit b4d061468c5beb753d9d455e3ddb0d1f732865ab
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 1 14:10:27 2013 -0500

    Fix compiler warning

 lib/vsprintf.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 828339b0c2a339ea135f4fc39d46eef15346018e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 27 19:02:18 2012 -0500

    Resolve compiler warning

 fs/autofs4/waitq.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 1aa1f59f5a450fe15f497ce05067816c0d0d7a39
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 27 18:59:50 2012 -0500

    fix compile warning

 fs/namei.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 59bc5e94be49f84894ea59c9488f2bee95005e8f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 27 18:53:28 2012 -0500

    compile fix

 net/ipv4/tcp_input.c |   17 -----------------
 1 files changed, 0 insertions(+), 17 deletions(-)

commit a6b13ac34e38694cdbbf16e38e271b986e50f715
Author: Eric Dumazet <edumazet@google.com>
Date:   Tue Jul 17 01:41:30 2012 +0000

    Upstream commit: 0c24604b
    
    tcp: implement RFC 5961 4.2
    
    Implement the RFC 5691 mitigation against Blind
    Reset attack using SYN bit.
    
    Section 4.2 of RFC 5961 advises to send a Challenge ACK and drop
    incoming packet, instead of resetting the session.
    
    Add a new SNMP counter to count number of challenge acks sent
    in response to SYN packets.
    (netstat -s | grep TCPSYNChallenge)
    
    Remove obsolete TCPAbortOnSyn, since we no longer abort a TCP session
    because of a SYN flag.
    
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Kiran Kumar Kella <kkiran@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	net/ipv4/tcp_input.c
    
    Conflicts:
    
    	net/ipv4/tcp_input.c

 include/linux/snmp.h |    2 +-
 net/ipv4/proc.c      |    2 +-
 net/ipv4/tcp_input.c |   32 +++++++++++++++-----------------
 3 files changed, 17 insertions(+), 19 deletions(-)

commit 1212f763a4d29950918abd8d71d0879389070067
Author: Eric Dumazet <edumazet@google.com>
Date:   Tue Jul 17 10:13:05 2012 +0200

    tcp: implement RFC 5961 3.2
    
    Implement the RFC 5691 mitigation against Blind
    Reset attack using RST bit.
    
    Idea is to validate incoming RST sequence,
    to match RCV.NXT value, instead of previouly accepted
    window : (RCV.NXT <= SEG.SEQ < RCV.NXT+RCV.WND)
    
    If sequence is in window but not an exact match, send
    a "challenge ACK", so that the other part can resend an
    RST with the appropriate sequence.
    
    Add a new sysctl, tcp_challenge_ack_limit, to limit
    number of challenge ACK sent per second.
    
    Add a new SNMP counter to count number of challenge acks sent.
    (netstat -s | grep TCPChallengeACK)
    
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Kiran Kumar Kella <kkiran@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	Documentation/networking/ip-sysctl.txt
    	include/linux/snmp.h
    	include/net/tcp.h
    	net/ipv4/proc.c
    	net/ipv4/sysctl_net_ipv4.c

 Documentation/networking/ip-sysctl.txt |    5 +++++
 include/linux/snmp.h                   |    1 +
 include/net/tcp.h                      |    1 +
 net/ipv4/proc.c                        |    1 +
 net/ipv4/sysctl_net_ipv4.c             |    7 +++++++
 net/ipv4/tcp_input.c                   |   31 ++++++++++++++++++++++++++++++-
 6 files changed, 45 insertions(+), 1 deletions(-)

commit a92965e69b95a89e4204119cc37fec98b3f68331
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 27 18:20:59 2012 -0500

    Clarify documentation for GRKERNSEC_DMESG based on Twitter discussion

 grsecurity/Kconfig |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 2606095f69b885982cba57f47154bc3e17830bbf
Author: Jarod Wilson <jarod@redhat.com>
Date:   Tue Nov 6 10:42:42 2012 -0500

    Upstream commit: ec8f02da9ea500474417d1d31fa3d46a562ab366
    
    random: prime last_data value per fips requirements
    
    The value stored in last_data must be primed for FIPS 140-2 purposes. Upon
    first use, either on system startup or after an RNDCLEARPOOL ioctl, we
    need to take an initial random sample, store it internally in last_data,
    then pass along the value after that to the requester, so that consistency
    checks aren't being run against stale and possibly known data.
    
    CC: Herbert Xu <herbert@gondor.apana.org.au>
    CC: "David S. Miller" <davem@davemloft.net>
    CC: Matt Mackall <mpm@selenic.com>
    CC: linux-crypto@vger.kernel.org
    Acked-by: Neil Horman <nhorman@tuxdriver.com>
    Signed-off-by: Jarod Wilson <jarod@redhat.com>
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
    
    Conflicts:
    
    	drivers/char/random.c

 drivers/char/random.c |   17 +++++++++++++++++
 1 files changed, 17 insertions(+), 0 deletions(-)

commit c0f5f10ffce80121c62a529be484ce9095555043
Author: Nick Kossifidis <mickflemm@gmail.com>
Date:   Sun Dec 16 22:18:11 2012 -0500

    Upstream commit: 6133705494bb02953e1e2cc3018a4373981b3c97
    
    random: Mix cputime from each thread that exits to the pool
    
    When a thread exits mix its cputime (userspace + kernelspace) to the entropy pool.
    
    We don't know how "random" this is, so we use add_device_randomness that doesn't mess
    with entropy count.
    
    Signed-off-by: Nick Kossifidis <mickflemm@gmail.com>
    Signed-off-by: Theodore Ts'o <tytso@mit.edu>

 kernel/posix-cpu-timers.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit e3b6f18a327ab45e54157e7ae60e41583d5a9701
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 27 18:04:19 2012 -0500

    Backport upstream commit: a68c2f12b4b28994aaf622bbe5724b7258cc2fcf
    
    sendfile: allows bypassing of notifier events
    author	Scott Wolchok <swolchok@umich.edu>
    do_sendfile() in fs/read_write.c does not call the fsnotify functions,
    unlike its neighbors.  This manifests as a lack of inotify ACCESS events
    when a file is sent using sendfile(2).
    
    Addresses
      https://bugzilla.kernel.org/show_bug.cgi?id=12812

 fs/read_write.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 0c43ad988d313fc92da8269afb079cf6c2ef1c18
Author: Eric Sandeen <sandeen@redhat.com>
Date:   Wed Nov 14 22:22:05 2012 -0500

    Upstream commit: 66bea92c69477a75a5d37b9bfed5773c92a3c4b4
    
    ext4: init pagevec in ext4_da_block_invalidatepages
    
    ext4_da_block_invalidatepages is missing a pagevec_init(),
    which means that pvec->cold contains random garbage.
    
    This affects whether the page goes to the front or
    back of the LRU when ->cold makes it to
    free_hot_cold_page()
    
    Reviewed-by: Lukas Czerner <lczerner@redhat.com>
    Reviewed-by: Carlos Maiolino <cmaiolino@redhat.com>
    Signed-off-by: Eric Sandeen <sandeen@redhat.com>
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
    Cc: stable@vger.kernel.org
    
    Conflicts:
    
    	fs/ext4/inode.c
    
    Conflicts:
    
    	fs/ext4/inode.c

 fs/ext4/inode.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 44256ea843718bee1464755a76c91602034a589f
Author: Christoffer Dall <cdall@cs.columbia.edu>
Date:   Fri Dec 21 13:03:50 2012 -0500

    Upstream commit: ad4b3fb7ff9940bcdb1e4cd62bd189d10fa636ba
    
    mm: Fix PageHead when !CONFIG_PAGEFLAGS_EXTENDED
    
    Unfortunately with !CONFIG_PAGEFLAGS_EXTENDED, (!PageHead) is false, and
    (PageHead) is true, for tail pages.  If this is indeed the intended
    behavior, which I doubt because it breaks cache cleaning on some ARM
    systems, then the nomenclature is highly problematic.
    
    This patch makes sure PageHead is only true for head pages and PageTail
    is only true for tail pages, and neither is true for non-compound pages.
    
    [ This buglet seems ancient - seems to have been introduced back in Apr
      2008 in commit 6a1e7f777f61: "pageflags: convert to the use of new
      macros".  And the reason nobody noticed is because the PageHead()
      tests are almost all about just sanity-checking, and only used on
      pages that are actual page heads.  The fact that the old code returned
      true for tail pages too was thus not really noticeable.   - Linus ]
    
    Signed-off-by: Christoffer Dall <cdall@cs.columbia.edu>
    Acked-by:  Andrea Arcangeli <aarcange@redhat.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Will Deacon <Will.Deacon@arm.com>
    Cc: Steve Capper <Steve.Capper@arm.com>
    Cc: Christoph Lameter <cl@linux.com>
    Cc: stable@kernel.org  # 2.6.26+
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 include/linux/page-flags.h |    8 +++++++-
 1 files changed, 7 insertions(+), 1 deletions(-)

commit 85936f2007493aa0a148622eb210167f16d6eff7
Author: Eric Dumazet <edumazet@google.com>
Date:   Wed Dec 26 12:44:34 2012 +0000

    Upstream commit: c3ae62af8e755ea68380fb5ce682e60079a4c388
    
    tcp: should drop incoming frames without ACK flag set
    
    In commit 96e0bf4b5193d (tcp: Discard segments that ack data not yet
    sent) John Dykstra enforced a check against ack sequences.
    
    In commit 354e4aa391ed5 (tcp: RFC 5961 5.2 Blind Data Injection Attack
    Mitigation) I added more safety tests.
    
    But we missed fact that these tests are not performed if ACK bit is
    not set.
    
    RFC 793 3.9 mandates TCP should drop a frame without ACK flag set.
    
    " fifth check the ACK field,
          if the ACK bit is off drop the segment and return"
    
    Not doing so permits an attacker to only guess an acceptable sequence
    number, evading stronger checks.
    
    Many thanks to Zhiyun Qian for bringing this issue to our attention.
    
    See :
    http://web.eecs.umich.edu/~zhiyunq/pub/ccs12_TCP_sequence_number_inference.pdf
    
    Reported-by: Zhiyun Qian <zhiyunq@umich.edu>
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Nandita Dukkipati <nanditad@google.com>
    Cc: Neal Cardwell <ncardwell@google.com>
    Cc: John Dykstra <john.dykstra1@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	net/ipv4/tcp_input.c

 net/ipv4/tcp_input.c |   13 +++++++++----
 1 files changed, 9 insertions(+), 4 deletions(-)

commit 4fd6cb50dfe5dc09b1c16a91ea30b27b3034ace7
Author: Eric Dumazet <edumazet@google.com>
Date:   Sun Oct 21 19:57:11 2012 +0000

    Upstream commit: 354e4aa391ed50a4d827ff6fc11e0667d0859b25
    
    tcp: RFC 5961 5.2 Blind Data Injection Attack Mitigation
    
    RFC 5961 5.2 [Blind Data Injection Attack].[Mitigation]
    
      All TCP stacks MAY implement the following mitigation.  TCP stacks
      that implement this mitigation MUST add an additional input check to
      any incoming segment.  The ACK value is considered acceptable only if
      it is in the range of ((SND.UNA - MAX.SND.WND) <= SEG.ACK <=
      SND.NXT).  All incoming segments whose ACK value doesn't satisfy the
      above condition MUST be discarded and an ACK sent back.
    
    Move tcp_send_challenge_ack() before tcp_ack() to avoid a forward
    declaration.
    
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Neal Cardwell <ncardwell@google.com>
    Cc: Yuchung Cheng <ycheng@google.com>
    Cc: Jerry Chu <hkchu@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/tcp_input.c |   26 +++++++++++++++++++++++++-
 1 files changed, 25 insertions(+), 1 deletions(-)

commit 14aa43c07a8bb0aafd1cdbfddfa3bd3d240d84f9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 22 18:45:28 2012 -0500

    Fix compile error reported at:
    https://bugs.gentoo.org/show_bug.cgi?id=447826

 include/linux/random.h |   13 -------------
 1 files changed, 0 insertions(+), 13 deletions(-)

commit 0959d54a4ed6aa6408de22d476b9882439db1d3c
Merge: 56250a0 4f640c3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 15 13:19:36 2012 -0500

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	arch/x86/kernel/kgdb.c
    	security/Kconfig
    	tools/gcc/size_overflow_hash.data

commit 4f640c3c6be49fcc334889a295728ce7c5cb44db
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 15 13:13:32 2012 -0500

    Update to pax-linux-2.6.32.60-test211.patch:
    - size overflow plugin update from Emese (new hashtable format, small fixes)
    - introduced local_unchecked_t and related wrappers to handle exceptional cases of non-refcounting local_t variables
    - fixed ftrace/kgdb/kprobes for i386/KERNEXEC

 arch/x86/include/asm/i387.h              |    2 +-
 arch/x86/include/asm/local.h             |   66 +
 arch/x86/kernel/ftrace.c                 |    2 +-
 arch/x86/kernel/kgdb.c                   |   29 +-
 arch/x86/kernel/kprobes.c                |    2 +-
 arch/x86/mm/pageattr.c                   |    2 +-
 drivers/misc/kgdbts.c                    |    4 +-
 include/asm-generic/atomic-long.h        |   21 +
 include/asm-generic/local.h              |   12 +
 kernel/trace/ring_buffer.c               |   74 +-
 security/Kconfig                         |    2 +-
 tools/gcc/generate_size_overflow_hash.sh |   12 +-
 tools/gcc/size_overflow_hash.data        | 5125 +++++++++++++++---------------
 tools/gcc/size_overflow_plugin.c         |  107 +-
 14 files changed, 2821 insertions(+), 2639 deletions(-)

commit 56250a011b8dc40b2643326d94898e4b5a38fd3d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Dec 7 15:40:17 2012 -0500

    compile fix

 grsecurity/grsec_sig.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 7884ea879983086b8676810f35d0928a99c15860
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Dec 7 15:16:19 2012 -0500

    Improve usability of GRKERNSEC_BRUTE, sponsorship work for Exonet:
    Log when activating bruteforce protection against a network daemon
    Expire the bruteforce protection in 30 minutes if no new crashes occur
    Check sysctl option at time of stalling forks so that flagged processes
    don't still delay when the feature is disabled and require a service restart
    
    Conflicts:
    
    	grsecurity/grsec_sig.c
    	include/linux/sched.h
    
    Conflicts:
    
    	fs/exec.c
    	grsecurity/grsec_sig.c
    	include/linux/grsecurity.h

 fs/exec.c                  |    2 +-
 grsecurity/grsec_sig.c     |   19 ++++++++++++++++---
 include/linux/grmsg.h      |    1 +
 include/linux/grsecurity.h |    2 +-
 include/linux/sched.h      |    1 +
 5 files changed, 20 insertions(+), 5 deletions(-)

commit 281d42167154a451c4c965bf3bdd87ed188f710d
Merge: edf0790 4cf22fc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Dec 4 19:02:52 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 4cf22fc30e7f92bf70721ac6041b96430c596383
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Dec 4 19:02:35 2012 -0500

    Update to pax-linux-2.6.32.60-test210.patch:
    - removed old cruft
    - fixed i386/fpu regression introduced by a previous backport, thanks to Kevin Chadwick for reporting it

 arch/x86/include/asm/i387.h |   12 ++++++++++--
 arch/x86/power/cpu.c        |    4 ----
 2 files changed, 10 insertions(+), 6 deletions(-)

commit edf07909e2c28ea7aa458b1982b260ad9b2fc064
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Dec 4 17:14:11 2012 -0500

    Revert "Upstream commit: c44600c9d1de64314c2bd58103f15acb53e10073"
    
    This reverts commit 68d50e39cdefe19e1619ad4ff040f457f8350676.

 fs/nfs/dir.c |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

commit 68d50e39cdefe19e1619ad4ff040f457f8350676
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Thu Nov 29 22:04:36 2012 -0500

    Upstream commit: c44600c9d1de64314c2bd58103f15acb53e10073
    
    nfs_lookup_revalidate(): fix a leak
    
    We are leaking fattr and fhandle if we decide that dentry is not to
    be invalidated, after all (e.g. happens to be a mountpoint).  Just
    free both before that...
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

 fs/nfs/dir.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit c02d84f0d236a26740b3e315932fd771edd27581
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Thu Nov 29 22:11:06 2012 -0500

    Upstream commit: 0903a0c8491c1e987dfc6eb294199a36760398bc
    
    cifs: get rid of blind d_drop() in readdir
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    
    Conflicts:
    
    	fs/cifs/readdir.c

 fs/cifs/readdir.c |   12 +++++++++---
 1 files changed, 9 insertions(+), 3 deletions(-)

commit 145b6d3c5d1e0fb496f772edb382a4cc30176a84
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Thu Nov 29 22:17:21 2012 -0500

    Upstream commit: 21d8a15ac333b05f1fecdf9fdc30996be2e11d60
    
    lookup_one_len: don't accept . and ..
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    
    Conflicts:
    
    	fs/namei.c
    
    Conflicts:
    
    	fs/namei.c

 fs/namei.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

commit 2bd6dfdce279a1ba816e6092d46edf1a5e0284fe
Author: Brian Behlendorf <behlendorf1@llnl.gov>
Date:   Tue Oct 26 14:23:10 2010 -0700

    div64_u64(): improve precision on 32bit platforms
    
    The current implementation of div64_u64 for 32bit systems returns an
    approximately correct result when the divisor exceeds 32bits.  Since doing
    64bit division using 32bit hardware is a long since solved problem we just
    use one of the existing proven methods.
    
    Additionally, add a div64_s64 function to correctly handle doing signed
    64bit division.
    
    Addresses https://bugzilla.redhat.com/show_bug.cgi?id=616105
    
    Signed-off-by: Brian Behlendorf <behlendorf1@llnl.gov>
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Cc: Ben Woodard <bwoodard@llnl.gov>
    Cc: Jeremy Fitzhardinge <jeremy@goop.org>
    Cc: Mark Grondona <mgrondona@llnl.gov>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 include/linux/kernel.h |    5 ++++
 include/linux/math64.h |   12 +++++++++++
 lib/div64.c            |   52 ++++++++++++++++++++++++++++++++++++++---------
 3 files changed, 59 insertions(+), 10 deletions(-)

commit 7e07b42d9dfe00f6ff7e1d53c7f8de85e8267acb
Merge: 123e5a6 a8f535c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Dec 3 17:25:43 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit a8f535cfc60a8c2e6dcdda56956d3ed87803c098
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Dec 3 17:25:26 2012 -0500

    Update to pax-linux-2.6.32.60-test209.patch:
    - fixed a refcount false positive in the USB stack, thanks to Christian Perle for reporting it

 drivers/usb/core/hcd.c   |    4 ++--
 drivers/usb/core/sysfs.c |    2 +-
 drivers/usb/core/usb.c   |    2 +-
 include/linux/usb.h      |    2 +-
 4 files changed, 5 insertions(+), 5 deletions(-)

commit 123e5a6c36bef00bdf6b0c5ea7db28598ddccfed
Author: Tommi Rantala <tt.rantala@gmail.com>
Date:   Tue Nov 27 04:01:46 2012 +0000

    Upstream commit: be364c8c0f17a3dd42707b5a090b318028538eb9
    
    sctp: fix memory leak in sctp_datamsg_from_user() when copy from user space fails
    
    Trinity (the syscall fuzzer) discovered a memory leak in SCTP,
    reproducible e.g. with the sendto() syscall by passing invalid
    user space pointer in the second argument:
    
     #include <string.h>
     #include <arpa/inet.h>
     #include <sys/socket.h>
    
     int main(void)
     {
             int fd;
             struct sockaddr_in sa;
    
             fd = socket(AF_INET, SOCK_STREAM, 132 /*IPPROTO_SCTP*/);
             if (fd < 0)
                     return 1;
    
             memset(&sa, 0, sizeof(sa));
             sa.sin_family = AF_INET;
             sa.sin_addr.s_addr = inet_addr("127.0.0.1");
             sa.sin_port = htons(11111);
    
             sendto(fd, NULL, 1, 0, (struct sockaddr *)&sa, sizeof(sa));
    
             return 0;
     }
    
    As far as I can tell, the leak has been around since ~2003.
    
    Signed-off-by: Tommi Rantala <tt.rantala@gmail.com>
    Acked-by: Vlad Yasevich <vyasevich@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/sctp/chunk.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

commit bada097284157101d8aae1e9203846e54cc965c2
Author: Tommi Rantala <tt.rantala@gmail.com>
Date:   Mon Nov 26 04:16:44 2012 +0000

    Upstream commit: c3b2c2581988d304127c2aa218430b5fca88ce56
    
    irda: irttp: fix memory leak in irttp_open_tsap() error path
    
    Cleanup the memory we allocated earlier in irttp_open_tsap() when we hit
    this error path. The leak goes back to at least 1da177e4
    ("Linux-2.6.12-rc2").
    
    Discovered with Trinity (the syscall fuzzer).
    
    Signed-off-by: Tommi Rantala <tt.rantala@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	net/irda/irttp.c

 net/irda/irttp.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 83f67484f9f27e8eb59ffe4cc67793b6868a9049
Author: Schoch Christian <e0326715@student.tuwien.ac.at>
Date:   Wed Nov 28 05:18:29 2012 +0000

    Upstream commit: 92d64c261e77cb2a6117887617e2a629fea6b67c
    
    sctp: Error in calculation of RTTvar
    
    The calculation of RTTVAR involves the subtraction of two unsigned
    numbers which
    may causes rollover and results in very high values of RTTVAR when RTT > SRTT.
    With this patch it is possible to set RTOmin = 1 to get the minimum of RTO at
    4 times the clock granularity.
    
    Change Notes:
    
    v2)
            *Replaced abs() by abs64() and long by __s64, changed patch
    description.
    
    Signed-off-by: Christian Schoch <e0326715@student.tuwien.ac.at>
    CC: Vlad Yasevich <vyasevich@gmail.com>
    CC: Sridhar Samudrala <sri@us.ibm.com>
    CC: Neil Horman <nhorman@tuxdriver.com>
    CC: linux-sctp@vger.kernel.org
    Acked-by: Vlad Yasevich <vyasevich@gmail.com>
    Acked-by: Neil Horman <nhorman@tuxdriver.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	net/sctp/transport.c

 net/sctp/transport.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 92af2c2744a6261a166af0dc16c63a668f8d53c8
Author: Oliver Hartkopp <socketcan@hartkopp.net>
Date:   Mon Nov 26 22:24:23 2012 +0100

    Upstream commit: 81b401100c01d2357031e874689f89bd788d13cd
    
    can: bcm: initialize ifindex for timeouts without previous frame reception
    
    Set in the rx_ifindex to pass the correct interface index in the case of a
    message timeout detection. Usually the rx_ifindex value is set at receive
    time. But when no CAN frame has been received the RX_TIMEOUT notification
    did not contain a valid value.
    
    Cc: linux-stable <stable@vger.kernel.org>
    Reported-by: Andre Naujoks <nautsch2@googlemail.com>
    Signed-off-by: Oliver Hartkopp <socketcan@hartkopp.net>
    Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>

 net/can/bcm.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit 895b3894565b275d979bb72e19620db4a87cc0c6
Merge: f96d263 1edbfa2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 1 11:12:57 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 1edbfa2df985cfc314eadf15d600b2755f0d70bd
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 1 11:12:17 2012 -0500

    Update to pax-linux-2.6.32.60-test208.patch:
    - simplified/synchronized some UDEREF/amd64 logic based on the 3.7 forward port

 arch/x86/include/asm/futex.h      |    2 +-
 arch/x86/include/asm/i387.h       |   18 +++------
 arch/x86/include/asm/uaccess_64.h |   79 +++++-------------------------------
 arch/x86/include/asm/xsave.h      |   20 ++++------
 arch/x86/kernel/dumpstack_32.c    |    2 +-
 arch/x86/kernel/dumpstack_64.c    |    2 +-
 arch/x86/kernel/entry_64.S        |    2 +-
 arch/x86/kernel/process_32.c      |    2 +-
 arch/x86/kernel/xsave.c           |    5 +-
 arch/x86/lib/csum-wrappers_64.c   |   16 +-------
 arch/x86/lib/usercopy_64.c        |   21 +--------
 11 files changed, 37 insertions(+), 132 deletions(-)

commit f96d2631d31abd1bf33cfacf70fecdd07c8ef6db
Author: Darren Hart <dvhart@linux.intel.com>
Date:   Mon Nov 26 16:29:56 2012 -0800

    Upstream commit: aa10990e028cac3d5e255711fb9fb47e00700e35
    
    futex: avoid wake_futex() for a PI futex_q
    
    Dave Jones reported a bug with futex_lock_pi() that his trinity test
    exposed.  Sometime between queue_me() and taking the q.lock_ptr, the
    lock_ptr became NULL, resulting in a crash.
    
    While futex_wake() is careful to not call wake_futex() on futex_q's with
    a pi_state or an rt_waiter (which are either waiting for a
    futex_unlock_pi() or a PI futex_requeue()), futex_wake_op() and
    futex_requeue() do not perform the same test.
    
    Update futex_wake_op() and futex_requeue() to test for q.pi_state and
    q.rt_waiter and abort with -EINVAL if detected.  To ensure any future
    breakage is caught, add a WARN() to wake_futex() if the same condition
    is true.
    
    This fix has seen 3 hours of testing with "trinity -c futex" on an
    x86_64 VM with 4 CPUS.
    
    [akpm@linux-foundation.org: tidy up the WARN()]
    Signed-off-by: Darren Hart <dvhart@linux.intel.com>
    Reported-by: Dave Jones <davej@redat.com>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ingo Molnar <mingo@elte.hu>
    Cc: John Kacur <jkacur@redhat.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 kernel/futex.c |   18 +++++++++++++++++-
 1 files changed, 17 insertions(+), 1 deletions(-)

commit 8f39088ba3c9b2227e90b7d478a63c0f07118bbd
Merge: 6490692 9ee3f3d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Nov 27 17:08:19 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 9ee3f3d48949c9f908d11dcbb4c996492b6465da
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Nov 27 17:08:03 2012 -0500

    Update to pax-linux-2.6.32.60-test207.patch:
    - fix undefined symbol in modules problem introduced by the previous latent entropy related change

 include/linux/init.h |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

commit 6490692bef4ed3e7aae862921812189a463cf26b
Merge: ab76e8e 63cc150
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Nov 26 17:13:41 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 63cc150c46149f4416f8662dbe2b6ca392080e33
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Nov 26 17:12:59 2012 -0500

    Update to pax-linux-2.6.32.60-test206.patch:
    - fix compilation error, thanks to cilly for reporting it

 fs/exec.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit ab76e8ef09470c256b15840d6a9eb4ef5a3ff807
Merge: d7f4422 a3552b2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Nov 25 18:58:54 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit a3552b2d7058c4fae3c159dd146e4ee2532eaa8b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Nov 25 18:58:13 2012 -0500

    Update to pax-linux-2.6.32.60-test205.patch:
    - fixed the kernexec plugin to handle a new gcc 4.7 pattern, previously (simple) return insns weren't instrumented
    - changed the latent entropy to not instrument hotplug related init functions that stick around after boot

 fs/exec.c                   |    2 +-
 include/linux/init.h        |   30 ++++++++++++++++++++++++------
 lib/list_debug.c            |    5 ++++-
 tools/gcc/kernexec_plugin.c |    7 ++++++-
 4 files changed, 35 insertions(+), 9 deletions(-)

commit d7f4422ab9dc2b6dde870b73a90ee579a24ff42f
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Wed Nov 21 19:27:23 2012 +0000

    Upstream commit: 441a179dafc0f99fc8b3a8268eef66958621082e
    (real nice enterprise-quality code there, Lou)
    
    [PARISC] fix user-triggerable panic on parisc
    
    int sys32_rt_sigprocmask(int how, compat_sigset_t __user *set, compat_sigset_t __user *oset,
                                        unsigned int sigsetsize)
    {
            sigset_t old_set, new_set;
            int ret;
    
            if (set && get_sigset32(set, &new_set, sigsetsize))
    
    ...
    static int
    get_sigset32(compat_sigset_t __user *up, sigset_t *set, size_t sz)
    {
            compat_sigset_t s;
            int r;
    
            if (sz != sizeof *set) panic("put_sigset32()");
    
    In other words, rt_sigprocmask(69, (void *)69, 69) done by 32bit process
    will promptly panic the box.
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: James Bottomley <JBottomley@Parallels.com>

 arch/parisc/kernel/signal32.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

commit 7e96752bc5250d92c8ecc1a4901c75edde69bd5a
Author: Thomas Gleixner <tglx@linutronix.de>
Date:   Tue Oct 23 22:29:38 2012 +0200

    Upstream commit: 59fa6245192159ab5e1e17b8e31f15afa9cff4bf
    
    futex: Handle futex_pi OWNER_DIED take over correctly
    
    Siddhesh analyzed a failure in the take over of pi futexes in case the
    owner died and provided a workaround.
    See: http://sourceware.org/bugzilla/show_bug.cgi?id=14076
    
    The detailed problem analysis shows:
    
    Futex F is initialized with PTHREAD_PRIO_INHERIT and
    PTHREAD_MUTEX_ROBUST_NP attributes.
    
    T1 lock_futex_pi(F);
    
    T2 lock_futex_pi(F);
       --> T2 blocks on the futex and creates pi_state which is associated
           to T1.
    
    T1 exits
       --> exit_robust_list() runs
           --> Futex F userspace value TID field is set to 0 and
               FUTEX_OWNER_DIED bit is set.
    
    T3 lock_futex_pi(F);
       --> Succeeds due to the check for F's userspace TID field == 0
       --> Claims ownership of the futex and sets its own TID into the
           userspace TID field of futex F
       --> returns to user space
    
    T1 --> exit_pi_state_list()
           --> Transfers pi_state to waiter T2 and wakes T2 via
           	   rt_mutex_unlock(&pi_state->mutex)
    
    T2 --> acquires pi_state->mutex and gains real ownership of the
           pi_state
       --> Claims ownership of the futex and sets its own TID into the
           userspace TID field of futex F
       --> returns to user space
    
    T3 --> observes inconsistent state
    
    This problem is independent of UP/SMP, preemptible/non preemptible
    kernels, or process shared vs. private. The only difference is that
    certain configurations are more likely to expose it.
    
    So as Siddhesh correctly analyzed the following check in
    futex_lock_pi_atomic() is the culprit:
    
    	if (unlikely(ownerdied || !(curval & FUTEX_TID_MASK))) {
    
    We check the userspace value for a TID value of 0 and take over the
    futex unconditionally if that's true.
    
    AFAICT this check is there as it is correct for a different corner
    case of futexes: the WAITERS bit became stale.
    
    Now the proposed change
    
    -	if (unlikely(ownerdied || !(curval & FUTEX_TID_MASK))) {
    +       if (unlikely(ownerdied ||
    +                       !(curval & (FUTEX_TID_MASK | FUTEX_WAITERS)))) {
    
    solves the problem, but it's not obvious why and it wreckages the
    "stale WAITERS bit" case.
    
    What happens is, that due to the WAITERS bit being set (T2 is blocked
    on that futex) it enforces T3 to go through lookup_pi_state(), which
    in the above case returns an existing pi_state and therefor forces T3
    to legitimately fight with T2 over the ownership of the pi_state (via
    pi_state->mutex). Probelm solved!
    
    Though that does not work for the "WAITERS bit is stale" problem
    because if lookup_pi_state() does not find existing pi_state it
    returns -ERSCH (due to TID == 0) which causes futex_lock_pi() to
    return -ESRCH to user space because the OWNER_DIED bit is not set.
    
    Now there is a different solution to that problem. Do not look at the
    user space value at all and enforce a lookup of possibly available
    pi_state. If pi_state can be found, then the new incoming locker T3
    blocks on that pi_state and legitimately races with T2 to acquire the
    rt_mutex and the pi_state and therefor the proper ownership of the
    user space futex.
    
    lookup_pi_state() has the correct order of checks. It first tries to
    find a pi_state associated with the user space futex and only if that
    fails it checks for futex TID value = 0. If no pi_state is available
    nothing can create new state at that point because this happens with
    the hash bucket lock held.
    
    So the above scenario changes to:
    
    T1 lock_futex_pi(F);
    
    T2 lock_futex_pi(F);
       --> T2 blocks on the futex and creates pi_state which is associated
           to T1.
    
    T1 exits
       --> exit_robust_list() runs
           --> Futex F userspace value TID field is set to 0 and
               FUTEX_OWNER_DIED bit is set.
    
    T3 lock_futex_pi(F);
       --> Finds pi_state and blocks on pi_state->rt_mutex
    
    T1 --> exit_pi_state_list()
           --> Transfers pi_state to waiter T2 and wakes it via
           	   rt_mutex_unlock(&pi_state->mutex)
    
    T2 --> acquires pi_state->mutex and gains ownership of the pi_state
       --> Claims ownership of the futex and sets its own TID into the
           userspace TID field of futex F
       --> returns to user space
    
    This covers all gazillion points on which T3 might come in between
    T1's exit_robust_list() clearing the TID field and T2 fixing it up. It
    also solves the "WAITERS bit stale" problem by forcing the take over.
    
    Another benefit of changing the code this way is that it makes it less
    dependent on untrusted user space values and therefor minimizes the
    possible wreckage which might be inflicted.
    
    As usual after staring for too long at the futex code my brain hurts
    so much that I really want to ditch that whole optimization of
    avoiding the syscall for the non contended case for PI futexes and rip
    out the maze of corner case handling code. Unfortunately we can't as
    user space relies on that existing behaviour, but at least thinking
    about it helps me to preserve my mental sanity. Maybe we should
    nevertheless :)
    
    Reported-and-tested-by: Siddhesh Poyarekar <siddhesh.poyarekar@gmail.com>
    Link: http://lkml.kernel.org/r/alpine.LFD.2.02.1210232138540.2756@ionos
    Acked-by: Darren Hart <dvhart@linux.intel.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    
    Conflicts:
    
    	kernel/futex.c

 kernel/futex.c |   49 ++++++++++++++++++++++++++-----------------------
 1 files changed, 26 insertions(+), 23 deletions(-)

commit e3fa34b503f7b0c53a838a88fb7df1dbfd470f20
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Nov 20 17:30:58 2012 -0500

    remove unneeded extern grsec_exec_file_lock

 kernel/exit.c |    4 ----
 1 files changed, 0 insertions(+), 4 deletions(-)

commit c38fba707bdccb180deffc4f1c615a8859e3fffe
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Nov 20 17:27:16 2012 -0500

    Resolve increasing /proc/sys/fs/file-nr reported by 'rha' on the forums
    current->exec_file leaked its reference counter in some cases

 fs/fs_struct.c              |    4 ++++
 grsecurity/gracl.c          |   16 ++++++++++++++++
 grsecurity/grsec_disabled.c |    5 +++++
 include/linux/grsecurity.h  |    1 +
 kernel/exit.c               |    9 ---------
 5 files changed, 26 insertions(+), 9 deletions(-)

commit 3e00422299a45268ffd8de5e2853483ef1979afa
Merge: a1489f5 1ed6282
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Nov 18 10:57:17 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 1ed62822f1cfb0a3953da349701f8cc8977a670d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Nov 18 10:56:05 2012 -0500

    Update to pax-linux-2.6.32.60-test204.patch:
    - updated size_overflow plugin from Emese, fixes another false positive reported by Szymon Juraszczyk
    - compiler crash fix from Emese for compiling with the size_overflow plugin for 32 bit archs
    - user.pax.flags checks became more strict to prevent duplicate flags
    - some cleanups here and there

 arch/x86/kernel/entry_64.S       |    7 --
 fs/binfmt_elf.c                  |    6 +-
 lib/list_debug.c                 |   18 ++--
 mm/vmalloc.c                     |   19 ++--
 tools/gcc/size_overflow_plugin.c |  184 +++++++++++++++++--------------------
 5 files changed, 109 insertions(+), 125 deletions(-)

commit a1489f5475481bae84711cd6d11d3e1052a398fd
Author: Takamori Yamaguchi <takamori.yamaguchi@jp.sony.com>
Date:   Thu Nov 8 15:53:39 2012 -0800

    Upstream commit: b0a8cc58e6b9aaae3045752059e5e6260c0b94bc
    
    mm: bugfix: set current->reclaim_state to NULL while returning from kswapd()
    
    In kswapd(), set current->reclaim_state to NULL before returning, as
    current->reclaim_state holds reference to variable on kswapd()'s stack.
    
    In rare cases, while returning from kswapd() during memory offlining,
    __free_slab() and freepages() can access the dangling pointer of
    current->reclaim_state.
    
    Signed-off-by: Takamori Yamaguchi <takamori.yamaguchi@jp.sony.com>
    Signed-off-by: Aaditya Kumar <aaditya.kumar@ap.sony.com>
    Acked-by: David Rientjes <rientjes@google.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/vmscan.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 779758d996ee08df5ee1037a6b77944fbd2cd1fe
Author: Jussi Kivilinna <jussi.kivilinna@mbnet.fi>
Date:   Sun Oct 21 20:42:28 2012 +0300

    Upstream commit: 9efade1b3e981f5064f9db9ca971b4dc7557ae42
    
    crypto: cryptd - disable softirqs in cryptd_queue_worker to prevent data corruption
    
    cryptd_queue_worker attempts to prevent simultaneous accesses to crypto
    workqueue by cryptd_enqueue_request using preempt_disable/preempt_enable.
    However cryptd_enqueue_request might be called from softirq context,
    so add local_bh_disable/local_bh_enable to prevent data corruption and
    panics.
    
    Bug report at http://marc.info/?l=linux-crypto-vger&m=134858649616319&w=2
    
    v2:
     - Disable software interrupts instead of hardware interrupts
    
    Cc: stable@vger.kernel.org
    Reported-by: Gurucharan Shetty <gurucharan.shetty@gmail.com>
    Signed-off-by: Jussi Kivilinna <jussi.kivilinna@mbnet.fi>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

 crypto/cryptd.c |   11 ++++++++---
 1 files changed, 8 insertions(+), 3 deletions(-)

commit 1c552b25695b033c38e277cc97bd87a14975a0bd
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Nov 12 22:10:20 2012 -0500

    remove whitespace in gradm_mt_init/exit

 net/netfilter/xt_gradm.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

commit c3a89b5063487f616f499985acec9d8ced20af80
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Nov 12 22:08:50 2012 -0500

    change strlen("conststring") to sizeof("conststring") - 1 as suggested by pipacs

 kernel/module.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 2baa9d5f47375047657c858b3de209f885df2213
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Nov 12 21:33:37 2012 -0500

    Fix an issue with nested subjects reported by Mark Moseley
    
    If a nested subject exists for which there are more than one objects
    that can match it (a directory nested subject can make this possible)
    then since the recent patch that fixed policy recreation for nested
    subjects, a cycle can be introduced in the nested subject list for a role,
    causing infinite loops under a lock on policy recreation events or
    RBAC disabling/reloading.
    
    Only add the nested subject to the list if it was the first time we've
    seen it, to eliminate duplicates and inadvertent cycles.

 grsecurity/gracl.c |   29 ++++++++++++++++++++---------
 1 files changed, 20 insertions(+), 9 deletions(-)

commit cda0cd6dbe7f742b5cae10b0e5f69cd45d548670
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Nov 7 19:29:37 2012 -0500

    include tboot.h

 arch/x86/mm/init.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 842d47f93c155f95bc37abf58e3dbca10e6bd3e7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Nov 7 19:06:11 2012 -0500

    Allow access to tboot serial log when in use, reported by Zaolin on forums
    
    Conflicts:
    
    	arch/x86/mm/init.c

 arch/x86/mm/init.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

commit 3f507b455817e20e3bc490209b631b02369d68d2
Author: Peter Senna Tschudin <peter.senna@gmail.com>
Date:   Sun Oct 28 06:12:01 2012 +0000

    Upstream commit: aa731872f7d33dcb8b54dad0cfb82d4e4d195d7e
    
    drivers/net/phy/mdio-bitbang.c: Call mdiobus_unregister before mdiobus_free
    
    Based on commit b27393aecf66199f5ddad37c302d3e0cfadbe6c0
    
    Calling mdiobus_free without calling mdiobus_unregister causes
    BUG_ON(). This patch fixes the issue.
    
    The semantic patch that found this issue(http://coccinelle.lip6.fr/):
    // <smpl>
    @@
    expression E;
    @@
      ... when != mdiobus_unregister(E);
    
    + mdiobus_unregister(E);
      mdiobus_free(E);
    // </smpl>
    
    Signed-off-by: Peter Senna Tschudin <peter.senna@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/phy/mdio-bitbang.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit ae60ee5c8116b513128f26d9f920569d837a39c9
Author: Jesper Dangaard Brouer <brouer@redhat.com>
Date:   Wed Oct 31 02:45:32 2012 +0000

    Upstream commit: 8f363b77ee4fbf7c3bbcf5ec2c5ca482d396d664
    
    net: fix divide by zero in tcp algorithm illinois
    
    Reading TCP stats when using TCP Illinois congestion control algorithm
    can cause a divide by zero kernel oops.
    
    The division by zero occur in tcp_illinois_info() at:
     do_div(t, ca->cnt_rtt);
    where ca->cnt_rtt can become zero (when rtt_reset is called)
    
    Steps to Reproduce:
     1. Register tcp_illinois:
         # sysctl -w net.ipv4.tcp_congestion_control=illinois
     2. Monitor internal TCP information via command "ss -i"
         # watch -d ss -i
     3. Establish new TCP conn to machine
    
    Either it fails at the initial conn, or else it needs to wait
    for a loss or a reset.
    
    This is only related to reading stats.  The function avg_delay() also
    performs the same divide, but is guarded with a (ca->cnt_rtt > 0) at its
    calling point in update_params().  Thus, simply fix tcp_illinois_info().
    
    Function tcp_illinois_info() / get_info() is called without
    socket lock.  Thus, eliminate any race condition on ca->cnt_rtt
    by using a local stack variable.  Simply reuse info.tcpv_rttcnt,
    as its already set to ca->cnt_rtt.
    Function avg_delay() is not affected by this race condition, as
    its called with the socket lock.
    
    Cc: Petr Matousek <pmatouse@redhat.com>
    Signed-off-by: Jesper Dangaard Brouer <brouer@redhat.com>
    Acked-by: Eric Dumazet <edumazet@google.com>
    Acked-by: Stephen Hemminger <shemminger@vyatta.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/tcp_illinois.c |    8 +++++---
 1 files changed, 5 insertions(+), 3 deletions(-)

commit d5381366b31ce1cdb457a172df946ad1d572464d
Author: Andrew Morton <akpm@linux-foundation.org>
Date:   Tue Oct 23 14:09:39 2012 -0700

    Upstream commit: 168bfeef7bba3f9784f7540b053e4ac72b769ce9
    
    amd64_edac:__amd64_set_scrub_rate(): avoid overindexing scrubrates[]
    
    If none of the elements in scrubrates[] matches, this loop will cause
    __amd64_set_scrub_rate() to incorrectly use the n+1th element.
    
    As the function is designed to use the final scrubrates[] element in the
    case of no match, we can fix this bug by simply terminating the array
    search at the n-1th element.
    
    Boris: this code is fragile anyway, see here why:
    http://marc.info/?l=linux-kernel&m=135102834131236&w=2
    
    It will be rewritten more robustly soonish.
    
    Reported-by: Denis Kirjanov <kirjanov@gmail.com>
    Cc: stable@vger.kernel.org
    Cc: Doug Thompson <dougthompson@xmission.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Borislav Petkov <borislav.petkov@amd.com>

 drivers/edac/amd64_edac.c |   11 ++++-------
 1 files changed, 4 insertions(+), 7 deletions(-)

commit cb767ddbfccb2b9b8b3bcd6c97dc5b7ee5aa2c02
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Oct 31 08:14:55 2012 -0400

    Fix bad merge on my part resulting in NULL deref with the following oops reported on the forums by rocknob:
    BUG: unable to handle kernel NULL pointer dereference at 0000000c
    IP: [<c1054d19>] sys_clock_gettime+0x39/0x140
    *pdpt = 0000000029855001 *pde = 0000000000000000
    Oops: 0000 [#1] SMP
    last sysfs file: /sys/devices/system/cpu/cpu7/cpufreq/stats/time_in_state
    Modules linked in: ip6t_rt ip6t_LOG nf_conntrack_ipv6 ip6t_REJECT ip6table_raw ip6table_filter ip6_tables i2c_dev ipt_LOG xt_limit nf_conntrack_ipv4 nf_defrag_ipv4 xt_state xt_multiport xt_NOTRACK iptable_raw ipt_REJECT iptable_filter nf_conntrack_ftp nf_conntrack e1000e usbcore ipv6
    
    Pid: 7528, comm: node Not tainted (2.6.32.59-ohne-grsec #2) To be filled by O.E.M.
    EIP: 0060:[<c1054d19>] EFLAGS: 00010246 CPU: 0
    EIP is at sys_clock_gettime+0x39/0x140
    EAX: 00000007 EBX: 00000007 ECX: bff19708 EDX: 00000000
    ESI: 00000007 EDI: bff19708 EBP: e7857fac ESP: e7857f90
    DS: 007b ES: 007b FS: 00d8 GS: 0033 SS: 0068
    Process node (pid: 7528, ti=e9692d1c task=e9692a80 task.ti=e9692d1c)
    Stack:
    e7857fb4 e7a585bc e9692a80 e7a58588 00000007 00000007 bff19708 e9692d1c
    <0> c10032a5 00000007 bff19708 41425ff4 00000007 bff19708 bff196e8 00000109
    <0> 0000007b ffff007b c1000000 00000000 00000109 414227e8 00000073 00000246
    Call Trace:
    [<c10032a5>] ? syscall_call+0x7/0xb
    Code: f8 89 7d fc 85 c0 0f 88 f6 00 00 00 83 f8 0f 0f 87 d5 00 00 00 8b 14 85 00 76 65 c1 85 d2 74 0b 8b 7a 04 85 ff 0f 84 af 00 00 00 <8b> 4a 0c 85 c9 0f 84 e4 00 00 00 8d 7d ec 89 fa ff d1 89 c3 85
    EIP: [<c1054d19>] sys_clock_gettime+0x39/0x140 SS:ESP 0068:e7857f90
    CR2: 000000000000000c
    ---[ end trace e6395fcedc83fa95 ]---

 kernel/posix-timers.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit e2ef6b5de87995e779e9ef832fd6a4b96ed2427f
Merge: 23740c9 6bfb000
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Oct 29 13:51:45 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 6bfb000209f371250dc864db8372c6cbc45e6ff7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Oct 29 13:51:28 2012 -0400

    Update to pax-linux-2.6.32.60-test203.patch:
    - got rid of useless parameter in load_elf_interp
    - changed the limit of KERNEXEC's alternative code segment, thanks to 'rbrk ss' for asking about it :)

 arch/x86/kernel/head_32.S |   28 +++++++++++++++-------------
 arch/x86/mm/init.c        |    1 +
 fs/binfmt_elf.c           |    8 +-------
 3 files changed, 17 insertions(+), 20 deletions(-)

commit 23740c9bef1ba507ce36f1f8281de3d29436c0c8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Oct 25 19:02:51 2012 -0400

    Make backported cciss driver compatible with const plugin (point to read-only fptr structure
    instead of copying it) and add its allocators to the size overflow hash table

 drivers/block/cciss.c             |   28 ++++++++++++++--------------
 drivers/block/cciss.h             |    2 +-
 tools/gcc/size_overflow_hash.data |    1 +
 3 files changed, 16 insertions(+), 15 deletions(-)

commit ee31e937b082b367b321bcd2402dc30c9949aa2f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Oct 25 18:24:11 2012 -0400

    Update cciss driver, thanks to Andre Ferraz
    Re-apply security fix (for filtered ioctl access) against updated cciss
    driver with commit id: edb680c4c184ee6001b68d3dd89eb1729f4e884e

 drivers/block/cciss.c               | 4148 ++++++++++++++++++++---------------
 drivers/block/cciss.h               |  278 ++-
 drivers/block/cciss_cmd.h           |  233 +--
 drivers/block/cciss_kernel_compat.h |  128 ++
 drivers/block/cciss_scsi.c          |  962 +++++----
 drivers/block/cciss_scsi.h          |   32 +-
 include/linux/Kbuild                |    1 +
 include/linux/cciss_defs.h          |  130 ++
 include/linux/cciss_ioctl.h         |  136 +--
 9 files changed, 3492 insertions(+), 2556 deletions(-)

commit 0823651fedbd8e7eea1fc51022ef77c41fd08f9f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Oct 24 17:21:16 2012 -0400

    Fix compilation from last backport

 grsecurity/gracl.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit b868732b727b16e47cfcfca2c5cf7aacc86e4361
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 23 19:29:11 2012 -0400

    Add second half of fix for slashbeast's problem with policy recreation
    in nested subjects: the list of nested subjects was being cleared for each
    role, not allowing for the processing of nested subjects on
    create/delete/rename.  Added a comment explaining the reason for the change.

 grsecurity/gracl.c |   16 ++++++++++++----
 1 files changed, 12 insertions(+), 4 deletions(-)

commit 536734f6fccafe8e27aaeb48694eae43673888d6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 23 14:40:19 2012 -0400

    Fix policy recreation on objects in nested subjects, reported by slashbeast

 grsecurity/gracl.c |    8 ++++++--
 1 files changed, 6 insertions(+), 2 deletions(-)

commit 2c0c03b3908869767f210363badf2f391e4d5213
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Oct 12 18:13:12 2012 -0400

    Additional fixes for harmless stack traces reported by HIDESYM as seq_files
    are handled generically

 kernel/cgroup.c           |    2 +-
 kernel/kprobes.c          |    4 ++--
 kernel/lockdep_proc.c     |   10 +++++-----
 kernel/time/timer_stats.c |    2 +-
 4 files changed, 9 insertions(+), 9 deletions(-)

commit 4315138bf2028369a1c986d39df1a8509a93a2fe
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Oct 11 17:57:57 2012 -0400

    Don't treat pivot_root as a chroot, fixes some issues with RHEL6 initrd
    causing tty1 console problems due to denied capability usage.  Both the
    chroot capability restrictions and separate chroot feature prevent pivot_root
    from being used inside a chroot already.

 fs/fs_struct.c |    8 +++++++-
 kernel/fork.c  |    8 +++++++-
 2 files changed, 14 insertions(+), 2 deletions(-)

commit 8b7cab89ee58b24fc6fa4d4d58f2616b195704ee
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Oct 11 17:17:10 2012 -0400

    Backport fix for harmless informational stack dump generated by HIDESYM, as
    we generically handle all seq_file output

 net/core/dev.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

commit bae1a147d0f8e6d86a419f6b46434b545f82543c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 9 17:21:58 2012 -0400

    Fix a bad git merge (duplicated an existing function)

 drivers/char/random.c |   19 -------------------
 1 files changed, 0 insertions(+), 19 deletions(-)

commit 737d1f0402d53f8751320511b0712bf8e4e4ae00
Merge: d0f67c6 83dd571
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 9 17:13:29 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 83dd5716ad6b3e773f4c2e7dfa0d0b9bb027783e
Merge: 883eacb 3ed9fdb7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 9 16:49:49 2012 -0400

    Update to pax-linux-2.6.32.60-test202.patch
    
    Merge branch 'linux-2.6.32.y' into pax-stable
    
    Conflicts:
    	arch/x86/mm/fault.c
    	arch/x86/mm/pgtable.c
    	drivers/char/random.c
    	include/linux/random.h

commit d0f67c6a9a5bacd89e627d931e34526593ceda41
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Oct 7 17:01:36 2012 -0400

    Add missing #include to proc_net.c, reported by neoice

 fs/proc/proc_net.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 2bfb7795b999a382f99ae4529ebfbdfe289330dd
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Oct 7 08:25:55 2012 -0400

    Fixes to recent grsec_proc_gid from Mathias Krause

 init/main.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit e62688cfd4765229405998f83515c7e7e7b40008
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Oct 6 16:32:23 2012 -0400

    Allow GRKERNSEC_PROC_GID to be chosen at boot time via grsec_proc_gid= on the kernel commandline.

 Documentation/kernel-parameters.txt |    3 +++
 fs/proc/base.c                      |   12 ++++++------
 fs/proc/inode.c                     |    2 +-
 fs/proc/proc_net.c                  |    2 +-
 grsecurity/Kconfig                  |    3 ++-
 grsecurity/gracl.c                  |    2 +-
 include/linux/grsecurity.h          |    5 +++++
 init/main.c                         |    9 +++++++++
 security/Kconfig                    |    3 ++-
 9 files changed, 30 insertions(+), 11 deletions(-)

commit 57314ce0566160ed336f09dacb08f494818893a1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Oct 6 16:06:57 2012 -0400

    Set type for GRKERNSEC_TPE_GID in Kconfig

 grsecurity/Kconfig |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 101e90cc714a5b914ea8ec4565fe8924ce4cd6d9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Oct 6 16:02:00 2012 -0400

    Improve automatic configuration of TPE, make option labels involved
    more descriptive (and change in the event of TPE inversion)

 grsecurity/Kconfig |   10 +++++++---
 security/Kconfig   |   22 ++++++++++++++++------
 2 files changed, 23 insertions(+), 9 deletions(-)

commit e58bef70f4cd8d1e9defe3164f0f780342a514b2
Author: Hugh Dickins <hughd@google.com>
Date:   Thu Aug 23 12:17:36 2012 +0200

    block: replace __getblk_slow misfix by grow_dev_page fix
    
    commit 676ce6d5ca3098339c028d44fe0427d1566a4d2d upstream.
    
    Commit 91f68c89d8f3 ("block: fix infinite loop in __getblk_slow")
    is not good: a successful call to grow_buffers() cannot guarantee
    that the page won't be reclaimed before the immediate next call to
    __find_get_block(), which is why there was always a loop there.
    
    Yesterday I got "EXT4-fs error (device loop0): __ext4_get_inode_loc:3595:
    inode #19278: block 664: comm cc1: unable to read itable block" on console,
    which pointed to this commit.
    
    I've been trying to bisect for weeks, why kbuild-on-ext4-on-loop-on-tmpfs
    sometimes fails from a missing header file, under memory pressure on
    ppc G5.  I've never seen this on x86, and I've never seen it on 3.5-rc7
    itself, despite that commit being in there: bisection pointed to an
    irrelevant pinctrl merge, but hard to tell when failure takes between
    18 minutes and 38 hours (but so far it's happened quicker on 3.6-rc2).
    
    (I've since found such __ext4_get_inode_loc errors in /var/log/messages
    from previous weeks: why the message never appeared on console until
    yesterday morning is a mystery for another day.)
    
    Revert 91f68c89d8f3, restoring __getblk_slow() to how it was (plus
    a checkpatch nitfix).  Simplify the interface between grow_buffers()
    and grow_dev_page(), and avoid the infinite loop beyond end of device
    by instead checking init_page_buffers()'s end_block there (I presume
    that's more efficient than a repeated call to blkdev_max_block()),
    returning -ENXIO to __getblk_slow() in that case.
    
    And remove akpm's ten-year-old "__getblk() cannot fail ... weird"
    comment, but that is worrying: are all users of __getblk() really
    now prepared for a NULL bh beyond end of device, or will some oops??
    
    Signed-off-by: Hugh Dickins <hughd@google.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

 fs/buffer.c |   66 ++++++++++++++++++++++++++--------------------------------
 1 files changed, 30 insertions(+), 36 deletions(-)

commit 54659f9f0b3501ac5a1dc4e25cdc88954e84c4c4
Author: Jeff Moyer <jmoyer@redhat.com>
Date:   Thu Jul 12 09:43:14 2012 -0400

    block: fix infinite loop in __getblk_slow
    
    commit 91f68c89d8f35fe98ea04159b9a3b42d0149478f upstream.
    
    Commit 080399aaaf35 ("block: don't mark buffers beyond end of disk as
    mapped") exposed a bug in __getblk_slow that causes mount to hang as it
    loops infinitely waiting for a buffer that lies beyond the end of the
    disk to become uptodate.
    
    The problem was initially reported by Torsten Hilbrich here:
    
        https://lkml.org/lkml/2012/6/18/54
    
    and also reported independently here:
    
        http://www.sysresccd.org/forums/viewtopic.php?f=13&t=4511
    
    and then Richard W.M.  Jones and Marcos Mello noted a few separate
    bugzillas also associated with the same issue.  This patch has been
    confirmed to fix:
    
        https://bugzilla.redhat.com/show_bug.cgi?id=835019
    
    The main problem is here, in __getblk_slow:
    
            for (;;) {
                    struct buffer_head * bh;
                    int ret;
    
                    bh = __find_get_block(bdev, block, size);
                    if (bh)
                            return bh;
    
                    ret = grow_buffers(bdev, block, size);
                    if (ret < 0)
                            return NULL;
                    if (ret == 0)
                            free_more_memory();
            }
    
    __find_get_block does not find the block, since it will not be marked as
    mapped, and so grow_buffers is called to fill in the buffers for the
    associated page.  I believe the for (;;) loop is there primarily to
    retry in the case of memory pressure keeping grow_buffers from
    succeeding.  However, we also continue to loop for other cases, like the
    block lying beond the end of the disk.  So, the fix I came up with is to
    only loop when grow_buffers fails due to memory allocation issues
    (return value of 0).
    
    The attached patch was tested by myself, Torsten, and Rich, and was
    found to resolve the problem in call cases.
    
    Signed-off-by: Jeff Moyer <jmoyer@redhat.com>
    Reported-and-Tested-by: Torsten Hilbrich <torsten.hilbrich@secunet.com>
    Tested-by: Richard W.M. Jones <rjones@redhat.com>
    Reviewed-by: Josh Boyer <jwboyer@redhat.com>
    [ Jens is on vacation, taking this directly  - Linus ]
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

 fs/buffer.c |   22 +++++++++++++---------
 1 files changed, 13 insertions(+), 9 deletions(-)

commit dd77ea24eaa3f8463445c7350ae05b68fba6328d
Author: Jeff Moyer <jmoyer@redhat.com>
Date:   Fri May 11 16:34:10 2012 +0200

    block: don't mark buffers beyond end of disk as mapped
    
    commit 080399aaaf3531f5b8761ec0ac30ff98891e8686 upstream.
    
    Hi,
    
    We have a bug report open where a squashfs image mounted on ppc64 would
    exhibit errors due to trying to read beyond the end of the disk.  It can
    easily be reproduced by doing the following:
    
    [root@ibm-p750e-02-lp3 ~]# ls -l install.img
    -rw-r--r-- 1 root root 142032896 Apr 30 16:46 install.img
    [root@ibm-p750e-02-lp3 ~]# mount -o loop ./install.img /mnt/test
    [root@ibm-p750e-02-lp3 ~]# dd if=/dev/loop0 of=/dev/null
    dd: reading `/dev/loop0': Input/output error
    277376+0 records in
    277376+0 records out
    142016512 bytes (142 MB) copied, 0.9465 s, 150 MB/s
    
    In dmesg, you'll find the following:
    
    squashfs: version 4.0 (2009/01/31) Phillip Lougher
    [   43.106012] attempt to access beyond end of device
    [   43.106029] loop0: rw=0, want=277410, limit=277408
    [   43.106039] Buffer I/O error on device loop0, logical block 138704
    [   43.106053] attempt to access beyond end of device
    [   43.106057] loop0: rw=0, want=277412, limit=277408
    [   43.106061] Buffer I/O error on device loop0, logical block 138705
    [   43.106066] attempt to access beyond end of device
    [   43.106070] loop0: rw=0, want=277414, limit=277408
    [   43.106073] Buffer I/O error on device loop0, logical block 138706
    [   43.106078] attempt to access beyond end of device
    [   43.106081] loop0: rw=0, want=277416, limit=277408
    [   43.106085] Buffer I/O error on device loop0, logical block 138707
    [   43.106089] attempt to access beyond end of device
    [   43.106093] loop0: rw=0, want=277418, limit=277408
    [   43.106096] Buffer I/O error on device loop0, logical block 138708
    [   43.106101] attempt to access beyond end of device
    [   43.106104] loop0: rw=0, want=277420, limit=277408
    [   43.106108] Buffer I/O error on device loop0, logical block 138709
    [   43.106112] attempt to access beyond end of device
    [   43.106116] loop0: rw=0, want=277422, limit=277408
    [   43.106120] Buffer I/O error on device loop0, logical block 138710
    [   43.106124] attempt to access beyond end of device
    [   43.106128] loop0: rw=0, want=277424, limit=277408
    [   43.106131] Buffer I/O error on device loop0, logical block 138711
    [   43.106135] attempt to access beyond end of device
    [   43.106139] loop0: rw=0, want=277426, limit=277408
    [   43.106143] Buffer I/O error on device loop0, logical block 138712
    [   43.106147] attempt to access beyond end of device
    [   43.106151] loop0: rw=0, want=277428, limit=277408
    [   43.106154] Buffer I/O error on device loop0, logical block 138713
    [   43.106158] attempt to access beyond end of device
    [   43.106162] loop0: rw=0, want=277430, limit=277408
    [   43.106166] attempt to access beyond end of device
    [   43.106169] loop0: rw=0, want=277432, limit=277408
    ...
    [   43.106307] attempt to access beyond end of device
    [   43.106311] loop0: rw=0, want=277470, limit=2774
    
    Squashfs manages to read in the end block(s) of the disk during the
    mount operation.  Then, when dd reads the block device, it leads to
    block_read_full_page being called with buffers that are beyond end of
    disk, but are marked as mapped.  Thus, it would end up submitting read
    I/O against them, resulting in the errors mentioned above.  I fixed the
    problem by modifying init_page_buffers to only set the buffer mapped if
    it fell inside of i_size.
    
    Cheers,
    Jeff
    
    Signed-off-by: Jeff Moyer <jmoyer@redhat.com>
    Acked-by: Nick Piggin <npiggin@kernel.dk>
    
    --
    
    Changes from v1->v2: re-used max_block, as suggested by Nick Piggin.
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    
    Conflicts:
    
    	fs/block_dev.c

 fs/block_dev.c     |    6 +++---
 fs/buffer.c        |    4 +++-
 include/linux/fs.h |    1 +
 3 files changed, 7 insertions(+), 4 deletions(-)

commit ff3bd5c294689c5b9d07f92fb3a7a227e757a53a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 2 19:31:59 2012 -0400

    Revert "block: fix infinite loop in __getblk_slow"
    
    This reverts commit 073a62d0bbe2e0c71d77efa3b0f6742137edd2d0.

 fs/buffer.c |   22 +++++++++-------------
 1 files changed, 9 insertions(+), 13 deletions(-)

commit c0882a8e14506df22711a2a0c1c03d2943adbf3f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 2 19:31:45 2012 -0400

    Revert "Upstream commit: 676ce6d5ca3098339c028d44fe0427d1566a4d2d"
    
    This reverts commit f9ea1d103d6527ab327acd1c97801d4f2082029b.

 fs/buffer.c |   66 ++++++++++++++++++++++++++++++++--------------------------
 1 files changed, 36 insertions(+), 30 deletions(-)

commit c1cf22500ffa1bdce5d2fbb59224da29a7310602
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 2 19:31:26 2012 -0400

    Revert "Upstream commit: 4f2ab0adb6a14e0a265aeb724a1d681793621c94"
    
    This reverts commit 06fff0cb88af9f40a4ab3248762cd9dd40bd6859.

 fs/block_dev.c     |    6 +++---
 fs/buffer.c        |    4 +---
 include/linux/fs.h |    1 -
 3 files changed, 4 insertions(+), 7 deletions(-)

commit cfa5e6da785beac1d9eef48b28fbf83884ff25f4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 2 18:56:21 2012 -0400

    Compile fix for epoll backport

 kernel/fork.c |    3 ---
 1 files changed, 0 insertions(+), 3 deletions(-)

commit 06fff0cb88af9f40a4ab3248762cd9dd40bd6859
Author: Jeff Moyer <jmoyer@redhat.com>
Date:   Fri May 11 16:34:10 2012 +0200

    Upstream commit: 4f2ab0adb6a14e0a265aeb724a1d681793621c94
    
    block: don't mark buffers beyond end of disk as mapped
    
    commit 080399aaaf3531f5b8761ec0ac30ff98891e8686 upstream.
    
    Hi,
    
    We have a bug report open where a squashfs image mounted on ppc64 would
    exhibit errors due to trying to read beyond the end of the disk.  It can
    easily be reproduced by doing the following:
    
    [root@ibm-p750e-02-lp3 ~]# ls -l install.img
    -rw-r--r-- 1 root root 142032896 Apr 30 16:46 install.img
    [root@ibm-p750e-02-lp3 ~]# mount -o loop ./install.img /mnt/test
    [root@ibm-p750e-02-lp3 ~]# dd if=/dev/loop0 of=/dev/null
    dd: reading `/dev/loop0': Input/output error
    277376+0 records in
    277376+0 records out
    142016512 bytes (142 MB) copied, 0.9465 s, 150 MB/s
    
    In dmesg, you'll find the following:
    
    squashfs: version 4.0 (2009/01/31) Phillip Lougher
    [   43.106012] attempt to access beyond end of device
    [   43.106029] loop0: rw=0, want=277410, limit=277408
    [   43.106039] Buffer I/O error on device loop0, logical block 138704
    [   43.106053] attempt to access beyond end of device
    [   43.106057] loop0: rw=0, want=277412, limit=277408
    [   43.106061] Buffer I/O error on device loop0, logical block 138705
    [   43.106066] attempt to access beyond end of device
    [   43.106070] loop0: rw=0, want=277414, limit=277408
    [   43.106073] Buffer I/O error on device loop0, logical block 138706
    [   43.106078] attempt to access beyond end of device
    [   43.106081] loop0: rw=0, want=277416, limit=277408
    [   43.106085] Buffer I/O error on device loop0, logical block 138707
    [   43.106089] attempt to access beyond end of device
    [   43.106093] loop0: rw=0, want=277418, limit=277408
    [   43.106096] Buffer I/O error on device loop0, logical block 138708
    [   43.106101] attempt to access beyond end of device
    [   43.106104] loop0: rw=0, want=277420, limit=277408
    [   43.106108] Buffer I/O error on device loop0, logical block 138709
    [   43.106112] attempt to access beyond end of device
    [   43.106116] loop0: rw=0, want=277422, limit=277408
    [   43.106120] Buffer I/O error on device loop0, logical block 138710
    [   43.106124] attempt to access beyond end of device
    [   43.106128] loop0: rw=0, want=277424, limit=277408
    [   43.106131] Buffer I/O error on device loop0, logical block 138711
    [   43.106135] attempt to access beyond end of device
    [   43.106139] loop0: rw=0, want=277426, limit=277408
    [   43.106143] Buffer I/O error on device loop0, logical block 138712
    [   43.106147] attempt to access beyond end of device
    [   43.106151] loop0: rw=0, want=277428, limit=277408
    [   43.106154] Buffer I/O error on device loop0, logical block 138713
    [   43.106158] attempt to access beyond end of device
    [   43.106162] loop0: rw=0, want=277430, limit=277408
    [   43.106166] attempt to access beyond end of device
    [   43.106169] loop0: rw=0, want=277432, limit=277408
    ...
    [   43.106307] attempt to access beyond end of device
    [   43.106311] loop0: rw=0, want=277470, limit=2774
    
    Squashfs manages to read in the end block(s) of the disk during the
    mount operation.  Then, when dd reads the block device, it leads to
    block_read_full_page being called with buffers that are beyond end of
    disk, but are marked as mapped.  Thus, it would end up submitting read
    I/O against them, resulting in the errors mentioned above.  I fixed the
    problem by modifying init_page_buffers to only set the buffer mapped if
    it fell inside of i_size.
    
    Cheers,
    Jeff
    
    Signed-off-by: Jeff Moyer <jmoyer@redhat.com>
    Acked-by: Nick Piggin <npiggin@kernel.dk>
    
    --
    
    Changes from v1->v2: re-used max_block, as suggested by Nick Piggin.
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Ben Hutchings <ben@decadent.org.uk>

 fs/block_dev.c     |    6 +++---
 fs/buffer.c        |    4 +++-
 include/linux/fs.h |    1 +
 3 files changed, 7 insertions(+), 4 deletions(-)

commit 1988d8dfda1ab4ca21e38af5b77647c047d997b8
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Fri Feb 24 20:07:29 2012 +0100

    Upstream commit: 971316f0503a5c50633d07b83b6db2f15a3a5b00
    (Thanks Willy)
    
    epoll: ep_unregister_pollwait() can use the freed pwq->whead
    
    signalfd_cleanup() ensures that ->signalfd_wqh is not used, but
    this is not enough. eppoll_entry->whead still points to the memory
    we are going to free, ep_unregister_pollwait()->remove_wait_queue()
    is obviously unsafe.
    
    Change ep_poll_callback(POLLFREE) to set eppoll_entry->whead = NULL,
    change ep_unregister_pollwait() to check pwq->whead != NULL under
    rcu_read_lock() before remove_wait_queue(). We add the new helper,
    ep_remove_wait_queue(), for this.
    
    This works because sighand_cachep is SLAB_DESTROY_BY_RCU and because
    ->signalfd_wqh is initialized in sighand_ctor(), not in copy_sighand.
    ep_unregister_pollwait()->remove_wait_queue() can play with already
    freed and potentially reused ->sighand, but this is fine. This memory
    must have the valid ->signalfd_wqh until rcu_read_unlock().
    
    Reported-by: Maxime Bizon <mbizon@freebox.fr>
    Cc: <stable@kernel.org>
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/eventpoll.c |   30 +++++++++++++++++++++++++++---
 fs/signalfd.c  |    6 +++++-
 2 files changed, 32 insertions(+), 4 deletions(-)

commit 3eb2e91a65442bdd092becd577fc516a875362ad
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Fri Feb 24 20:07:11 2012 +0100

    Upstream commit: d80e731ecab420ddcb79ee9d0ac427acbc187b4b
    (Thanks Willy)
    
    epoll: introduce POLLFREE to flush ->signalfd_wqh before kfree()
    
    This patch is intentionally incomplete to simplify the review.
    It ignores ep_unregister_pollwait() which plays with the same wqh.
    See the next change.
    
    epoll assumes that the EPOLL_CTL_ADD'ed file controls everything
    f_op->poll() needs. In particular it assumes that the wait queue
    can't go away until eventpoll_release(). This is not true in case
    of signalfd, the task which does EPOLL_CTL_ADD uses its ->sighand
    which is not connected to the file.
    
    This patch adds the special event, POLLFREE, currently only for
    epoll. It expects that init_poll_funcptr()'ed hook should do the
    necessary cleanup. Perhaps it should be defined as EPOLLFREE in
    eventpoll.
    
    __cleanup_sighand() is changed to do wake_up_poll(POLLFREE) if
    ->signalfd_wqh is not empty, we add the new signalfd_cleanup()
    helper.
    
    ep_poll_callback(POLLFREE) simply does list_del_init(task_list).
    This make this poll entry inconsistent, but we don't care. If you
    share epoll fd which contains our sigfd with another process you
    should blame yourself. signalfd is "really special". I simply do
    not know how we can define the "right" semantics if it used with
    epoll.
    
    The main problem is, epoll calls signalfd_poll() once to establish
    the connection with the wait queue, after that signalfd_poll(NULL)
    returns the different/inconsistent results depending on who does
    EPOLL_CTL_MOD/signalfd_read/etc. IOW: apart from sigmask, signalfd
    has nothing to do with the file, it works with the current thread.
    
    In short: this patch is the hack which tries to fix the symptoms.
    It also assumes that nobody can take tasklist_lock under epoll
    locks, this seems to be true.
    
    Note:
    
    	- we do not have wake_up_all_poll() but wake_up_poll()
    	  is fine, poll/epoll doesn't use WQ_FLAG_EXCLUSIVE.
    
    	- signalfd_cleanup() uses POLLHUP along with POLLFREE,
    	  we need a couple of simple changes in eventpoll.c to
    	  make sure it can't be "lost".
    
    Reported-by: Maxime Bizon <mbizon@freebox.fr>
    Cc: <stable@kernel.org>
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	kernel/fork.c

 fs/eventpoll.c             |    4 ++++
 fs/signalfd.c              |   11 +++++++++++
 include/asm-generic/poll.h |    2 ++
 include/linux/signalfd.h   |    5 ++++-
 kernel/fork.c              |    8 +++++++-
 5 files changed, 28 insertions(+), 2 deletions(-)

commit f9ea1d103d6527ab327acd1c97801d4f2082029b
Author: Hugh Dickins <hughd@google.com>
Date:   Thu Aug 23 12:17:36 2012 +0200

    Upstream commit: 676ce6d5ca3098339c028d44fe0427d1566a4d2d
    (Thanks Willy)
    
    block: replace __getblk_slow misfix by grow_dev_page fix
    
    Commit 91f68c89d8f3 ("block: fix infinite loop in __getblk_slow")
    is not good: a successful call to grow_buffers() cannot guarantee
    that the page won't be reclaimed before the immediate next call to
    __find_get_block(), which is why there was always a loop there.
    
    Yesterday I got "EXT4-fs error (device loop0): __ext4_get_inode_loc:3595:
    inode #19278: block 664: comm cc1: unable to read itable block" on console,
    which pointed to this commit.
    
    I've been trying to bisect for weeks, why kbuild-on-ext4-on-loop-on-tmpfs
    sometimes fails from a missing header file, under memory pressure on
    ppc G5.  I've never seen this on x86, and I've never seen it on 3.5-rc7
    itself, despite that commit being in there: bisection pointed to an
    irrelevant pinctrl merge, but hard to tell when failure takes between
    18 minutes and 38 hours (but so far it's happened quicker on 3.6-rc2).
    
    (I've since found such __ext4_get_inode_loc errors in /var/log/messages
    from previous weeks: why the message never appeared on console until
    yesterday morning is a mystery for another day.)
    
    Revert 91f68c89d8f3, restoring __getblk_slow() to how it was (plus
    a checkpatch nitfix).  Simplify the interface between grow_buffers()
    and grow_dev_page(), and avoid the infinite loop beyond end of device
    by instead checking init_page_buffers()'s end_block there (I presume
    that's more efficient than a repeated call to blkdev_max_block()),
    returning -ENXIO to __getblk_slow() in that case.
    
    And remove akpm's ten-year-old "__getblk() cannot fail ... weird"
    comment, but that is worrying: are all users of __getblk() really
    now prepared for a NULL bh beyond end of device, or will some oops??
    
    Signed-off-by: Hugh Dickins <hughd@google.com>
    Cc: stable@vger.kernel.org # 3.0 3.2 3.4 3.5
    Signed-off-by: Jens Axboe <axboe@kernel.dk>

 fs/buffer.c |   66 ++++++++++++++++++++++++++--------------------------------
 1 files changed, 30 insertions(+), 36 deletions(-)

commit 608a4740ec4ebd2448bd03de7596eec8758f0039
Merge: 99606da 883eacb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 2 18:22:16 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 883eacb800af10bd76c2b052767fda373456d000
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Oct 2 18:22:00 2012 -0400

    Update to pax-linux-2.6.32.59-test202.patch:
    - updated size_overflow plugin from Emese (better handling of cloned functions)

 tools/gcc/generate_size_overflow_hash.sh |   12 +-
 tools/gcc/size_overflow_hash.data        | 4836 ++++++++++++++++--------------
 tools/gcc/size_overflow_plugin.c         |  704 +++--
 3 files changed, 2986 insertions(+), 2566 deletions(-)

commit 99606dab321eb7c8b3cb2ed446ebf13d0b04fe18
Author: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
Date:   Fri Aug 17 10:22:37 2012 -0400

    Upstream commit: 8d54db795dfb1049d45dc34f0dddbc5347ec5642
    
    xen/boot: Disable NUMA for PV guests.
    
    The hypervisor is in charge of allocating the proper "NUMA" memory
    and dealing with the CPU scheduler to keep them bound to the proper
    NUMA node. The PV guests (and PVHVM) have no inkling of where they
    run and do not need to know that right now. In the future we will
    need to inject NUMA configuration data (if a guest spans two or more
    NUMA nodes) so that the kernel can make the right choices. But those
    patches are not yet present.
    
    In the meantime, disable the NUMA capability in the PV guest, which
    also fixes a bootup issue. Andre says:
    
    "we see Dom0 crashes due to the kernel detecting the NUMA topology not
    by ACPI, but directly from the northbridge (CONFIG_AMD_NUMA).
    
    This will detect the actual NUMA config of the physical machine, but
    will crash about the mismatch with Dom0's virtual memory. Variation of
    the theme: Dom0 sees what it's not supposed to see.
    
    This happens with the said config option enabled and on a machine where
    this scanning is still enabled (K8 and Fam10h, not Bulldozer class)
    
    We have this dump then:
    NUMA: Warning: node ids are out of bound, from=-1 to=-1 distance=10
    Scanning NUMA topology in Northbridge 24
    Number of physical nodes 4
    Node 0 MemBase 0000000000000000 Limit 0000000040000000
    Node 1 MemBase 0000000040000000 Limit 0000000138000000
    Node 2 MemBase 0000000138000000 Limit 00000001f8000000
    Node 3 MemBase 00000001f8000000 Limit 0000000238000000
    Initmem setup node 0 0000000000000000-0000000040000000
      NODE_DATA [000000003ffd9000 - 000000003fffffff]
    Initmem setup node 1 0000000040000000-0000000138000000
      NODE_DATA [0000000137fd9000 - 0000000137ffffff]
    Initmem setup node 2 0000000138000000-00000001f8000000
      NODE_DATA [00000001f095e000 - 00000001f0984fff]
    Initmem setup node 3 00000001f8000000-0000000238000000
    Cannot find 159744 bytes in node 3
    BUG: unable to handle kernel NULL pointer dereference at (null)
    IP: [<ffffffff81d220e6>] __alloc_bootmem_node+0x43/0x96
    Pid: 0, comm: swapper Not tainted 3.3.6 #1 AMD Dinar/Dinar
    RIP: e030:[<ffffffff81d220e6>]  [<ffffffff81d220e6>] __alloc_bootmem_node+0x43/0x96
    .. snip..
      [<ffffffff81d23024>] sparse_early_usemaps_alloc_node+0x64/0x178
      [<ffffffff81d23348>] sparse_init+0xe4/0x25a
      [<ffffffff81d16840>] paging_init+0x13/0x22
      [<ffffffff81d07fbb>] setup_arch+0x9c6/0xa9b
      [<ffffffff81683954>] ? printk+0x3c/0x3e
      [<ffffffff81d01a38>] start_kernel+0xe5/0x468
      [<ffffffff81d012cf>] x86_64_start_reservations+0xba/0xc1
      [<ffffffff81007153>] ? xen_setup_runstate_info+0x2c/0x36
      [<ffffffff81d050ee>] xen_start_kernel+0x565/0x56c
    "
    
    so we just disable NUMA scanning by setting numa_off=1.
    
    CC: stable@vger.kernel.org
    Reported-and-Tested-by: Andre Przywara <andre.przywara@amd.com>
    Acked-by: Andre Przywara <andre.przywara@amd.com>
    Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>

 arch/x86/xen/setup.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

commit 3096bde1e6681fd6187722eaaed790748f554d15
Author: Eric Dumazet <edumazet@google.com>
Date:   Mon Sep 24 07:00:11 2012 +0000

    Upstream commit: 3e10986d1d698140747fcfc2761ec9cb64c1d582
    
    net: guard tcp_set_keepalive() to tcp sockets
    
    Its possible to use RAW sockets to get a crash in
    tcp_set_keepalive() / sk_reset_timer()
    
    Fix is to make sure socket is a SOCK_STREAM one.
    
    Reported-by: Dave Jones <davej@redhat.com>
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/core/sock.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 072f6d60e4127a5dda4b16c84f39645035840b12
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Sep 29 11:49:41 2012 -0400

    commit 3898a264c27efc8de894d5358de79cc5a8d6ebc2
    Author: Wei Yongjun <yongjun_wei@trendmicro.com.cn>
    Date:   Wed Sep 26 19:51:58 2012 +0000
    
        Upstream commit: beb5ac20b3f90ffabac1eecd3c00205255df0728
    
        netdev: pasemi: fix return value check in pasemi_mac_phy_init()
    
        In case of error, the function of_phy_connect() returns NULL
        pointer not ERR_PTR(). The IS_ERR() test in the return value
        check should be replaced with NULL test.
    
        dpatch engine is used to auto generate this patch.
        (https://github.com/weiyj/dpatch)
    
        Signed-off-by: Wei Yongjun <yongjun_wei@trendmicro.com.cn>
        Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/pasemi_mac.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 56015f19e0eddb38d31632cfcb60740c30a07cc9
Merge: 842f4b2 590f7fb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Sep 26 17:49:08 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 590f7fbe6b48e2008a19cd8461d2c02091df8557
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Sep 26 17:48:19 2012 -0400

    Update to pax-linux-2.6.32.59-test201.patch:
    - fixed more struct apic constification fallout in lguest
    - cleaned up CONSTIFY_PLUGIN use

 arch/um/Makefile                       |    2 +-
 arch/x86/boot/Makefile                 |    2 +-
 arch/x86/boot/compressed/Makefile      |    2 +-
 arch/x86/kernel/acpi/realmode/Makefile |    2 +-
 arch/x86/lguest/boot.c                 |   12 ++++++------
 5 files changed, 10 insertions(+), 10 deletions(-)

commit 842f4b2c305e391b59a3b14fd09d17862bc6d63d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Sep 25 18:38:29 2012 -0400

    cred_guard_mutex isn't safe to use in 2.6.32 due to ->signal not being pinned
    to the task struct
    revert recent ->signal-related changes
    remove unnecessary protection on /proc/pid/personality
    make /proc/pid/io race fix use exec_id instead of cred_guard_mutex
    
    the mm_for_maps usage of cred_guard_mutex is fine as it happens within an mm
    semaphore, which synchronizes with exit_mm which occurs prior to __exit_signal

 fs/proc/base.c |   34 ++++++++++++++++------------------
 1 files changed, 16 insertions(+), 18 deletions(-)

commit 794a4f3d0de090c704df3aeb872b15cc99a73e0e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Sep 24 07:05:38 2012 -0400

    Remove added tty_audit.c

 drivers/tty/tty_audit.c |  360 -----------------------------------------------
 1 files changed, 0 insertions(+), 360 deletions(-)

commit e8a8363f34af5b6e3eb12fe0fd3204395512e77e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 17:50:15 2012 -0400

    Fix typo in hugetlb fix backport, thanks to kocka for reporting

 mm/hugetlb.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 8487ee1657c33f8c8764bc8ed060e526372d91cd
Author: Xiaotian Feng <dfeng@redhat.com>
Date:   Thu Mar 3 18:08:24 2011 +0800

    Upstream commit: 00bff392c81e4fb1901e5160fdd5afdb2546a6ab
    
    tty_audit: fix tty_audit_add_data live lock on audit disabled
    
    The current tty_audit_add_data code:
    
            do {
                    size_t run;
    
                    run = N_TTY_BUF_SIZE - buf->valid;
                    if (run > size)
                            run = size;
                    memcpy(buf->data + buf->valid, data, run);
                    buf->valid += run;
                    data += run;
                    size -= run;
                    if (buf->valid == N_TTY_BUF_SIZE)
                            tty_audit_buf_push_current(buf);
            } while (size != 0);
    
    If the current buffer is full, kernel will then call tty_audit_buf_push_current
    to empty the buffer. But if we disabled audit at the same time, tty_audit_buf_push()
    returns immediately if audit_enabled is zero.  Without emptying the buffer.
    With obvious effect on tty_audit_add_data() that ends up spinning in that loop,
    copying 0 bytes at each iteration and attempting to push each time without any effect.
    Holding the lock all along.
    
    Suggested-by: Alexander Viro <aviro@redhat.com>
    Signed-off-by: Xiaotian Feng <dfeng@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
    
    Conflicts:
    
    	drivers/tty/tty_audit.c

 drivers/char/tty_audit.c |    4 +-
 drivers/tty/tty_audit.c  |  360 ++++++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 363 insertions(+), 1 deletions(-)

commit 2a1061e72caa41c90e6955d270f6553cca3316f2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 11:19:19 2012 -0400

    commit cc9b17ad29ecaa20bfe426a8d4dbfb94b13ff1cc
    Author: Jason Wang <jasowang@redhat.com>
    Date:   Wed May 30 21:18:10 2012 +0000
    
        net: sock: validate data_len before allocating skb in sock_alloc_send_pskb()
    
        We need to validate the number of pages consumed by data_len, otherwise frags
        array could be overflowed by userspace. So this patch validate data_len and
        return -EMSGSIZE when data_len may occupies more frags than MAX_SKB_FRAGS.
    
        Signed-off-by: Jason Wang <jasowang@redhat.com>
        Signed-off-by: David S. Miller <davem@davemloft.net>
        [dannf: backported to Debian's 2.6.32]

 net/core/sock.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

commit d8a303cd963cb1c93d715d38cd000e1b395937f0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 11:18:19 2012 -0400

    commit 90481622d75715bfcb68501280a917dbfe516029
    Author: David Gibson <david@gibson.dropbear.id.au>
    Date:   Wed Mar 21 16:34:12 2012 -0700
    
        hugepages: fix use after free bug in "quota" handling
    
        hugetlbfs_{get,put}_quota() are badly named.  They don't interact with the
        general quota handling code, and they don't much resemble its behaviour.
        Rather than being about maintaining limits on on-disk block usage by
        particular users, they are instead about maintaining limits on in-memory
        page usage (including anonymous MAP_PRIVATE copied-on-write pages)
        associated with a particular hugetlbfs filesystem instance.
    
        Worse, they work by having callbacks to the hugetlbfs filesystem code from
        the low-level page handling code, in particular from free_huge_page().
        This is a layering violation of itself, but more importantly, if the
        kernel does a get_user_pages() on hugepages (which can happen from KVM
        amongst others), then the free_huge_page() can be delayed until after the
        associated inode has already been freed.  If an unmount occurs at the
        wrong time, even the hugetlbfs superblock where the "quota" limits are
        stored may have been freed.
    
        Andrew Barry proposed a patch to fix this by having hugepages, instead of
        storing a pointer to their address_space and reaching the superblock from
        there, had the hugepages store pointers directly to the superblock,
        bumping the reference count as appropriate to avoid it being freed.
        Andrew Morton rejected that version, however, on the grounds that it made
        the existing layering violation worse.
    
        This is a reworked version of Andrew's patch, which removes the extra, and
        some of the existing, layering violation.  It works by introducing the
        concept of a hugepage "subpool" at the lower hugepage mm layer - that is a
        finite logical pool of hugepages to allocate from.  hugetlbfs now creates
        a subpool for each filesystem instance with a page limit set, and a
        pointer to the subpool gets added to each allocated hugepage, instead of
        the address_space pointer used now.  The subpool has its own lifetime and
        is only freed once all pages in it _and_ all other references to it (i.e.
        superblocks) are gone.
    
        subpools are optional - a NULL subpool pointer is taken by the code to
        mean that no subpool limits are in effect.
    
        Previous discussion of this bug found in:  "Fix refcounting in hugetlbfs
        quota handling.". See:  https://lkml.org/lkml/2011/8/11/28 or
        http://marc.info/?l=linux-mm&m=126928970510627&w=1
        v2: Fixed a bug spotted by Hillf Danton, and removed the extra parameter to
        alloc_huge_page() - since it already takes the vma, it is not necessary.
    
        Signed-off-by: Andrew Barry <abarry@cray.com>
        Signed-off-by: David Gibson <david@gibson.dropbear.id.au>
        Cc: Hugh Dickins <hughd@google.com>
        Cc: Mel Gorman <mgorman@suse.de>
        Cc: Minchan Kim <minchan.kim@gmail.com>
        Cc: Hillf Danton <dhillf@gmail.com>
        Cc: Paul Mackerras <paulus@samba.org>
        Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
        Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
        [dannf: backported to Debian's 2.6.32]

 fs/hugetlbfs/inode.c    |   54 +++++++-----------
 include/linux/hugetlb.h |   14 ++++--
 mm/hugetlb.c            |  135 +++++++++++++++++++++++++++++++++++++---------
 3 files changed, 139 insertions(+), 64 deletions(-)

commit 8515cfc4a5c3af2e1a9da745244c19869ace0eee
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 11:13:34 2012 -0400

    ommit 3e515705a1f46beb1c942bb8043c16f8ac7b1e9e
    Author: Avi Kivity <avi@redhat.com>
    Date:   Mon Mar 5 14:23:29 2012 +0200
    
        KVM: Ensure all vcpus are consistent with in-kernel irqchip settings
    
        If some vcpus are created before KVM_CREATE_IRQCHIP, then
        irqchip_in_kernel() and vcpu->arch.apic will be inconsistent, leading
        to potential NULL pointer dereferences.
    
        Fix by:
        - ensuring that no vcpus are installed when KVM_CREATE_IRQCHIP is called
        - ensuring that a vcpu has an apic if it is installed after KVM_CREATE_IRQCHIP
    
        This is somewhat long winded because vcpu->arch.apic is created without
        kvm->lock held.
    
        Based on earlier patch by Michael Ellerman.
    
        Signed-off-by: Michael Ellerman <michael@ellerman.id.au>
        Signed-off-by: Avi Kivity <avi@redhat.com>
        [dannf: backported to Debian's 2.6.32]

 arch/ia64/kvm/kvm-ia64.c |    5 +++++
 arch/x86/kvm/x86.c       |    8 ++++++++
 include/linux/kvm_host.h |    7 +++++++
 virt/kvm/kvm_main.c      |    4 ++++
 4 files changed, 24 insertions(+), 0 deletions(-)

commit 8fcc84cdafa8c387afd41d5e16aa2e34ee80f0a6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 11:13:01 2012 -0400

    commit 3ddea128ad75bd33e88780fe44f44c3717369b98
    Author: Marcelo Tosatti <mtosatti@redhat.com>
    Date:   Thu Oct 29 13:44:15 2009 -0200
    
        KVM: x86: disallow multiple KVM_CREATE_IRQCHIP
    
        Otherwise kvm will leak memory on multiple KVM_CREATE_IRQCHIP.
        Also serialize multiple accesses with kvm->lock.
    
        Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
        Signed-off-by: Avi Kivity <avi@redhat.com>

 arch/x86/kvm/irq.h |    6 +++++-
 arch/x86/kvm/x86.c |   30 ++++++++++++++++++++++--------
 2 files changed, 27 insertions(+), 9 deletions(-)

commit 6e2892bf020a0bcbe899cb5921dd3b34cb39fa67
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 11:10:50 2012 -0400

    From: =?UTF-8?q?Stephan=20B=C3=A4rwolf?= <stephan.baerwolf@tu-ilmenau.de>
    Date: Thu, 12 Jan 2012 16:43:04 +0100
    Subject: [PATCH 2/2] KVM: x86: fix missing checks in syscall emulation
    
    commit bdb42f5afebe208eae90406959383856ae2caf2b upstream.
    
    On hosts without this patch, 32bit guests will crash (and 64bit guests
    may behave in a wrong way) for example by simply executing following
    nasm-demo-application:
    
        [bits 32]
        global _start
        SECTION .text
        _start: syscall
    
    (I tested it with winxp and linux - both always crashed)
    
        Disassembly of section .text:
    
        00000000 <_start>:
           0:   0f 05                   syscall
    
    The reason seems a missing "invalid opcode"-trap (int6) for the
    syscall opcode "0f05", which is not available on Intel CPUs
    within non-longmodes, as also on some AMD CPUs within legacy-mode.
    (depending on CPU vendor, MSR_EFER and cpuid)
    
    Because previous mentioned OSs may not engage corresponding
    syscall target-registers (STAR, LSTAR, CSTAR), they remain
    NULL and (non trapping) syscalls are leading to multiple
    faults and finally crashs.
    
    Depending on the architecture (AMD or Intel) pretended by
    guests, various checks according to vendor's documentation
    are implemented to overcome the current issue and behave
    like the CPUs physical counterparts.
    
    [mtosatti: cleanup/beautify code]
    
    [bwh: Backport to 2.6.32:
     - Add the prerequisite read of EFER
     - Return -1 in the error cases rather than invoking emulate_ud()
       directly
     - Adjust context]
    [dannf: fix build by passing x86_emulate_ops through each call]
    
    Signed-off-by: Stephan Baerwolf <stephan.baerwolf@tu-ilmenau.de>
    Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
    Signed-off-by: Ben Hutchings <ben@decadent.org.uk>

 arch/x86/include/asm/kvm_emulate.h |   13 ++++++++
 arch/x86/kvm/emulate.c             |   57 ++++++++++++++++++++++++++++++++++-
 2 files changed, 68 insertions(+), 2 deletions(-)

commit e550b76ed02429cd878be765ecf965463827e5ab
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 11:10:00 2012 -0400

    From: =?UTF-8?q?Stephan=20B=C3=A4rwolf?= <stephan.baerwolf@tu-ilmenau.de>
    Date: Thu, 12 Jan 2012 16:43:03 +0100
    Subject: [PATCH 1/2] KVM: x86: extend "struct x86_emulate_ops" with
     "get_cpuid"
    
    commit 0769c5de24621141c953fbe1f943582d37cb4244 upstream.
    
    In order to be able to proceed checks on CPU-specific properties
    within the emulator, function "get_cpuid" is introduced.
    With "get_cpuid" it is possible to virtually call the guests
    "cpuid"-opcode without changing the VM's context.
    
    [mtosatti: cleanup/beautify code]
    
    [bwh: Backport to 2.6.32:
     - Don't use emul_to_vcpu
     - Adjust context]
    
    Signed-off-by: Stephan Baerwolf <stephan.baerwolf@tu-ilmenau.de>
    Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
    Signed-off-by: Ben Hutchings <ben@decadent.org.uk>

 arch/x86/include/asm/kvm_emulate.h |    2 ++
 arch/x86/kvm/x86.c                 |   23 +++++++++++++++++++++++
 2 files changed, 25 insertions(+), 0 deletions(-)

commit e64d6cdb949ff2388886ebd3c8bb1dc1476c64cb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 11:07:52 2012 -0400

    commit e0bccd315db0c2f919e7fcf9cb60db21d9986f52
    Author: Ben Hutchings <ben@decadent.org.uk>
    Date:   Sun Mar 20 06:48:05 2011 +0000
    
        rose: Add length checks to CALL_REQUEST parsing
    
        Define some constant offsets for CALL_REQUEST based on the description
        at <http://www.techfest.com/networking/wan/x25plp.htm> and the
        definition of ROSE as using 10-digit (5-byte) addresses.  Use them
        consistently.  Validate all implicit and explicit facilities lengths.
        Validate the address length byte rather than either trusting or
        assuming its value.
    
        Signed-off-by: Ben Hutchings <ben@decadent.org.uk>
        Signed-off-by: David S. Miller <davem@davemloft.net>
        [dannf: backported to Debian's 2.6.32]

 include/net/rose.h       |    8 ++++-
 net/rose/af_rose.c       |    8 ++--
 net/rose/rose_loopback.c |   13 ++++++-
 net/rose/rose_route.c    |   20 +++++++----
 net/rose/rose_subr.c     |   91 +++++++++++++++++++++++++++++-----------------
 5 files changed, 93 insertions(+), 47 deletions(-)

commit fc9e179c6b7694e3dbd57a89dfe0e3716e354985
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 11:06:59 2012 -0400

    commit 0924ab2cfa98b1ece26c033d696651fd62896c69
    Author: Jan Kiszka <jan.kiszka@siemens.com>
    Date:   Wed Dec 14 19:25:13 2011 +0100
    
        KVM: x86: Prevent starting PIT timers in the absence of irqchip support
    
        User space may create the PIT and forgets about setting up the irqchips.
        In that case, firing PIT IRQs will crash the host:
    
        BUG: unable to handle kernel NULL pointer dereference at 0000000000000128
        IP: [<ffffffffa10f6280>] kvm_set_irq+0x30/0x170 [kvm]
        ...
        Call Trace:
         [<ffffffffa11228c1>] pit_do_work+0x51/0xd0 [kvm]
         [<ffffffff81071431>] process_one_work+0x111/0x4d0
         [<ffffffff81071bb2>] worker_thread+0x152/0x340
         [<ffffffff81075c8e>] kthread+0x7e/0x90
         [<ffffffff815a4474>] kernel_thread_helper+0x4/0x10
    
        Prevent this by checking the irqchip mode before starting a timer. We
        can't deny creating the PIT if the irqchips aren't set up yet as
        current user land expects this order to work.
    
        Signed-off-by: Jan Kiszka <jan.kiszka@siemens.com>
        Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
        [dannf: backported to Debian's 2.6.32]

 arch/x86/kvm/i8254.c |   10 +++++++---
 1 files changed, 7 insertions(+), 3 deletions(-)

commit c2451257b29a7c9304c560e8f4116e61b8363b19
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 11:04:34 2012 -0400

    commit 423873736b78f549fbfa2f715f2e4de7e6c5e1e9
    Author: Alex Williamson <alex.williamson@redhat.com>
    Date:   Tue Dec 20 21:59:03 2011 -0700
    
        KVM: Remove ability to assign a device without iommu support
    
        This option has no users and it exposes a security hole that we
        can allow devices to be assigned without iommu protection.  Make
        KVM_DEV_ASSIGN_ENABLE_IOMMU a mandatory option.
    
        Signed-off-by: Alex Williamson <alex.williamson@redhat.com>
        Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
        [dannf: backported to Debian's 2.6.32]

 virt/kvm/kvm_main.c |   18 +++++++++---------
 1 files changed, 9 insertions(+), 9 deletions(-)

commit 12a9b5b29b8119416f805282ef9c6cb912bc4567
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 11:01:18 2012 -0400

    commit 15291164b22a357cb211b618adfef4fa82fc0de3
    Author: Eric Sandeen <sandeen@redhat.com>
    Date:   Mon Feb 20 17:53:01 2012 -0500
    
        jbd2: clear BH_Delay & BH_Unwritten in journal_unmap_buffer
    
        journal_unmap_buffer()'s zap_buffer: code clears a lot of buffer head
        state ala discard_buffer(), but does not touch _Delay or _Unwritten as
        discard_buffer() does.
    
        This can be problematic in some areas of the ext4 code which assume
        that if they have found a buffer marked unwritten or delay, then it's
        a live one.  Perhaps those spots should check whether it is mapped
        as well, but if jbd2 is going to tear down a buffer, let's really
        tear it down completely.
    
        Without this I get some fsx failures on sub-page-block filesystems
        up until v3.2, at which point 4e96b2dbbf1d7e81f22047a50f862555a6cb87cb
        and 189e868fa8fdca702eb9db9d8afc46b5cb9144c9 make the failures go
        away, because buried within that large change is some more flag
        clearing.  I still think it's worth doing in jbd2, since
        ->invalidatepage leads here directly, and it's the right place
        to clear away these flags.
    
        Signed-off-by: Eric Sandeen <sandeen@redhat.com>
        Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
        Cc: stable@vger.kernel.org
        [dannf: backported to Debian's 2.6.32]

 fs/jbd2/transaction.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 6bafe16a811a1e7fcc3c74bb80afc363956f4891
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 10:58:43 2012 -0400

    check for negative pathlen in xfs_readlink

 fs/xfs/xfs_vnodeops.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit d8e53c937745d528754633f7c850b6857bcc98e5
Merge: 88c53ec 5e5986b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 10:36:51 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 5e5986b1dead61b4ec2c86d37932a1fac42a9c46
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Sep 23 10:36:35 2012 -0400

    Update to pax-linux-2.6.32.59-test200.patch:
    - made the constify plugin more robust based on results from the gcc test suite
    - fixed softmode/EMUTRAMP regression (executables produced by the patched binutils would not run)

 fs/binfmt_elf.c             |    2 +-
 tools/gcc/constify_plugin.c |    5 ++++-
 2 files changed, 5 insertions(+), 2 deletions(-)

commit 88c53ec596f7887fc8cf2d8d3ef0b599ee0d7e2c
Merge: 2353e62 91f9993
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Sep 21 17:18:10 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 91f999348ed44071818d495ee22b41195e45d55b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Sep 21 17:16:24 2012 -0400

    Update to pax-linux-2.6.32.59-test199.patch:
    - fixed stupid backport mistake, thanks kaloz&minipli on irc

 net/ipv4/netfilter/arp_tables.c |    6 +++---
 net/ipv4/netfilter/ip_tables.c  |    6 +++---
 net/ipv6/netfilter/ip6_tables.c |    6 +++---
 3 files changed, 9 insertions(+), 9 deletions(-)

commit 2353e62e599b143357c375d4844c25e3da8cefc2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Sep 19 20:57:26 2012 -0400

    allow kernel pointers to be printed in /proc/vmallocinfo, a 0600 entry

 mm/vmalloc.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 1ca8b4bf54b3fa594c5fc502902c51453ef5a28b
Merge: 38d0916 e425144
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Sep 19 19:58:45 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit e425144244f00b460449983d680fbf3c1e8077c5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Sep 19 19:58:08 2012 -0400

    Update to pax-linux-2.6.32.59-test198.patch:
    - fixed several copy_*_user_overflow induced warnings
    - fixed fallout of struct apic constification in xen

 arch/x86/kernel/tls.c                      |    2 +-
 arch/x86/xen/enlighten.c                   |   12 ++++++------
 drivers/net/wireless/iwlwifi/iwl-debugfs.c |   10 +++++-----
 kernel/capability.c                        |    2 +-
 net/bluetooth/hci_sock.c                   |    2 +-
 net/bluetooth/rfcomm/sock.c                |    2 +-
 net/compat.c                               |    2 +-
 net/ipv4/netfilter/arp_tables.c            |    6 +++---
 net/ipv4/netfilter/ip_tables.c             |    6 +++---
 net/ipv6/netfilter/ip6_tables.c            |    6 +++---
 net/packet/af_packet.c                     |    4 ++--
 security/Kconfig                           |    3 ---
 12 files changed, 27 insertions(+), 30 deletions(-)

commit 38d0916c8f0cc53205f43a8ec56133f5a65ff24d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Sep 19 18:05:27 2012 -0400

    From: Mathias Krause <minipli@googlemail.com>
    To: "David S. Miller" <davem@davemloft.net>
    Cc: Steffen Klassert <steffen.klassert@secunet.com>, netdev@vger.kernel.org,
            linux-kernel@vger.kernel.org,
            Mathias Krause <minipli@googlemail.com>
    Subject: [PATCH 3/6] xfrm_user: fix info leak in copy_to_user_policy()
    Date: Wed, 19 Sep 2012 23:33:40 +0200
    
    The memory reserved to dump the xfrm policy includes multiple padding
    bytes added by the compiler for alignment (padding bytes in struct
    xfrm_selector and struct xfrm_userpolicy_info). Add an explicit
    memset(0) before filling the buffer to avoid the heap info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>

 net/xfrm/xfrm_user.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 0af464715c11b75f94eadc8f1c49b20d879b118a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Sep 19 18:04:08 2012 -0400

    From: Mathias Krause <minipli@googlemail.com>
    To: "David S. Miller" <davem@davemloft.net>
    Cc: Steffen Klassert <steffen.klassert@secunet.com>, netdev@vger.kernel.org,
            linux-kernel@vger.kernel.org,
            Mathias Krause <minipli@googlemail.com>
    Subject: [PATCH 2/6] xfrm_user: fix info leak in copy_to_user_state()
    Date: Wed, 19 Sep 2012 23:33:39 +0200
    
    The memory reserved to dump the xfrm state includes the padding bytes of
    struct xfrm_usersa_info added by the compiler for alignment (7 for
    amd64, 3 for i386). Add an explicit memset(0) before filling the buffer
    to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>

 net/xfrm/xfrm_user.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit e7e8aafd009c194f2745581cb7de53566375a047
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Sep 19 18:00:26 2012 -0400

    (different fix for 2.6.32)
    
    From: Mathias Krause <minipli@googlemail.com>
    To: "David S. Miller" <davem@davemloft.net>
    Cc: Steffen Klassert <steffen.klassert@secunet.com>, netdev@vger.kernel.org,
            linux-kernel@vger.kernel.org,
            Mathias Krause <minipli@googlemail.com>
    Subject: [PATCH 1/6] xfrm_user: fix info leak in copy_to_user_auth()
    Date: Wed, 19 Sep 2012 23:33:38 +0200
    
    copy_to_user_auth() fails to initialize the remainder of alg_name and
    therefore discloses up to 54 bytes of heap memory via netlink to
    userland.
    
    Use strncpy() instead of strcpy() to fill the trailing bytes of alg_name
    with null bytes.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    
    Conflicts:
    
    	net/xfrm/xfrm_user.c

 net/xfrm/xfrm_user.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 61347cda2599fe10e98a031e3d690a618c99c3d7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Sep 17 18:11:25 2012 -0400

    From: Mathias Krause <minipli@googlemail.com>
    To: "David S. Miller" <davem@davemloft.net>
    Cc: Steffen Klassert <steffen.klassert@secunet.com>, netdev@vger.kernel.org,
            linux-kernel@vger.kernel.org,
            Mathias Krause <minipli@googlemail.com>, stable@vger.kernel.org
    Subject: [PATCH] xfrm_user: return error pointer instead of NULL
    Date: Thu, 13 Sep 2012 23:41:26 +0200
    
    When dump_one_state() returns an error, e.g. because of a too small
    buffer to dump the whole xfrm state, xfrm_state_netlink() returns NULL
    instead of an error pointer. But its callers expect an error pointer
    and therefore continue to operate on a NULL skbuff.
    
    This could lead to a privilege escalation (execution of user code in
    kernel context) if the attacker has CAP_NET_ADMIN and is able to map
    address 0.
    
    Cc: stable@vger.kernel.org
    Signed-off-by: Mathias Krause <minipli@googlemail.com>

 net/xfrm/xfrm_user.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

commit 5720339163c0a772e1c125f6182e2464057577ca
Merge: 81ce8ac 61b068f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Sep 17 18:10:17 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 61b068f5575c5b64dc0003293f9201d9b31f7fea
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Sep 17 18:02:49 2012 -0400

    Update to pax-linux-2.6.32.59-test197.patch:
    - fixed longstanding problem with the per-cpu pgd and kvm

 arch/x86/kvm/vmx.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

commit 81ce8ac1e9b9340ee9ec24156859b0eee5ae7788
Merge: a0fcc4c 270e5d6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Sep 15 11:47:04 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 270e5d6f9aa72df42aba1da017b67b1340e66915
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Sep 15 11:46:17 2012 -0400

    Update to pax-linux-2.6.32.59-test196.patch:
    - fixed USERCOPY/SLOB false positive bug

 mm/slob.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit a0fcc4cd3d1374c7deebf03b0d2e6cb1ff622833
Merge: bb0aef3 760c511
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Sep 11 17:57:14 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 760c511a4b278d615b9fa710e7a89bf8ba817c19
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Sep 11 17:56:59 2012 -0400

    Update to pax-linux-2.6.32.59-test195.patch:
    - updated size_overflow plugin from Emese, should fix the false positives due to TCP sequence numbers leaking into size parameters
    - fixed sparc32 compilation

 arch/sparc/mm/fault_32.c                 |    2 +-
 arch/x86/include/asm/reboot.h            |    2 +-
 arch/x86/kernel/reboot.c                 |    8 +-
 include/linux/compiler-gcc4.h            |    1 +
 include/linux/compiler.h                 |    4 +
 include/linux/dmaengine.h                |    4 +-
 include/linux/skbuff.h                   |    4 +-
 include/net/netdma.h                     |    2 +-
 include/net/sock.h                       |    2 +-
 include/net/tcp.h                        |    8 +-
 init/main.c                              |    4 +-
 net/ipv4/tcp_input.c                     |    2 +-
 tools/gcc/generate_size_overflow_hash.sh |   10 +-
 tools/gcc/size_overflow_hash.data        | 4551 +++++++++++++++---------------
 tools/gcc/size_overflow_plugin.c         |  341 ++-
 15 files changed, 2542 insertions(+), 2403 deletions(-)

commit bb0aef32e5f80cd762c979fd6b4c7f4f116ef677
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Sep 10 17:42:30 2012 -0400

    Add new nameidata flag to easily separate out the case where we want
    to perform a symlink ownership check against the parent (when we're creating a not-yet-existing file)
    and when we don't

 fs/namei.c            |    4 +++-
 include/linux/namei.h |    2 ++
 2 files changed, 5 insertions(+), 1 deletions(-)

commit 8587541e9b02cbfe73ea0479444ac10e6cd447e5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Sep 8 08:20:10 2012 -0400

    compile fix

 fs/namei.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 852d4dcc4d49488ee2eec4ae48aebc4ad8d62496
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Sep 8 08:13:08 2012 -0400

    Have symlinkown feature check ownership of the directory if trying to create a
    not-yet-existing file described by a symlink.  Technically not necessary
    to provide what's promised in the documentation for the feature, but this
    will match the behavior of the feature for 3.2 and 3.5.

 fs/namei.c |   15 ++++++++++++---
 1 files changed, 12 insertions(+), 3 deletions(-)

commit f105ccc638ccac14c0050ee638a3eae02e4c048b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Sep 6 19:23:27 2012 -0400

    compile fix

 security/commoncap.c |    4 ----
 1 files changed, 0 insertions(+), 4 deletions(-)

commit 3cd85b4cb978672cbfe4b613cb3aa285810f340d
Merge: 25e4723 10589af
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Sep 6 19:22:45 2012 -0400

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	security/commoncap.c
    	tools/gcc/size_overflow_hash.data

commit 10589afca30f70fbe1906ee56e5d821827d98252
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Sep 6 19:21:27 2012 -0400

    Update to pax-linux-2.6.32.59-test194.patch:
    - updated size overflow hashtable from Emese
    - hopefully fixed the problem reported by jorgus in http://forums.grsecurity.net/viewtopic.php?f=3&t=3044
    - fixed arm compilation reported by Larry H. from subreption.com

 include/asm-generic/4level-fixup.h |    2 ++
 mm/slab.c                          |    3 +++
 mm/slob.c                          |    5 +++++
 mm/slub.c                          |    3 +++
 security/commoncap.c               |    1 +
 tools/gcc/size_overflow_hash.data  |   13 +++++++++++--
 6 files changed, 25 insertions(+), 2 deletions(-)

commit 25e4723a31a51701562058c3b36c32774ad5924b
Author: Dave Jones <davej@redhat.com>
Date:   Thu Sep 6 12:01:00 2012 -0400

    Upstream commit: 80de7c3138ee9fd86a98696fd2cf7ad89b995d0a
    
    Remove user-triggerable BUG from mpol_to_str
    
    Trivially triggerable, found by trinity:
    
      kernel BUG at mm/mempolicy.c:2546!
      Process trinity-child2 (pid: 23988, threadinfo ffff88010197e000, task ffff88007821a670)
      Call Trace:
        show_numa_map+0xd5/0x450
        show_pid_numa_map+0x13/0x20
        traverse+0xf2/0x230
        seq_read+0x34b/0x3e0
        vfs_read+0xac/0x180
        sys_pread64+0xa2/0xc0
        system_call_fastpath+0x1a/0x1f
      RIP: mpol_to_str+0x156/0x360
    
    Cc: stable@vger.kernel.org
    Signed-off-by: Dave Jones <davej@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/mempolicy.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit a0d2e5d162e6fe19a7b8f01643586d684a1ada21
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Sep 6 18:37:05 2012 -0400

    allow non-root send for NETLINK_USERSOCK

 net/netlink/af_netlink.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit d1b6ff4ae75a1536a293806f936c297e88d45ea9
Author: David S. Miller <davem@davemloft.net>
Date:   Mon Aug 30 19:08:01 2010 -0700

    Upstream commit: b963ea89f00f13c648af4082e5efb2172d369727
    
    netlink: Make NETLINK_USERSOCK work again.
    
    Once we started enforcing the a nl_table[] entry exist for
    a protocol, NETLINK_USERSOCK stopped working.  Add a dummy
    table entry so that it works again.
    
    Reported-by: Thomas Voegtle <tv@lio96.de>
    Tested-by: Thomas Voegtle <tv@lio96.de>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/netlink/af_netlink.c |   22 ++++++++++++++++++++++
 1 files changed, 22 insertions(+), 0 deletions(-)

commit ea775fcfdd17d602b2f0ce679059ba81e08d23ae
Author: Pablo Neira Ayuso <pablo@netfilter.org>
Date:   Thu Aug 23 02:09:11 2012 +0000

    Upstream commit: 20e1db19db5d6b9e4e83021595eab0dc8f107bef
    
    netlink: fix possible spoofing from non-root processes
    
    Non-root user-space processes can send Netlink messages to other
    processes that are well-known for being subscribed to Netlink
    asynchronous notifications. This allows ilegitimate non-root
    process to send forged messages to Netlink subscribers.
    
    The userspace process usually verifies the legitimate origin in
    two ways:
    
    a) Socket credentials. If UID != 0, then the message comes from
       some ilegitimate process and the message needs to be dropped.
    
    b) Netlink portID. In general, portID == 0 means that the origin
       of the messages comes from the kernel. Thus, discarding any
       message not coming from the kernel.
    
    However, ctnetlink sets the portID in event messages that has
    been triggered by some user-space process, eg. conntrack utility.
    So other processes subscribed to ctnetlink events, eg. conntrackd,
    know that the event was triggered by some user-space action.
    
    Neither of the two ways to discard ilegitimate messages coming
    from non-root processes can help for ctnetlink.
    
    This patch adds capability validation in case that dst_pid is set
    in netlink_sendmsg(). This approach is aggressive since existing
    applications using any Netlink bus to deliver messages between
    two user-space processes will break. Note that the exception is
    NETLINK_USERSOCK, since it is reserved for netlink-to-netlink
    userspace communication.
    
    Still, if anyone wants that his Netlink bus allows netlink-to-netlink
    userspace, then they can set NL_NONROOT_SEND. However, by default,
    I don't think it makes sense to allow to use NETLINK_ROUTE to
    communicate two processes that are sending no matter what information
    that is not related to link/neighbouring/routing. They should be using
    NETLINK_USERSOCK instead for that.
    
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	net/netlink/af_netlink.c

 net/netlink/af_netlink.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

commit be95325b9f217dd1cbcdb931618b5c4b988ccbdb
Author: Paul Cercueil <paul@crapouillou.net>
Date:   Tue Jul 24 03:00:24 2012 +0200

    Upstream commit: e432964a3c5ce517fd93101ae3875172ee958b65
    
    fbcon: prevent possible buffer overflow.
    
    Signed-off-by: Paul Cercueil <paul@crapouillou.net>
    Signed-off-by: Florian Tobias Schandinat <FlorianSchandinat@gmx.de>

 drivers/video/console/fbcon.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit ef516e9d6ce3ae95072d8cf26cd1e434ecd6bca9
Author: Julia Lawall <Julia.Lawall@lip6.fr>
Date:   Wed Aug 29 06:49:15 2012 +0000

    Upstream commit: 599901c3e4204e9d9c5a24df5402cd91617a2a26
    
    net/xfrm/xfrm_state.c: fix error return code
    
    Initialize return variable before exiting on an error path.
    
    A simplified version of the semantic match that finds this problem is as
    follows: (http://coccinelle.lip6.fr/)
    
    // <smpl>
    (
    if@p1 (\(ret < 0\|ret != 0\))
     { ... return ret; }
    |
    ret@p1 = 0
    )
    ... when != ret = e1
        when != &ret
    *if(...)
    {
      ... when != ret = e2
          when forall
     return ret;
    }
    
    // </smpl>
    
    Signed-off-by: Julia Lawall <Julia.Lawall@lip6.fr>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/xfrm/xfrm_state.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

commit 2a314b1ecb353d1b59f1de255c4be33c1ccc5558
Author: Julia Lawall <Julia.Lawall@lip6.fr>
Date:   Wed Aug 29 06:49:12 2012 +0000

    Upstream commit: 48f125ce1cc3ff275f9587b5bf56bf0f90766c7d
    
    net: ipv6: fix error return code
    
    Initialize return variable before exiting on an error path.
    
    The initial initialization of the return variable is also dropped, because
    that value is never used.
    
    A simplified version of the semantic match that finds this problem is as
    follows: (http://coccinelle.lip6.fr/)
    
    // <smpl>
    (
    if@p1 (\(ret < 0\|ret != 0\))
     { ... return ret; }
    |
    ret@p1 = 0
    )
    ... when != ret = e1
        when != &ret
    *if(...)
    {
      ... when != ret = e2
          when forall
     return ret;
    }
    
    // </smpl>
    
    Signed-off-by: Julia Lawall <Julia.Lawall@lip6.fr>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	net/ipv6/esp6.c

 net/ipv6/esp6.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

commit 6442882466b52f259c9bdfd3e3feb733b636ba03
Author: Heiko Carstens <heiko.carstens@de.ibm.com>
Date:   Tue Aug 28 10:02:08 2012 +0200

    Upstream commit: 768fd0737f4533635ea351566dff98fd4912b0d8
    
    s390/32: Don't clobber personality flags on exec
    
    In native 32 bit mode the personality flags were not correctly inherited.
    This is the s390 version of 59e4c3a2 "powerpc/32: Don't clobber personality
    flags on exec".
    
    Reported-by: Mike Frysinger <vapier@gentoo.org>
    Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
    Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
    
    Conflicts:
    
    	arch/s390/include/asm/elf.h

 arch/s390/include/asm/elf.h |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 6ed9bb7b0aed494b9d7327d05ba5e404469f7d13
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 30 20:12:03 2012 -0400

    Fix an infoleak discovered by my recent HIDESYM improvement and reported by Niki Guldbrand

 fs/autofs4/waitq.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

commit 761d03c32d6b7f936c254c650d9b406ff6ac9ee6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 30 19:44:27 2012 -0400

    Revert my backport due to a compilation error, bring in a backport from minipli that copies each struct member into a zeroed stack buffer before copying to userland

 include/linux/tfrc.h   |    1 -
 net/dccp/ccids/ccid3.c |   20 ++++++++++++++------
 2 files changed, 14 insertions(+), 7 deletions(-)

commit 552916aeadf506a7ef21e9536f0443b3bbc0549c
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Fri Aug 17 22:42:36 2012 -0400

    Upstream commit: 98022748f6c7bce85b9f123fd4d1a621219dd8d9
    
    eventpoll: use-after-possible-free in epoll_create1()
    
    As soon as we'd installed the file into descriptor table, it can
    get closed by another thread.  Freeing ep in process...
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

 fs/eventpoll.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 5f7bd80b4153119f37c64ab965f11c92b1d55e57
Author: Jiri Kosina <jkosina@suse.cz>
Date:   Mon Aug 13 03:18:28 2012 +0000

    Upstream commit: 7256a5d2da56f2ea8ad49e8dbe9e2984f0899b42
    
    powerpc: Fix personality handling in ppc64_personality()
    
    Directly comparing current->personality against PER_LINUX32 doesn't work
    in cases when any of the personality flags stored in the top three bytes
    are used.
    
    Directly forcefully setting personality to PER_LINUX32 or PER_LINUX
    discards any flags stored in the top three bytes
    
    Use personality() macro to compare only PER_MASK bytes and make sure that
    we are setting only the bits that should be set, instead of overwriting
    the whole value.
    
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>

 arch/powerpc/kernel/syscalls.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

commit 71444663bc3ecbd632fef236ca806ebb4c488d9a
Merge: 4a0c015 cc3e311
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 27 18:53:50 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit cc3e311066a956009e9ec744f7038021e2ad6de4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 27 18:53:09 2012 -0400

    Update to pax-linux-2.6.32.59-test193.patch:
    - fixed interaction between RANDKSTACK and STACKLEAK, reported by Mathias Krause
    - clarified config help language for options that rely on a gcc plugin

 arch/x86/ia32/ia32entry.S  |   33 ++++++++++++++++++++++++---------
 arch/x86/kernel/entry_32.S |   18 +++++++++++++++++-
 arch/x86/kernel/entry_64.S |   15 ++++++++++-----
 security/Kconfig           |   28 ++++++++++++++++++++--------
 4 files changed, 71 insertions(+), 23 deletions(-)

commit 4a0c015486495191826792ad7b804825381e31ce
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 23 20:45:24 2012 -0400

    Fix a netlink/xfrm infoleak (requires CAP_NET_ADMIN)
    It's infoleak city in this code!  Thanks to minipli for pointing me
    to the file

 net/xfrm/xfrm_user.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 8c07463ab8d233a2cee9575e6b9b6ef4f1c82b77
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 23 20:23:40 2012 -0400

    Resolve a potential heap infoleak similar to that from:
    2d88a5d364043c7a7418d311aadb440036553bd8

 include/linux/tfrc.h   |    1 +
 net/dccp/ccids/ccid3.c |    1 +
 2 files changed, 2 insertions(+), 0 deletions(-)

commit 2fb187ac877449b4cd5d294421691593f1592978
Author: Mathias Krause <minipli@googlemail.com>
Date:   Thu Jul 12 08:46:54 2012 +0200

    Upstream commit: 0143fc5e9f6f5aad4764801015bc8d4b4a278200
    
    isofs: avoid info leak on export
    
    For type 1 the parent_offset member in struct isofs_fid gets copied
    uninitialized to userland. Fix this by initializing it to 0.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Signed-off-by: Jan Kara <jack@suse.cz>

 fs/isofs/export.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit f87093a6be4e8e00b72a5eb3943f45df46de54ee
Author: Mathias Krause <minipli@googlemail.com>
Date:   Thu Jul 12 08:46:55 2012 +0200

    Upstream commit: 0143fc5e9f6f5aad4764801015bc8d4b4a278200
    
    udf: avoid info leak on export
    
    For type 0x51 the udf.parent_partref member in struct fid gets copied
    uninitialized to userland. Fix this by initializing it to 0.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Signed-off-by: Jan Kara <jack@suse.cz>

 fs/udf/namei.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 72986211f00ecb7f76d9d848e9b641cf62f65955
Author: Mathias Krause <minipli@googlemail.com>
Date:   Sun Jul 29 19:45:14 2012 +0000

    Upstream commit: a117dacde0288f3ec60b6e5bcedae8fa37ee0dfc
    
    net/tun: fix ioctl() based info leaks
    
    The tun module leaks up to 36 bytes of memory by not fully initializing
    a structure located on the stack that gets copied to user memory by the
    TUNGETIFF and SIOCGIFHWADDR ioctl()s.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	drivers/net/tun.c

 drivers/net/tun.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

commit 0946351d1b31b8c998fbadbed27426547e9ab216
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:44 2012 +0000

    Upstream commit: e862f1a9b7df4e8196ebec45ac62295138aa3fc2
    
    atm: fix info leak in getsockopt(SO_ATMPVC)
    
    The ATM code fails to initialize the two padding bytes of struct
    sockaddr_atmpvc inserted for alignment. Add an explicit memset(0)
    before filling the structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	net/atm/common.c

 net/atm/common.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit daf45d7f652151f6872640e43f8b38a093293255
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:45 2012 +0000

    Upstream commit: 3c0c5cfdcd4d69ffc4b9c0907cec99039f30a50a
    
    atm: fix info leak via getsockname()
    
    The ATM code fails to initialize the two padding bytes of struct
    sockaddr_atmpvc inserted for alignment. Add an explicit memset(0)
    before filling the structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	net/atm/pvc.c

 net/atm/pvc.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 094d6e36d091170fd17dfda2f4b3b2f923177f78
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:46 2012 +0000

    Upstream commit: e15ca9a0ef9a86f0477530b0f44a725d67f889ee
    
    Bluetooth: HCI - Fix info leak in getsockopt(HCI_FILTER)
    
    The HCI code fails to initialize the two padding bytes of struct
    hci_ufilter before copying it to userland -- that for leaking two
    bytes kernel stack. Add an explicit memset(0) before filling the
    structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Marcel Holtmann <marcel@holtmann.org>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Johan Hedberg <johan.hedberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/bluetooth/hci_sock.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 3abd8bcacf6f571a3bc0dc2c39c0e72c875b9682
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:49 2012 +0000

    Upstream commit: f9432c5ec8b1e9a09b9b0e5569e3c73db8de432a
    
    Bluetooth: RFCOMM - Fix info leak in ioctl(RFCOMMGETDEVLIST)
    
    The RFCOMM code fails to initialize the two padding bytes of struct
    rfcomm_dev_list_req inserted for alignment before copying it to
    userland. Additionally there are two padding bytes in each instance of
    struct rfcomm_dev_info. The ioctl() that for disclosures two bytes plus
    dev_num times two bytes uninitialized kernel heap memory.
    
    Allocate the memory using kzalloc() to fix this issue.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Marcel Holtmann <marcel@holtmann.org>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Johan Hedberg <johan.hedberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    
    Conflicts:
    
    	net/bluetooth/rfcomm/tty.c

 net/bluetooth/rfcomm/tty.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 006259e7b1a63f1905104c4583090a5e046057ba
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:50 2012 +0000

    Upstream commit: 9344a972961d1a6d2c04d9008b13617bcb6ec2ef
    
    Bluetooth: RFCOMM - Fix info leak via getsockname()
    
    The RFCOMM code fails to initialize the trailing padding byte of struct
    sockaddr_rc added for alignment. It that for leaks one byte kernel stack
    via the getsockname() syscall. Add an explicit memset(0) before filling
    the structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Marcel Holtmann <marcel@holtmann.org>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Johan Hedberg <johan.hedberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/bluetooth/rfcomm/sock.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 155c48f8c825dd079cc8c50a7b94c7425254ab66
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:53 2012 +0000

    Upstream commit: 3592aaeb80290bda0f2cf0b5456c97bfc638b192
    
    llc: fix info leak via getsockname()
    
    The LLC code wrongly returns 0, i.e. "success", when the socket is
    zapped. Together with the uninitialized uaddrlen pointer argument from
    sys_getsockname this leads to an arbitrary memory leak of up to 128
    bytes kernel stack via the getsockname() syscall.
    
    Return an error instead when the socket is zapped to prevent the info
    leak. Also remove the unnecessary memset(0). We don't directly write to
    the memory pointed by uaddr but memcpy() a local structure at the end of
    the function that is properly initialized.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Arnaldo Carvalho de Melo <acme@ghostprotocols.net>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/llc/af_llc.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

commit 592cc886c63b9815a35693e66f8c8b6ced9cdfad
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:54 2012 +0000

    Upstream commit: 276bdb82dedb290511467a5a4fdbe9f0b52dce6f
    
    dccp: check ccid before dereferencing
    
    ccid_hc_rx_getsockopt() and ccid_hc_tx_getsockopt() might be called with
    a NULL ccid pointer leading to a NULL pointer dereference. This could
    lead to a privilege escalation if the attacker is able to map page 0 and
    prepare it with a fake ccid_ops pointer.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Gerrit Renker <gerrit@erg.abdn.ac.uk>
    Cc: stable@vger.kernel.org
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/dccp/ccid.h |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 4f5b59057302f61625f464eaec0622b828a4326b
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Mon Aug 20 15:28:00 2012 +0100

    Upstream commit: 0e665d5d1125f9f4ccff56a75e814f10f88861a2
    
    vfs: missed source of ->f_pos races
    
    compat_sys_{read,write}v() need the same "pass a copy of file->f_pos" thing
    as sys_{read,write}{,v}().
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Cc: stable@kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/compat.c |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

commit cd913eae4624f47c3b7b9227308fbdb9f6b1b1e7
Merge: 1a61aaa c1bc082
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 20 15:21:01 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit c1bc082065d12103909cd0e8e9a142941cdd4d0f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 20 15:20:45 2012 -0400

    Update to pax-linux-2.6.32.59-test192.patch:
    - updated size overflow plugin from Emese, should fix http://forums.grsecurity.net/viewtopic.php?f=3&t=3037

 tools/gcc/generate_size_overflow_hash.sh |    4 +-
 tools/gcc/size_overflow_plugin.c         |  407 ++++++++++++++++--------------
 2 files changed, 222 insertions(+), 189 deletions(-)

commit 1a61aaa56e9992e19ebca969f97f45c220591636
Merge: 9de1e58 4f8377d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 15 19:50:27 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 4f8377d02704acea52bc8d39aade5c934e775e7e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 15 19:50:10 2012 -0400

    Update to pax-linux-2.6.32.59-test191.patch:
    - updated size overflow plugin from Emese

 tools/gcc/size_overflow_plugin.c |   37 +++++++++++++++++++++++++++++--------
 1 files changed, 29 insertions(+), 8 deletions(-)

commit 9de1e58c3324cbc5a849194b5484faec217e2772
Merge: 00e04de ffcb61b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 15 18:03:44 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit ffcb61becf3a6fa7682166243788a86c13f4fa4c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 15 18:03:17 2012 -0400

    Update to pax-linux-2.6.32.59-test190.patch:
    - updated report_size_overflow to the new version expected by the plugin

 fs/exec.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 00e04de95b78a2ee9c3142aaf5225897d88bbef2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 13 19:27:33 2012 -0400

    compile fix

 grsecurity/gracl_fs.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit b7136258ef79e7db3c074d24f4647a737f30d4bc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 13 19:23:46 2012 -0400

    compile fix

 security/commoncap.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit da64cc991e66e1497530588b16edf35e26500da8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 13 19:15:45 2012 -0400

    Add new is_privileged_binary/is_root_privileged_binary functions, make RBAC linking restrictions
    and option-based linking restrictions use it
    Clean up our sgid mode checking

 grsecurity/gracl.c         |    6 +++---
 grsecurity/gracl_fs.c      |    8 +++++---
 grsecurity/grsec_link.c    |    3 +--
 include/linux/capability.h |    3 +++
 security/commoncap.c       |   39 +++++++++++++++++++++++++++++++++++++++
 5 files changed, 51 insertions(+), 8 deletions(-)

commit 3395a4513e02a9fd899d0f4d0ee3865aa885574f
Merge: 68c38f8 1c45cd8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 12 09:16:43 2012 -0400

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	tools/gcc/size_overflow_hash.data

commit 1c45cd88efe30d5700b494577193f653f512176e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 12 09:14:23 2012 -0400

    Update to pax-linux-2.6.32.59-test189.patch:
    - new size overflow plugin from Emese that hopefully fixes most of the false positives and also adds more instrumentation (e.g., type casts)
    - size overflow plugin update from Emese that fixes a false positive
    - a USERCOPY false positive fix reported by Christian Lamparter
    - fixed REFCOUNT on arm
    - fixed size overflow attr placement on alloc_vmap_area

 arch/arm/include/asm/atomic.h     |    2 +-
 arch/x86/kernel/kdebugfs.c        |    4 +-
 arch/x86/lib/usercopy_32.c        |   12 +-
 include/linux/slob_def.h          |    3 +-
 include/linux/slub_def.h          |    6 +-
 mm/vmalloc.c                      |    9 +-
 tools/gcc/size_overflow_hash.data |  467 +++++++++++++++++++++++--
 tools/gcc/size_overflow_plugin.c  |  698 ++++++++++++++++++++++++++++---------
 8 files changed, 978 insertions(+), 223 deletions(-)

commit 68c38f81d4bd1cc988fb0832c4803a1a3be8077a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 11 20:12:03 2012 -0400

    Don't perform symlinkown checks in do_follow_link when LOOKUP_PARENT is
    set, it'll get handled under do_link in do_filp_open instead
    Thanks to CloudLinux for reporting

 fs/namei.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit b8f84907a5b7334e55367f2db2f31acfbafa9f99
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 10 18:59:04 2012 -0400

    Check target against NULL for recent symlinkown feature or we'll oops
    on trying to check the ownership of a non-existent symlink target
    Thanks to CloudLinux for reporting

 grsecurity/grsec_link.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 820a7173624798c455abc2934155ca2edbeaea2c
Merge: 41b2ab9 2ce88a4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 6 20:15:24 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 2ce88a4ba44cfbe2065ea6cdd7b8bb54ed518399
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 6 20:14:52 2012 -0400

    Update to pax-linux-2.6.32.59-test188.patch:
    - fixed mm.pax_flags configuration dependency

 include/linux/mm_types.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 41b2ab9e6b3953adf9dc0f49bc713ed5f0ae1732
Merge: 709e88a 204e494
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 6 17:14:00 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 204e494fc5a0207d6a06ed027c0dfc49b76d039f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 6 17:13:36 2012 -0400

    Update to pax-linux-2.6.32.59-test187.patch:
    - fixed another i386/KERNEXEC and EFI boot problem reported by Maxim Kammerer, https://bugs.gentoo.org/show_bug.cgi?id=430122

 arch/x86/kernel/efi_stub_32.S |   22 +++++++++++++++++++---
 1 files changed, 19 insertions(+), 3 deletions(-)

commit 709e88a7b033bdc68a066384ecaf8544c1e43802
Merge: ca02430 a202db6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 5 16:29:20 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit a202db6e9b64f2a9b7a3a3826bd20de499be706a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 5 16:28:34 2012 -0400

    Update to pax-linux-2.6.32.59-test186.patch:
    - fixed i386/KERNEXEC and EFI boot problem reported by Maxim Kammerer, https://bugs.gentoo.org/show_bug.cgi?id=428726

 arch/x86/boot/header.S |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

commit ca02430162467e2b62a4f2f6de08542cadb52bdc
Author: Darren Hart <dvhart@linux.intel.com>
Date:   Fri Jul 20 11:53:31 2012 -0700

    futex: Forbid uaddr == uaddr2 in futex_wait_requeue_pi()
    
    If uaddr == uaddr2, then we have broken the rule of only requeueing
    from a non-pi futex to a pi futex with this call. If we attempt this,
    as the trinity test suite manages to do, we miss early wakeups as
    q.key is equal to key2 (because they are the same uaddr). We will then
    attempt to dereference the pi_mutex (which would exist had the futex_q
    been properly requeued to a pi futex) and trigger a NULL pointer
    dereference.
    
    Signed-off-by: Darren Hart <dvhart@linux.intel.com>
    Cc: Dave Jones <davej@redhat.com>
    Cc: stable@vger.kernel.org
    Link: http://lkml.kernel.org/r/ad82bfe7f7d130247fbe2b5b4275654807774227.1342809673.git.dvhart@linux.intel.com
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    
    Conflicts:
    
    	kernel/futex.c

 kernel/futex.c |   13 ++++++++-----
 1 files changed, 8 insertions(+), 5 deletions(-)

commit 264171337c9d5a586a1783ac322d9e0382a2f5dc
Author: Darren Hart <dvhart@linux.intel.com>
Date:   Fri Jul 20 11:53:29 2012 -0700

    futex: Test for pi_mutex on fault in futex_wait_requeue_pi()
    
    If fixup_pi_state_owner() faults, pi_mutex may be NULL. Test
    for pi_mutex != NULL before testing the owner against current
    and possibly unlocking it.
    
    Signed-off-by: Darren Hart <dvhart@linux.intel.com>
    Cc: Dave Jones <davej@redhat.com>
    Cc: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable@vger.kernel.org
    Link: http://lkml.kernel.org/r/dc59890338fc413606f04e5c5b131530734dae3d.1342809673.git.dvhart@linux.intel.com
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

 kernel/futex.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 5e35a39f3fc775e76164f60390c05873e9cf41db
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 5 13:06:18 2012 -0400

    Allow addresses in /proc/modules, we make it unreadable to non-root

 kernel/module.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 09b9c6ef2b01ebe11756845f05d2880e6ae471ca
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 2 15:17:24 2012 -0400

    Use the unchecked function for the unchecked atomic_t

 net/netfilter/nf_conntrack_core.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit be3ec37e0c2935a3265f7025e7088d5265d66bf4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 1 17:11:37 2012 -0400

    Replace infoleaking slab name with an atomic counter

 net/netfilter/nf_conntrack_core.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

commit 901e452fa2981dae6a772a3cceda67293b994937
Author: Vikram Mulukutla <markivx@codeaurora.org>
Date:   Mon Jul 30 14:39:58 2012 -0700

    panic: fix a possible deadlock in panic()
    
    panic_lock is meant to ensure that panic processing takes place only on
    one cpu; if any of the other cpus encounter a panic, they will spin
    waiting to be shut down.
    
    However, this causes a regression in this scenario:
    
    1. Cpu 0 encounters a panic and acquires the panic_lock
       and proceeds with the panic processing.
    2. There is an interrupt on cpu 0 that also encounters
       an error condition and invokes panic.
    3. This second invocation fails to acquire the panic_lock
       and enters the infinite while loop in panic_smp_self_stop.
    
    Thus all panic processing is stopped, and the cpu is stuck for eternity
    in the while(1) inside panic_smp_self_stop.
    
    To address this, disable local interrupts with local_irq_disable before
    acquiring the panic_lock.  This will prevent interrupt handlers from
    executing during the panic processing, thus avoiding this particular
    problem.
    
    Signed-off-by: Vikram Mulukutla <markivx@codeaurora.org>
    Reviewed-by: Stephen Boyd <sboyd@codeaurora.org>
    Cc: Michael Holzheu <holzheu@linux.vnet.ibm.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 kernel/panic.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

commit 61b10131ee524d6b319b98bf96ed2be0b3173abd
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 31 17:59:16 2012 -0400

    Report discovered infoleaks

 lib/vsprintf.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

commit 75c3fbbf357709b487f2faa76f08dc62b612fdad
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 31 17:52:28 2012 -0400

    Backport HIDESYM improvements
    
    Conflicts:
    
    	kernel/kallsyms.c
    	lib/vsprintf.c

 fs/seq_file.c      |   16 ++++++++++++++++
 grsecurity/Kconfig |    1 +
 lib/vsprintf.c     |   12 ++++++++++++
 3 files changed, 29 insertions(+), 0 deletions(-)

commit 54408ff04f8f2cb0e4cf6198d57a4af0858f633d
Merge: 1f13f74 a7d3362
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 30 20:48:45 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit a7d336295ea6bcde1a6777d8f50e9fe523a80227
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 30 20:48:01 2012 -0400

    Update to pax-linux-2.6.32.59-test185.patch:
    - fixed a bug reported by Maxim Kammerer in https://bugs.gentoo.org/show_bug.cgi
    ?id=428576
      - work around some ld 'smartness' that merges empty sections with symbols, fix
    es relocatable !MODULES i386 builds

 arch/x86/boot/compressed/relocs.c |    2 +-
 arch/x86/kernel/vmlinux.lds.S     |    5 +++--
 2 files changed, 4 insertions(+), 3 deletions(-)

commit 1f13f7429d85badb804fa5071d4258a2ea92a9dd
Author: Weiping Pan <wpan@redhat.com>
Date:   Mon Jul 23 10:37:48 2012 +0800

    rds: set correct msg_namelen
    
    Jay Fenlason (fenlason@redhat.com) found a bug,
    that recvfrom() on an RDS socket can return the contents of random kernel
    memory to userspace if it was called with a address length larger than
    sizeof(struct sockaddr_in).
    rds_recvmsg() also fails to set the addr_len paramater properly before
    returning, but that's just a bug.
    There are also a number of cases wher recvfrom() can return an entirely bogus
    address. Anything in rds_recvmsg() that returns a non-negative value but does
    not go through the "sin = (struct sockaddr_in *)msg->msg_name;" code path
    at the end of the while(1) loop will return up to 128 bytes of kernel memory
    to userspace.
    
    And I write two test programs to reproduce this bug, you will see that in
    rds_server, fromAddr will be overwritten and the following sock_fd will be
    destroyed.
    Yes, it is the programmer's fault to set msg_namelen incorrectly, but it is
    better to make the kernel copy the real length of address to user space in
    such case.
    
    How to run the test programs ?
    I test them on 32bit x86 system, 3.5.0-rc7.
    
    1 compile
    gcc -o rds_client rds_client.c
    gcc -o rds_server rds_server.c
    
    2 run ./rds_server on one console
    
    3 run ./rds_client on another console
    
    4 you will see something like:
    server is waiting to receive data...
    old socket fd=3
    server received data from client:data from client
    msg.msg_namelen=32
    new socket fd=-1067277685
    sendmsg()
    : Bad file descriptor
    
    /***************** rds_client.c ********************/
    
    int main(void)
    {
    	int sock_fd;
    	struct sockaddr_in serverAddr;
    	struct sockaddr_in toAddr;
    	char recvBuffer[128] = "data from client";
    	struct msghdr msg;
    	struct iovec iov;
    
    	sock_fd = socket(AF_RDS, SOCK_SEQPACKET, 0);
    	if (sock_fd < 0) {
    		perror("create socket error\n");
    		exit(1);
    	}
    
    	memset(&serverAddr, 0, sizeof(serverAddr));
    	serverAddr.sin_family = AF_INET;
    	serverAddr.sin_addr.s_addr = inet_addr("127.0.0.1");
    	serverAddr.sin_port = htons(4001);
    
    	if (bind(sock_fd, (struct sockaddr*)&serverAddr, sizeof(serverAddr)) < 0) {
    		perror("bind() error\n");
    		close(sock_fd);
    		exit(1);
    	}
    
    	memset(&toAddr, 0, sizeof(toAddr));
    	toAddr.sin_family = AF_INET;
    	toAddr.sin_addr.s_addr = inet_addr("127.0.0.1");
    	toAddr.sin_port = htons(4000);
    	msg.msg_name = &toAddr;
    	msg.msg_namelen = sizeof(toAddr);
    	msg.msg_iov = &iov;
    	msg.msg_iovlen = 1;
    	msg.msg_iov->iov_base = recvBuffer;
    	msg.msg_iov->iov_len = strlen(recvBuffer) + 1;
    	msg.msg_control = 0;
    	msg.msg_controllen = 0;
    	msg.msg_flags = 0;
    
    	if (sendmsg(sock_fd, &msg, 0) == -1) {
    		perror("sendto() error\n");
    		close(sock_fd);
    		exit(1);
    	}
    
    	printf("client send data:%s\n", recvBuffer);
    
    	memset(recvBuffer, '\0', 128);
    
    	msg.msg_name = &toAddr;
    	msg.msg_namelen = sizeof(toAddr);
    	msg.msg_iov = &iov;
    	msg.msg_iovlen = 1;
    	msg.msg_iov->iov_base = recvBuffer;
    	msg.msg_iov->iov_len = 128;
    	msg.msg_control = 0;
    	msg.msg_controllen = 0;
    	msg.msg_flags = 0;
    	if (recvmsg(sock_fd, &msg, 0) == -1) {
    		perror("recvmsg() error\n");
    		close(sock_fd);
    		exit(1);
    	}
    
    	printf("receive data from server:%s\n", recvBuffer);
    
    	close(sock_fd);
    
    	return 0;
    }
    
    /***************** rds_server.c ********************/
    
    int main(void)
    {
    	struct sockaddr_in fromAddr;
    	int sock_fd;
    	struct sockaddr_in serverAddr;
    	unsigned int addrLen;
    	char recvBuffer[128];
    	struct msghdr msg;
    	struct iovec iov;
    
    	sock_fd = socket(AF_RDS, SOCK_SEQPACKET, 0);
    	if(sock_fd < 0) {
    		perror("create socket error\n");
    		exit(0);
    	}
    
    	memset(&serverAddr, 0, sizeof(serverAddr));
    	serverAddr.sin_family = AF_INET;
    	serverAddr.sin_addr.s_addr = inet_addr("127.0.0.1");
    	serverAddr.sin_port = htons(4000);
    	if (bind(sock_fd, (struct sockaddr*)&serverAddr, sizeof(serverAddr)) < 0) {
    		perror("bind error\n");
    		close(sock_fd);
    		exit(1);
    	}
    
    	printf("server is waiting to receive data...\n");
    	msg.msg_name = &fromAddr;
    
    	/*
    	 * I add 16 to sizeof(fromAddr), ie 32,
    	 * and pay attention to the definition of fromAddr,
    	 * recvmsg() will overwrite sock_fd,
    	 * since kernel will copy 32 bytes to userspace.
    	 *
    	 * If you just use sizeof(fromAddr), it works fine.
    	 * */
    	msg.msg_namelen = sizeof(fromAddr) + 16;
    	/* msg.msg_namelen = sizeof(fromAddr); */
    	msg.msg_iov = &iov;
    	msg.msg_iovlen = 1;
    	msg.msg_iov->iov_base = recvBuffer;
    	msg.msg_iov->iov_len = 128;
    	msg.msg_control = 0;
    	msg.msg_controllen = 0;
    	msg.msg_flags = 0;
    
    	while (1) {
    		printf("old socket fd=%d\n", sock_fd);
    		if (recvmsg(sock_fd, &msg, 0) == -1) {
    			perror("recvmsg() error\n");
    			close(sock_fd);
    			exit(1);
    		}
    		printf("server received data from client:%s\n", recvBuffer);
    		printf("msg.msg_namelen=%d\n", msg.msg_namelen);
    		printf("new socket fd=%d\n", sock_fd);
    		strcat(recvBuffer, "--data from server");
    		if (sendmsg(sock_fd, &msg, 0) == -1) {
    			perror("sendmsg()\n");
    			close(sock_fd);
    			exit(1);
    		}
    	}
    
    	close(sock_fd);
    	return 0;
    }
    
    Signed-off-by: Weiping Pan <wpan@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/rds/recv.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit bb9c4abdf87a162ac076f0c75ef2e12b156441cf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 30 16:58:07 2012 -0400

    Make GRKERNSEC enable PROC_FS

 security/Kconfig |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 38e19cf070f74949cf7f01493ff68777b3a05777
Merge: 2b1d305 a154df1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 19:40:52 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit a154df1683155c8c3330c67f292e5e7d8ff9928d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 19:40:03 2012 -0400

    Initialize mlock error code to 0, fixes erroneous -EINVAL reported with lvm on the forums

 mm/mlock.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 2b1d3055f23e41fea892556d327fe3c3e608b30a
Merge: 1025d4e 5f58fbb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 19:27:14 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 5f58fbb9e96c2e4426412021b0b7319e8588f4e2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 19:24:13 2012 -0400

    Update to pax-linux-3.4.6-test25.patch:
    - added emulation for new sparc plt stubs

 arch/sparc/mm/fault_32.c |   25 +++++++++++++++++--------
 arch/sparc/mm/fault_64.c |   25 +++++++++++++++++--------
 2 files changed, 34 insertions(+), 16 deletions(-)

commit 1025d4e42dd42dd29bbdff31f05856a98aaf7d99
Merge: 9d8e215 47a014a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 18:19:13 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 47a014a4499483812e808987338f380a34128aad
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 18:18:09 2012 -0400

    Backport changes from pax-linux-3.4.6-test25.patch:
    - added emulation for a new sparc plt stub

 arch/sparc/mm/fault_32.c |   14 ++++++++++----
 arch/sparc/mm/fault_64.c |   14 ++++++++++----
 2 files changed, 20 insertions(+), 8 deletions(-)

commit 9d8e21513434f56e3a4ae12df2da7ddce8daeb7b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 17:26:05 2012 -0400

    Additional fix to keep_bootcon

 kernel/printk.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

commit 7f70735dc0d3f84d4e6b07946776c595667d6868
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 17:12:28 2012 -0400

    fix typo

 kernel/printk.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 3fd4e79b82785942b0c3a29f08d3b7f1805f4181
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 17:08:08 2012 -0400

    Add keep_bootcon to debug sparc booting

 Documentation/kernel-parameters.txt |    6 ++++++
 kernel/printk.c                     |   16 +++++++++++++++-
 2 files changed, 21 insertions(+), 1 deletions(-)

commit 2e17a162ddca0ff111419829a222c74c75671d51
Merge: 171c145 b41e4cc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 16:40:47 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit b41e4ccf42b87b1362cecff08b0dde599d185497
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 16:40:26 2012 -0400

    Fix boot failure on SLUB and USERCOPY

 mm/slub.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 171c1454dd100f1e9d76b142b90eeb372bf75e56
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 12:59:04 2012 -0400

    Update calls from PaX plugin due to backported random.c changes

 drivers/char/random.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit bd4da3d58f1f292d13d2553d1f642d3be725c7de
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 09:49:32 2012 -0400

    Turn on the latent entropy plugin by default

 security/Kconfig |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit fda76de85bbd1c61ff0a7fe013df085fdb65d0e9
Author: Tony Luck <tony.luck@intel.com>
Date:   Fri Jul 20 13:15:20 2012 -0700

    dmi: Feed DMI table to /dev/random driver
    
    Send the entire DMI (SMBIOS) table to the /dev/random driver to
    help seed its pools.
    
    Signed-off-by: Tony Luck <tony.luck@intel.com>
    Signed-off-by: Theodore Ts'o <tytso@mit.edu>
    
    Conflicts:
    
    	drivers/firmware/dmi_scan.c

 drivers/firmware/dmi_scan.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit f7a30b957ca132901f7d2ae3a748c293e9bdc679
Author: H. Peter Anvin <hpa@linux.intel.com>
Date:   Fri Jul 27 22:26:08 2012 -0400

    random: mix in architectural randomness in extract_buf()
    
    Mix in any architectural randomness in extract_buf() instead of
    xfer_secondary_buf().  This allows us to mix in more architectural
    randomness, and it also makes xfer_secondary_buf() faster, moving a
    tiny bit of additional CPU overhead to process which is extracting the
    randomness.
    
    [ Commit description modified by tytso to remove an extended
      advertisement for the RDRAND instruction. ]
    
    Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
    Acked-by: Ingo Molnar <mingo@kernel.org>
    Cc: DJ Johnston <dj.johnston@intel.com>
    Signed-off-by: Theodore Ts'o <tytso@mit.edu>
    Cc: stable@vger.kernel.org
    
    Conflicts:
    
    	drivers/char/random.c

 drivers/char/random.c |   55 ++++++++++++++++++++++++++++--------------------
 1 files changed, 32 insertions(+), 23 deletions(-)

commit 2b2af6f79b2c2a4ce3b58fdc95fe5a2052821998
Merge: a5c1e71 9f923bc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 09:36:13 2012 -0400

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	drivers/char/random.c
    	security/Kconfig

commit 9f923bc03561ebe36f96ade4376a2f2c8b930756
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 09:31:39 2012 -0400

    Update to pax-linux-2.6.32.59-test182.patch
    - reorganized the USERCOPY infrastructure so that grsecurity can depend on certain parts of it
    - fix up the last changes as pointed out by spender
    - reworked the latent entropy plugin to use an explicit function attribute
    - fixed a recent REFCOUNT change that broke !X86
    - made the latent entropy plugin sort of LTO compatible
    `

 Documentation/dontdiff            |    3 +-
 Makefile                          |    8 +-
 arch/x86/include/asm/atomic_32.h  |   36 ++++-
 arch/x86/include/asm/atomic_64.h  |   39 ++++-
 drivers/char/mem.c                |    4 +-
 drivers/char/random.c             |   11 ++
 fs/binfmt_elf.c                   |   72 ++-------
 fs/bio.c                          |    2 +-
 fs/exec.c                         |   26 +++-
 include/asm-generic/atomic-long.h |    6 +
 include/asm-generic/atomic.h      |    2 +-
 include/linux/compiler-gcc4.h     |    5 +
 include/linux/compiler.h          |    5 +
 include/linux/gfp.h               |   10 +-
 include/linux/init.h              |   14 ++-
 include/linux/random.h            |    4 +
 include/linux/sched.h             |    6 +-
 include/linux/slab.h              |    5 +-
 include/linux/slab_def.h          |   19 +++
 init/main.c                       |   16 ++-
 mm/slab.c                         |   71 ++++++---
 mm/slob.c                         |   45 +++----
 mm/slub.c                         |   77 +++++++---
 scripts/mod/modpost.c             |   10 +-
 security/Kconfig                  |   41 ++++--
 tools/gcc/.gitignore              |    1 +
 tools/gcc/Makefile                |    2 +
 tools/gcc/colorize_plugin.c       |    2 +-
 tools/gcc/constify_plugin.c       |    2 +-
 tools/gcc/kallocstat_plugin.c     |    2 +-
 tools/gcc/kernexec_plugin.c       |    6 +-
 tools/gcc/latent_entropy_plugin.c |  295 +++++++++++++++++++++++++++++++++++++
 tools/gcc/stackleak_plugin.c      |    4 +-
 33 files changed, 658 insertions(+), 193 deletions(-)

commit a5c1e714180aacf43785d94c4b9a73f74dab801d
Author: David S. Miller <davem@davemloft.net>
Date:   Wed Jan 5 13:08:06 2011 -0800

    atyfb: Fix bootup hangs on sparc64.
    
    After commit 25edd6946a1d74e5e77813c2324a0908c68bcf9e ("sparc64: Get
    rid of indirect p1275 PROM call buffer.")  we can't pass virtual
    addresses >4GB to PROM calls.
    
    Largely this is never necessary in drivers because we have a copy of
    the entire PROM device tree in the kernel and a set of of_*()
    interfaces to access it.
    
    Unfortunately there were some lingering prom calls in the atyfb
    driver, in particular prom_finddevice() was being called with an
    on-stack address which could be anywhere.
    
    This code is actually probing for information we already have, the
    PROM choosen console output device is stored in of_console_device so
    all of this nasty code consolidates into a one-line comparison.
    
    Next we have some prom_getintdefault() calls which are trivially
    transformed into the equivalent of_getintprop_default().
    
    Special thanks to Fabio, who figured out exactly where the bootup
    was hanging.  That made this bug trivial to fix.
    
    Reported-by: Fabio M. Di NItto <fabbione@fabbione.net>
    Reported-by: Sam Ravnborg <sam@ravnborg.org>
    Reported-by: Frans van Berckel <fberckel@xs4all.nl>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Fabio M. Di NItto <fabbione@fabbione.net>
    
    Conflicts:
    
    	drivers/video/aty/atyfb_base.c

 drivers/video/aty/atyfb_base.c |   26 +++++---------------------
 1 files changed, 5 insertions(+), 21 deletions(-)

commit 876ad154b6027b5b03a5ec36b35fe6567d5474df
Author: Vasiliy Kulikov <segoon@openwall.com>
Date:   Tue Jul 26 16:08:38 2011 -0700

    proc: fix a race in do_io_accounting()
    
    If an inode's mode permits opening /proc/PID/io and the resulting file
    descriptor is kept across execve() of a setuid or similar binary, the
    ptrace_may_access() check tries to prevent using this fd against the
    task with escalated privileges.
    
    Unfortunately, there is a race in the check against execve().  If
    execve() is processed after the ptrace check, but before the actual io
    information gathering, io statistics will be gathered from the
    privileged process.  At least in theory this might lead to gathering
    sensible information (like ssh/ftp password length) that wouldn't be
    available otherwise.
    
    Holding task->signal->cred_guard_mutex while gathering the io
    information should protect against the race.
    
    The order of locking is similar to the one inside of ptrace_attach():
    first goes cred_guard_mutex, then lock_task_sighand().
    
    Signed-off-by: Vasiliy Kulikov <segoon@openwall.com>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Cc: <stable@kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/proc/base.c |   16 +++++++++++++---
 1 files changed, 13 insertions(+), 3 deletions(-)

commit e5cd162e117380d9b2bb7c130ee4746c0206d47c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 24 20:34:13 2012 -0400

    use min_t instead of min

 fs/proc/base.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit cd7326a5ef12de0eac13c4ab0f6c736627ac70ec
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 24 20:22:48 2012 -0400

    Fix bad merge of cred_guard_mutex change

 include/linux/init_task.h |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

commit 848277639f9bf5db81a131cd9006fda154e2f044
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 24 20:08:39 2012 -0400

    Add duplicate access checks for /proc/pid/environ

 fs/proc/base.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

commit 4aff82f6e44d1dbca5dae9093f3f79e090b68d03
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 24 20:02:10 2012 -0400

    Fix up more users of cred_guard_mutex

 fs/proc/base.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

commit fbd2b3566eaee334b6b11e744056e2099a75d3fd
Author: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
Date:   Wed Oct 27 15:34:08 2010 -0700

    signals: move cred_guard_mutex from task_struct to signal_struct
    
    Oleg Nesterov pointed out we have to prevent multiple-threads-inside-exec
    itself and we can reuse ->cred_guard_mutex for it.  Yes, concurrent
    execve() has no worth.
    
    Let's move ->cred_guard_mutex from task_struct to signal_struct.  It
    naturally prevent multiple-threads-inside-exec.
    
    Signed-off-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Reviewed-by: Oleg Nesterov <oleg@redhat.com>
    Acked-by: Roland McGrath <roland@redhat.com>
    Acked-by: David Howells <dhowells@redhat.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	include/linux/init_task.h
    	include/linux/sched.h
    	kernel/cred.c

 fs/exec.c                 |   10 +++++-----
 fs/proc/base.c            |    8 ++++----
 include/linux/init_task.h |    6 ++++--
 include/linux/sched.h     |    6 +++---
 include/linux/tracehook.h |    2 +-
 kernel/cred.c             |    4 +---
 kernel/fork.c             |    2 ++
 kernel/ptrace.c           |    4 ++--
 8 files changed, 22 insertions(+), 20 deletions(-)

commit 99fd60f9e633a888e6d487df6834d172f32af4da
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 23 18:59:53 2012 -0400

    Fix up range checks on environ_read, reported at:
    http://permalink.gmane.org/gmane.linux.kernel.hardened.devel/472

 fs/proc/base.c |   13 +++++++------
 1 files changed, 7 insertions(+), 6 deletions(-)

commit 6b7fa6f6a512bb3c79a7618e56bc2a827611c330
Author: J. Bruce Fields <bfields@fieldses.org>
Date:   Mon Jul 23 15:17:17 2012 -0400

    locks: fix checking of fcntl_setlease argument
    
    The only checks of the long argument passed to fcntl(fd,F_SETLEASE,.)
    are done after converting the long to an int.  Thus some illegal values
    may be let through and cause problems in later code.
    
    [ They actually *don't* cause problems in mainline, as of Dave Jones's
      commit 8d657eb3b438 "Remove easily user-triggerable BUG from
      generic_setlease", but we should fix this anyway.  And this patch will
      be necessary to fix real bugs on earlier kernels. ]
    
    Cc: stable@vger.kernel.org
    Signed-off-by: J. Bruce Fields <bfields@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/locks.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

commit 8cf250584f374ea2b8eee0bedc14d3fe4e6ea786
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 21 12:44:16 2012 -0400

    Add second fs/bio.c overflow check

 fs/bio.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit f094f86cc64e86bd5df2c0bfecb24d6891836319
Author: Anders Kaseorg <andersk@MIT.EDU>
Date:   Sun Jul 15 17:14:25 2012 -0400

    fifo: Do not restart open() if it already found a partner
    
    If a parent and child process open the two ends of a fifo, and the
    child immediately exits, the parent may receive a SIGCHLD before its
    open() returns.  In that case, we need to make sure that open() will
    return successfully after the SIGCHLD handler returns, instead of
    throwing EINTR or being restarted.  Otherwise, the restarted open()
    would incorrectly wait for a second partner on the other end.
    
    The following test demonstrates the EINTR that was wrongly thrown from
    the parent’s open().  Change .sa_flags = 0 to .sa_flags = SA_RESTART
    to see a deadlock instead, in which the restarted open() waits for a
    second reader that will never come.  (On my systems, this happens
    pretty reliably within about 5 to 500 iterations.  Others report that
    it manages to loop ~forever sometimes; YMMV.)
    
      #include <sys/stat.h>
      #include <sys/types.h>
      #include <sys/wait.h>
      #include <fcntl.h>
      #include <signal.h>
      #include <stdio.h>
      #include <stdlib.h>
      #include <unistd.h>
    
      #define CHECK(x) do if ((x) == -1) {perror(#x); abort();} while(0)
    
      void handler(int signum) {}
    
      int main()
      {
          struct sigaction act = {.sa_handler = handler, .sa_flags = 0};
          CHECK(sigaction(SIGCHLD, &act, NULL));
          CHECK(mknod("fifo", S_IFIFO | S_IRWXU, 0));
          for (;;) {
              int fd;
              pid_t pid;
              putc('.', stderr);
              CHECK(pid = fork());
              if (pid == 0) {
                  CHECK(fd = open("fifo", O_RDONLY));
                  _exit(0);
              }
              CHECK(fd = open("fifo", O_WRONLY));
              CHECK(close(fd));
              CHECK(waitpid(pid, NULL, 0));
          }
      }
    
    This is what I suspect was causing the Git test suite to fail in
    t9010-svn-fe.sh:
    
    	http://bugs.debian.org/678852
    
    Signed-off-by: Anders Kaseorg <andersk@mit.edu>
    Reviewed-by: Jonathan Nieder <jrnieder@gmail.com>
    Cc: stable@kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/fifo.c

 fs/fifo.c |   12 +++++-------
 1 files changed, 5 insertions(+), 7 deletions(-)

commit e39b3171e24c63689fefeffd6cd2ff321084e1ec
Author: Neil Horman <nhorman@tuxdriver.com>
Date:   Mon Jul 16 09:13:51 2012 +0000

    sctp: Fix list corruption resulting from freeing an association on a list
    
    A few days ago Dave Jones reported this oops:
    
    [22766.294255] general protection fault: 0000 [#1] PREEMPT SMP
    [22766.295376] CPU 0
    [22766.295384] Modules linked in:
    [22766.387137]  ffffffffa169f292 6b6b6b6b6b6b6b6b ffff880147c03a90
    ffff880147c03a74
    [22766.387135] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 00000000000
    [22766.387136] Process trinity-watchdo (pid: 10896, threadinfo ffff88013e7d2000,
    [22766.387137] Stack:
    [22766.387140]  ffff880147c03a10
    [22766.387140]  ffffffffa169f2b6
    [22766.387140]  ffff88013ed95728
    [22766.387143]  0000000000000002
    [22766.387143]  0000000000000000
    [22766.387143]  ffff880003fad062
    [22766.387144]  ffff88013c120000
    [22766.387144]
    [22766.387145] Call Trace:
    [22766.387145]  <IRQ>
    [22766.387150]  [<ffffffffa169f292>] ? __sctp_lookup_association+0x62/0xd0
    [sctp]
    [22766.387154]  [<ffffffffa169f2b6>] __sctp_lookup_association+0x86/0xd0 [sctp]
    [22766.387157]  [<ffffffffa169f597>] sctp_rcv+0x207/0xbb0 [sctp]
    [22766.387161]  [<ffffffff810d4da8>] ? trace_hardirqs_off_caller+0x28/0xd0
    [22766.387163]  [<ffffffff815827e3>] ? nf_hook_slow+0x133/0x210
    [22766.387166]  [<ffffffff815902fc>] ? ip_local_deliver_finish+0x4c/0x4c0
    [22766.387168]  [<ffffffff8159043d>] ip_local_deliver_finish+0x18d/0x4c0
    [22766.387169]  [<ffffffff815902fc>] ? ip_local_deliver_finish+0x4c/0x4c0
    [22766.387171]  [<ffffffff81590a07>] ip_local_deliver+0x47/0x80
    [22766.387172]  [<ffffffff8158fd80>] ip_rcv_finish+0x150/0x680
    [22766.387174]  [<ffffffff81590c54>] ip_rcv+0x214/0x320
    [22766.387176]  [<ffffffff81558c07>] __netif_receive_skb+0x7b7/0x910
    [22766.387178]  [<ffffffff8155856c>] ? __netif_receive_skb+0x11c/0x910
    [22766.387180]  [<ffffffff810d423e>] ? put_lock_stats.isra.25+0xe/0x40
    [22766.387182]  [<ffffffff81558f83>] netif_receive_skb+0x23/0x1f0
    [22766.387183]  [<ffffffff815596a9>] ? dev_gro_receive+0x139/0x440
    [22766.387185]  [<ffffffff81559280>] napi_skb_finish+0x70/0xa0
    [22766.387187]  [<ffffffff81559cb5>] napi_gro_receive+0xf5/0x130
    [22766.387218]  [<ffffffffa01c4679>] e1000_receive_skb+0x59/0x70 [e1000e]
    [22766.387242]  [<ffffffffa01c5aab>] e1000_clean_rx_irq+0x28b/0x460 [e1000e]
    [22766.387266]  [<ffffffffa01c9c18>] e1000e_poll+0x78/0x430 [e1000e]
    [22766.387268]  [<ffffffff81559fea>] net_rx_action+0x1aa/0x3d0
    [22766.387270]  [<ffffffff810a495f>] ? account_system_vtime+0x10f/0x130
    [22766.387273]  [<ffffffff810734d0>] __do_softirq+0xe0/0x420
    [22766.387275]  [<ffffffff8169826c>] call_softirq+0x1c/0x30
    [22766.387278]  [<ffffffff8101db15>] do_softirq+0xd5/0x110
    [22766.387279]  [<ffffffff81073bc5>] irq_exit+0xd5/0xe0
    [22766.387281]  [<ffffffff81698b03>] do_IRQ+0x63/0xd0
    [22766.387283]  [<ffffffff8168ee2f>] common_interrupt+0x6f/0x6f
    [22766.387283]  <EOI>
    [22766.387284]
    [22766.387285]  [<ffffffff8168eed9>] ? retint_swapgs+0x13/0x1b
    [22766.387285] Code: c0 90 5d c3 66 0f 1f 44 00 00 4c 89 c8 5d c3 0f 1f 00 55 48
    89 e5 48 83
    ec 20 48 89 5d e8 4c 89 65 f0 4c 89 6d f8 66 66 66 66 90 <0f> b7 87 98 00 00 00
    48 89 fb
    49 89 f5 66 c1 c0 08 66 39 46 02
    [22766.387307]
    [22766.387307] RIP
    [22766.387311]  [<ffffffffa168a2c9>] sctp_assoc_is_match+0x19/0x90 [sctp]
    [22766.387311]  RSP <ffff880147c039b0>
    [22766.387142]  ffffffffa16ab120
    [22766.599537] ---[ end trace 3f6dae82e37b17f5 ]---
    [22766.601221] Kernel panic - not syncing: Fatal exception in interrupt
    
    It appears from his analysis and some staring at the code that this is likely
    occuring because an association is getting freed while still on the
    sctp_assoc_hashtable.  As a result, we get a gpf when traversing the hashtable
    while a freed node corrupts part of the list.
    
    Nominally I would think that an mibalanced refcount was responsible for this,
    but I can't seem to find any obvious imbalance.  What I did note however was
    that the two places where we create an association using
    sctp_primitive_ASSOCIATE (__sctp_connect and sctp_sendmsg), have failure paths
    which free a newly created association after calling sctp_primitive_ASSOCIATE.
    sctp_primitive_ASSOCIATE brings us into the sctp_sf_do_prm_asoc path, which
    issues a SCTP_CMD_NEW_ASOC side effect, which in turn adds a new association to
    the aforementioned hash table.  the sctp command interpreter that process side
    effects has not way to unwind previously processed commands, so freeing the
    association from the __sctp_connect or sctp_sendmsg error path would lead to a
    freed association remaining on this hash table.
    
    I've fixed this but modifying sctp_[un]hash_established to use hlist_del_init,
    which allows us to proerly use hlist_unhashed to check if the node is on a
    hashlist safely during a delete.  That in turn alows us to safely call
    sctp_unhash_established in the __sctp_connect and sctp_sendmsg error paths
    before freeing them, regardles of what the associations state is on the hash
    list.
    
    I noted, while I was doing this, that the __sctp_unhash_endpoint was using
    hlist_unhsashed in a simmilar fashion, but never nullified any removed nodes
    pointers to make that function work properly, so I fixed that up in a simmilar
    fashion.
    
    I attempted to test this using a virtual guest running the SCTP_RR test from
    netperf in a loop while running the trinity fuzzer, both in a loop.  I wasn't
    able to recreate the problem prior to this fix, nor was I able to trigger the
    failure after (neither of which I suppose is suprising).  Given the trace above
    however, I think its likely that this is what we hit.
    
    Signed-off-by: Neil Horman <nhorman@tuxdriver.com>
    Reported-by: davej@redhat.com
    CC: davej@redhat.com
    CC: "David S. Miller" <davem@davemloft.net>
    CC: Vlad Yasevich <vyasevich@gmail.com>
    CC: Sridhar Samudrala <sri@us.ibm.com>
    CC: linux-sctp@vger.kernel.org
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/sctp/input.c  |    7 ++-----
 net/sctp/socket.c |   12 ++++++++++--
 2 files changed, 12 insertions(+), 7 deletions(-)

commit f11d91abcb03d53d0c99b70db83e78ff8ef659e2
Author: Paul Moore <pmoore@redhat.com>
Date:   Tue Jul 17 11:07:47 2012 +0000

    cipso: don't follow a NULL pointer when setsockopt() is called
    
    As reported by Alan Cox, and verified by Lin Ming, when a user
    attempts to add a CIPSO option to a socket using the CIPSO_V4_TAG_LOCAL
    tag the kernel dies a terrible death when it attempts to follow a NULL
    pointer (the skb argument to cipso_v4_validate() is NULL when called via
    the setsockopt() syscall).
    
    This patch fixes this by first checking to ensure that the skb is
    non-NULL before using it to find the incoming network interface.  In
    the unlikely case where the skb is NULL and the user attempts to add
    a CIPSO option with the _TAG_LOCAL tag we return an error as this is
    not something we want to allow.
    
    A simple reproducer, kindly supplied by Lin Ming, although you must
    have the CIPSO DOI #3 configure on the system first or you will be
    caught early in cipso_v4_validate():
    
    	#include <sys/types.h>
    	#include <sys/socket.h>
    	#include <linux/ip.h>
    	#include <linux/in.h>
    	#include <string.h>
    
    	struct local_tag {
    		char type;
    		char length;
    		char info[4];
    	};
    
    	struct cipso {
    		char type;
    		char length;
    		char doi[4];
    		struct local_tag local;
    	};
    
    	int main(int argc, char **argv)
    	{
    		int sockfd;
    		struct cipso cipso = {
    			.type = IPOPT_CIPSO,
    			.length = sizeof(struct cipso),
    			.local = {
    				.type = 128,
    				.length = sizeof(struct local_tag),
    			},
    		};
    
    		memset(cipso.doi, 0, 4);
    		cipso.doi[3] = 3;
    
    		sockfd = socket(AF_INET, SOCK_DGRAM, 0);
    		#define SOL_IP 0
    		setsockopt(sockfd, SOL_IP, IP_OPTIONS,
    			&cipso, sizeof(struct cipso));
    
    		return 0;
    	}
    
    CC: Lin Ming <mlin@ss.pku.edu.cn>
    Reported-by: Alan Cox <alan@lxorguk.ukuu.org.uk>
    Signed-off-by: Paul Moore <pmoore@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/cipso_ipv4.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

commit 073a62d0bbe2e0c71d77efa3b0f6742137edd2d0
Author: Jeff Moyer <jmoyer@redhat.com>
Date:   Thu Jul 12 09:43:14 2012 -0400

    block: fix infinite loop in __getblk_slow
    
    Commit 080399aaaf35 ("block: don't mark buffers beyond end of disk as
    mapped") exposed a bug in __getblk_slow that causes mount to hang as it
    loops infinitely waiting for a buffer that lies beyond the end of the
    disk to become uptodate.
    
    The problem was initially reported by Torsten Hilbrich here:
    
        https://lkml.org/lkml/2012/6/18/54
    
    and also reported independently here:
    
        http://www.sysresccd.org/forums/viewtopic.php?f=13&t=4511
    
    and then Richard W.M.  Jones and Marcos Mello noted a few separate
    bugzillas also associated with the same issue.  This patch has been
    confirmed to fix:
    
        https://bugzilla.redhat.com/show_bug.cgi?id=835019
    
    The main problem is here, in __getblk_slow:
    
            for (;;) {
                    struct buffer_head * bh;
                    int ret;
    
                    bh = __find_get_block(bdev, block, size);
                    if (bh)
                            return bh;
    
                    ret = grow_buffers(bdev, block, size);
                    if (ret < 0)
                            return NULL;
                    if (ret == 0)
                            free_more_memory();
            }
    
    __find_get_block does not find the block, since it will not be marked as
    mapped, and so grow_buffers is called to fill in the buffers for the
    associated page.  I believe the for (;;) loop is there primarily to
    retry in the case of memory pressure keeping grow_buffers from
    succeeding.  However, we also continue to loop for other cases, like the
    block lying beond the end of the disk.  So, the fix I came up with is to
    only loop when grow_buffers fails due to memory allocation issues
    (return value of 0).
    
    The attached patch was tested by myself, Torsten, and Rich, and was
    found to resolve the problem in call cases.
    
    Signed-off-by: Jeff Moyer <jmoyer@redhat.com>
    Reported-and-Tested-by: Torsten Hilbrich <torsten.hilbrich@secunet.com>
    Tested-by: Richard W.M. Jones <rjones@redhat.com>
    Reviewed-by: Josh Boyer <jwboyer@redhat.com>
    Cc: Stable <stable@vger.kernel.org>  # 3.0+
    [ Jens is on vacation, taking this directly  - Linus ]
    --
    Stable Notes: this patch requires backport to 3.0, 3.2 and 3.3.
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/buffer.c |   22 +++++++++++++---------
 1 files changed, 13 insertions(+), 9 deletions(-)

commit 5cfc159740a87e931b356cf8b1b0a6cfc876efe6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 16 17:42:23 2012 -0400

    backport of dup_task fix from ab93eb82164f9fc426eae7b286510cfd94738b8e

 kernel/fork.c |   11 ++++++++---
 1 files changed, 8 insertions(+), 3 deletions(-)

commit cd930ef2e95053464c6bc18452f0420cfbc8da90
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 15 09:12:31 2012 -0400

    Don't build kernel/stop_machine.c on UP

 kernel/Makefile |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 5b2f565b0d7f513cd866d3ca33cb299f23a62e09
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jul 13 11:06:13 2012 -0400

        be2net: fix a race in be_xmit()
    
        [ Upstream commit cd8f76c0a0c6fce0b2cf23c9bd0123f91453f46d ]
    
        As soon as hardware is notified of a transmit, we no longer can assume
        skb can be dereferenced, as TX completion might have freed the packet.
    
        Signed-off-by: Eric Dumazet <edumazet@google.com>
        Cc: Sathya Perla <sathya.perla@emulex.com>
        Signed-off-by: David S. Miller <davem@davemloft.net>
        Signed-off-by: Ben Hutchings <ben@decadent.org.uk>

 drivers/net/benet/be_main.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

commit 29f73564adf7f56f749877e585f3c09a51862f89
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 12 21:53:37 2012 -0400

    Force STOP_MACHINE on if grsecurity is enabled

 init/Kconfig     |    2 +-
 security/Kconfig |    1 +
 2 files changed, 2 insertions(+), 1 deletions(-)

commit 1073afa377fbda7573badcbfb079a02c76b501cc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 12 21:14:51 2012 -0400

    Fix possible race on RBAC disable by ensuring all other
    CPUs are forced out of the kernel -- this is preferable to
    other locking methods that would impact performance of common paths
    for what should be a very infrequent operation that doesn't
    need to be fast
    Thanks to Mark Moseley for reporting and testing
    
    Conflicts:
    
    	grsecurity/gracl.c

 grsecurity/gracl.c |   33 +++++++++++++++++----------------
 1 files changed, 17 insertions(+), 16 deletions(-)

commit 50fc9e761beed30bb7c974458e72c1b0504e619e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 12 20:46:54 2012 -0400

    Fix RBAC enable / special role exit race with fork
    Thanks to Mark Moseley for reporting and testing
    
    race looked like:
    >   cpu 1                               cpu 2
    >   fork begins
    >   fork calls dup_task_struct
    >                                       RBAC sets ->acl on all procs in tasklist
    >   fork completes, adds to tasklist
    >                                       RBAC sets enabled flag
    >   process exists with RBAC enabled
    >   and NULL ->acl

 grsecurity/gracl.c |   11 +++++------
 kernel/fork.c      |    5 +++--
 2 files changed, 8 insertions(+), 8 deletions(-)

commit efce57e2f0b61c225449bc624afdb9034a31303b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 7 20:30:28 2012 -0400

    Backport security fix:
    http://git.kernel.org/?p=linux/kernel/git/torvalds/linux.git;a=commitdiff;h=9ab4233dd08036fe34a89c7dc6f47a8bf2eb29eb
    
    author	Andy Lutomirski <luto@amacapital.net>
    Thu, 5 Jul 2012 23:00:11 +0000 (16:00 -0700)
    committer	Linus Torvalds <torvalds@linux-foundation.org>
    Fri, 6 Jul 2012 17:34:38 +0000 (10:34 -0700)
    Otherwise the code races with munmap (causing a use-after-free
    of the vma) or with close (causing a use-after-free of the struct
    file).
    
    The bug was introduced by commit 90ed52ebe481 ("[PATCH] holepunch: fix
    mmap_sem i_mutex deadlock")
    
    Cc: Hugh Dickins <hugh@veritas.com>
    Cc: Miklos Szeredi <mszeredi@suse.cz>
    Cc: Badari Pulavarty <pbadari@us.ibm.com>
    Cc: Nick Piggin <npiggin@suse.de>
    Cc: stable@vger.kernel.org
    Signed-off-by: Andy Lutomirski <luto@amacapital.net>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/madvise.c |   19 ++++++++++++++-----
 1 files changed, 14 insertions(+), 5 deletions(-)

commit 067ede10755d38e4c6502dbfbed3992206d190c0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 2 18:36:51 2012 -0400

    Introduce kernel-enforced SymlinksIfOwnerMatch feature
    (Highly desirable feature for webhosting companies)
    
    Conflicts:
    
    	fs/namei.c

 fs/namei.c                 |   11 +++++++++++
 fs/udf/super.c             |    6 +++---
 grsecurity/Kconfig         |   27 ++++++++++++++++++++++++++-
 grsecurity/grsec_init.c    |    6 ++++++
 grsecurity/grsec_link.c    |   16 ++++++++++++++++
 grsecurity/grsec_sysctl.c  |   18 ++++++++++++++++++
 include/linux/grinternal.h |    2 ++
 include/linux/grmsg.h      |    1 +
 include/linux/grsecurity.h |    1 +
 security/Kconfig           |   11 +++++++++++
 10 files changed, 95 insertions(+), 4 deletions(-)

commit 28a3cf7fc4a8c6942dab78b6e3af1ede37334894
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 7 15:24:59 2012 -0400

    Fix compilation failure when !GRKERNSEC

 security/Kconfig |   38 +++++++++++++++++++-------------------
 1 files changed, 19 insertions(+), 19 deletions(-)

commit c4c56d4af2b90340d0a420b27fbe0e35a1555c22
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 25 17:10:14 2012 -0400

    Introduce new configuration system
    
    Conflicts:
    
    	arch/x86/Kconfig.debug
    	grsecurity/Kconfig

 grsecurity/Kconfig |  252 +++++++++-------------------------------------------
 security/Kconfig   |  215 +++++++++++++++++++++++++++++++++++++++++++-
 2 files changed, 256 insertions(+), 211 deletions(-)

commit 8163685e7b66ba3974da12c4f0bfcd1732511afe
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 7 15:27:46 2012 -0400

    Fix epoll compilation

 fs/eventpoll.c |    8 --------
 1 files changed, 0 insertions(+), 8 deletions(-)

commit 3264d09607a60638a0f3bfce2c109d15943f18d9
Author: Jason Baron <jbaron@redhat.com>
Date:   Fri Mar 16 16:34:03 2012 -0400

    Don't limit non-nested epoll paths
    
    commit 93dc6107a76daed81c07f50215fa6ae77691634f upstream.
    
    Commit 28d82dc1c4ed ("epoll: limit paths") that I did to limit the
    number of possible wakeup paths in epoll is causing a few applications
    to longer work (dovecot for one).
    
    The original patch is really about limiting the amount of epoll nesting
    (since epoll fds can be attached to other fds). Thus, we probably can
    allow an unlimited number of paths of depth 1. My current patch limits
    it at 1000. And enforce the limits on paths that have a greater depth.
    
    This is captured in: https://bugzilla.redhat.com/show_bug.cgi?id=681578
    
    Signed-off-by: Jason Baron <jbaron@redhat.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Jonathan Nieder <jrnieder@gmail.com>
    Signed-off-by: Ben Hutchings <ben@decadent.org.uk>

 fs/eventpoll.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

commit 63ccec82a4e155af90102149128859b99f6a82dd
Author: Jason Baron <jbaron@redhat.com>
Date:   Wed Apr 25 16:01:47 2012 -0700

    epoll: clear the tfile_check_list on -ELOOP
    
    An epoll_ctl(,EPOLL_CTL_ADD,,) operation can return '-ELOOP' to prevent
    circular epoll dependencies from being created.  However, in that case we
    do not properly clear the 'tfile_check_list'.  Thus, add a call to
    clear_tfile_check_list() for the -ELOOP case.
    
    Signed-off-by: Jason Baron <jbaron@redhat.com>
    Reported-by: Yurij M. Plotnikov <Yurij.Plotnikov@oktetlabs.ru>
    Cc: Nelson Elhage <nelhage@nelhage.com>
    Cc: Davide Libenzi <davidel@xmailserver.org>
    Tested-by: Alexandra N. Kossovsky <Alexandra.Kossovsky@oktetlabs.ru>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/eventpoll.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

commit 482239416113140fb4fa9b377cdf2f1496638238
Author: Jason Baron <jbaron@redhat.com>
Date:   Thu Jan 12 17:17:43 2012 -0800

    epoll: limit paths
    
    The current epoll code can be tickled to run basically indefinitely in
    both loop detection path check (on ep_insert()), and in the wakeup paths.
    The programs that tickle this behavior set up deeply linked networks of
    epoll file descriptors that cause the epoll algorithms to traverse them
    indefinitely.  A couple of these sample programs have been previously
    posted in this thread: https://lkml.org/lkml/2011/2/25/297.
    
    To fix the loop detection path check algorithms, I simply keep track of
    the epoll nodes that have been already visited.  Thus, the loop detection
    becomes proportional to the number of epoll file descriptor and links.
    This dramatically decreases the run-time of the loop check algorithm.  In
    one diabolical case I tried it reduced the run-time from 15 mintues (all
    in kernel time) to .3 seconds.
    
    Fixing the wakeup paths could be done at wakeup time in a similar manner
    by keeping track of nodes that have already been visited, but the
    complexity is harder, since there can be multiple wakeups on different
    cpus...Thus, I've opted to limit the number of possible wakeup paths when
    the paths are created.
    
    This is accomplished, by noting that the end file descriptor points that
    are found during the loop detection pass (from the newly added link), are
    actually the sources for wakeup events.  I keep a list of these file
    descriptors and limit the number and length of these paths that emanate
    from these 'source file descriptors'.  In the current implemetation I
    allow 1000 paths of length 1, 500 of length 2, 100 of length 3, 50 of
    length 4 and 10 of length 5.  Note that it is sufficient to check the
    'source file descriptors' reachable from the newly added link, since no
    other 'source file descriptors' will have newly added links.  This allows
    us to check only the wakeup paths that may have gotten too long, and not
    re-check all possible wakeup paths on the system.
    
    In terms of the path limit selection, I think its first worth noting that
    the most common case for epoll, is probably the model where you have 1
    epoll file descriptor that is monitoring n number of 'source file
    descriptors'.  In this case, each 'source file descriptor' has a 1 path of
    length 1.  Thus, I believe that the limits I'm proposing are quite
    reasonable and in fact may be too generous.  Thus, I'm hoping that the
    proposed limits will not prevent any workloads that currently work to
    fail.
    
    In terms of locking, I have extended the use of the 'epmutex' to all
    epoll_ctl add and remove operations.  Currently its only used in a subset
    of the add paths.  I need to hold the epmutex, so that we can correctly
    traverse a coherent graph, to check the number of paths.  I believe that
    this additional locking is probably ok, since its in the setup/teardown
    paths, and doesn't affect the running paths, but it certainly is going to
    add some extra overhead.  Also, worth noting is that the epmuex was
    recently added to the ep_ctl add operations in the initial path loop
    detection code using the argument that it was not on a critical path.
    
    Another thing to note here, is the length of epoll chains that is allowed.
    Currently, eventpoll.c defines:
    
    /* Maximum number of nesting allowed inside epoll sets */
    
    This basically means that I am limited to a graph depth of 5 (EP_MAX_NESTS
    + 1).  However, this limit is currently only enforced during the loop
    check detection code, and only when the epoll file descriptors are added
    in a certain order.  Thus, this limit is currently easily bypassed.  The
    newly added check for wakeup paths, stricly limits the wakeup paths to a
    length of 5, regardless of the order in which ep's are linked together.
    Thus, a side-effect of the new code is a more consistent enforcement of
    the graph depth.
    
    Thus far, I've tested this, using the sample programs previously
    mentioned, which now either return quickly or return -EINVAL.  I've also
    testing using the piptest.c epoll tester, which showed no difference in
    performance.  I've also created a number of different epoll networks and
    tested that they behave as expectded.
    
    I believe this solves the original diabolical test cases, while still
    preserving the sane epoll nesting.
    
    Signed-off-by: Jason Baron <jbaron@redhat.com>
    Cc: Nelson Elhage <nelhage@ksplice.com>
    Cc: Davide Libenzi <davidel@xmailserver.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/eventpoll.c

 fs/eventpoll.c            |  234 +++++++++++++++++++++++++++++++++++++++++----
 include/linux/eventpoll.h |    1 +
 include/linux/fs.h        |    1 +
 3 files changed, 215 insertions(+), 21 deletions(-)

commit e7872929b3d7e4a83a6a75320d64018e2db5f774
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Sat Jun 9 19:08:25 2012 +0300

    mtd: cafe_nand: fix an & vs | mistake
    
    The intent here was clearly to set result to true if the 0x40000000 flag
    was set.  But instead there was a | vs & typo and we always set result
    to true.
    
    Artem: check the spec at
    wiki.laptop.org/images/5/5c/88ALP01_Datasheet_July_2007.pdf
    and this fix looks correct.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
    Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>

 drivers/mtd/nand/cafe_nand.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit be6fe8612e7a1a5482502e40d85618598f056b25
Author: Jan Kara <jack@suse.cz>
Date:   Wed Jun 27 21:23:07 2012 +0200

    udf: Fortify loading of sparing table
    
    Add sanity checks when loading sparing table from disk to avoid accessing
    unallocated memory or writing to it.
    
    Signed-off-by: Jan Kara <jack@suse.cz>

 fs/udf/super.c |   86 ++++++++++++++++++++++++++++++++++---------------------
 1 files changed, 53 insertions(+), 33 deletions(-)

commit 2df8df1b179483f8d990d9eb44b83eb7f85ef5b0
Author: Jan Kara <jack@suse.cz>
Date:   Wed Jun 27 20:20:22 2012 +0200

    udf: Avoid run away loop when partition table length is corrupted
    
    Check provided length of partition table so that (possibly maliciously)
    corrupted partition table cannot cause accessing data beyond current buffer.
    
    Signed-off-by: Jan Kara <jack@suse.cz>

 fs/udf/super.c |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

commit 44495bb8f4aaf7a7e089847a940e51c31496d306
Author: H. Peter Anvin <hpa@zytor.com>
Date:   Sun Jul 31 13:54:50 2011 -0700

    random: Add support for architectural random hooks
    
    Add support for architecture-specific hooks into the kernel-directed
    random number generator interfaces.  This patchset does not use the
    architecture random number generator interfaces for the
    userspace-directed interfaces (/dev/random and /dev/urandom), thus
    eliminating the need to distinguish between them based on a pool
    pointer.
    
    Changes in version 3:
    - Moved the hooks from extract_entropy() to get_random_bytes().
    - Changes the hooks to inlines.
    
    Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
    Cc: Fenghua Yu <fenghua.yu@intel.com>
    Cc: Matt Mackall <mpm@selenic.com>
    Cc: Herbert Xu <herbert@gondor.apana.org.au>
    Cc: "Theodore Ts'o" <tytso@mit.edu>
    
    Conflicts:
    
    	drivers/char/random.c

 drivers/char/random.c  |   23 +++++++++++++++++++++--
 include/linux/random.h |   13 +++++++++++++
 2 files changed, 34 insertions(+), 2 deletions(-)

commit dc50f26ab82ea092708183254e2f111a5c54ddc4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 7 14:21:06 2012 -0400

    use PaX's ACCESS_ONCE_RW when modifying structure

 drivers/char/random.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit e814630759a7a4e9cd60680f35892680eea87ea3
Author: Kees Cook <kees.cook@canonical.com>
Date:   Tue May 24 16:29:26 2011 -0700

    x86, cpufeature: Update CPU feature RDRND to RDRAND
    
    The Intel manual changed the name of the CPUID bit to match the
    instruction name. We should follow suit for sanity's sake. (See Intel SDM
    Volume 2, Table 3-20 "Feature Information Returned in the ECX Register".)
    
    [ hpa: we can only do this at this time because there are currently no CPUs
      with this feature on the market, hence this is pre-hardware enabling.
      However, Cc:'ing stable so that stable can present a consistent ABI. ]
    
    Signed-off-by: Kees Cook <kees.cook@canonical.com>
    Link: http://lkml.kernel.org/r/20110524232926.GA27728@outflux.net
    Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
    Cc: Fenghua Yu <fenghua.yu@intel.com>
    Cc: <stable@kernel.org> v2.6.36-39
    
    Conflicts:
    
    	arch/x86/include/asm/cpufeature.h

 arch/x86/include/asm/cpufeature.h |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 29834e8a2b13524a44defe749561cad63420174e
Author: H. Peter Anvin <hpa@zytor.com>
Date:   Sun Jul 31 14:02:19 2011 -0700

    x86, random: Verify RDRAND functionality and allow it to be disabled
    
    If the CPU declares that RDRAND is available, go through a guranteed
    reseed sequence, and make sure that it is actually working (producing
    data.)   If it does not, disable the CPU feature flag.
    
    Allow RDRAND to be disabled on the command line (as opposed to at
    compile time) for a user who has special requirements with regards to
    random numbers.
    
    Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
    Cc: Matt Mackall <mpm@selenic.com>
    Cc: Herbert Xu <herbert@gondor.apana.org.au>
    Cc: "Theodore Ts'o" <tytso@mit.edu>
    
    Conflicts:
    
    	arch/x86/kernel/cpu/Makefile

 Documentation/kernel-parameters.txt |    5 ++
 arch/x86/include/asm/archrandom.h   |    2 +
 arch/x86/kernel/cpu/Makefile        |    1 +
 arch/x86/kernel/cpu/common.c        |    2 +
 arch/x86/kernel/cpu/rdrand.c        |   73 +++++++++++++++++++++++++++++++++++
 5 files changed, 83 insertions(+), 0 deletions(-)

commit 0ed7ff34e81d9e2ddd639c3ad42a32b04447321b
Author: H. Peter Anvin <hpa@zytor.com>
Date:   Sun Jul 31 13:59:29 2011 -0700

    x86, random: Architectural inlines to get random integers with RDRAND
    
    Architectural inlines to get random ints and longs using the RDRAND
    instruction.
    
    Intel has introduced a new RDRAND instruction, a Digital Random Number
    Generator (DRNG), which is functionally an high bandwidth entropy
    source, cryptographic whitener, and integrity monitor all built into
    hardware.  This enables RDRAND to be used directly, bypassing the
    kernel random number pool.
    
    For technical documentation, see:
    
    http://software.intel.com/en-us/articles/download-the-latest-bull-mountain-software-implementation-guide/
    
    In this patch, this is *only* used for the nonblocking random number
    pool.  RDRAND is a nonblocking source, similar to our /dev/urandom,
    and is therefore not a direct replacement for /dev/random.  The
    architectural hooks presented in the previous patch only feed the
    kernel internal users, which only use the nonblocking pool, and so
    this is not a problem.
    
    Since this instruction is available in userspace, there is no reason
    to have a /dev/hw_rng device driver for the purpose of feeding rngd.
    This is especially so since RDRAND is a nonblocking source, and needs
    additional whitening and reduction (see the above technical
    documentation for details) in order to be of "pure entropy source"
    quality.
    
    The CONFIG_EXPERT compile-time option can be used to disable this use
    of RDRAND.
    
    Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
    Originally-by: Fenghua Yu <fenghua.yu@intel.com>
    Cc: Matt Mackall <mpm@selenic.com>
    Cc: Herbert Xu <herbert@gondor.apana.org.au>
    Cc: "Theodore Ts'o" <tytso@mit.edu>

 arch/x86/Kconfig                  |    9 +++++
 arch/x86/include/asm/archrandom.h |   73 +++++++++++++++++++++++++++++++++++++
 2 files changed, 82 insertions(+), 0 deletions(-)

commit 00764213e0f3ef09db5e91e51acbb3ee94e4e59f
Author: Theodore Ts'o <tytso@mit.edu>
Date:   Thu Jul 5 10:21:01 2012 -0400

    random: use the arch-specific rng in xfer_secondary_pool
    
    If the CPU supports a hardware random number generator, use it in
    xfer_secondary_pool(), where it will significantly improve things and
    where we can afford it.
    
    Also, remove the use of the arch-specific rng in
    add_timer_randomness(), since the call is significantly slower than
    get_cycles(), and we're much better off using it in
    xfer_secondary_pool() anyway.
    
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
    Cc: stable@vger.kernel.org

 drivers/char/random.c |   17 +++++++++++++----
 1 files changed, 13 insertions(+), 4 deletions(-)

commit 263b5a7619321c7e58aa30f5691feaa3e8bc7f74
Author: Theodore Ts'o <tytso@mit.edu>
Date:   Wed Jul 4 21:23:25 2012 -0400

    net: feed /dev/random with the MAC address when registering a device
    
    Cc: David Miller <davem@davemloft.net>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
    Cc: stable@vger.kernel.org
    
    Conflicts:
    
    	net/core/dev.c

 net/core/dev.c       |    7 +++----
 net/core/rtnetlink.c |    1 +
 2 files changed, 4 insertions(+), 4 deletions(-)

commit cda6af0a718205879c6b58c2456a93dbf6f7a93e
Author: Theodore Ts'o <tytso@mit.edu>
Date:   Wed Jul 4 11:22:20 2012 -0400

    usb: feed USB device information to the /dev/random driver
    
    Send the USB device's serial, product, and manufacturer strings to the
    /dev/random driver to help seed its pools.
    
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Acked-by: Greg KH <greg@kroah.com>
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
    Cc: stable@vger.kernel.org
    
    Conflicts:
    
    	drivers/usb/core/hub.c

 drivers/usb/core/hub.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

commit 74b68e7a185366d8e09236844a3ec26deefaa229
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Wed Jul 4 11:16:01 2012 -0400

    random: create add_device_randomness() interface
    
    Add a new interface, add_device_randomness() for adding data to the
    random pool that is likely to differ between two devices (or possibly
    even per boot).  This would be things like MAC addresses or serial
    numbers, or the read-out of the RTC. This does *not* add any actual
    entropy to the pool, but it initializes the pool to different values
    for devices that might otherwise be identical and have very little
    entropy available to them (particularly common in the embedded world).
    
    [ Modified by tytso to mix in a timestamp, since there may be some
      variability caused by the time needed to detect/configure the hardware
      in question. ]
    
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
    Cc: stable@vger.kernel.org

 drivers/char/random.c  |   28 ++++++++++++++++++++++++++++
 include/linux/random.h |    1 +
 2 files changed, 29 insertions(+), 0 deletions(-)

commit 73019d37958226d9f411b68cd9f6e206b392f18c
Author: Theodore Ts'o <tytso@mit.edu>
Date:   Wed Jul 4 10:38:30 2012 -0400

    random: use lockless techniques in the interrupt path
    
    The real-time Linux folks don't like add_interrupt_randomness() taking
    a spinlock since it is called in the low-level interrupt routine.
    This also allows us to reduce the overhead in the fast path, for the
    random driver, which is the interrupt collection path.
    
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
    Cc: stable@vger.kernel.org

 drivers/char/random.c |   78 ++++++++++++++++++++++++------------------------
 1 files changed, 39 insertions(+), 39 deletions(-)

commit 7c369eb649ab939269694d4523abd8c0e174ceab
Author: H. Peter Anvin <hpa@linux.intel.com>
Date:   Mon Jan 16 11:23:29 2012 -0800

    random: Adjust the number of loops when initializing
    
    When we are initializing using arch_get_random_long() we only need to
    loop enough times to touch all the bytes in the buffer; using
    poolwords for that does twice the number of operations necessary on a
    64-bit machine, since in the random number generator code "word" means
    32 bits.
    
    Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
    Cc: "Theodore Ts'o" <tytso@mit.edu>
    Link: http://lkml.kernel.org/r/1324589281-31931-1-git-send-email-tytso@mit.edu

 drivers/char/random.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit d98d754e3db9ab55528bdb3b654e388b22f11ca9
Author: Theodore Ts'o <tytso@mit.edu>
Date:   Thu Dec 22 16:28:01 2011 -0500

    random: Use arch-specific RNG to initialize the entropy store
    
    If there is an architecture-specific random number generator (such as
    RDRAND for Intel architectures), use it to initialize /dev/random's
    entropy stores.  Even in the worst case, if RDRAND is something like
    AES(NSA_KEY, counter++), it won't hurt, and it will definitely help
    against any other adversaries.
    
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
    Link: http://lkml.kernel.org/r/1324589281-31931-1-git-send-email-tytso@mit.edu
    Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>

 drivers/char/random.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

commit 1251d257f84dcedb2a10194cd23d37d5bb57c9ba
Author: Theodore Ts'o <tytso@mit.edu>
Date:   Mon Jul 2 07:52:16 2012 -0400

    random: make 'add_interrupt_randomness()' do something sane
    
    We've been moving away from add_interrupt_randomness() for various
    reasons: it's too expensive to do on every interrupt, and flooding the
    CPU with interrupts could theoretically cause bogus floods of entropy
    from a somewhat externally controllable source.
    
    This solves both problems by limiting the actual randomness addition
    to just once a second or after 128 interrupts, whicever comes first.
    During that time, the interrupt cycle data is buffered up in a per-cpu
    pool.  Also, we make sure the the nonblocking pool used by urandom is
    initialized before we start feeding the normal input pool.  This
    assures that /dev/urandom is returning unpredictable data as soon as
    possible.
    
    (Based on an original patch by Linus, but significantly modified by
    tytso.)
    
    Tested-by: Eric Wustrow <ewust@umich.edu>
    Reported-by: Eric Wustrow <ewust@umich.edu>
    Reported-by: Nadia Heninger <nadiah@cs.ucsd.edu>
    Reported-by: Zakir Durumeric <zakir@umich.edu>
    Reported-by: J. Alex Halderman <jhalderm@umich.edu>.
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
    Cc: stable@vger.kernel.org
    
    Conflicts:
    
    	kernel/irq/handle.c

 drivers/char/random.c  |  103 ++++++++++++++++++++++++++++++++++++++++--------
 include/linux/random.h |    2 +-
 kernel/irq/handle.c    |    7 +--
 3 files changed, 90 insertions(+), 22 deletions(-)

commit 150911d734ccc7a305ec22fa44dacd3d00f6c54a
Author: Matt Mackall <mpm@selenic.com>
Date:   Thu May 20 19:55:01 2010 +1000

    random: simplify fips mode
    
    Rather than dynamically allocate 10 bytes, move it to static allocation.
    This saves space and avoids the need for error checking.
    
    Signed-off-by: Matt Mackall <mpm@selenic.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

 drivers/char/random.c |   10 +++-------
 1 files changed, 3 insertions(+), 7 deletions(-)

commit 59159131aa402cfb6a8a79153c7a7d023aff5238
Author: Jarod Wilson <jarod@redhat.com>
Date:   Mon Feb 21 21:43:10 2011 +1100

    random: update interface comments to reflect reality
    
    At present, the comment header in random.c makes no mention of
    add_disk_randomness, and instead, suggests that disk activity adds to the
    random pool by way of add_interrupt_randomness, which appears to not have
    been the case since sometime prior to the existence of git, and even prior
    to bitkeeper. Didn't look any further back. At least, as far as I can
    tell, there are no storage drivers setting IRQF_SAMPLE_RANDOM, which is a
    requirement for add_interrupt_randomness to trigger, so the only way for a
    disk to contribute entropy is by way of add_disk_randomness. Update
    comments accordingly, complete with special mention about solid state
    drives being a crappy source of entropy (see e2e1a148bc for reference).
    
    Signed-off-by: Jarod Wilson <jarod@redhat.com>
    Acked-by: Matt Mackall <mpm@selenic.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

 drivers/char/random.c |   13 ++++++++++---
 1 files changed, 10 insertions(+), 3 deletions(-)

commit 54d2594363d7566cccf8ce18a0fd5e18efbd4c58
Author: Theodore Ts'o <tytso@mit.edu>
Date:   Fri Jul 6 14:03:18 2012 -0400

    random: fix up sparse warnings
    
    Add extern and static declarations to suppress sparse warnings
    
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>

 drivers/char/random.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit a2faa09ac2f70e4462185fc4e54c5f3685864002
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 1 19:58:41 2012 -0400

    Add missing read lock in recent filldir code

 grsecurity/gracl.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

commit 0b7992f53307662b79ad0e5edfa188a6ebb10827
Merge: 002ecf9 3d9bda1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 1 19:54:57 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 3d9bda1544d46222652cd990fc07bd839c40f488
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 1 19:53:50 2012 -0400

    Update to pax-linux-2.6.32.59-test180.patch
    
    moved some ifdef's around to fix compiler warnings in the ELF loader hunks,
    thanks to Thiébaud Weksteen for raising the problem and providing the
    initial patch.

 arch/x86/include/asm/uaccess_32.h |   17 +----
 arch/x86/include/asm/uaccess_64.h |   17 +----
 fs/binfmt_elf.c                   |  164 ++++++++++++++++++-------------------
 3 files changed, 85 insertions(+), 113 deletions(-)

commit 002ecf9d027068d79ec76daa2f4436452f682403
Merge: 3a40e79 e26c109
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jun 22 18:43:00 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit e26c10948b10016238304d972c0545aea799a1cb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jun 22 18:42:20 2012 -0400

    Update to pax-linux-2.6.32.59-test178.patch

 scripts/gcc-plugin.sh            |    6 +++---
 tools/gcc/size_overflow_plugin.c |    2 ++
 2 files changed, 5 insertions(+), 3 deletions(-)

commit 3a40e79782b9b763dd4fc024e9999a0ae621f56c
Merge: 0e83f8d c3bfb01
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 20 18:01:31 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit c3bfb01fd600d627277e2d5e8eb50ddc0b78f066
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 20 18:01:16 2012 -0400

    Update to pax-linux-2.6.32.59-test177.patch

 Makefile |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 0e83f8d97b3fdecc98e7b1f9f1072333c9f5b60f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 20 17:55:07 2012 -0400

    revert sort change

 tools/gcc/generate_size_overflow_hash.sh |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 2d96eaa3853bcee441719df8521997dec28c61a2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jun 19 21:55:07 2012 -0400

    add grsecurity allocators to size overflow table
    change sorting of overflow table

 tools/gcc/generate_size_overflow_hash.sh |    2 +-
 tools/gcc/size_overflow_hash.data        |    4 ++++
 2 files changed, 5 insertions(+), 1 deletions(-)

commit 8ecbb955fc0416278ad04e077d37a5333b806b44
Merge: b01fa4c 39999b7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jun 19 20:14:19 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 39999b77e582ac59e70f93bff3b284f25313f8ac
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jun 19 20:12:51 2012 -0400

    Update to pax-linux-2.6.32.59-test176.patch

 Documentation/dontdiff                   |    1 +
 tools/gcc/Makefile                       |   10 +
 tools/gcc/generate_size_overflow_hash.sh |   94 +
 tools/gcc/size_overflow_hash.data        | 1847 +++++
 tools/gcc/size_overflow_hash.h           |13266 ------------------------------
 tools/gcc/size_overflow_plugin.c         |   15 +-
 6 files changed, 1959 insertions(+), 13274 deletions(-)

commit b01fa4c83844011288da7b8a128d78548b078519
Merge: 0521c1e 4d3e3fb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 18 20:22:09 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 4d3e3fb407dbc2e25951184f26a6d74658423414
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 18 20:21:50 2012 -0400

    Update to pax-linux-2.6.32.59-test175.patch

 arch/x86/include/asm/uaccess_32.h |    8 ++++----
 arch/x86/include/asm/uaccess_64.h |    8 ++++----
 tools/gcc/size_overflow_plugin.c  |    2 +-
 3 files changed, 9 insertions(+), 9 deletions(-)

commit 0521c1e06e9beb3bca9476f70d8b170307fd86cc
Merge: 434829e 95c5167
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jun 17 19:23:43 2012 -0400

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	Makefile
    	tools/gcc/Makefile

commit 95c5167e3e8877ef1f88f5e537f311a3c4370417
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jun 17 19:22:21 2012 -0400

    Update to pax-linux-2.6.32.59-test174.patch

 Makefile                          |    5 +-
 arch/x86/include/asm/uaccess_32.h |   28 ++++++++++++-
 arch/x86/include/asm/uaccess_64.h |   28 +++++++++++++
 arch/x86/lib/usercopy_32.c        |   12 ++++++
 arch/x86/lib/usercopy_64.c        |   12 ++++++
 include/linux/compiler-gcc4.h     |    7 +++
 include/linux/compiler.h          |   13 ++++++
 scripts/Makefile.build            |    2 +-
 scripts/Makefile.host             |   26 +++++++++++-
 scripts/gcc-plugin.sh             |   17 +++++++-
 tools/gcc/Makefile                |   23 ++++++----
 tools/gcc/colorize_plugin.c       |    1 +
 tools/gcc/size_overflow_plugin.c  |   80 ++++++++++++++----------------------
 13 files changed, 188 insertions(+), 66 deletions(-)

commit 434829e8fb36864be498a979d33d51442d89343f
Merge: 1d42c69 28cf4bc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jun 14 21:14:26 2012 -0400

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	fs/exec.c

commit 28cf4bc968e51d90b44dbba490098c0ad6bf0732
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jun 14 21:13:27 2012 -0400

    Update to pax-linux-2.6.32.59-test173.patch

 fs/exec.c                        |    8 +-
 tools/gcc/size_overflow_hash.h   |13933 ++++++++++++++++++++++----------------
 tools/gcc/size_overflow_plugin.c |  188 +-
 3 files changed, 8390 insertions(+), 5739 deletions(-)

commit 1d42c695253e683824fc46acf6b0c098244c8c8d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 13 23:08:14 2012 -0400

    fix PaX braino

 fs/exec.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

commit dc444304588cef3939008c101d266a779037ae70
Merge: d7076b6 f88f063
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 13 21:13:49 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit f88f063440d835818f5cdfd96373ac1628fead07
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 13 21:13:31 2012 -0400

    Update to pax-linux-2.6.32.59-test171.patch

 Documentation/dontdiff        |    1 +
 arch/arm/include/asm/atomic.h |   24 +++++++++++++++++++-----
 fs/exec.c                     |    7 +++++--
 3 files changed, 25 insertions(+), 7 deletions(-)

commit d7076b691c02c719c9b85353267143575bdd5deb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 11 17:25:09 2012 -0400

    fix ia64 compilation reported by Dennis Schridde

 security/commoncap.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit b6fad41ab44f1256096d0ce0751e2008917b2d57
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 11 17:23:28 2012 -0400

    make filename const

 include/trace/events/fs.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit cbd4f0104f747073c7fd9043802caad92cacda9a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jun 9 15:58:21 2012 -0400

    Add (a correct) Ubuntu ureadahead patch

 fs/exec.c                 |    4 +++
 fs/open.c                 |    4 +++
 include/trace/events/fs.h |   53 +++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 61 insertions(+), 0 deletions(-)

commit 8643606c086612e0ed256a719c777e5b3d998ea7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jun 9 14:23:05 2012 -0400

    hide cs base/limit

 fs/proc/task_mmu.c |   15 ++++++++-------
 1 files changed, 8 insertions(+), 7 deletions(-)

commit d3a487ee3b9cf56519849297172e4914b19b0535
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jun 9 13:39:08 2012 -0400

    Bump grsecurity version

 include/linux/gracl.h |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 32615fe3a121f9cb0201f1b6b88c1c58635415d3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 18:11:57 2012 -0400

    Revert "ipc/mqueue: enforce hard limits"
    
    This reverts commit 02234cf7c659f0ba0e4771cacca28a3f350e96bd.

 ipc/mqueue.c |    8 +++-----
 1 files changed, 3 insertions(+), 5 deletions(-)

commit f8183edaefdef8104617e238f241d071f7e39486
Author: Konrad Rzeszutek Wilk <konrad@darnok.org>
Date:   Wed May 30 18:23:56 2012 -0400

    x86, amd, xen: Avoid NULL pointer paravirt references
    
    Stub out MSR methods that aren't actually needed.  This fixes a crash
    as Xen Dom0 on AMD Trinity systems.  A bigger patch should be added to
    remove the paravirt machinery completely for the methods which
    apparently have no users!
    
    Reported-by: Andre Przywara <andre.przywara@amd.com>
    Link: http://lkml.kernel.org/r/20120530222356.GA28417@andromeda.dapyr.net
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>
    Cc: <stable@vger.kernel.org>

 arch/x86/xen/enlighten.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit 02234cf7c659f0ba0e4771cacca28a3f350e96bd
Author: Doug Ledford <dledford@redhat.com>
Date:   Thu May 31 16:26:29 2012 -0700

    ipc/mqueue: enforce hard limits
    
    In two places we don't enforce the hard limits for CAP_SYS_RESOURCE apps.
    In preparation for making more reasonable hard limits, start enforcing
    them even on CAP_SYS_RESOURCE.
    
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Cc: Serge E. Hallyn <serue@us.ibm.com>
    Cc: Amerigo Wang <amwang@redhat.com>
    Cc: Joe Korty <joe.korty@ccur.com>
    Cc: Jiri Slaby <jslaby@suse.cz>
    Acked-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Cc: Manfred Spraul <manfred@colorfullife.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 ipc/mqueue.c |    8 +++++---
 1 files changed, 5 insertions(+), 3 deletions(-)

commit c45a8750d785fd07e2e1b1ad3708af0dbe325c05
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 17:39:36 2012 -0400

    drop additional invalid states

 net/ipv4/tcp_input.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 634feb732d3fd508fa10a371af6d6829ed2680ad
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jun 3 09:01:18 2012 -0400

    Fix compilation error reported by Huub Reuver

 arch/x86/mm/init.c |    5 ++---
 1 files changed, 2 insertions(+), 3 deletions(-)

commit b1231876c77b24b2e041d0bb4ceccdcd1190f77f
Merge: ce8ab0e 23e18e3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jun 1 19:34:47 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 23e18e3422d3c4daefc7caf28bbd66dd4d1234da
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jun 1 19:34:29 2012 -0400

    Update to pax-linux-2.6.32.59-test170.patch

 Makefile                         |   21 +++++++++------------
 include/linux/Kbuild             |    2 +-
 scripts/Makefile.lib             |    6 +++---
 tools/gcc/size_overflow_plugin.c |    2 +-
 4 files changed, 14 insertions(+), 17 deletions(-)

commit ce8ab0e129f8f14798bde63e1d12f8d8c6964ab5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 18:12:30 2012 -0400

    fix compiler warning

 arch/x86/mm/init.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 4cbceceb91b24d4ec3e83f39f33045a18eee95a3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 18:07:32 2012 -0400

    compile fixes
    
    Conflicts:
    
    	kernel/sysctl.c

 arch/x86/mm/init.c |   13 +++++++------
 1 files changed, 7 insertions(+), 6 deletions(-)

commit 91ecb4b7e55a9d89d1f02a9924daf0cc67fdafbf
Merge: e60053a 9d6ef84
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 17:48:26 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 9d6ef84270054ccbd44129de70906981bee8cbcc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 17:48:06 2012 -0400

    Update to pax-linux-2.6.32.59-test169.patch

 include/linux/Kbuild        |    2 +-
 tools/gcc/constify_plugin.c |   61 ++++++++++++++++++++++++++++++------------
 2 files changed, 44 insertions(+), 19 deletions(-)

commit e60053a401ae4b11a0aeb3ca87a3f2b64ab4238e
Author: Thomas Meyer <thomas@m3y3r.de>
Date:   Tue May 29 15:06:21 2012 -0700

    mm: use kcalloc() instead of kzalloc() to allocate array
    
    The advantage of kcalloc is, that will prevent integer overflows which
    could result from the multiplication of number of elements and size and
    it is also a bit nicer to read.
    
    The semantic patch that makes this change is available in
    https://lkml.org/lkml/2011/11/25/107
    
    Signed-off-by: Thomas Meyer <thomas@m3y3r.de>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	mm/vmalloc.c

 mm/vmalloc.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit bb7c166b6f5e52fe02fbd7440102b7d1fd607fbb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 17:31:45 2012 -0400

    introduce change similar to 7edc8b0ac16cbaed7cb4ea4c6b95ce98d2997e84

 kernel/fork.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 6af0bb642f50fb93376f69b1aa3e676fd6613c41
Author: Ryota Ozaki <ozaki.ryota@gmail.com>
Date:   Tue May 29 15:06:20 2012 -0700

    mm: fix off-by-one bug in print_nodes_state()
    
    /sys/devices/system/node/{online,possible} outputs a garbage byte
    because print_nodes_state() returns content size + 1.  To fix the bug,
    the patch changes the use of cpuset_sprintf_cpulist to follow the use at
    other places, which is clearer and safer.
    
    This bug was introduced in v2.6.24 (commit bde631a51876: "mm: add node
    states sysfs class attributeS").
    
    Signed-off-by: Ryota Ozaki <ozaki.ryota@gmail.com>
    Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 drivers/base/node.c |    8 +++-----
 1 files changed, 3 insertions(+), 5 deletions(-)

commit 9f9dada1e0fc3540c21f4323e2a14c805364282b
Author: Dave Hansen <dave@linux.vnet.ibm.com>
Date:   Wed May 30 07:51:07 2012 -0700

    mm: fix vma_resv_map() NULL pointer
    
    hugetlb_reserve_pages() can be used for either normal file-backed
    hugetlbfs mappings, or MAP_HUGETLB.  In the MAP_HUGETLB, semi-anonymous
    mode, there is not a VMA around.  The new call to resv_map_put() assumed
    that there was, and resulted in a NULL pointer dereference:
    
      BUG: unable to handle kernel NULL pointer dereference at 0000000000000030
      IP: vma_resv_map+0x9/0x30
      PGD 141453067 PUD 1421e1067 PMD 0
      Oops: 0000 [#1] PREEMPT SMP
      ...
      Pid: 14006, comm: trinity-child6 Not tainted 3.4.0+ #36
      RIP: vma_resv_map+0x9/0x30
      ...
      Process trinity-child6 (pid: 14006, threadinfo ffff8801414e0000, task ffff8801414f26b0)
      Call Trace:
        resv_map_put+0xe/0x40
        hugetlb_reserve_pages+0xa6/0x1d0
        hugetlb_file_setup+0x102/0x2c0
        newseg+0x115/0x360
        ipcget+0x1ce/0x310
        sys_shmget+0x5a/0x60
        system_call_fastpath+0x16/0x1b
    
    This was reported by Dave Jones, but was reproducible with the
    libhugetlbfs test cases, so shame on me for not running them in the
    first place.
    
    With this, the oops is gone, and the output of libhugetlbfs's
    run_tests.py is identical to plain 3.4 again.
    
    [ Marked for stable, since this was introduced by commit c50ac050811d
      ("hugetlb: fix resv_map leak in error path") which was also marked for
      stable ]
    
    Reported-by: Dave Jones <davej@redhat.com>
    Cc: Mel Gorman <mel@csn.ul.ie>
    Cc: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Cc: Christoph Lameter <cl@linux.com>
    Cc: Andrea Arcangeli <aarcange@redhat.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: <stable@vger.kernel.org>        [2.6.32+]
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/hugetlb.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 58cb290b7019ef96f0ef9ee0d336786797ad0650
Author: Eric Dumazet <eric.dumazet@gmail.com>
Date:   Fri Dec 2 23:41:42 2011 +0000

    tcp: drop SYN+FIN messages
    
    Denys Fedoryshchenko reported that SYN+FIN attacks were bringing his
    linux machines to their limits.
    
    Dont call conn_request() if the TCP flags includes SYN flag
    
    Reported-by: Denys Fedoryshchenko <denys@visp.net.lb>
    Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/tcp_input.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit abebde3743984b2d4e67fda7c900ec72dcc23e82
Merge: 8950fdb 58da12c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun May 27 18:49:03 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 58da12c97534d653f54ccc94a7aa59f30d191386
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun May 27 18:48:44 2012 -0400

    Update to pax-linux-2.6.32.59-test168.patch

 Makefile                           |   17 ++++++++++-------
 arch/x86/include/asm/mmu_context.h |    8 ++++----
 arch/x86/include/asm/pgtable.h     |    6 +++---
 arch/x86/mm/pgtable.c              |    8 ++++++--
 4 files changed, 23 insertions(+), 16 deletions(-)

commit 8950fdb9cfd29d7fd9bf90e9a734cce7a102ef8d
Merge: dd45f8e 4f1f2e2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 26 20:18:52 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 4f1f2e21a4eb514454f6a1a011f5d0afbba08933
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 26 20:18:15 2012 -0400

    Fix deadlock introduced in January in hugetlb code and reported on the forums

 mm/hugetlb.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

commit dd45f8ee8c00e4fcd5a092fe3c930501603538c5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 26 11:48:22 2012 -0400

    From dave@linux.vnet.ibm.com Fri May 18 13:50:17 2012
    Date: Fri, 18 May 2012 11:46:30 -0700
    From: Dave Hansen <dave@linux.vnet.ibm.com>
    To: cl@linux.com
    Cc: linux-kernel@vger.kernel.org, linux-mm@kvack.org, aarcange@redhat.com, kosaki.motohiro@jp.fujitsu.com, hughd@google.com, rientjes@google.com, adobriyan@gmail.com, akpm@linux-foundation.org, mel@csn.ul.ie, Dave Hansen <dave@linux.vnet.ibm.com>
    Subject: [RFC][PATCH] hugetlb: fix resv_map leak in error path
    
    When called for anonymous (non-shared) mappings,
    hugetlb_reserve_pages() does a resv_map_alloc().  It depends on
    code in hugetlbfs's vm_ops->close() to release that allocation.
    
    However, in the mmap() failure path, we do a plain unmap_region()
    without the remove_vma() which actually calls vm_ops->close().
    
    This is a decent fix.  This leak could get reintroduced if
    new code (say, after hugetlb_reserve_pages() in
    hugetlbfs_file_mmap()) decides to return an error.  But, I think
    it would have to unroll the reservation anyway.
    
    This hasn't been extensively tested.  Pretty much compile and
    boot tested along with Christoph's test case.
    
    Comments?
    
    Signed-off-by: Dave Hansen <dave@linux.vnet.ibm.com>

 mm/hugetlb.c |   28 ++++++++++++++++++++++------
 1 files changed, 22 insertions(+), 6 deletions(-)

commit e813104b72d948ba107b911a8265d5637f501ac6
Merge: b680bd9 3ba78e7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 26 11:42:05 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 3ba78e7b02a41fb433c648e242268350f6332715
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 26 11:41:44 2012 -0400

    Update to pax-linux-2.6.32.59-test167.patch

 Makefile                                    |    4 +-
 arch/x86/include/asm/floppy.h               |    1 -
 arch/x86/include/asm/kvm_host.h             |    6 +-
 arch/x86/include/asm/syscalls.h             |    2 +-
 arch/x86/include/asm/uaccess_32.h           |   17 -
 arch/x86/include/asm/uaccess_64.h           |   19 +-
 arch/x86/kernel/cpu/mcheck/mce-inject.c     |    2 -
 arch/x86/kernel/cpu/mtrr/if.c               |    2 -
 arch/x86/kernel/dumpstack_64.c              |    3 +
 arch/x86/kernel/i387.c                      |   14 -
 arch/x86/kernel/ldt.c                       |    2 -
 arch/x86/kernel/microcode_intel.c           |    1 -
 arch/x86/kernel/ptrace.c                    |    4 -
 arch/x86/kernel/setup_percpu.c              |    4 -
 arch/x86/kernel/tlb_uv.c                    |    2 -
 arch/x86/kernel/tls.h                       |    2 +-
 arch/x86/kernel/vm86_32.c                   |    3 -
 arch/x86/kvm/mmu.c                          |    2 -
 arch/x86/kvm/x86.c                          |    6 -
 crypto/ablkcipher.c                         |    4 -
 crypto/aead.c                               |    3 -
 crypto/blkcipher.c                          |    3 -
 crypto/cipher.c                             |    3 -
 drivers/acpi/battery.c                      |    3 -
 drivers/acpi/sbs.c                          |    3 -
 drivers/infiniband/hw/ipath/ipath_fs.c      |    2 -
 drivers/lguest/lguest_user.c                |    1 -
 drivers/media/video/cpia.c                  |    1 -
 drivers/media/video/cpia2/cpia2_core.c      |    1 -
 drivers/media/video/cx231xx/cx231xx-audio.c |    2 -
 drivers/media/video/em28xx/em28xx-audio.c   |    2 -
 drivers/media/video/gspca/gspca.c           |    1 -
 drivers/media/video/meye.c                  |    1 -
 drivers/media/video/ov511.c                 |    2 -
 drivers/media/video/se401.c                 |    1 -
 drivers/media/video/stv680.c                |    1 -
 drivers/media/video/usbvideo/vicam.c        |    1 -
 drivers/media/video/videobuf-dma-sg.c       |    7 -
 drivers/media/video/videobuf-vmalloc.c      |    7 -
 drivers/media/video/w9968cf.c               |    2 +-
 drivers/net/chelsio/sge.c                   |    2 -
 drivers/net/cxgb3/sge.c                     |    2 -
 drivers/net/wireless/ath/ath5k/debug.c      |    3 -
 drivers/net/wireless/ath/ath9k/debug.c      |    2 -
 drivers/oprofile/oprofile_files.c           |    5 -
 drivers/oprofile/oprofilefs.c               |    1 -
 fs/cifs/asn1.c                              |    3 -
 fs/configfs/file.c                          |    2 -
 fs/ncpfs/ncplib_kernel.h                    |    4 +-
 fs/sysfs/bin.c                              |    2 -
 fs/sysfs/file.c                             |    2 -
 include/asm-generic/pgtable-nopud.h         |    1 +
 include/asm-generic/uaccess.h               |   11 -
 include/linux/crash_dump.h                  |    2 +-
 include/linux/kvm_host.h                    |    4 +-
 include/linux/moduleloader.h                |    4 +-
 include/linux/oprofile.h                    |    2 +-
 include/linux/slab.h                        |    4 +-
 include/linux/slab_def.h                    |    2 -
 include/linux/slob_def.h                    |    2 -
 include/linux/slub_def.h                    |    6 +-
 include/linux/vmalloc.h                     |   14 +-
 mm/vmalloc.c                                |    7 +
 net/bridge/netfilter/ebt_ulog.c             |    1 -
 net/ipv4/netfilter/arp_tables.c             |    7 -
 net/ipv4/netfilter/ip_tables.c              |   10 -
 net/ipv4/netfilter/ipt_ULOG.c               |    1 -
 net/ipv4/netfilter/nf_nat_snmp_basic.c      |    4 -
 net/ipv6/netfilter/ip6_tables.c             |   11 -
 scripts/Makefile.lib                        |    6 +-
 sound/drivers/vx/vx_pcm.c                   |    1 -
 sound/pcmcia/pdaudiocf/pdaudiocf_pcm.c      |    1 -
 sound/usb/usbaudio.c                        |    1 -
 tools/gcc/size_overflow_hash.h              |10651 +++++++++++++++++++++++++++
 tools/gcc/size_overflow_hash1.h             | 2413 ------
 tools/gcc/size_overflow_hash2.h             |   14 -
 tools/gcc/size_overflow_plugin.c            |  155 +-
 77 files changed, 10788 insertions(+), 2722 deletions(-)

commit b680bd9e26a0d9646d2e55f924f627e9b21fcc18
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 19 10:47:15 2012 -0400

    init ebda range earlier in boot

 arch/x86/mm/init.c |   48 +++++++++++++++++++++++++++++-------------------
 1 files changed, 29 insertions(+), 19 deletions(-)

commit 5d9a1a5e8e92e9c2b2e042fe1027fc2abcf61410
Author: Willy Tarreau <w@1wt.eu>
Date:   Thu May 17 11:14:14 2012 +0000

    tcp: do_tcp_sendpages() must try to push data out on oom conditions
    
    Since recent changes on TCP splicing (starting with commits 2f533844
    "tcp: allow splice() to build full TSO packets" and 35f9c09f "tcp:
    tcp_sendpages() should call tcp_push() once"), I started seeing
    massive stalls when forwarding traffic between two sockets using
    splice() when pipe buffers were larger than socket buffers.
    
    Latest changes (net: netdev_alloc_skb() use build_skb()) made the
    problem even more apparent.
    
    The reason seems to be that if do_tcp_sendpages() fails on out of memory
    condition without being able to send at least one byte, tcp_push() is not
    called and the buffers cannot be flushed.
    
    After applying the attached patch, I cannot reproduce the stalls at all
    and the data rate it perfectly stable and steady under any condition
    which previously caused the problem to be permanent.
    
    The issue seems to have been there since before the kernel migrated to
    git, which makes me think that the stalls I occasionally experienced
    with tux during stress-tests years ago were probably related to the
    same issue.
    
    This issue was first encountered on 3.0.31 and 3.2.17, so please backport
    to -stable.
    
    Signed-off-by: Willy Tarreau <w@1wt.eu>
    Acked-by: Eric Dumazet <edumazet@google.com>
    Cc: <stable@vger.kernel.org>

 net/ipv4/tcp.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

commit 1f80506a69c0a18f5ecd9d28e1478b853ac060f5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 19 08:30:54 2012 -0400

    Precompute _start/_end

 arch/x86/mm/init.c |   25 ++++++++++++-------------
 1 files changed, 12 insertions(+), 13 deletions(-)

commit 1d5077543846d8a88d47b5db3772faf38608bc04
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 19 07:45:06 2012 -0400

    Use new method of EBDA detection
    Resolves issue from: https://bugs.gentoo.org/show_bug.cgi?id=416415
    
    Conflicts:
    
    	arch/x86/mm/init.c

 arch/x86/mm/init.c |   27 ++++++++++++++++++++++++++-
 1 files changed, 26 insertions(+), 1 deletions(-)

commit ceae82d551f6fc92e0f93eb1f5ab72a113026871
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon May 14 18:45:04 2012 -0400

    Backport changes similar to 38bf1953987c1735f3c9140fca762949a8cae507

 drivers/md/dm-log-userspace-transfer.c |    2 +-
 drivers/staging/dst/dcore.c            |    2 +-
 drivers/staging/pohmelfs/config.c      |    2 +-
 drivers/video/uvesafb.c                |    2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

commit 1cbffe423ace08507c18ddac980078066ace5195
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon May 14 18:30:19 2012 -0400

    Fix dl2k driver compilation error reported by mnalis on the forums

 drivers/net/dl2k.h |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit 5c71363e56290c89c50b051a33819c967867c89e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun May 13 15:42:34 2012 -0400

    Add MIPS support to GRKERNSEC_SETXID, choose a thread info flag bit
    for each of our supported architectures that can be properly expressed
    within the instruction making use of an immediate value:
    < 12 on sparc64
    < 32 on mips
    < 16 on powerpc
    < 8 or expressable within 8 bits with a shift amount on arm

 arch/arm/include/asm/thread_info.h      |    7 ++++++-
 arch/mips/include/asm/thread_info.h     |    7 ++++++-
 arch/mips/kernel/entry.S                |    2 +-
 arch/mips/kernel/ptrace.c               |    9 +++++++++
 arch/mips/kernel/scall32-o32.S          |    2 +-
 arch/mips/kernel/scall64-64.S           |    2 +-
 arch/mips/kernel/scall64-n32.S          |    2 +-
 arch/mips/kernel/scall64-o32.S          |    2 +-
 arch/powerpc/include/asm/thread_info.h  |    5 +++--
 arch/sparc/include/asm/thread_info_64.h |    3 ++-
 arch/x86/include/asm/thread_info.h      |    3 ++-
 grsecurity/Kconfig                      |    4 ++--
 12 files changed, 35 insertions(+), 13 deletions(-)

commit c14c5f001052e32ed337fc9d77b5a912e78808a4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun May 13 14:21:06 2012 -0400

    Add arm/ppc/sparc64 support to GRKERNSEC_SETXID
    (backported from my 3.3 branch)

 arch/arm/include/asm/thread_info.h      |    5 +++++
 arch/arm/kernel/entry-common.S          |    4 ++--
 arch/arm/kernel/ptrace.c                |    9 +++++++++
 arch/powerpc/include/asm/thread_info.h  |    6 +++++-
 arch/powerpc/kernel/ptrace.c            |   14 ++++++++++++++
 arch/sparc/include/asm/thread_info_64.h |    7 +++++++
 arch/sparc/kernel/ptrace_64.c           |   14 ++++++++++++++
 arch/sparc/kernel/syscalls.S            |   10 +++++-----
 arch/x86/include/asm/thread_info.h      |    2 +-
 grsecurity/Kconfig                      |    4 ++--
 10 files changed, 64 insertions(+), 11 deletions(-)

commit 357a5cd25b5496b3c31c0e8226e4833904f8f631
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 12 23:24:22 2012 -0400

    Make CONFIG_GRKERNSEC_SETXID depend on X86 for now, more architectures to
    be added later
    Speeds up implementation by using existing thread info flag check
    Will also apply the new credentials faster than the previous method, either
    upon the next syscall entry or exit
    Resolves oops triggerable by root reported by Pavel Labushev
    
    Conflicts:
    
    	arch/x86/kernel/ptrace.c

 arch/x86/include/asm/thread_info.h |    8 +++++---
 arch/x86/kernel/ptrace.c           |   14 ++++++++++++++
 grsecurity/Kconfig                 |    3 ++-
 kernel/cred.c                      |   11 ++++++++++-
 kernel/sched.c                     |   15 ---------------
 5 files changed, 31 insertions(+), 20 deletions(-)

commit 44b2f60c23729e7d9a3f361d30547d3e30205407
Merge: 914afe7 6bf7194
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 12 17:08:17 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 6bf7194addf7024965d89e6179028397105cadbe
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 12 17:07:50 2012 -0400

    Update to pax-linux-2.6.32.59-test165.patch

 arch/x86/kernel/entry_32.S |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 914afe7538e7a0d6264af7bdc4a365c77420c840
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 9 17:38:36 2012 -0400

    No need to perform descendent checks on anything but PTRACE_ATTACH
    resolves issue with strace -f v4.7

 grsecurity/gracl.c |   24 +++++++++++++-----------
 1 files changed, 13 insertions(+), 11 deletions(-)

commit f3dc5219b65de6288a832f9c5c7a0699a4ab8e3b
Merge: ebca0cf c9c8562
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 9 17:36:43 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit c9c8562036249bea1b032d4871556de5f54b72bf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 9 17:36:22 2012 -0400

    Update to pax-linux-2.6.32.59-test164.patch

 arch/x86/mm/hugetlbpage.c |    7 ++++++-
 arch/x86/mm/init_64.c     |    2 +-
 lib/ioremap.c             |    4 ++--
 mm/memory.c               |    8 ++++++--
 4 files changed, 15 insertions(+), 6 deletions(-)

commit ebca0cf0f1a7e27c8168c97b14ca34da8465b74f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon May 7 18:13:20 2012 -0400

    commit 1bb57e940e1958e40d51f2078f50c3a96a9b2d75
    Author: Jeff Mahoney <jeffm@suse.com>
    Date:   Wed Apr 25 14:32:09 2012 +0000
    
        dl2k: Clean up rio_ioctl
    
        The dl2k driver's rio_ioctl call has a few issues:
        - No permissions checking
        - Implements SIOCGMIIREG and SIOCGMIIREG using the SIOCDEVPRIVATE numbers
        - Has a few ioctls that may have been used for debugging at one point
          but have no place in the kernel proper.
    
        This patch removes all but the MII ioctls, renumbers them to use the
        standard ones, and adds the proper permission check for SIOCSMIIREG.
    
        We can also get rid of the dl2k-specific struct mii_data in favor of
        the generic struct mii_ioctl_data.
    
        Since we have the phyid on hand, we can add the SIOCGMIIPHY ioctl too.
    
        Most of the MII code for the driver could probably be converted to use
        the generic MII library but I don't have a device to test the results.
    
        Reported-by: Stephan Mueller <stephan.mueller@atsec.com>
        Signed-off-by: Jeff Mahoney <jeffm@suse.com>
        Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/dl2k.c |   52 +++++++++-------------------------------------------
 drivers/net/dl2k.h |    7 -------
 2 files changed, 9 insertions(+), 50 deletions(-)

commit 59df9221ff2085690d01cddc3d5977a5e026c83c
Author: David Vrabel <david.vrabel@citrix.com>
Date:   Thu Apr 26 19:44:06 2012 +0100

    xen: correctly check for pending events when restoring irq flags
    
    In xen_restore_fl_direct(), xen_force_evtchn_callback() was being
    called even if no events were pending.  This resulted in (depending on
    workload) about a 100 times as many xen_version hypercalls as
    necessary.
    
    Fix this by correcting the sense of the conditional jump.
    
    This seems to give a significant performance benefit for some
    workloads.
    
    There is some subtle tricksy "..since the check here is trying to
    check both pending and masked in a single cmpw, but I think this is
    correct. It will call check_events now only when the combined
    mask+pending word is 0x0001 (aka unmasked, pending)." (Ian)
    
    CC: stable@kernel.org
    Acked-by: Ian Campbell <ian.campbell@citrix.com>
    Signed-off-by: David Vrabel <david.vrabel@citrix.com>
    Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>

 arch/x86/xen/xen-asm.S |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit a44585c4a9f9708986f37be1bc1a4b200b282a77
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Fri May 4 12:09:39 2012 -0700

    hfsplus: Fix potential buffer overflows
    
    Commit ec81aecb2966 ("hfs: fix a potential buffer overflow") fixed a few
    potential buffer overflows in the hfs filesystem.  But as Timo Warns
    pointed out, these changes also need to be made on the hfsplus
    filesystem as well.
    
    Reported-by: Timo Warns <warns@pre-sense.de>
    Acked-by: WANG Cong <amwang@redhat.com>
    Cc: Alexey Khoroshilov <khoroshilov@ispras.ru>
    Cc: Miklos Szeredi <mszeredi@suse.cz>
    Cc: Sage Weil <sage@newdream.net>
    Cc: Eugene Teo <eteo@redhat.com>
    Cc: Roman Zippel <zippel@linux-m68k.org>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Cc: Christoph Hellwig <hch@lst.de>
    Cc: Alexey Dobriyan <adobriyan@gmail.com>
    Cc: Dave Anderson <anderson@redhat.com>
    Cc: stable <stable@vger.kernel.org>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/hfsplus/dir.c

 fs/hfsplus/catalog.c |    4 ++++
 fs/hfsplus/dir.c     |   11 +++++++++++
 2 files changed, 15 insertions(+), 0 deletions(-)

commit c92279b6042af806d01d9147c972045716263731
Merge: 6cc594f 0d394ec
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon May 7 17:45:18 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 0d394ec9cf9de72b91001b0eae1b25f18528b255
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon May 7 17:44:52 2012 -0400

    Update to pax-linux-2.6.32.59-test163.patch

 arch/alpha/include/asm/pgalloc.h      |    6 +++
 arch/arm/include/asm/pgalloc.h        |    1 +
 arch/ia64/include/asm/pgalloc.h       |   12 ++++++
 arch/mips/include/asm/pgalloc.h       |    5 ++
 arch/parisc/include/asm/pgalloc.h     |    6 +++
 arch/powerpc/include/asm/pgalloc-64.h |    7 +++
 arch/sparc/include/asm/pgalloc_32.h   |    1 +
 arch/sparc/include/asm/pgalloc_64.h   |    1 +
 arch/um/include/asm/pgtable-3level.h  |    1 +
 arch/x86/include/asm/pgalloc.h        |   16 ++++++++
 arch/x86/include/asm/pgtable_64.h     |    2 +
 arch/x86/mm/init_64.c                 |    6 +-
 fs/binfmt_elf.c                       |    6 ++-
 include/linux/mm.h                    |   26 ++++++++++++
 mm/memory.c                           |   41 ++++++++++++++++++++
 mm/sparse-vmemmap.c                   |    4 +-
 mm/vmalloc.c                          |    4 +-
 tools/gcc/size_overflow_plugin.c      |   68 ++++++++++++++++++++++++++-------
 18 files changed, 191 insertions(+), 22 deletions(-)

commit 6cc594f287121d2297013dbd964768d20b18b04f
Merge: d7620ea eb74fa6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 27 17:56:46 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit eb74fa6666dac6f9e03b0758070771a8327e1679
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 27 17:56:18 2012 -0400

    Update to pax-linux-2.6.32.59-test161.patch

 arch/arm/include/asm/atomic.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit d7620ea4c388fbaa6ffeea42a503080d8fb390e1
Merge: b455400 9065343
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Apr 26 16:25:16 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 90653431ff56a7fda28c0d6a7f7f3313df5809f4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Apr 26 16:24:22 2012 -0400

    Disable PAX_SIZE_OVERFLOW on !X86
    Update to pax-linux-2.6.32.59-test161.patch

 security/Kconfig |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit b45540017842f7755235da08df4b80bcab775611
Merge: cbbb203 9a04d9e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Apr 23 18:10:46 2012 -0400

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	security/Kconfig

commit 9a04d9e7adf6d38ac2666bfd7aeab1ca2cb2c07f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Apr 23 18:01:39 2012 -0400

    Update to pax-linux-2.6.32.59-test160.patch

 arch/x86/kvm/svm.c          |    1 -
 security/Kconfig            |    1 +
 security/commoncap.c        |    5 +++++
 tools/gcc/constify_plugin.c |    2 +-
 4 files changed, 7 insertions(+), 2 deletions(-)

commit cbbb2031c5fd9a4a50be3e55d95fc0ac612df9c0
Author: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Date:   Fri Apr 13 03:35:13 2012 +0000

    sparc64: Eliminate obsolete __handle_softirq() function
    
    The invocation of softirq is now handled by irq_exit(), so there is no
    need for sparc64 to invoke it on the trap-return path.  In fact, doing so
    is a bug because if the trap occurred in the idle loop, this invocation
    can result in lockdep-RCU failures.  The problem is that RCU ignores idle
    CPUs, and the sparc64 trap-return path to the softirq handlers fails to
    tell RCU that the CPU must be considered non-idle while those handlers
    are executing.  This means that RCU is ignoring any RCU read-side critical
    sections in those handlers, which in turn means that RCU-protected data
    can be yanked out from under those read-side critical sections.
    
    The shiny new lockdep-RCU ability to detect RCU read-side critical sections
    that RCU is ignoring located this problem.
    
    The fix is straightforward: Make sparc64 stop manually invoking the
    softirq handlers.
    
    Reported-by: Meelis Roos <mroos@linux.ee>
    Suggested-by: David Miller <davem@davemloft.net>
    Signed-off-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
    Tested-by: Meelis Roos <mroos@linux.ee>
    Cc: stable@vger.kernel.org
    Signed-off-by: David S. Miller <davem@davemloft.net>

 arch/sparc/kernel/rtrap_64.S |    7 -------
 1 files changed, 0 insertions(+), 7 deletions(-)

commit 18678ce8ff0caa92c1449149042a161103584599
Author: David S. Miller <davem@davemloft.net>
Date:   Fri Apr 13 11:56:22 2012 -0700

    sparc64: Fix bootup crash on sun4v.
    
    The DS driver registers as a subsys_initcall() but this can be too
    early, in particular this risks registering before we've had a chance
    to allocate and setup module_kset in kernel/params.c which is
    performed also as a subsyts_initcall().
    
    Register DS using device_initcall() insteal.
    
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Cc: stable@vger.kernel.org

 arch/sparc/kernel/ds.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 0b3c8c6b877bae23be7f2ef972bf5424f17ddaa4
Author: Lubos Lunak <l.lunak@suse.cz>
Date:   Wed Mar 21 14:08:24 2012 +0100

    do not export kernel's NULL #define to userspace
    
    GCC's NULL is actually __null, which allows detecting some questionable
    NULL usage and warn about it.  Moreover each platform/compiler should
    have its own stddef.h anyway (which is different from linux/stddef.h).
    
    So there's no good reason to leak kernel's NULL to userspace and
    override what the compiler provides.
    
    Signed-off-by: Luboš Luňák <l.lunak@suse.cz>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 include/linux/stddef.h |    8 ++------
 1 files changed, 2 insertions(+), 6 deletions(-)

commit 3696f294c6b89bdb5d10d835af78c74dfe7c9469
Author: Eric Paris <eparis@redhat.com>
Date:   Tue Apr 17 16:26:54 2012 -0400

    fcaps: clear the same personality flags as suid when fcaps are used
    
    If a process increases permissions using fcaps all of the dangerous
    personality flags which are cleared for suid apps should also be cleared.
    Thus programs given priviledge with fcaps will continue to have address space
    randomization enabled even if the parent tried to disable it to make it
    easier to attack.
    
    Signed-off-by: Eric Paris <eparis@redhat.com>
    Reviewed-by: Serge Hallyn <serge.hallyn@canonical.com>
    Signed-off-by: James Morris <james.l.morris@oracle.com>

 security/commoncap.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

commit 1267a831503e813ca35b092f905fdb652996124d
Merge: 719c976 f6b977b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 13 16:46:20 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit f6b977ba24f54aef6652e485e249299563efe9eb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 13 16:45:12 2012 -0400

    Remove size_overflow checks from vmx_set_msr and kvm_set_msr_common

 arch/x86/include/asm/kvm_host.h |    2 +-
 arch/x86/kvm/vmx.c              |    1 -
 2 files changed, 1 insertions(+), 2 deletions(-)

commit 719c976838b078635923a4f7985f84582994ab52
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Mon Apr 9 21:03:50 2012 +0200

    cred: copy_process() should clear child->replacement_session_keyring
    
    keyctl_session_to_parent(task) sets ->replacement_session_keyring,
    it should be processed and cleared by key_replace_session_keyring().
    
    However, this task can fork before it notices TIF_NOTIFY_RESUME and
    the new child gets the bogus ->replacement_session_keyring copied by
    dup_task_struct(). This is obviously wrong and, if nothing else, this
    leads to put_cred(already_freed_cred).
    
    change copy_creds() to clear this member. If copy_process() fails
    before this point the wrong ->replacement_session_keyring doesn't
    matter, exit_creds() won't be called.
    
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Acked-by: David Howells <dhowells@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	kernel/cred.c

 kernel/cred.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 40887a42590f38fe694147499524af726cc1e27e
Author: Jason Wessel <jason.wessel@windriver.com>
Date:   Thu Apr 12 12:49:17 2012 -0700

    panic: fix stack dump print on direct call to panic()
    
    Commit 6e6f0a1f0fa6 ("panic: don't print redundant backtraces on oops")
    causes a regression where no stack trace will be printed at all for the
    case where kernel code calls panic() directly while not processing an
    oops, and of course there are 100's of instances of this type of call.
    
    The original commit executed the check (!oops_in_progress), but this will
    always be false because just before the dump_stack() there is a call to
    bust_spinlocks(1), which does the following:
    
      void __attribute__((weak)) bust_spinlocks(int yes)
      {
    	if (yes) {
    		++oops_in_progress;
    
    The proper way to resolve the problem that original commit tried to
    solve is to avoid printing a stack dump from panic() when the either of
    the following conditions is true:
    
      1) TAINT_DIE has been set (this is done by oops_end())
         This indicates and oops has already been printed.
      2) oops_in_progress > 1
         This guards against the rare case where panic() is invoked
         a second time, or in between oops_begin() and oops_end()
    
    Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: <stable@vger.kernel.org>	[3.3+]
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 kernel/panic.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 26334c7beadf9b5970ebef2407731ca1975928cc
Author: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date:   Thu Apr 12 12:49:12 2012 -0700

    drivers/char/random.c: fix boot id uniqueness race
    
    /proc/sys/kernel/random/boot_id can be read concurrently by userspace
    processes.  If two (or more) user-space processes concurrently read
    boot_id when sysctl_bootid is not yet assigned, a race can occur making
    boot_id differ between the reads.  Because the whole point of the boot id
    is to be unique across a kernel execution, fix this by protecting this
    operation with a spinlock.
    
    Given that this operation is not frequently used, hitting the spinlock
    on each call should not be an issue.
    
    Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
    Cc: "Theodore Ts'o" <tytso@mit.edu>
    Cc: Matt Mackall <mpm@selenic.com>
    Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
    Cc: Greg Kroah-Hartman <greg@kroah.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 drivers/char/random.c |   11 ++++++++---
 1 files changed, 8 insertions(+), 3 deletions(-)

commit 5a440b87c7c63e5a885d5f96d52b35d69fa66eee
Merge: 63c9ff2 6e6ac3c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Apr 9 17:03:45 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 6e6ac3c2789aa2f74af9f512e552c3a065f1f52e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Apr 9 17:03:02 2012 -0400

    Update to pax-linux-2.6.32.59-test158.patch

 arch/x86/kernel/kdebugfs.c |    2 ++
 arch/x86/mm/pgtable.c      |    4 ++++
 2 files changed, 6 insertions(+), 0 deletions(-)

commit 63c9ff2bf26de5dc709284af66983d64af0b8aed
Merge: 4c35a7c ddd693a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 18:08:56 2012 -0400

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	mm/mmap.c

commit ddd693a5102b6e053fd7eb41dec841bd064a7924
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 18:07:35 2012 -0400

    Update to pax-linux-2.6.32.59-test157.patch

 arch/x86/kernel/ldt.c                       |    1 +
 arch/x86/kernel/tlb_uv.c                    |    2 +
 arch/x86/kvm/mmu.c                          |    2 +
 drivers/media/video/cpia.c                  |    1 +
 drivers/media/video/cpia2/cpia2_core.c      |    1 +
 drivers/media/video/cx231xx/cx231xx-audio.c |    2 +
 drivers/media/video/em28xx/em28xx-audio.c   |    2 +
 drivers/media/video/gspca/gspca.c           |    1 +
 drivers/media/video/meye.c                  |    1 +
 drivers/media/video/ov511.c                 |    2 +
 drivers/media/video/se401.c                 |    1 +
 drivers/media/video/stv680.c                |    1 +
 drivers/media/video/usbvideo/vicam.c        |    1 +
 drivers/media/video/videobuf-dma-sg.c       |    4 +
 drivers/media/video/videobuf-vmalloc.c      |    4 +
 drivers/media/video/w9968cf.c               |    2 +-
 drivers/net/chelsio/sge.c                   |    2 +
 drivers/net/cxgb3/sge.c                     |    2 +
 fs/binfmt_elf.c                             |    1 +
 fs/configfs/file.c                          |    2 +
 fs/sysfs/file.c                             |    2 +
 include/linux/kvm_host.h                    |    2 +-
 include/linux/mm_types.h                    |    4 +-
 init/do_mounts.h                            |    2 +-
 mm/mmap.c                                   |    5 +
 net/bridge/netfilter/ebt_ulog.c             |    1 +
 net/ipv4/netfilter/ip_tables.c              |    4 +
 net/ipv4/netfilter/ipt_ULOG.c               |    1 +
 net/ipv6/netfilter/ip6_tables.c             |    4 +
 sound/drivers/vx/vx_pcm.c                   |    1 +
 sound/pcmcia/pdaudiocf/pdaudiocf_pcm.c      |    1 +
 sound/usb/usbaudio.c                        |    1 +
 tools/gcc/size_overflow_hash1.h             | 2012 ++++++++++++++++++++++-----
 tools/gcc/size_overflow_hash2.h             |   24 +-
 tools/gcc/size_overflow_plugin.c            |   47 +-
 35 files changed, 1785 insertions(+), 361 deletions(-)

commit 4c35a7ca87711f9ffca8a694439ac3aaa4c779f7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 18:04:03 2012 -0400

    Revert "Fix RLIMIT_AS accounting with brk randomization"
    
    This reverts commit 803069c97a11ac7a2dd6c1a0b441437ae711c8ed.

 fs/binfmt_elf.c |    2 +-
 mm/mmap.c       |    3 ---
 2 files changed, 1 insertions(+), 4 deletions(-)

commit 50696aa13c836d621d87e0ca15955e3ea554e887
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 18:03:50 2012 -0400

    Revert "Fix RLIMIT_AS checking with brk randomization"
    
    This reverts commit 0f2c6b5fcbae1edf1ec5e262aee88d40a8272d4d.

 fs/binfmt_elf.c |    2 --
 mm/mmap.c       |    5 +----
 2 files changed, 1 insertions(+), 6 deletions(-)

commit 5f28bcddf2646cb3de6a69d65f10c30707b8083a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 18:03:29 2012 -0400

    Revert "Fix RLIMIT_AS checking with brk randomization"
    
    This reverts commit 99f21df37ebbcd2a642f9438dacd63343fcbf461.

 fs/binfmt_elf.c |    2 ++
 mm/mmap.c       |    2 +-
 2 files changed, 3 insertions(+), 1 deletions(-)

commit 0ae0ecebc365be11bacd58087038e7b38e0b6572
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 18:03:16 2012 -0400

    Revert "fix wraparound"
    
    This reverts commit def8ef9790858a20befe1805af78dea8dbe56546.

 fs/binfmt_elf.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

commit 43e869262e3c228da91a64bb941bfcecd46e520e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 18:03:03 2012 -0400

    Revert "fake start_brk value before mmap is processed"
    
    This reverts commit bb93be2e87f25458e13c43ff321c36fa748eaba6.

 fs/binfmt_elf.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

commit d5a8bba439ce0efd7340c707e9968a4d3bc8d0f6
Merge: 491867d a1d9451
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 16:11:57 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit a1d94512b12eb1e9605194a7a822b3ea2cb143a9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 16:11:22 2012 -0400

    Update to pax-linux-2.6.32.59-test156.patch

 arch/x86/kernel/tls.c            |    4 +-
 arch/x86/mm/pgtable.c            |   12 +-
 drivers/mtd/ubi/build.c          |   16 +-
 include/linux/mm_types.h         |    2 +-
 scripts/mod/modpost.c            |    2 +-
 scripts/tags.sh                  |    2 +-
 tools/gcc/kernexec_plugin.c      |    2 +-
 tools/gcc/size_overflow_plugin.c |  501 +++++++++++++++++++++-----------------
 8 files changed, 297 insertions(+), 244 deletions(-)

commit 491867d2cfae87045687ba36e006973562db065c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 15:40:58 2012 -0400

    Always allow use of AF_UNSPEC for already-connected sockets to disconnect

 grsecurity/gracl_ip.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit 7729bad29806b17f42163b018be9c087edd31338
Author: Eric Dumazet <eric.dumazet@gmail.com>
Date:   Fri Apr 6 10:49:10 2012 +0200

    net: fix a race in sock_queue_err_skb()
    
    As soon as an skb is queued into socket error queue, another thread
    can consume it, so we are not allowed to reference skb anymore, or risk
    use after free.
    
    Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/core/skbuff.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

commit 1db2fc9aacec613c8459dce30983181ce71838a4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 10:13:28 2012 -0400

    always allow admin to follow ptrace'd execs
    no need for task_lock

 grsecurity/gracl.c |   19 ++++++++++++++++---
 1 files changed, 16 insertions(+), 3 deletions(-)

commit 336845b2bd3dd3e2c63f7ef2d901b79548c60a19
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 07:04:45 2012 -0400

    Require CAP_SYS_ADMIN for /proc/sysrq-trigger

 drivers/char/sysrq.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 626905f29e3c9bbef3fd4f9179e247e422d01b84
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 07:01:20 2012 -0400

    Require CAP_SYS_ADMIN for /sys/kernel/uevent_helper

 kernel/ksysfs.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit bb93be2e87f25458e13c43ff321c36fa748eaba6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 6 19:45:36 2012 -0400

    fake start_brk value before mmap is processed

 fs/binfmt_elf.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit def8ef9790858a20befe1805af78dea8dbe56546
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 6 18:56:24 2012 -0400

    fix wraparound
    
    Conflicts:
    
    	fs/binfmt_elf.c

 fs/binfmt_elf.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 99f21df37ebbcd2a642f9438dacd63343fcbf461
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 6 18:14:20 2012 -0400

    Fix RLIMIT_AS checking with brk randomization

 fs/binfmt_elf.c |    2 --
 mm/mmap.c       |    2 +-
 2 files changed, 1 insertions(+), 3 deletions(-)

commit 0f2c6b5fcbae1edf1ec5e262aee88d40a8272d4d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Apr 5 20:54:16 2012 -0400

    Fix RLIMIT_AS checking with brk randomization

 fs/binfmt_elf.c |    2 ++
 mm/mmap.c       |    5 ++++-
 2 files changed, 6 insertions(+), 1 deletions(-)

commit 803069c97a11ac7a2dd6c1a0b441437ae711c8ed
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Apr 5 19:53:46 2012 -0400

    Fix RLIMIT_AS accounting with brk randomization
    
    Conflicts:
    
    	mm/mmap.c

 fs/binfmt_elf.c |    2 +-
 mm/mmap.c       |    3 +++
 2 files changed, 4 insertions(+), 1 deletions(-)

commit effbefd3bd6d1718fe830f30247e459ae94306e5
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Sat Mar 24 10:52:50 2012 +0300

    x86, tls: Off by one limit check
    
    These are used as offsets into an array of GDT_ENTRY_TLS_ENTRIES members
    so GDT_ENTRY_TLS_ENTRIES is one past the end of the array.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Link: http://lkml.kernel.org/r/20120324075250.GA28258@elgon.mountain
    Cc: <stable@vger.kernel.org>
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>

 arch/x86/kernel/tls.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit f5bb3d336d7b233a175ea8513f3ddb547609ec25
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 25 18:53:56 2012 -0400

    make const

 fs/dcache.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 65c3acadbb73db2a7158230af93e4a0d37de1b70
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Mon Mar 19 16:19:53 2012 -0700

    vfs: get rid of batshit-insane pointless dentry hash calculations
    
    For some odd historical reason, the final mixing round for the dentry
    cache hash table lookup had an insane "xor with big constant" logic.  In
    two places.
    
    The big constant that is being xor'ed is GOLDEN_RATIO_PRIME, which is a
    fairly random-looking number that is designed to be *multiplied* with so
    that the bits get spread out over a whole long-word.
    
    But xor'ing with it is insane.  It doesn't really even change the hash -
    it really only shifts the hash around in the hash table.  To make
    matters worse, the insane big constant is different on 32-bit and 64-bit
    builds, even though the name hash bits we use are always 32-bit (and the
    bits from the pointer we mix in effectively are too).
    
    It's all total voodoo programming, in other words.
    
    Now, some testing and analysis of the hash chains shows that the rest of
    the hash function seems to be fairly good.  It does pick the right bits
    of the parent dentry pointer, for example, and while it's generally a
    bad idea to use an xor to mix down the upper bits (because if there is a
    repeating pattern, the xor can cause "destructive interference"), it
    seems to not have been a disaster.
    
    For example, replacing the hash with the normal "hash_long()" code (that
    uses the GOLDEN_RATIO_PRIME constant correctly, btw) actually just makes
    the hash worse.  The hand-picked hash knew which bits of the pointer had
    the highest entropy, and hash_long() ends up mixing bits less optimally
    at least in some trivial tests.
    
    So the hash function overall seems fine, it just has that really odd
    "shift result around by a constant xor".
    
    So get rid of the silly xor, and replace the down-mixing of the bits
    with an add instead of an xor that tends to not have the same kind of
    destructive interference issues.  Some stats on the resulting hash
    chains shows that they look statistically identical before and after,
    but the code is simpler and no longer makes you go "WTF?".
    
    Also, the incoming hash really is just "unsigned int", not a long, and
    there's no real point to worry about the high 26 bits of the dentry
    pointer for the 64-bit case, because they are all going to be identical
    anyway.
    
    So also change the hashing to be done in the more natural 'unsigned int'
    that is the real size of the actual hashed data anyway.
    
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/dcache.c

 fs/dcache.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

commit 3092cd4378943ed81d3bbf5c389ec97e0421beb8
Author: Dmitry Adamushko <dmitry.adamushko@gmail.com>
Date:   Thu Mar 22 21:39:25 2012 +0100

    x86-32: Fix endless loop when processing signals for kernel tasks
    
    The problem occurs on !CONFIG_VM86 kernels [1] when a kernel-mode task
    returns from a system call with a pending signal.
    
    A real-life scenario is a child of 'khelper' returning from a failed
    kernel_execve() in ____call_usermodehelper() [ kernel/kmod.c ].
    kernel_execve() fails due to a pending SIGKILL, which is the result of
    "kill -9 -1" (at least, busybox's init does it upon reboot).
    
    The loop is as follows:
    
    * syscall_exit_work:
     - work_pending:            // start_of_the_loop
     - work_notify_sig:
       - do_notify_resume()
         - do_signal()
           - if (!user_mode(regs)) return;
     - resume_userspace         // TIF_SIGPENDING is still set
     - work_pending             // so we call work_pending => goto
                                // start_of_the_loop
    
    More information can be found in another LKML thread:
    http://www.serverphorums.com/read.php?12,457826
    
    [1] the problem was also seen on MIPS.
    
    Signed-off-by: Dmitry Adamushko <dmitry.adamushko@gmail.com>
    Link: http://lkml.kernel.org/r/1332448765.2299.68.camel@dimm
    Cc: Oleg Nesterov <oleg@redhat.com>
    Cc: Roland McGrath <roland@hack.frob.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>

 arch/x86/kernel/entry_32.S |   17 ++++++++++-------
 1 files changed, 10 insertions(+), 7 deletions(-)

commit a154c18cbe88325f24ac14149c6a4e23f52f9eb3
Merge: 3166067 f86aad9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 25 18:33:32 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit f86aad96630478e3987a4b115a2c5af1f39edf77
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 25 18:33:18 2012 -0400

    Update to pax-linux-2.6.32.59-test155.patch

 fs/binfmt_elf.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

commit 31660670d1896830d0c39392a131d970a1bae28b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 24 22:13:21 2012 -0400

    Backport L2TP fix for cilly
    http://lists.debian.org/debian-kernel/2011/12/msg00484.html

 drivers/net/pppol2tp.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 22d074672125f6a246d65a77353206c59aa1385a
Merge: 5a975e9 b3f064e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 24 19:37:19 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit b3f064e6423ded0dcba59eecd1dfb05bd470c38d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 24 19:36:57 2012 -0400

    Update to pax-linux-2.6.32.59-test154.patch
    reduces overcommit amount from recently increased brk entropy

 arch/arm/include/asm/atomic.h |    5 +++++
 fs/binfmt_elf.c               |   27 ++++++++++++++++++++++-----
 fs/bio.c                      |    2 +-
 3 files changed, 28 insertions(+), 6 deletions(-)

commit 5a975e95af53a673289b91bfb55927f087c809bf
Merge: 092dcb6 7cdca8e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 22 19:02:29 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 7cdca8e93bd1da5b9bbba51df4f7215847584d22
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 22 19:01:45 2012 -0400

    Update to pax-linux-2.6.32.59-test153.patch

 arch/x86/include/asm/uaccess_32.h |    6 +++---
 arch/x86/include/asm/uaccess_64.h |    8 ++++----
 arch/x86/lib/usercopy_32.c        |    6 +++---
 arch/x86/lib/usercopy_64.c        |    8 ++++----
 4 files changed, 14 insertions(+), 14 deletions(-)

commit 092dcb6735f33f0d18072df70563cd44315b28c2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 22 18:59:57 2012 -0400

    Use umode_t instead of mode_t

 grsecurity/gracl_fs.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 566b256dd1cbcc88922a844ecebdd762e56d623e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 22 18:56:48 2012 -0400

    Use umode_t instead of mode_t for umask type

 grsecurity/gracl_fs.c |    2 +-
 include/linux/gracl.h |    3 ++-
 2 files changed, 3 insertions(+), 2 deletions(-)

commit 3dd5abd5214d9ed2904d324c785e72e87bf8a2b1
Merge: 9176a87 c6ac106
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 21 20:13:42 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit c6ac106b9ef3213892bf710ecd0ecb7a0f8821bf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 21 20:13:23 2012 -0400

    Update to pax-linux-2.6.32.59-test152.patch

 arch/x86/kvm/x86.c            |    6 ++----
 include/asm-generic/uaccess.h |    1 -
 2 files changed, 2 insertions(+), 5 deletions(-)

commit 9176a87f2544c9fd30585685c03c5842c9e62a25
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 21 19:42:42 2012 -0400

    compile fix

 grsecurity/gracl.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 03edf9eb83b4480bedfa23d556b67aff52f3ca66
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 21 19:34:56 2012 -0400

    Resolve some very tricky hash table manipulations that resulted in an infinite loop in certain
    uses of domains with particular hash collisions

 grsecurity/gracl.c |   62 +++++++++++++++++++++++++++++++++++++++++----------
 1 files changed, 50 insertions(+), 12 deletions(-)

commit 552418c6ff6c53e998627093f37c5fa174d46db6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 20:25:49 2012 -0400

    zero kernel_role

 grsecurity/gracl.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 1b365b8b1a0e4db724b805b8fc5528ac33e7e0c7
Merge: 92afdf4 4045ead
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 19:10:11 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 4045eaddde5586993007853c5361b0410014656f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 19:08:29 2012 -0400

    Temporary workaround for (most) size_overflow plugin false-positives
    Increase randomization for brk-managed heap to 21 bits
    Update to pax-linux-2.6.32.59-test151.patch

 arch/x86/include/asm/uaccess_32.h |    4 ++--
 arch/x86/include/asm/uaccess_64.h |    8 ++++----
 fs/binfmt_elf.c                   |    2 +-
 include/asm-generic/uaccess.h     |    4 ----
 4 files changed, 7 insertions(+), 11 deletions(-)

commit 92afdf49876fe40ab3bc6c513b96a7859c7667e5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 18:58:53 2012 -0400

    compile fix

 grsecurity/gracl.c |    9 +++------
 1 files changed, 3 insertions(+), 6 deletions(-)

commit 2c803141acfcfd076cb932d7a87fca735a84ebaa
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 18:52:23 2012 -0400

    Require default and kernel role

 grsecurity/gracl.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit b7c346bcb1dc0362cd3280c1326c4e7329877248
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 18:47:28 2012 -0400

    Allow policies without special roles
    don't call free_variables in error path of copy_user_acl, we'll call it later (triggered by a policy without special roles)

 grsecurity/gracl.c |  113 +++++++++++++++++++---------------------------------
 1 files changed, 41 insertions(+), 72 deletions(-)

commit b700dd101238a1d1691ed2345447e0d631993fc3
Author: Ryusuke Konishi <konishi.ryusuke@lab.ntt.co.jp>
Date:   Fri Mar 16 17:08:39 2012 -0700

    nilfs2: fix NULL pointer dereference in nilfs_load_super_block()
    
    According to the report from Slicky Devil, nilfs caused kernel oops at
    nilfs_load_super_block function during mount after he shrank the
    partition without resizing the filesystem:
    
     BUG: unable to handle kernel NULL pointer dereference at 00000048
     IP: [<d0d7a08e>] nilfs_load_super_block+0x17e/0x280 [nilfs2]
     *pde = 00000000
     Oops: 0000 [#1] PREEMPT SMP
     ...
     Call Trace:
      [<d0d7a87b>] init_nilfs+0x4b/0x2e0 [nilfs2]
      [<d0d6f707>] nilfs_mount+0x447/0x5b0 [nilfs2]
      [<c0226636>] mount_fs+0x36/0x180
      [<c023d961>] vfs_kern_mount+0x51/0xa0
      [<c023ddae>] do_kern_mount+0x3e/0xe0
      [<c023f189>] do_mount+0x169/0x700
      [<c023fa9b>] sys_mount+0x6b/0xa0
      [<c04abd1f>] sysenter_do_call+0x12/0x28
     Code: 53 18 8b 43 20 89 4b 18 8b 4b 24 89 53 1c 89 43 24 89 4b 20 8b 43
     20 c7 43 2c 00 00 00 00 23 75 e8 8b 50 68 89 53 28 8b 54 b3 20 <8b> 72
     48 8b 7a 4c 8b 55 08 89 b3 84 00 00 00 89 bb 88 00 00 00
     EIP: [<d0d7a08e>] nilfs_load_super_block+0x17e/0x280 [nilfs2] SS:ESP 0068:ca9bbdcc
     CR2: 0000000000000048
    
    This turned out due to a defect in an error path which runs if the
    calculated location of the secondary super block was invalid.
    
    This patch fixes it and eliminates the reported oops.
    
    Reported-by: Slicky Devil <slicky.dvl@gmail.com>
    Signed-off-by: Ryusuke Konishi <konishi.ryusuke@lab.ntt.co.jp>
    Tested-by: Slicky Devil <slicky.dvl@gmail.com>
    Cc: <stable@vger.kernel.org>	[2.6.30+]
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/nilfs2/the_nilfs.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 5672d417a051626d95d85de5153c02076b504cbc
Author: Thomas Gleixner <tglx@linutronix.de>
Date:   Fri Mar 9 20:55:10 2012 +0100

    x86: Derandom delay_tsc for 64 bit
    
    Commit f0fbf0abc093 ("x86: integrate delay functions") converted
    delay_tsc() into a random delay generator for 64 bit.  The reason is
    that it merged the mostly identical versions of delay_32.c and
    delay_64.c.  Though the subtle difference of the result was:
    
     static void delay_tsc(unsigned long loops)
     {
    -	unsigned bclock, now;
    +	unsigned long bclock, now;
    
    Now the function uses rdtscl() which returns the lower 32bit of the
    TSC. On 32bit that's not problematic as unsigned long is 32bit. On 64
    bit this fails when the lower 32bit are close to wrap around when
    bclock is read, because the following check
    
           if ((now - bclock) >= loops)
           	  	break;
    
    evaluated to true on 64bit for e.g. bclock = 0xffffffff and now = 0
    because the unsigned long (now - bclock) of these values results in
    0xffffffff00000001 which is definitely larger than the loops
    value. That explains Tvortkos observation:
    
    "Because I am seeing udelay(500) (_occasionally_) being short, and
     that by delaying for some duration between 0us (yep) and 491us."
    
    Make those variables explicitely u32 again, so this works for both 32
    and 64 bit.
    
    Reported-by: Tvrtko Ursulin <tvrtko.ursulin@onelan.co.uk>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: stable@vger.kernel.org # >= 2.6.27
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 arch/x86/lib/delay.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit b126508f5718c6a4b35414c6c351c7a9c5959191
Merge: 8d86e79 1b49f3c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 18 13:02:57 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 1b49f3cdfbdc0048bcba385860de08c046409518
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 18 13:02:37 2012 -0400

    Update to pax-linux-2.6.32.59-test150.patch

 tools/gcc/colorize_plugin.c |  147 +++++++++++++++++++++++++++++++++++++++++++
 1 files changed, 147 insertions(+), 0 deletions(-)

commit 8d86e79dd59cb66dbb2c901c7a5becb7aa7494a6
Merge: 2f2cdf7 fcdef7b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 18 12:55:35 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit fcdef7bf28af43260197999b45cb848594c3f570
Merge: 0d2a9ed 6d22460
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 18 12:55:25 2012 -0400

    Merge branch 'linux-2.6.32.y' into pax-stable

commit 2f2cdf7082dda96b6d508bf344a455967c75c5ea
Merge: e8e1661 0d2a9ed
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 16 21:07:17 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 0d2a9ed427a1aa6e75bf961e6851357d33f96c0e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 16 21:05:34 2012 -0400

    Update to pax-linux-2.6.32.58-test150.patch
    Introduce size_overflow plugin from Emese Revfy
    Many thanks to Emese for her hard work! :)

 Documentation/dontdiff                  |    1 +
 Makefile                                |    7 +-
 arch/x86/include/asm/floppy.h           |    1 +
 arch/x86/include/asm/kvm_host.h         |    8 +-
 arch/x86/include/asm/syscalls.h         |    2 +-
 arch/x86/include/asm/uaccess_32.h       |   37 +-
 arch/x86/include/asm/uaccess_64.h       |   37 +-
 arch/x86/kernel/cpu/mcheck/mce-inject.c |    2 +
 arch/x86/kernel/cpu/mtrr/if.c           |    2 +
 arch/x86/kernel/i387.c                  |   14 +
 arch/x86/kernel/ldt.c                   |    1 +
 arch/x86/kernel/microcode_intel.c       |    1 +
 arch/x86/kernel/ptrace.c                |    4 +
 arch/x86/kernel/setup_percpu.c          |    4 +
 arch/x86/kernel/tls.h                   |    2 +-
 arch/x86/kernel/vm86_32.c               |    3 +
 arch/x86/kvm/svm.c                      |    1 +
 arch/x86/kvm/vmx.c                      |    1 +
 arch/x86/kvm/x86.c                      |   10 +-
 arch/x86/lib/usercopy_32.c              |   12 +-
 arch/x86/lib/usercopy_64.c              |    8 +-
 crypto/ablkcipher.c                     |    4 +
 crypto/aead.c                           |    3 +
 crypto/blkcipher.c                      |    3 +
 crypto/cipher.c                         |    3 +
 drivers/acpi/battery.c                  |    3 +
 drivers/acpi/sbs.c                      |    3 +
 drivers/infiniband/hw/ipath/ipath_fs.c  |    2 +
 drivers/lguest/lguest_user.c            |    1 +
 drivers/media/video/videobuf-dma-sg.c   |    3 +
 drivers/media/video/videobuf-vmalloc.c  |    3 +
 drivers/mtd/ubi/build.c                 |    2 +-
 drivers/net/wireless/ath/ath5k/debug.c  |    3 +
 drivers/net/wireless/ath/ath9k/debug.c  |    2 +
 drivers/oprofile/oprofile_files.c       |    5 +
 drivers/oprofile/oprofilefs.c           |    1 +
 drivers/usb/core/message.c              |    4 +-
 fs/autofs/root.c                        |    3 +-
 fs/cifs/asn1.c                          |    3 +
 fs/exec.c                               |   10 +
 fs/ncpfs/ncplib_kernel.h                |    4 +-
 fs/seq_file.c                           |   12 +-
 fs/sysfs/bin.c                          |    2 +
 include/asm-generic/int-l64.h           |    2 -
 include/asm-generic/int-ll64.h          |    2 -
 include/asm-generic/uaccess.h           |   16 +
 include/linux/compiler-gcc4.h           |    3 +
 include/linux/compiler.h                |    3 +
 include/linux/crash_dump.h              |    2 +-
 include/linux/kvm_host.h                |    2 +-
 include/linux/moduleloader.h            |    2 +-
 include/linux/oprofile.h                |    2 +-
 include/linux/slab.h                    |   41 +--
 include/linux/slab_def.h                |    6 +-
 include/linux/slob_def.h                |    5 +-
 include/linux/slub_def.h                |    8 +-
 include/linux/uaccess.h                 |    2 +-
 include/linux/vmalloc.h                 |   95 +---
 lib/parser.c                            |    2 +-
 mm/vmalloc.c                            |    7 -
 net/ipv4/netfilter/arp_tables.c         |    7 +
 net/ipv4/netfilter/ip_tables.c          |    6 +
 net/ipv4/netfilter/nf_nat_snmp_basic.c  |    6 +-
 net/ipv6/netfilter/ip6_tables.c         |    7 +
 security/Kconfig                        |   14 +-
 tools/gcc/Makefile                      |    3 +
 tools/gcc/size_overflow_hash1.h         | 1055 +++++++++++++++++++++++++++++++
 tools/gcc/size_overflow_hash2.h         |   14 +
 tools/gcc/size_overflow_plugin.c        | 1042 ++++++++++++++++++++++++++++++
 tools/gcc/stackleak_plugin.c            |    4 +-
 70 files changed, 2396 insertions(+), 199 deletions(-)

commit e8e1661d3e1fc0f5f9ade35bc4f11b7109042435
Merge: e6ce86e f892d75
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 15 20:44:49 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit f892d7567ae8ee6916093d7353fc3d5122424f24
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 15 20:44:30 2012 -0400

    Update to pax-linux-2.6.32.58-test148.patch

 include/asm-generic/local.h  |    1 +
 tools/gcc/stackleak_plugin.c |   41 +++++++++++++----------------------------
 2 files changed, 14 insertions(+), 28 deletions(-)

commit e6ce86e41acc7bd19e07ee8594394cbecf1adb63
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 18:19:41 2012 -0400

    Add backported be2net driver for BladeEngine 10GbE card used in HP blade servers
    Fix compilation of driver and make compatible with PaX
    source tarball was hp-be2net-4.0.479.0.tar.gz from:
    ftp://ftp.hp.com/pub/softlib2/software1/pubsw-linux/p834914788/v72405/
    2/2/12

 drivers/net/benet/Makefile     |    6 +-
 drivers/net/benet/be.h         |  390 ++++-
 drivers/net/benet/be_cmds.c    | 2049 ++++++++++++++++++++---
 drivers/net/benet/be_cmds.h    | 1001 ++++++++++--
 drivers/net/benet/be_compat.c  |  630 +++++++
 drivers/net/benet/be_compat.h  |  621 +++++++
 drivers/net/benet/be_ethtool.c |  842 ++++++++--
 drivers/net/benet/be_hw.h      |  351 ++++-
 drivers/net/benet/be_main.c    | 3539 ++++++++++++++++++++++++++++++----------
 drivers/net/benet/be_misc.c    |  106 ++
 drivers/net/benet/be_proc.c    |  513 ++++++
 drivers/net/benet/version.h    |   51 +
 include/linux/skbuff.h         |   16 +
 13 files changed, 8631 insertions(+), 1484 deletions(-)

commit 3d5fb2b1fb3e86f7e74d4c011a8fa6d4596767c0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:45:05 2012 -0400

    Backport LSI 3ware SAS/SATA-RAID driver
    Backport paravirt SCSI driver for VMware's virtual HBA

 MAINTAINERS               |    8 +
 drivers/scsi/3w-sas.c     | 1933 +++++++++++++++++++++++++++++++++++++++++++++
 drivers/scsi/3w-sas.h     |  396 +++++++++
 drivers/scsi/Kconfig      |   19 +
 drivers/scsi/Makefile     |    2 +
 drivers/scsi/vmw_pvscsi.c | 1401 ++++++++++++++++++++++++++++++++
 drivers/scsi/vmw_pvscsi.h |  397 ++++++++++
 include/scsi/scsi_host.h  |    6 +
 8 files changed, 4162 insertions(+), 0 deletions(-)

commit 97184e329c4834f2f260fcbf4bf586de1b2d8fb5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:32:02 2012 -0400

    add colorize plugin

 tools/gcc/colorize_plugin.c |  147 +++++++++++++++++++++++++++++++++++++++++++
 1 files changed, 147 insertions(+), 0 deletions(-)

commit a94359164c627ad70aab734d356b5c41d5ec9baf
Merge: ff3cefb 7a5b5f6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:31:48 2012 -0400

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	fs/exec.c
    	security/Kconfig

commit 7a5b5f6c6975ffa07249855e2afffa7c7f594450
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:29:06 2012 -0400

    Update to pax-linux-2.6.32.58-test147.patch

 Documentation/dontdiff                  |    1 +
 Makefile                                |    4 +-
 arch/arm/include/asm/atomic.h           |  164 ++++++++++++++++++++++++++++++-
 arch/arm/include/asm/cache.h            |    2 +-
 arch/arm/include/asm/system.h           |   11 ++-
 arch/arm/kernel/process.c               |    6 +-
 arch/arm/kernel/setup.c                 |    2 +-
 arch/arm/kernel/vmlinux.lds.S           |    4 +
 arch/arm/lib/copy_page.S                |    1 +
 arch/arm/mm/fault.c                     |   14 +++
 arch/powerpc/kernel/irq.c               |   10 +-
 arch/sparc/include/asm/atomic.h         |    1 -
 arch/sparc/include/asm/atomic_32.h      |    2 +
 arch/x86/kernel/entry_64.S              |    2 +-
 fs/exec.c                               |    2 +-
 include/asm-generic/emergency-restart.h |    2 +-
 include/linux/prefetch.h                |    1 +
 include/linux/sched.h                   |    4 +-
 kernel/exit.c                           |    2 +-
 kernel/module.c                         |    2 +-
 mm/mmap.c                               |   11 ++-
 net/ipv6/xfrm6_tunnel.c                 |    2 +-
 security/Kconfig                        |    2 +-
 tools/gcc/Makefile                      |    2 +
 tools/gcc/stackleak_plugin.c            |    4 +-
 25 files changed, 232 insertions(+), 26 deletions(-)

commit ff3cefbd0ae5ac9ce4c4c71bdc72a0d6ea2eeecb
Merge: 3dbbafe 0f17ad8e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 12 18:05:05 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 0f17ad8e070b85769823443fcd8c6173f29587f1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 21:10:20 2012 -0400

    Fix ARM compilation while waiting for new PaX patch

 arch/arm/include/asm/cacheflush.h |    4 ++--
 arch/arm/include/asm/page.h       |    2 +-
 arch/arm/kernel/setup.c           |    6 +++---
 3 files changed, 6 insertions(+), 6 deletions(-)

commit 3dbbafeb7c01010ce35ad795e2a9cba5b5d57098
Merge: 7b9ded6 505c298
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 21:10:44 2012 -0400

    Merge branch 'pax-stable' into grsec-stable

commit 505c29854744a3ddefa6401ef8a05f2e4e254447
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 21:10:20 2012 -0400

    Fix ARM compilation while waiting for new PaX patch

 arch/arm/include/asm/cacheflush.h |    4 ++--
 arch/arm/include/asm/page.h       |    2 +-
 arch/arm/kernel/setup.c           |    6 +++---
 3 files changed, 6 insertions(+), 6 deletions(-)

commit 7b9ded6de0ab5de306417770283bf16cd701de35
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 12:55:56 2012 -0400

    Use &per_cpu instead of per_cpu_ptr

 include/linux/sched.h |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

commit 6ef65bf93136f0c3d8814bdb5999c920cd974855
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 11:01:33 2012 -0400

    Allow 4096 CPUs

 include/linux/sched.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit fd6dc475c468a04780dfcc4f69d09f0b9fe01c69
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 10:25:58 2012 -0400

    Use a per-cpu 48-bit counter instead of a global atomic64
    Initialize each counter to have the cpu number in the lower 16 bits
    instead of incrementing the counter each time by 1, perform the increments
    above the cpu number so that wrapping/exhausting the counter doesn't corrupt
    any state
    idea from PaX Team
    
    this version can't use this_cpu_add_return, so use something equivalent
    and make it available for fs/compat.c as well

 fs/compat.c           |    8 +-------
 fs/exec.c             |   17 +++++++++++++----
 include/linux/sched.h |   15 +++++++++++++++
 3 files changed, 29 insertions(+), 11 deletions(-)

commit a4d89db00d0cad860f2a19ce5a47f142e636fa03
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 10 20:22:51 2012 -0500

    Special vnsec edition! :)
    Further reduce argv/env allowance for suid/sgid apps to 512KB
    Clamp suid/sgid stack resource limit to 8MB (preventing compat mmap layout fallback/too large stack gap)
    Clear 3GB personality on suid/sgid binaries
    Restore 4 bits entropy in the lowest bits of arg/env strings (now 28 bits on x86, 39 bits on x64)
      with the main purpose of throwing off program stack -> arg/env alignment
    Update documentation

 fs/compat.c                 |   57 +++++++++++++++++++++-----------------
 fs/exec.c                   |   64 ++++++++++++++++++++++++-------------------
 grsecurity/Kconfig          |   15 ++++++----
 include/linux/personality.h |    1 +
 4 files changed, 78 insertions(+), 59 deletions(-)

commit e446f370b76e2eaa7cfbba40f8c3d63905d030a0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 10 20:09:55 2012 -0500

    Resolve skbuff.h warnings that turn into errors during compilation in
    the grsecurity directory with -Werror

 arch/alpha/include/asm/cache.h                     |    5 +++--
 arch/arm/include/asm/cache.h                       |    4 +++-
 arch/avr32/include/asm/cache.h                     |    4 +++-
 arch/blackfin/include/asm/cache.h                  |    4 +++-
 arch/cris/include/arch-v10/arch/cache.h            |    3 ++-
 arch/cris/include/arch-v32/arch/cache.h            |    3 ++-
 arch/frv/include/asm/cache.h                       |    3 ++-
 arch/h8300/include/asm/cache.h                     |    4 +++-
 arch/ia64/include/asm/cache.h                      |    3 ++-
 arch/m32r/include/asm/cache.h                      |    4 +++-
 arch/m68k/include/asm/cache.h                      |    4 +++-
 arch/microblaze/include/asm/cache.h                |    3 ++-
 arch/mips/include/asm/cache.h                      |    3 ++-
 arch/mn10300/proc-mn103e010/include/proc/cache.h   |    4 +++-
 arch/parisc/include/asm/cache.h                    |    5 +++--
 arch/powerpc/include/asm/cache.h                   |    3 ++-
 arch/s390/include/asm/cache.h                      |    4 +++-
 arch/score/include/asm/cache.h                     |    4 +++-
 arch/sh/include/asm/cache.h                        |    3 ++-
 arch/sparc/include/asm/cache.h                     |    4 +++-
 arch/um/include/asm/cache.h                        |    3 ++-
 arch/xtensa/variants/dc232b/include/variant/core.h |    2 +-
 arch/xtensa/variants/fsf/include/variant/core.h    |    3 ++-
 arch/xtensa/variants/s6000/include/variant/core.h  |    3 ++-
 24 files changed, 59 insertions(+), 26 deletions(-)

commit e24b1e34543c3e76e6b03383e6f6ead00a9a8bcd
Author: Mikulas Patocka <mpatocka@redhat.com>
Date:   Sun Mar 4 19:52:03 2012 -0500

    mm: fix find_vma_prev
    
    Commit 6bd4837de96e ("mm: simplify find_vma_prev()") broke memory
    management on PA-RISC.
    
    After application of the patch, programs that allocate big arrays on the
    stack crash with segfault, for example, this will crash if compiled
    without optimization:
    
      int main()
      {
    	char array[200000];
    	array[199999] = 0;
    	return 0;
      }
    
    The reason is that PA-RISC has up-growing stack and the stack is usually
    the last memory area.  In the above example, a page fault happens above
    the stack.
    
    Previously, if we passed too high address to find_vma_prev, it returned
    NULL and stored the last VMA in *pprev.  After "simplify find_vma_prev"
    change, it stores NULL in *pprev.  Consequently, the stack area is not
    found and it is not expanded, as it used to be before the change.
    
    This patch restores the old behavior and makes it return the last VMA in
    *pprev if the requested address is higher than address of any other VMA.
    
    Signed-off-by: Mikulas Patocka <mpatocka@redhat.com>
    Acked-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/mmap.c |   12 ++++++++++--
 1 files changed, 10 insertions(+), 2 deletions(-)

commit cc92173df9e39be74bef7c8577e750d16d272f68
Author: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
Date:   Wed Feb 15 11:32:31 2012 -0700

    eCryptfs: Remove mmap from directory operations
    
    BugLink: http://bugs.launchpad.net/bugs/948139
    
    backported from 38e3eaeedcac75360af8a92e7b66956ec4f334e5
    
    Adrian reported that mkfontscale didn't work inside of eCryptfs mounts.
    Strace revealed the following:
    
    open("./", O_RDONLY|O_NONBLOCK|O_LARGEFILE|O_DIRECTORY|O_CLOEXEC) = 3
    fcntl64(3, F_GETFD) = 0x1 (flags FD_CLOEXEC)
    open("./fonts.scale", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 4
    getdents(3, /* 80 entries */, 32768) = 2304
    open("./.", O_RDONLY) = 5
    fcntl64(5, F_SETFD, FD_CLOEXEC) = 0
    fstat64(5, {st_mode=S_IFDIR|0755, st_size=16384, ...}) = 0
    mmap2(NULL, 16384, PROT_READ, MAP_PRIVATE, 5, 0) = 0xb7fcf000
    close(5) = 0
     --- SIGBUS (Bus error) @ 0 (0) ---
     +++ killed by SIGBUS +++
    
    The mmap2() on a directory was successful, resulting in a SIGBUS
    signal later.  This patch removes mmap() from the list of possible
    ecryptfs_dir_fops so that mmap() isn't possible on eCryptfs directory
    files.
    
    http://bugs.launchpad.net/bugs/400443
    
    Reported-by: Adrian C. <anrxc@sysphere.org>
    Signed-off-by: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Stefan Bader <stefan.bader@canonical.com>

 fs/ecryptfs/file.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

commit 7bb67e19f42d4926f1cd1b4edef4eddb32d83fbf
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Mon Mar 5 06:39:47 2012 +0000

    VM_GROWS{UP,DOWN} shouldn't be set on shmem VMAs
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/mmap.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit c99d92183b7f426ca00c844642bea2a948b2e6ea
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Mon Mar 5 06:38:42 2012 +0000

    aout: move setup_arg_pages() prior to reading/mapping the binary
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 arch/x86/ia32/ia32_aout.c |   14 +++++++-------
 fs/binfmt_aout.c          |   14 +++++++-------
 2 files changed, 14 insertions(+), 14 deletions(-)

commit 940612508a948143c7f7c3032f7ca08933d3f9ba
Author: Hugh Dickins <hughd@google.com>
Date:   Tue Mar 6 12:28:52 2012 -0800

    mmap: EINVAL not ENOMEM when rejecting VM_GROWS
    
    Currently error is -ENOMEM when rejecting VM_GROWSDOWN|VM_GROWSUP
    from shared anonymous: hoist the file case's -EINVAL up for both.
    
    Signed-off-by: Hugh Dickins <hughd@google.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/mmap.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 72238082f7e7200a0f153f82f75e4b1ed365a8e7
Author: H. Peter Anvin <hpa@zytor.com>
Date:   Fri Mar 2 10:43:48 2012 -0800

    regset: Prevent null pointer reference on readonly regsets
    
    The regset common infrastructure assumed that regsets would always
    have .get and .set methods, but not necessarily .active methods.
    Unfortunately people have since written regsets without .set methods.
    
    Rather than putting in stub functions everywhere, handle regsets with
    null .get or .set methods explicitly.
    
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>
    Reviewed-by: Oleg Nesterov <oleg@redhat.com>
    Acked-by: Roland McGrath <roland@hack.frob.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/binfmt_elf.c        |    2 +-
 include/linux/regset.h |    6 ++++++
 2 files changed, 7 insertions(+), 1 deletions(-)

commit 58b17f2a661e8a4abb8a6f007f4fced154588a85
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 18:12:57 2012 -0500

    Fix compiler errors reported on forums

 grsecurity/gracl.c |    5 ++---
 1 files changed, 2 insertions(+), 3 deletions(-)

commit 8c85de5598be91cc05b97c35a84bc24c1e127b36
Merge: 56ce5ec 0e7c630
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 17:39:40 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 0e7c6300c63fe7073cf93f733a3c8b56a283a6b8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 17:39:04 2012 -0500

    Update to pax-linux-2.6.32.58-test144.patch

 tools/gcc/Makefile |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 56ce5ec6a493d17a1038767acf82e2909e1267b1
Merge: edae9fb e6b850a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 17:27:37 2012 -0500

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	fs/ecryptfs/main.c

commit e6b850a5c44840d7a7c3c22d11c00d98dc73e2a6
Merge: 94055dc 51c9aee
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 17:26:54 2012 -0500

    Merge branch 'linux-2.6.32.y' into pax-stable

commit edae9fb9d3092430980868b6ebcc51794c0dff79
Author: Louis Rilling <louis.rilling@kerlabs.com>
Date:   Thu Mar 1 14:45:42 2012 +0000

    block: Fix io_context leak after clone with CLONE_IO
    
    With CLONE_IO, copy_io() increments both ioc->refcount and ioc->nr_tasks.
    However exit_io_context() only decrements ioc->refcount if ioc->nr_tasks
    reaches 0.
    
    Always call put_io_context() in exit_io_context().
    
    Signed-off-by: Louis Rilling <louis.rilling@kerlabs.com>
    Signed-off-by: Jens Axboe <jens.axboe@oracle.com>
    
    (cherry picked from commit 61cc74fbb87af6aa551a06a370590c9bc07e29d9)
    CVE-2012-0879
    BugLink: http://bugs.launchpad.net/bugs/940743
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Acked-by: Herton Krzesinski <herton.krzesinski@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

 block/blk-ioc.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 4e88917a4fc4daaf99492af8c6c811a83c016cab
Author: Louis Rilling <louis.rilling@kerlabs.com>
Date:   Thu Mar 1 14:45:43 2012 +0000

    block: Fix io_context leak after failure of clone with CLONE_IO
    
    With CLONE_IO, parent's io_context->nr_tasks is incremented, but never
    decremented whenever copy_process() fails afterwards, which prevents
    exit_io_context() from calling IO schedulers exit functions.
    
    Give a task_struct to exit_io_context(), and call exit_io_context() instead of
    put_io_context() in copy_process() cleanup path.
    
    Signed-off-by: Louis Rilling <louis.rilling@kerlabs.com>
    Signed-off-by: Jens Axboe <jens.axboe@oracle.com>
    
    (cherry picked from commit b69f2292063d2caf37ca9aec7d63ded203701bf3)
    CVE-2012-0879
    BugLink: http://bugs.launchpad.net/bugs/940743
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Acked-by: Herton Krzesinski <herton.krzesinski@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

 block/blk-ioc.c           |   10 +++++-----
 include/linux/iocontext.h |    5 +++--
 kernel/exit.c             |    2 +-
 kernel/fork.c             |    3 ++-
 4 files changed, 11 insertions(+), 9 deletions(-)

commit 47b6a32c17f13f1266c9e1e894e2663e6b3d5bf1
Author: Tim Gardner <tim.gardner@canonical.com>
Date:   Thu Mar 1 16:52:42 2012 +0000

    eCryptfs: Handle failed metadata read in lookup
    
    When failing to read the lower file's crypto metadata during a lookup,
    eCryptfs must continue on without throwing an error. For example, there
    may be a plaintext file in the lower mount point that the user wants to
    delete through the eCryptfs mount.
    
    If an error is encountered while reading the metadata in lookup(), the
    eCryptfs inode's size could be incorrect. We must be sure to reread the
    plaintext inode size from the metadata when performing an open() or
    setattr(). The metadata is already being read in those paths, so this
    adds minimal performance overhead.
    
    This patch introduces a flag which will track whether or not the
    plaintext inode size has been read so that an incorrect i_size can be
    fixed in the open() or setattr() paths.
    
    BugLink: http://bugs.launchpad.net/bugs/509180
    
    Cc: <stable@kernel.org>
    Signed-off-by: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
    
    (backported from 3aeb86ea4cd15f728147a3bd5469a205ada8c767)
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>
    Acked-by: Leann Ogasawara <leann.ogasawara@canonical.com>
    Acked-by: Stefan Bader <stefan.bader@canonical.com>
    Acked-by: Brad Figg <brad.figg@canonical.com>
    Acked-by: Herton Krzesinski <herton.krzesinski@canonical.com>

 fs/ecryptfs/crypto.c          |   21 +++++++++++++++++++++
 fs/ecryptfs/ecryptfs_kernel.h |    2 ++
 fs/ecryptfs/file.c            |    3 ++-
 fs/ecryptfs/inode.c           |   18 +++---------------
 4 files changed, 28 insertions(+), 16 deletions(-)

commit 2ee4a1b8c427d8719b45d87fd66956d2ee080a26
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 2 21:32:37 2012 -0500

    Fix memory leak on logged exec_id check failure in /proc/pid/statm
    Thanks to Djalal Harouni for the report

 fs/proc/array.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 5533e59b7d5efb37d7bbfd45bb1fa7dd27c54e2e
Merge: 8066abf 94055dc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 2 18:45:53 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 94055dc1526191f46a6ba2c8efe38f451ddc1546
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 2 18:45:28 2012 -0500

    Backport changes between test18 and test19 of PaX's 3.2.9 patch

 fs/binfmt_elf.c              |    2 +-
 tools/gcc/stackleak_plugin.c |   59 ++++++++++++++++++++++++++++++++----------
 2 files changed, 46 insertions(+), 15 deletions(-)

commit 8066abf18c2136a09903753de821e8a96ad69544
Author: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
Date:   Fri Apr 29 16:26:27 2011 -0500

    eCryptfs: Clear i_nlink in rmdir
    
    BugLink: http://bugs.launchpad.net/bugs/723518
    
    eCryptfs wasn't clearing the eCryptfs inode's i_nlink after a successful
    vfs_rmdir() on the lower directory. This resulted in the inode evict and
    destroy paths to be missed.
    
    https://bugs.launchpad.net/ecryptfs/+bug/723518
    
    Signed-off-by: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
    Cc: <stable@kernel.org>
    (cherry picked from commit 07850552b92b3637fa56767b5e460b4238014447)
    Signed-off-by: Colin King <colin.king@canonical.com>
    Acked-by: Herton Krzesinski <herton.krzesinski@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

 fs/ecryptfs/inode.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 8af3b1dc00f0eab6829b55306c7daddd8bcbe3cd
Author: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
Date:   Tue Apr 12 11:21:36 2011 -0500

    eCryptfs: Remove extra d_delete in ecryptfs_rmdir
    
    BugLink: http://bugs.launchpad.net/bugs/723518
    
    vfs_rmdir() already calls d_delete() on the lower dentry. That was being
    duplicated in ecryptfs_rmdir() and caused a NULL pointer dereference
    when NFSv3 was the lower filesystem.
    
    Signed-off-by: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
    (cherry picked from commit 35ffa948b2f7bdf79e488cd496232935d095087a)
    Signed-off-by: Colin King <colin.king@canonical.com>
    Acked-by: Herton Krzesinski <herton.krzesinski@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

 fs/ecryptfs/inode.c |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

commit d793be93356a915a3e22ae3c08c759b47c3d0489
Author: Andy Whitcroft <apw@canonical.com>
Date:   Thu Feb 16 17:11:07 2012 +0000

    ecryptfs: read on a directory should return EISDIR if not supported
    
    read() calls against a file descriptor connected to a directory are
    incorrectly returning EINVAL rather than EISDIR:
    
      [EISDIR]
        [XSI] [Option Start] The fildes argument refers to a directory and the
        implementation does not allow the directory to be read using read()
        or pread(). The readdir() function should be used instead. [Option End]
    
    This occurs because we do not have a .read operation defined for
    ecryptfs directories.  Connect this up to generic_read_dir().
    
    BugLink: http://bugs.launchpad.net/bugs/719691
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Signed-off-by: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
    (cherry picked from commit 323ef68faf1bbd9b1e66aea268fd09d358d7e8ab)
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Acked-by: Brad Figg <brad.figg@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

 fs/ecryptfs/file.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 44cb4148342d7b83fc4625178f9923ff90b36cd6
Author: Colin Ian King <colin.king@canonical.com>
Date:   Thu Feb 16 14:38:26 2012 +0000

    eCryptfs: Use notify_change for truncating lower inodes
    
    When truncating inodes in the lower filesystem, eCryptfs directly
    invoked vmtruncate(). As Christoph Hellwig pointed out, vmtruncate() is
    a filesystem helper function, but filesystems may need to do more than
    just a call to vmtruncate().
    
    This patch moves the lower inode truncation out of ecryptfs_truncate()
    and renames the function to truncate_upper().  truncate_upper() updates
    an iattr for the lower inode to indicate if the lower inode needs to be
    truncated upon return.  ecryptfs_setattr() then calls notify_change(),
    using the updated iattr for the lower inode, to complete the truncation.
    
    For eCryptfs functions needing to truncate, ecryptfs_truncate() is
    reintroduced as a simple way to truncate the upper inode to a specified
    size and then truncate the lower inode accordingly.
    
    Reported-by: Christoph Hellwig <hch@lst.de>
    Acked-by: Dustin Kirkland <kirkland@canonical.com>
    Cc: ecryptfs-devel@lists.launchpad.net
    Cc: linux-fsdevel@vger.kernel.org
    Signed-off-by: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
    
    backported from 5f3ef64f4da1c587cdcfaaac72311225b7df094c
    BugLink: http://bugs.launchpad.net/bugs/451368
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

 fs/ecryptfs/inode.c |   99 ++++++++++++++++++++++++++++++++++----------------
 1 files changed, 67 insertions(+), 32 deletions(-)

commit 232bff5a9ee62ca1c6e36c6859db98b33ed4c96b
Author: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
Date:   Wed Feb 15 17:24:29 2012 +0000

    eCryptfs: Remove mmap from directory operations
    
    BugLink: http://bugs.launchpad.net/bugs/400443
    
    Adrian reported that mkfontscale didn't work inside of eCryptfs mounts.
    Strace revealed the following:
    
    open("./", O_RDONLY|O_NONBLOCK|O_LARGEFILE|O_DIRECTORY|O_CLOEXEC) = 3
    fcntl64(3, F_GETFD) = 0x1 (flags FD_CLOEXEC)
    open("./fonts.scale", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 4
    getdents(3, /* 80 entries */, 32768) = 2304
    open("./.", O_RDONLY) = 5
    fcntl64(5, F_SETFD, FD_CLOEXEC) = 0
    fstat64(5, {st_mode=S_IFDIR|0755, st_size=16384, ...}) = 0
    mmap2(NULL, 16384, PROT_READ, MAP_PRIVATE, 5, 0) = 0xb7fcf000
    close(5) = 0
     --- SIGBUS (Bus error) @ 0 (0) ---
     +++ killed by SIGBUS +++
    
    The mmap2() on a directory was successful, resulting in a SIGBUS
    signal later.  This patch removes mmap() from the list of possible
    ecryptfs_dir_fops so that mmap() isn't possible on eCryptfs directory
    files.
    
    Reported-by: Adrian C. <anrxc@sysphere.org>
    Signed-off-by: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
    
    backported from 38e3eaeedcac75360af8a92e7b66956ec4f334e5
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Acked-by: Herton Krzesinski <herton.krzesinski@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

 fs/ecryptfs/file.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

commit ff8a6e59c4a382c790b01bac257a8ae4acd102c5
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Wed Feb 15 19:04:44 2012 +0000

    Ban ecryptfs over ecryptfs
    
    BugLink: http://bugs.launchpad.net/bugs/932987
    
    This is a seriously simplified patch from Eric Sandeen; copy of
    rationale follows:
    ===
      mounting stacked ecryptfs on ecryptfs has been shown to lead to bugs
      in testing.  For crypto info in xattr, there is no mechanism for handling
      this at all, and for normal file headers, we run into other trouble:
    
      BUG: unable to handle kernel NULL pointer dereference at 0000000000000008
      IP: [<ffffffffa015b0b3>] ecryptfs_d_revalidate+0x43/0xa0 [ecryptfs]
      ...
    
      There doesn't seem to be any good usecase for this, so I'd suggest just
      disallowing the configuration.
    
      Based on a patch originally, I believe, from Mike Halcrow.
    ===
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    
    Backported from 4403158ba295c8e36f6736b1bb12d0f7e1923dac
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Acked-by: Brad Figg <brad.figg@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>
    
    Conflicts:
    
    	fs/ecryptfs/main.c

 fs/ecryptfs/main.c |   18 ++++++++++++++++++
 1 files changed, 18 insertions(+), 0 deletions(-)

commit 6302d10b308a35e5cfcbc432fe09ef4f37e3bf26
Author: Alex Williamson <alex.williamson@redhat.com>
Date:   Tue Feb 28 15:11:50 2012 +0000

    KVM: Device assignment permission checks
    
    Only allow KVM device assignment to attach to devices which:
    
     - Are not bridges
     - Have BAR resources (assume others are special devices)
     - The user has permissions to use
    
    Assigning a bridge is a configuration error, it's not supported, and
    typically doesn't result in the behavior the user is expecting anyway.
    Devices without BAR resources are typically chipset components that
    also don't have host drivers.  We don't want users to hold such devices
    captive or cause system problems by fencing them off into an iommu
    domain.  We determine "permission to use" by testing whether the user
    has access to the PCI sysfs resource files.  By default a normal user
    will not have access to these files, so it provides a good indication
    that an administration agent has granted the user access to the device.
    
    [Yang Bai: add missing #include]
    [avi: fix comment style]
    
    Signed-off-by: Alex Williamson <alex.williamson@redhat.com>
    Signed-off-by: Yang Bai <hamo.by@gmail.com>
    Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
    
    (backported from commit 3d27e23b17010c668db311140b17bbbb70c78fb9)
    CVE-2011-4347
    BugLink: http://bugs.launchpad.net/bugs/897812
    Signed-off-by: Andy Whitcroft <apw@canonical.com>
    Acked-by: Seth Forshee <seth.forshee@canonical.com>
    Signed-off-by: Tim Gardner <tim.gardner@canonical.com>

 virt/kvm/kvm_main.c |   75 +++++++++++++++++++++++++++++++++++++++++++++++++++
 1 files changed, 75 insertions(+), 0 deletions(-)

commit 5cd8df5408bb9ad0c23275f1c5e6902b9c08b719
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Mon Feb 6 10:20:45 2012 +0100

    cdrom: use copy_to_user() without the underscores
    
    commit 822bfa51ce44f2c63c300fdb76dc99c4d5a5ca9f upstream.
    
    "nframes" comes from the user and "nframes * CD_FRAMESIZE_RAW" can wrap
    on 32 bit systems.  That would have been ok if we used the same wrapped
    value for the copy, but we use a shifted value.  We should just use the
    checked version of copy_to_user() because it's not going to make a
    difference to the speed.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

 drivers/cdrom/cdrom.c |    8 +-------
 1 files changed, 1 insertions(+), 7 deletions(-)

commit dfc3f612d7153a84ef5a40c911a76249fe4dcc1b
Merge: f845dcb 16b89f5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 27 18:01:31 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 16b89f5e68e3f8f3959993550273f2bca227ed23
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 27 18:01:10 2012 -0500

    Update to pax-linux-2.6.32.57-test144.patch

 fs/binfmt_elf.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit f845dcb84c463d24921caec3bae4d132f811219a
Merge: 6366f6b 0710984
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 26 19:02:15 2012 -0500

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	Makefile

commit 0710984acba53f724c827e911143a6f5b93f69d0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 26 19:00:14 2012 -0500

    Update to pax-linux-2.6.32.57-test143.patch

 Makefile |   41 +++++++++++++++++++++++++----------------
 1 files changed, 25 insertions(+), 16 deletions(-)

commit 6366f6b96bbcca8a4eec30df82e80e826f236a6a
Merge: 51d415f 0887c0f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 21:00:23 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 0887c0f374c2d63e3a29cbb4e7cee9d001715d4a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 21:00:07 2012 -0500

    Update to pax-linux-2.6.32.57-test142.patch

 Makefile                               |    2 +-
 arch/x86/include/asm/alternative-asm.h |    2 +-
 arch/x86/kernel/kprobes.c              |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

commit 51d415fe7097dd531b100bf03986697eba33ffea
Merge: 96dedf7 2adbcc9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 11:45:08 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 2adbcc9e95f6c599d4dad6074684d8184e64e369
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 11:44:52 2012 -0500

    Update to pax-linux-2.6.32.57-test141.patch

 tools/gcc/Makefile |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 96dedf78c119203301717c492a4ff7081d56f82e
Merge: 2badf5f 6569e27
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 11:31:01 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 6569e2706c1af193ab5ca9bcedc4d63096c61f6e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 11:30:19 2012 -0500

    Update to pax-linux-2.6.32.57-test140.patch

 arch/alpha/include/asm/atomic.h  |   18 +++---
 arch/frv/include/asm/atomic.h    |   18 +++---
 arch/ia64/include/asm/atomic.h   |   18 +++---
 arch/mips/include/asm/atomic.h   |   18 +++---
 arch/parisc/include/asm/atomic.h |   18 +++---
 arch/s390/include/asm/atomic.h   |   18 +++---
 kernel/panic.c                   |    6 ++-
 mm/mmap.c                        |   36 +++----------
 tools/gcc/kernexec_plugin.c      |  101 +++++++++++++++++++++++++++++++++----
 tools/gcc/stackleak_plugin.c     |   20 +++++---
 10 files changed, 169 insertions(+), 102 deletions(-)

commit 2badf5f689a95cd9c848cc0e20ec332806bc83f9
Merge: ecfd2fc b0ceb91
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 10:27:36 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit b0ceb9136408df01d1b089b46fb4b7fcfd804789
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 10:27:06 2012 -0500

    Remove unnecessary cast

 drivers/char/mmtimer.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 85d7293e3e04acd748ea198494e7a826b707e6d1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 10:25:15 2012 -0500

    remove struct

 drivers/char/mmtimer.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit bc5525670ee949b18963ee6e1cd144aba89f22a5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 10:21:24 2012 -0500

    Make k_clock const again, just not in drivers/char/mmtimer.c

 drivers/char/mmtimer.c       |    4 ++--
 include/linux/posix-timers.h |    4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

commit ecfd2fc93d53f6f1aa5137a49279df7588312d6f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 08:47:21 2012 -0500

    Log bad /proc/pid/mem

 fs/proc/base.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

commit cf7084bf186ef481031dadf7f4ff02144d79e0be
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 08:20:36 2012 -0500

    Make use of f_version for protecting /proc file structs (fine since we're
    not a directory or seq_file)

 fs/proc/base.c |   16 ++++++++++------
 1 files changed, 10 insertions(+), 6 deletions(-)

commit 027197da5341edc50f7bbabe97a4447a219d8cbf
Merge: c1bdefc 72e25f26
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:50:17 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 72e25f260d57e3bd8c67688cab977aa3dec2d903
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:48:37 2012 -0500

    Fix ia64 compilation

 include/linux/posix-timers.h |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit c1bdefc87f87db7b93985c265c14ec0d7eb86d0e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:49:20 2012 -0500

    Revert "Fix ia64 compilation"
    Applying against pax-stable
    
    This reverts commit aa184fac628a89bd890efcabd64d2946e8946fdf.

 include/linux/posix-timers.h |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

commit aa184fac628a89bd890efcabd64d2946e8946fdf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:48:37 2012 -0500

    Fix ia64 compilation

 include/linux/posix-timers.h |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 6cd9aca0d14fa3e41b0c121df40397b2aff57617
Merge: 1be044e a7acbbc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:34:14 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit a7acbbcf7bfa053246ba0b1a4b654510f3bbe938
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:33:59 2012 -0500

    Fix sparc32 compilation

 arch/sparc/Kconfig               |    1 +
 arch/sparc/include/asm/atomic.h  |    1 +
 arch/sparc/include/asm/page_32.h |    2 ++
 3 files changed, 4 insertions(+), 0 deletions(-)

commit 1be044e8b0966e9dc2b93280b0ec05c0397be05f
Merge: b4a64cf 687a6ef
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:00:10 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 687a6ef1884ffd20ba64242cb55f52073dcdc3ab
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 18:59:01 2012 -0500

    (6:57:09 PM) pipacs: but you can be proactive
    (Fix other-arch atomic64/REFCOUNT compilation failures)

 arch/alpha/include/asm/atomic.h  |   10 ++++++++++
 arch/arm/Kconfig                 |    1 +
 arch/arm/include/asm/atomic.h    |    4 ++++
 arch/frv/include/asm/atomic.h    |   10 ++++++++++
 arch/ia64/include/asm/atomic.h   |   10 ++++++++++
 arch/mips/Kconfig                |    1 +
 arch/mips/include/asm/atomic.h   |   14 ++++++++++++++
 arch/parisc/include/asm/atomic.h |   10 ++++++++++
 arch/s390/include/asm/atomic.h   |   10 ++++++++++
 9 files changed, 70 insertions(+), 0 deletions(-)

commit b4a64cfcaec8886bd2907432381138c976fdf7eb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 21:10:12 2012 -0500

    Remove unnecessary copies, as suggested by solar

 grsecurity/gracl.c |   11 ++++++-----
 kernel/fork.c      |    4 ----
 2 files changed, 6 insertions(+), 9 deletions(-)

commit 22c9688e666aa07a15b41d28546ea870e8f93d0d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 20:48:35 2012 -0500

    Add recent PROC_MEMMAP enhancement to the compat version of execve() as pointed
    out by solar, forgot to add it in the backport

 fs/compat.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

commit 35af929b33c6610b261af7209a0eb78157da5122
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 19:03:49 2012 -0500

    Compilation fix

 fs/open.c |    7 ++-----
 1 files changed, 2 insertions(+), 5 deletions(-)

commit c43325b61c201f45446033ca3cf2253e5cf6c662
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 18:58:45 2012 -0500

    Sync up with test patch

 fs/open.c                   |    2 +-
 grsecurity/gracl_fs.c       |   27 ++++-----------------------
 grsecurity/grsec_disabled.c |   11 ++---------
 include/linux/grmsg.h       |    1 -
 include/linux/grsecurity.h  |    6 ++----
 5 files changed, 9 insertions(+), 38 deletions(-)

commit cb9a6d664e3a3fcd9f3df3b310f81c7748b95173
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Tue Jul 26 04:15:54 2011 -0400

    merge fchmod() and fchmodat() guts, kill ancient broken kludge
    
    The kludge in question is undocumented and doesn't work for 32bit
    binaries on amd64, sparc64 and s390.  Passing (mode_t)-1 as
    mode had (since 0.99.14v and contrary to behaviour of any
    other Unix, prescriptions of POSIX, SuS and our own manpages)
    was kinda-sorta no-op.  Note that any software relying on
    that (and looking for examples shows none) would be visibly
    broken on sparc64, where practically all userland is built
    32bit.  No such complaints noticed...
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    
    Conflicts:
    
    	fs/open.c

 fs/open.c |   96 +++++++++++++++++++------------------------------------------
 1 files changed, 30 insertions(+), 66 deletions(-)

commit 465a092931637e4a520c2d2d755189802bf74691
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 18:18:49 2012 -0500

    Apply umask checks to chmod/fchmod as well, as requested by sponsor
    While 3.2 uses combined code for chmod/fchmod, in this kernel we need to hook
    separate functions
    Union the enforced umask with the existing one to produce minimal privilege
    Change umask type to u16
    
    Conflicts:
    
    	fs/open.c

 fs/fs_struct.c              |    2 +-
 fs/open.c                   |    6 +++---
 grsecurity/gracl_fs.c       |   20 ++++++++++++++++----
 grsecurity/grsec_disabled.c |    6 +++---
 include/linux/gracl.h       |    3 ++-
 include/linux/grsecurity.h  |    4 ++--
 6 files changed, 27 insertions(+), 14 deletions(-)

commit e3117d775f65b8c3dc191cd26b3b1c6690e45f11
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Feb 22 18:16:11 2012 -0500

    Add per-role umask enforcement to RBAC, requested by a sponsor

 fs/fs_struct.c              |    2 +-
 grsecurity/gracl_fs.c       |    9 +++++++++
 grsecurity/grsec_disabled.c |    5 +++++
 include/linux/gracl.h       |    5 +++--
 include/linux/grsecurity.h  |    2 ++
 5 files changed, 20 insertions(+), 3 deletions(-)

commit 12430db3e1c839f4681e620484b620dc743911af
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 09:17:57 2012 -0500

    Fix wrong logic on capability checks for switching roles, broke policies
    Thanks to Richard Kojedzinszky for reporting

 grsecurity/gracl.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit cf6b5c8ed1989daca1c66faf118f17bfdd5d93e9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 21:20:10 2012 -0500

    sparc64 compile fix

 fs/seq_file.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit fec67d63c16452e7a59f5952972e49d883391ab1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 18:38:32 2012 -0500

    Update configuration help and name for GRKERNSEC_PROC_MEMMAP

 grsecurity/Kconfig |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

commit c5ac1c8fdb233ee524d8449c31cb73abacfd3162
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 18:18:01 2012 -0500

    optimize the check a bit

 fs/exec.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 494cb302690cba6daf117583e405645dd40c5364
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 18:00:45 2012 -0500

    smile VUPEN :D
    (limit argv+env to 1MB for suid/sgid binaries)

 fs/exec.c |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)

commit f44d1be39ce6336f8270bff0040babf09c040ef7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 17:49:33 2012 -0500

    Address Space Protection -> Memory Protections (suggested on IRC for consistency)

 grsecurity/Kconfig |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 11749696a05a2a4090d036d8c51a99acdea4a0d5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 17:45:06 2012 -0500

    Change the long long type for exec_id to the proper u64

 include/linux/sched.h    |    2 +-
 include/linux/seq_file.h |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

commit f423e3922b874dd3b4dee42f82cd5035885162cf
Merge: 7f161ae 49c118c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 13 18:36:19 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 49c118ccb5bfb7a1e30a269383add009710519af
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 13 18:35:43 2012 -0500

    Merge changes from pax-linux-2.6.32.57-test138.patch

 arch/s390/include/asm/elf.h |    4 ++--
 arch/x86/kernel/entry_64.S  |    2 +-
 arch/x86/mm/fault.c         |    4 ++--
 arch/x86/mm/init.c          |    2 +-
 arch/x86/mm/pageattr.c      |    2 +-
 arch/x86/mm/pgtable.c       |    4 ++--
 arch/x86/pci/pcbios.c       |    2 +-
 fs/binfmt_elf.c             |    3 +++
 init/main.c                 |    2 +-
 mm/slob.c                   |    2 +-
 10 files changed, 15 insertions(+), 12 deletions(-)

commit 7f161ae4afd5181e047a7c4017589e124de777cc
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Feb 9 00:46:47 2012 +0000

    isdn: type bug in isdn_net_header()
    
    We use len to store the return value from eth_header().  eth_header()
    can return -ETH_HLEN (-14).  We want to pass this back instead of
    truncating it to 65522 and returning that.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Neil Horman <nhorman@tuxdriver.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/isdn/i4l/isdn_net.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 40cfbc3bbc8cce9e012051cfc5e559a63e1a44b2
Author: Heiko Carstens <heiko.carstens@de.ibm.com>
Date:   Sat Feb 4 10:47:10 2012 +0100

    exec: fix use-after-free bug in setup_new_exec()
    
    Setting the task name is done within setup_new_exec() by accessing
    bprm->filename. However this happens after flush_old_exec().
    This may result in a use after free bug, flush_old_exec() may
    "complete" vfork_done, which will wake up the parent which in turn
    may free the passed in filename.
    To fix this add a new tcomm field in struct linux_binprm which
    contains the now early generated task name until it is used.
    
    Fixes this bug on s390:
    
      Unable to handle kernel pointer dereference at virtual kernel address 0000000039768000
      Process kworker/u:3 (pid: 245, task: 000000003a3dc840, ksp: 0000000039453818)
      Krnl PSW : 0704000180000000 0000000000282e94 (setup_new_exec+0xa0/0x374)
      Call Trace:
      ([<0000000000282e2c>] setup_new_exec+0x38/0x374)
       [<00000000002dd12e>] load_elf_binary+0x402/0x1bf4
       [<0000000000280a42>] search_binary_handler+0x38e/0x5bc
       [<0000000000282b6c>] do_execve_common+0x410/0x514
       [<0000000000282cb6>] do_execve+0x46/0x58
       [<00000000005bce58>] kernel_execve+0x28/0x70
       [<000000000014ba2e>] ____call_usermodehelper+0x102/0x140
       [<00000000005bc8da>] kernel_thread_starter+0x6/0xc
       [<00000000005bc8d4>] kernel_thread_starter+0x0/0xc
      Last Breaking-Event-Address:
       [<00000000002830f0>] setup_new_exec+0x2fc/0x374
    
      Kernel panic - not syncing: Fatal exception: panic_on_oops
    
    Reported-by: Sebastian Ott <sebott@linux.vnet.ibm.com>
    Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/exec.c

 fs/exec.c               |   33 +++++++++++++++++----------------
 include/linux/binfmts.h |    3 ++-
 2 files changed, 19 insertions(+), 17 deletions(-)

commit 903969f2221ca14e607222d40eebcac38266e9b7
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Feb 10 09:03:58 2012 +0100

    relay: prevent integer overflow in relay_open()
    
    "subbuf_size" and "n_subbufs" come from the user and they need to be
    capped to prevent an integer overflow.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable@kernel.org
    Signed-off-by: Jens Axboe <axboe@kernel.dk>

 kernel/relay.c |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

commit 774c978af6eab02f5a709e51f73e781da69534cd
Merge: b2ee77f 5d82c3c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 13 17:48:52 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 5d82c3c5f9b43acbbaba0d16c2516576ee4d7600
Merge: 57cfeff 1897bf2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 13 17:48:38 2012 -0500

    Merge branch 'linux-2.6.32.y' into pax-stable

commit b2ee77fc6532f280d2433217e8b622e190e18846
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 12 16:44:05 2012 -0500

    add missing declaration

 grsecurity/gracl.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 0f738167bd3f923451ac526f6eaed86f6b27e504
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 12 16:36:04 2012 -0500

    Require CAP_SETUID/CAP_SETGID in a subject in order to change roles
    in addition to existing checks (this handles the setresuid ruid = euid case)

 grsecurity/gracl.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

commit 804a37c4c42603c021cd8e787407731aceeab448
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 12 16:16:53 2012 -0500

    Revert setreuid changes when RBAC is enabled
    I'l fix the learning issue Lavish reported in a different way
    through gradm modifications
    
    This reverts commit 2f47176536bac553b98cacd27a9e482fe04247cf.

 kernel/sys.c |   30 ++++++------------------------
 1 files changed, 6 insertions(+), 24 deletions(-)

commit e991bb5002d3bd996d9c07c24878c2a0f247e143
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 11 14:22:46 2012 -0500

    copy exec_id on fork

 kernel/fork.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

commit 67178f5c1ccb61ca3778baab3aafe9eb1a5228fa
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 10 19:54:21 2012 -0500

    Introduce new enhancement to GRKERNSEC_PROC_MEMMAP
    prevents reads of sensitive /proc/pid entries where the file descriptor
    was opened in a different task than the one performing the read

 fs/exec.c                  |    8 ++++++++
 fs/proc/array.c            |   14 ++++++++++++++
 fs/proc/task_mmu.c         |   14 ++++++++++++++
 fs/seq_file.c              |    3 +++
 grsecurity/Kconfig         |    4 ++++
 grsecurity/Makefile        |    2 ++
 grsecurity/grsec_mem.c     |    7 +++++++
 include/linux/grmsg.h      |    1 +
 include/linux/grsecurity.h |    2 ++
 include/linux/sched.h      |    3 +++
 include/linux/seq_file.h   |    3 +++
 mm/mempolicy.c             |   17 +++++++++++++++++
 12 files changed, 78 insertions(+), 0 deletions(-)

commit 7e600e98936204b0fdd5fc4927f3e84ed8a916d4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 10 17:45:05 2012 -0500

    remove duplicate signal check

 fs/ecryptfs/read_write.c |    5 -----
 1 files changed, 0 insertions(+), 5 deletions(-)

commit cf5731b0b8ac026402e004a62cc3b0c522b5d9d2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Feb 7 17:21:00 2012 -0500

    Add current_is_single_threaded() fix I applied to the test branch but
    forgot to apply to stable when backporting GRKERNSEC_SETXID

 lib/is_single_threaded.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit 62c225e1fb6dae81cc09529cf5907d2d873d2501
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 5 19:24:45 2012 -0500

    We now allow configurations with no PaX markings, giving the system no way to override the defaults

 include/linux/grsecurity.h |    6 ------
 1 files changed, 0 insertions(+), 6 deletions(-)

commit 9d26eddf728a13211ecd562c3bb694f06dad9ed4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 5 10:01:23 2012 -0500

    Increase the buffer size of logged TPE reason, otherwise we could truncate the "y" in directory

 grsecurity/grsec_tpe.c |    2 +-
 include/linux/grmsg.h  |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

commit 438081ca64865be76271b92db39b99e47a15efd9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 4 21:01:16 2012 -0500

    Improve security of ptrace-based monitoring/sandboxing
    See:
    http://article.gmane.org/gmane.linux.kernel.lsm/15156

 include/linux/tracehook.h |    9 +++++----
 1 files changed, 5 insertions(+), 4 deletions(-)

commit 2f47176536bac553b98cacd27a9e482fe04247cf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:25:38 2012 -0500

    Reported by lavish on IRC:
    If a suid/sgid binary did not learn any setuid/setgid call during learning,
    we would not any CAP_SETUID/CAP_SETGID capability to the task, nor
    any restrictions on uid/gid changes.  uid and gid can however be changed
    within a suid/sgid binary via setresuid/setresgid with ruid/rgid set to
    euid/egid.
    
    My fix:
    POSIX doesn't specify whether unprivileged users can perform the above
    setresuid/setresgid as an unprivileged user, though Linux has historically
    permitted them.  Modify this behavior when RBAC is enabled to require
    CAP_SETUID/CAP_SETGID for these operations.
    
    Thanks to Lavish for the report!

 kernel/sys.c |   30 ++++++++++++++++++++++++------
 1 files changed, 24 insertions(+), 6 deletions(-)

commit e93b3fe92d7de50e133327162ae7c40723f88802
Merge: 3cf8fac 57cfeff
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:14:52 2012 -0500

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	block/scsi_ioctl.c
    	drivers/scsi/sd.c

commit 57cfeff6b583d0514e11b6651ce07c4ec52e9566
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:13:03 2012 -0500

    Merge changes from pax-linux-2.6.32.55-test137.patch

 arch/x86/kernel/cpu/mcheck/p5.c      |    1 +
 arch/x86/kernel/cpu/mcheck/winchip.c |    1 +
 arch/x86/mm/ioremap.c                |    3 +++
 drivers/char/tty_io.c                |    2 +-
 security/Kconfig                     |    1 +
 5 files changed, 7 insertions(+), 1 deletions(-)

commit 08864616a21369d4fce2f9249995e4d81a313e45
Merge: fc57040 adb67a7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:12:09 2012 -0500

    Merge branch 'linux-2.6.32.y' into pax-stable

commit 3cf8facd7367a6fa8709e9965f493d3c01aa1433
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 30 23:26:44 2012 -0500

    Implement new version of CONFIG_GRKERNSEC_SYSFS_RESTRICT
    
    We'll whitelist required directories for compatibility instead of requiring
    that people disable the feature entirely if they use SELinux, fuse, etc

 fs/debugfs/inode.c |    4 ++++
 fs/sysfs/dir.c     |   12 ++++++++++++
 fs/sysfs/mount.c   |    4 ----
 grsecurity/Kconfig |   10 +++++++---
 4 files changed, 23 insertions(+), 7 deletions(-)

commit 57146febf72d36af9c158cdcdb843173857f7a2e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 30 17:20:04 2012 -0500

    fix bad ecryptfs merge

 fs/ecryptfs/crypto.c |   13 -------------
 1 files changed, 0 insertions(+), 13 deletions(-)

commit 9588c65f970847a62b3bb549fcee94a8bb318987
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 29 01:12:19 2012 -0500

    perform RBAC check if TPE is on but match fails, matches previous behavior

 grsecurity/grsec_tpe.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 071127ee32668640c423b3a2d04efde6f36c7d51
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jan 28 13:17:06 2012 -0500

    log more information about the reason for a TPE denial for novice users, requested by a sponsor

 grsecurity/grsec_tpe.c |   57 +++++++++++++++++++++++++++++++++++++----------
 include/linux/grmsg.h  |    2 +-
 2 files changed, 46 insertions(+), 13 deletions(-)

commit de266622ac8e0132537b467b7ab5f0aee15942bf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 20:54:31 2012 -0500

    sync documentation with test patch

 grsecurity/Kconfig |   10 ++++------
 1 files changed, 4 insertions(+), 6 deletions(-)

commit 2a30fcc6cb300b4c05ce33b809152554f1cd29d0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:58:01 2012 -0500

    merge upstream sha512 changes

 crypto/sha512_generic.c |   62 +++++++++++++++++++++++++---------------------
 1 files changed, 34 insertions(+), 28 deletions(-)

commit 65b29a4ed4b9152bcec36d5113a34f84b0694f7b
Author: Li Wang <liwang@nudt.edu.cn>
Date:   Thu Jan 19 09:44:36 2012 +0800

    eCryptfs: Infinite loop due to overflow in ecryptfs_write()
    
    ecryptfs_write() can enter an infinite loop when truncating a file to a
    size larger than 4G. This only happens on architectures where size_t is
    represented by 32 bits.
    
    This was caused by a size_t overflow due to it incorrectly being used to
    store the result of a calculation which uses potentially large values of
    type loff_t.
    
    [tyhicks@canonical.com: rewrite subject and commit message]
    Signed-off-by: Li Wang <liwang@nudt.edu.cn>
    Signed-off-by: Yunchuan Wen <wenyunchuan@kylinos.com.cn>
    Reviewed-by: Cong Wang <xiyou.wangcong@gmail.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>

 fs/ecryptfs/read_write.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 57f9e335b11d47434172f078804c581d73aaaa5d
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Wed Jan 18 18:30:04 2012 -0600

    eCryptfs: Make truncate path killable
    
    ecryptfs_write() handles the truncation of eCryptfs inodes. It grabs a
    page, zeroes out the appropriate portions, and then encrypts the page
    before writing it to the lower filesystem. It was unkillable and due to
    the lack of sparse file support could result in tying up a large portion
    of system resources, while encrypting pages of zeros, with no way for
    the truncate operation to be stopped from userspace.
    
    This patch adds the ability for ecryptfs_write() to detect a pending
    fatal signal and return as gracefully as possible. The intent is to
    leave the lower file in a useable state, while still allowing a user to
    break out of the encryption loop. If a pending fatal signal is detected,
    the eCryptfs inode size is updated to reflect the modified inode size
    and then -EINTR is returned.
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Cc: <stable@vger.kernel.org>

 fs/ecryptfs/read_write.c |   19 ++++++++++++++-----
 1 files changed, 14 insertions(+), 5 deletions(-)

commit 826405ab264e1bc3834a59ae44c2ca79b3ea82a3
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Tue Jan 24 10:02:22 2012 -0600

    eCryptfs: Fix oops when printing debug info in extent crypto functions
    
    If pages passed to the eCryptfs extent-based crypto functions are not
    mapped and the module parameter ecryptfs_verbosity=1 was specified at
    loading time, a NULL pointer dereference will occur.
    
    Note that this wouldn't happen on a production system, as you wouldn't
    pass ecryptfs_verbosity=1 on a production system. It leaks private
    information to the system logs and is for debugging only.
    
    The debugging info printed in these messages is no longer very useful
    and rather than doing a kmap() in these debugging paths, it will be
    better to simply remove the debugging paths completely.
    
    https://launchpad.net/bugs/913651
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reported-by: Daniel DeFreez
    Cc: <stable@vger.kernel.org>
    
    Conflicts:
    
    	fs/ecryptfs/crypto.c

 fs/ecryptfs/crypto.c |   33 +++------------------------------
 1 files changed, 3 insertions(+), 30 deletions(-)

commit bd1ee492bbdb0accab183c634dc316a2e12c8cb8
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Thu Jan 12 11:30:44 2012 +0100

    eCryptfs: Sanitize write counts of /dev/ecryptfs
    
    A malicious count value specified when writing to /dev/ecryptfs may
    result in a a very large kernel memory allocation.
    
    This patch peeks at the specified packet payload size, adds that to the
    size of the packet headers and compares the result with the write count
    value. The resulting maximum memory allocation size is approximately 532
    bytes.
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reported-by: Sasha Levin <levinsasha928@gmail.com>
    Cc: <stable@vger.kernel.org>

 fs/ecryptfs/miscdev.c |   56 +++++++++++++++++++++++++++++++++---------------
 1 files changed, 38 insertions(+), 18 deletions(-)

commit 57a72432415a451aa8fa48bb5fa18f714b3a6a92
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:50:41 2012 -0500

    drop lock in xfs_readlink
    
    http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blobdiff;f=fs/xfs/xfs_vnodeops.c;fp=fs/xfs/xfs_vnodeops.c;h=ebdb88840a47817b5704df2aaa0fefb8b11fd96e;hp=0cf52da9d2468a547a614f55cf0191a396f82574;hb=aaad641eadfd3e74b0fbb68fcf539b9cef0415d0;hpb=74a7f6a0a61f1f5addd0afa789785f4cefcfcafc

 fs/xfs/xfs_vnodeops.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit a1f8a979c5038e3ec0ad00a09acb30163380bb31
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:40:59 2012 -0500

    sync with test patch

 grsecurity/gracl.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

commit 75d62f6720a0a507e295e195233bd8c919c12a85
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:31:07 2012 -0500

    fix typo

 grsecurity/gracl.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 35cdf74f990edffd420edd9eea322a3c03fb3132
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:27:07 2012 -0500

    fix typo

 grsecurity/gracl.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit aa7be66902ba3f0a567cf4bb1096100761c8a7f7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:22:54 2012 -0500

    include proper header

 grsecurity/gracl.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 522a704962f4ddee44eb00169297f44bc7857382
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:19:48 2012 -0500

    add missing hunks, compilation fixes

 fs/compat.c                |    7 ++++++-
 fs/exec.c                  |    2 +-
 grsecurity/gracl.c         |    6 +++---
 grsecurity/grsec_ptrace.c  |    2 +-
 include/linux/grsecurity.h |    2 +-
 5 files changed, 12 insertions(+), 7 deletions(-)

commit 812e9b117142b319f034b1b52c3f60ce41bc78a0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:07:19 2012 -0500

    add missing declaration

 include/linux/grinternal.h |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit ddb7634ada8d0100da810e0fd3177f89a412c3cc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:03:22 2012 -0500

    fix typo

 include/linux/grmsg.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 6ec00041fe0325216040e7255c3ab85afe6066e7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:00:42 2012 -0500

    fix typo

 kernel/cred.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit d179f2c6e24b7f901f4e90e90479c862a3f05244
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 18:57:33 2012 -0500

    make set_user global

 kernel/sys.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 2d0778ebe964eb2f8a522be0ca61aeecd9964e53
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 18:52:36 2012 -0500

    Introduce CONFIG_GRKERNSEC_SETXID and CONFIG_GRKERNSEC_PTRACE_READEXEC

 fs/exec.c                  |    5 ++
 grsecurity/Kconfig         |   30 +++++++++++++
 grsecurity/grsec_init.c    |    8 ++++
 grsecurity/grsec_ptrace.c  |   16 +++++++
 grsecurity/grsec_sysctl.c  |   20 +++++++++
 include/linux/grmsg.h      |    1 +
 include/linux/grsecurity.h |    5 ++
 include/linux/sched.h      |    3 +
 kernel/cred.c              |   99 +++++++++++++++++++++++++++++++++++++++++++-
 kernel/sched.c             |   15 +++++++
 10 files changed, 201 insertions(+), 1 deletions(-)

commit 92000b859586a6b038677130f663e9edff061237
Merge: dba507f fc57040
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 25 21:00:24 2012 -0500

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	block/scsi_ioctl.c
    	include/linux/blkdev.h

commit fc57040683d2aa303e148af2ef132effdcaaaee2
Merge: 67c46a7 b16a92f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 25 20:53:21 2012 -0500

    Merge branch 'linux-2.6.32.y' into pax-stable

commit dba507f426a7dd006b70be6791be8cdb7def63f6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 22 16:33:53 2012 -0500

    Fix booting on !SMP kernels, ATOM failure reported on forums
    Thanks to THE PaX TEAM for debugging

 kernel/sched.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

commit 8521d8b3e6c223880eacc9d7cd4812a88f0b923d
Merge: 30109c8 67c46a7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 20 18:07:18 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 67c46a75571a1ca1dd33a1fd671d76c5bfd443ba
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 20 18:07:02 2012 -0500

    Merge the diff between pax-linux-3.2.1-test4.patch and pax-linux-3.2.1-test5.patch
    Denies executable shared memory when MPROTECT is active
    Fixes ia32 emulation crash on 64bit host introduced in a recent patch

 arch/x86/ia32/ia32entry.S |    1 +
 ipc/shm.c                 |    6 ++++++
 2 files changed, 7 insertions(+), 0 deletions(-)

commit 30109c8e22c19788b939a4041adbb172c44d2610
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 19 20:09:25 2012 -0500

    add function declaration

 fs/proc/base.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 5610ac72e149f1f62f0f0099311cc6e10a7a664e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 19 20:05:08 2012 -0500

    Add a temporary workaround on the read end while upstream prepares a backport

 fs/proc/base.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

commit 154d61840ac22c4004e12ae6a5533ee5d63805f7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 19 19:35:31 2012 -0500

    Revert "Backport new /proc/pid/mem code.  mem_write was always disabled in this kernel,"
    
    This reverts commit 76ab55b3a022f98fbd01659b86df6eb56a74145a.

 fs/proc/base.c |  132 +++++++++++++++++++++++++++++++++++---------------------
 1 files changed, 82 insertions(+), 50 deletions(-)

commit d92e4f83f07a2835b7bef4a6b308450fd0a8325f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 19 19:35:03 2012 -0500

    Revert "Fix up /proc/pid/mem backport, introduce new access_process_mm function"
    
    This reverts commit 20302b5879500d6c6ad185afeb1ed2fcbfea03ad.

 fs/proc/base.c     |   12 +++++++-----
 include/linux/mm.h |    1 -
 mm/memory.c        |   14 ++------------
 3 files changed, 9 insertions(+), 18 deletions(-)

commit 20302b5879500d6c6ad185afeb1ed2fcbfea03ad
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 19 18:35:52 2012 -0500

    Fix up /proc/pid/mem backport, introduce new access_process_mm function

 fs/proc/base.c     |   12 +++++-------
 include/linux/mm.h |    1 +
 mm/memory.c        |   14 ++++++++++++--
 3 files changed, 18 insertions(+), 9 deletions(-)

commit 76ab55b3a022f98fbd01659b86df6eb56a74145a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jan 19 17:38:54 2012 -0500

    Backport new /proc/pid/mem code.  mem_write was always disabled in this kernel,
    but this cleans up the read side also.  Thank Linus for silent fixes!

 fs/proc/base.c |  132 +++++++++++++++++++++-----------------------------------
 1 files changed, 50 insertions(+), 82 deletions(-)

commit d40034db02aed3e9ed60ac2f99e74732843eb715
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 18 20:52:50 2012 -0500

    Fix compilation failure from scsi ioctl backport

 block/scsi_ioctl.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

commit ef1a97e74a43f77107a7da1e0133bf9a75c4932c
Author: Sean Hefty <sean.hefty@intel.com>
Date:   Tue Dec 6 21:17:11 2011 +0000

    RDMA/cma: Verify private data length
    
    private_data_len is defined as a u8.  If the user specifies a large
    private_data size (> 220 bytes), we will calculate a total length that
    exceeds 255, resulting in private_data_len wrapping back to 0.  This
    can lead to overwriting random kernel memory.  Avoid this by verifying
    that the resulting size fits into a u8.
    
    Reported-by: B. Thery <benjamin.thery@bull.net>
    Addresses: <http://bugs.openfabrics.org/bugzilla/show_bug.cgi?id=2335>
    Signed-off-by: Sean Hefty <sean.hefty@intel.com>
    Signed-off-by: Roland Dreier <roland@purestorage.com>

 drivers/infiniband/core/cma.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

commit 7950775d75bccd58dc4c0e9bdc4b0388d823bb8d
Author: Haogang Chen <haogangchen@gmail.com>
Date:   Mon Dec 19 17:11:56 2011 -0800

    nilfs2: potential integer overflow in nilfs_ioctl_clean_segments()
    
    There is a potential integer overflow in nilfs_ioctl_clean_segments().
    When a large argv[n].v_nmembs is passed from the userspace, the subsequent
    call to vmalloc() will allocate a buffer smaller than expected, which
    leads to out-of-bound access in nilfs_ioctl_move_blocks() and
    lfs_clean_segments().
    
    The following check does not prevent the overflow because nsegs is also
    controlled by the userspace and could be very large.
    
    		if (argv[n].v_nmembs > nsegs * nilfs->ns_blocks_per_segment)
    			goto out_free;
    
    This patch clamps argv[n].v_nmembs to UINT_MAX / argv[n].v_size, and
    returns -EINVAL when overflow.
    
    Signed-off-by: Haogang Chen <haogangchen@gmail.com>
    Signed-off-by: Ryusuke Konishi <konishi.ryusuke@lab.ntt.co.jp>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/nilfs2/ioctl.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit ea35b13e49ba29ef73250d150061f2c1121656da
Author: Jesper Juhl <jj@chaosbits.net>
Date:   Sun Jan 8 22:44:29 2012 +0100

    audit: always follow va_copy() with va_end()
    
    A call to va_copy() should always be followed by a call to va_end() in
    the same function.  In kernel/autit.c::audit_log_vformat() this is not
    always done.  This patch makes sure va_end() is always called.
    
    Signed-off-by: Jesper Juhl <jj@chaosbits.net>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Cc: Eric Paris <eparis@redhat.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 kernel/audit.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

commit 7a73189b0652fa9a04a940a1e704ff3ae6805a08
Author: Andi Kleen <ak@linux.intel.com>
Date:   Thu Jan 12 17:20:30 2012 -0800

    panic: don't print redundant backtraces on oops
    
    When an oops causes a panic and panic prints another backtrace it's pretty
    common to have the original oops data be scrolled away on a 80x50 screen.
    
    The second backtrace is quite redundant and not needed anyways.
    
    So don't print the panic backtrace when oops_in_progress is true.
    
    [akpm@linux-foundation.org: add comment]
    Signed-off-by: Andi Kleen <ak@linux.intel.com>
    Cc: Michael Holzheu <holzheu@linux.vnet.ibm.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 kernel/panic.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

commit dce1c3c84d1290ab1e54709e7e857eca4bc658e4
Author: Paolo Bonzini <pbonzini@redhat.com>
Date:   Thu Jan 12 16:01:28 2012 +0100

    block: fail SCSI passthrough ioctls on partition devices
    
    Linux allows executing the SG_IO ioctl on a partition or LVM volume, and
    will pass the command to the underlying block device.  This is
    well-known, but it is also a large security problem when (via Unix
    permissions, ACLs, SELinux or a combination thereof) a program or user
    needs to be granted access only to part of the disk.
    
    This patch lets partitions forward a small set of harmless ioctls;
    others are logged with printk so that we can see which ioctls are
    actually sent.  In my tests only CDROM_GET_CAPABILITY actually occurred.
    Of course it was being sent to a (partition on a) hard disk, so it would
    have failed with ENOTTY and the patch isn't changing anything in
    practice.  Still, I'm treating it specially to avoid spamming the logs.
    
    In principle, this restriction should include programs running with
    CAP_SYS_RAWIO.  If for example I let a program access /dev/sda2 and
    /dev/sdb, it still should not be able to read/write outside the
    boundaries of /dev/sda2 independent of the capabilities.  However, for
    now programs with CAP_SYS_RAWIO will still be allowed to send the
    ioctls.  Their actions will still be logged.
    
    This patch does not affect the non-libata IDE driver.  That driver
    however already tests for bd != bd->bd_contains before issuing some
    ioctl; it could be restricted further to forbid these ioctls even for
    programs running with CAP_SYS_ADMIN/CAP_SYS_RAWIO.
    
    Cc: linux-scsi@vger.kernel.org
    Cc: Jens Axboe <axboe@kernel.dk>
    Cc: James Bottomley <JBottomley@parallels.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    [ Make it also print the command name when warning - Linus ]
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 block/scsi_ioctl.c     |   45 +++++++++++++++++++++++++++++++++++++++++++++
 drivers/scsi/sd.c      |   11 +++++++++--
 include/linux/blkdev.h |    1 +
 3 files changed, 55 insertions(+), 2 deletions(-)

commit edb680c4c184ee6001b68d3dd89eb1729f4e884e
Author: Paolo Bonzini <pbonzini@redhat.com>
Date:   Thu Jan 12 16:01:27 2012 +0100

    block: add and use scsi_blk_cmd_ioctl
    
    Introduce a wrapper around scsi_cmd_ioctl that takes a block device.
    
    The function will then be enhanced to detect partition block devices
    and, in that case, subject the ioctls to whitelisting.
    
    Cc: linux-scsi@vger.kernel.org
    Cc: Jens Axboe <axboe@kernel.dk>
    Cc: James Bottomley <JBottomley@parallels.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	block/scsi_ioctl.c
    	drivers/block/ub.c

 block/scsi_ioctl.c             |    9 ++++++++-
 drivers/block/cciss.c          |    6 +++---
 drivers/block/ub.c             |    3 +--
 drivers/block/virtio_blk.c     |    4 ++--
 drivers/cdrom/cdrom.c          |    3 +--
 drivers/ide/ide-floppy_ioctl.c |    3 +--
 drivers/scsi/sd.c              |    2 +-
 include/linux/blkdev.h         |    2 ++
 8 files changed, 19 insertions(+), 13 deletions(-)

commit 061fb16341f6cf32dec1412ce116464c70b0d95f
Author: Xi Wang <xi.wang@gmail.com>
Date:   Tue Dec 20 18:39:41 2011 -0500

    audit: fix signedness bug in audit_log_execve_info()
    
    In the loop, a size_t "len" is used to hold the return value of
    audit_log_single_execve_arg(), which returns -1 on error.  In that
    case the error handling (len <= 0) will be bypassed since "len" is
    unsigned, and the loop continues with (p += len) being wrapped.
    Change the type of "len" to signed int to fix the error handling.
    
    	size_t len;
    	...
    	for (...) {
    		len = audit_log_single_execve_arg(...);
    		if (len <= 0)
    			break;
    		p += len;
    	}
    
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Signed-off-by: Eric Paris <eparis@redhat.com>

 kernel/auditsc.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 7014fc59a8a5394895e6465548c241f31bcb7877
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 16 13:10:38 2012 -0500

    Ignore the 0 signal for protected task RBAC checks

 grsecurity/grsec_sig.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit b830280ce3a4a3754316c3cd12cefb8a586af1c5
Merge: 82c4d27 8090897
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 13 20:12:25 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit 809089761a4174c5930437b999ed833b278fc8e6
Merge: ac9dda1 f2ab2a1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 13 20:12:12 2012 -0500

    Merge branch 'linux-2.6.32.y' into pax-stable

commit 82c4d27919566155486cde8b2858af49235d4153
Merge: 2ac6c6e ac9dda1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 10 15:59:49 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit ac9dda17072962f93205e391640659362e6b24db
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 10 15:59:25 2012 -0500

    Merge changes from pax-linux-2.6.32.53-test135.patch

 arch/x86/include/asm/alternative-asm.h |    4 +-
 arch/x86/include/asm/atomic_32.h       |    4 +-
 arch/x86/mm/fault.c                    |   52 ++++++++++++++++++++++++++++++++
 security/Kconfig                       |    6 +--
 4 files changed, 58 insertions(+), 8 deletions(-)

commit 2ac6c6e4c325498d003ea386a96840e9547ca327
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 8 08:32:08 2012 -0500

    Fix PaX mismerge

 fs/binfmt_elf.c |   15 ---------------
 1 files changed, 0 insertions(+), 15 deletions(-)

commit f6dbbbfe4ca34f02d73a552b32a9584388fcf6c2
Merge: 61b0458 b82c81b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 21:52:55 2012 -0500

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	fs/binfmt_elf.c
    	security/Kconfig

commit b82c81b15dc819fa6ca7ad3b107affa8f2c430bb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 21:49:36 2012 -0500

    Resync with PaX patch

 security/keys/process_keys.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 41d57e6fda4b1041f35c4a1917a685e607deaeaa
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 21:47:59 2012 -0500

    Merge changes from pax-linux-2.6.32.53-test134.patch

 Makefile                         |    4 +
 arch/x86/ia32/ia32entry.S        |    2 +
 arch/x86/kernel/cpu/common.c     |    2 +-
 arch/x86/kernel/entry_64.S       |    4 +-
 fs/binfmt_elf.c                  |  216 ++++++++++++++++++++++++++++++++++----
 fs/exec.c                        |    4 +
 include/linux/fsnotify_backend.h |    1 +
 include/linux/mm_types.h         |    2 +-
 include/linux/xattr.h            |    5 +
 mm/hugetlb.c                     |    1 +
 security/Kconfig                 |   71 +++++++++---
 11 files changed, 268 insertions(+), 44 deletions(-)

commit 61b04582f27377c7d94881df4b38dcc372eb1f6c
Merge: 114bfb5 f10ac11
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 18:50:19 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit f10ac1153528d345f26fcaad68629e0df5fbcfef
Merge: df4852a 8761f65
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 6 18:50:08 2012 -0500

    Merge branch 'linux-2.6.32.y' into pax-stable

commit 114bfb503640c1a7996f0b73b1aedfa4cdedf194
Merge: 0da4531 df4852a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 3 17:43:52 2012 -0500

    Merge branch 'pax-stable' into grsec-stable

commit df4852aee85c5ad79e646d800784f1543811b525
Merge: 7949551 7d48308
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 3 17:43:12 2012 -0500

    Merge branch 'linux-2.6.32.y' into pax-stable

commit 0da4531e30203699c87c0916f93dc97b4e502288
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 2 13:19:20 2012 -0500

    Remove unnecessary headers

 kernel/printk.c |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

commit 9b2166d9cf2add837c5e614e69f87687c322df5f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 2 13:14:49 2012 -0500

    Don't do permission checks on already-opened /proc/kmsg

 kernel/printk.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

commit 2f3673e68b7a6a3e2d2648b3558c7fae9c097ef3
Author: Kees Cook <kees.cook@canonical.com>
Date:   Wed Feb 3 15:37:13 2010 -0800

    syslog: use defined constants instead of raw numbers
    
    Right now the syslog "type" action are just raw numbers which makes
    the source difficult to follow.  This patch replaces the raw numbers
    with defined constants for some level of sanity.
    
    Signed-off-by: Kees Cook <kees.cook@canonical.com>
    Acked-by: John Johansen <john.johansen@canonical.com>
    Acked-by: Serge Hallyn <serue@us.ibm.com>
    Signed-off-by: James Morris <jmorris@namei.org>

 fs/proc/kmsg.c           |   10 +++++-----
 include/linux/syslog.h   |   23 +++++++++++++++++++++++
 kernel/printk.c          |   45 +++++++++++++++++++--------------------------
 security/commoncap.c     |    5 +++--
 security/selinux/hooks.c |   21 +++++++++++----------
 5 files changed, 61 insertions(+), 43 deletions(-)

commit e5cc64c2dba9091f2de889856aecd6823ce72300
Author: Kees Cook <kees.cook@canonical.com>
Date:   Wed Feb 3 15:36:43 2010 -0800

    syslog: distinguish between /proc/kmsg and syscalls
    
    This allows the LSM to distinguish between syslog functions originating
    from /proc/kmsg access and direct syscalls.  By default, the commoncaps
    will now no longer require CAP_SYS_ADMIN to read an opened /proc/kmsg
    file descriptor.  For example the kernel syslog reader can now drop
    privileges after opening /proc/kmsg, instead of staying privileged with
    CAP_SYS_ADMIN.  MAC systems that implement security_syslog have unchanged
    behavior.
    
    Signed-off-by: Kees Cook <kees.cook@canonical.com>
    Acked-by: Serge Hallyn <serue@us.ibm.com>
    Acked-by: John Johansen <john.johansen@canonical.com>
    Signed-off-by: James Morris <jmorris@namei.org>
    
    Conflicts:
    
    	kernel/printk.c
    	security/commoncap.c

 fs/proc/kmsg.c             |   14 +++++++-------
 include/linux/security.h   |   11 ++++++-----
 include/linux/syslog.h     |   29 +++++++++++++++++++++++++++++
 kernel/printk.c            |    9 ++++++---
 security/commoncap.c       |    8 +++++++-
 security/security.c        |    4 ++--
 security/selinux/hooks.c   |    5 +++--
 security/smack/smack_lsm.c |    4 ++--
 8 files changed, 62 insertions(+), 22 deletions(-)

commit a26a978a30c923c206222b35f63c385ccd09078f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 22 20:20:44 2011 -0500

    Only further restrict futex targeting another process -- our modified
    permission check also happened to allow a case where a process retaining
    uid 0 could issue futex syscalls against other uid 0 tasks, despite the euid
    being non-zero (reported on forums by ben_w)

 kernel/futex.c        |    5 +----
 kernel/futex_compat.c |    5 +----
 2 files changed, 2 insertions(+), 8 deletions(-)

commit 4fafbf2459516939b5f25cbf706b4643d46378fc
Merge: 4efb1cc 7949551
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 22 19:17:47 2011 -0500

    Merge branch 'pax-stable' into grsec-stable
    
    Conflicts:
    	fs/hfs/btree.c

commit 7949551a30f3c9e2a023f7505c7c471308724a0a
Merge: aec65dc c8375e7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Dec 22 19:16:36 2011 -0500

    Merge branch 'linux-2.6.32.y' into pax-stable
    
    Conflicts:
    	arch/x86/oprofile/backtrace.c

commit 4efb1cc0ba6231a5a50520d38cbd2a5d07255c9d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 10 17:39:00 2011 -0500

    Fix bad grsec merge

 arch/x86/include/asm/uaccess_64.h |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

commit 7d957810e34013de3f08088d63f22f8bfa77dc12
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 10 17:36:45 2011 -0500

    Revert "Fix bad PaX merge", applying to PaX tree
    
    This reverts commit 51cd08176e7cd4580b7e0063c5785330f5738cbf.

 arch/x86/include/asm/uaccess_64.h |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 71b3842e15793661ff851921f5a884e3f5b86601
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 10 17:34:27 2011 -0500

    Fix bad PaX merge

 arch/x86/include/asm/uaccess_64.h |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

commit f8493e6a4cecade98e35fe0d47e33083331b6a61
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Dec 7 20:00:29 2011 -0500

    Remove harmless duplicate code -- exec_file would be null already so the
    second check would never pass.

 kernel/exit.c |   11 -----------
 1 files changed, 0 insertions(+), 11 deletions(-)

commit 4ca5b26a5e088e244aa5ad4514f7dfce0c2e0bfc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Dec 7 19:48:24 2011 -0500

    Revert back to (possibly?) undocumented /proc/pid behavior that gdb depended
    on for attaching to a thread.  Entries exist in /proc for threads, but
    are not visible in a readdir.

 fs/proc/base.c |    3 ---
 1 files changed, 0 insertions(+), 3 deletions(-)

commit 2d46e078d7012ad27099e9608f55f8f49413e96e
Author: Xi Wang <xi.wang@gmail.com>
Date:   Tue Nov 29 09:26:30 2011 +0000

    sctp: better integer overflow check in sctp_auth_create_key()
    
    The check from commit 30c2235c is incomplete and cannot prevent
    cases like key_len = 0x80000000 (INT_MAX + 1).  In that case, the
    left-hand side of the check (INT_MAX - key_len), which is unsigned,
    becomes 0xffffffff (UINT_MAX) and bypasses the check.
    
    However this shouldn't be a security issue.  The function is called
    from the following two code paths:
    
     1) setsockopt()
    
     2) sctp_auth_asoc_set_secret()
    
    In case (1), sca_keylength is never going to exceed 65535 since it's
    bounded by a u16 from the user API.  As such, the key length will
    never overflow.
    
    In case (2), sca_keylength is computed based on the user key (1 short)
    and 2 * key_vector (3 shorts) for a total of 7 * USHRT_MAX, which still
    will not overflow.
    
    In other words, this overflow check is not really necessary.  Just
    make it more correct.
    
    Signed-off-by: Xi Wang <xi.wang@gmail.com>
    Cc: Vlad Yasevich <vladislav.yasevich@hp.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/sctp/auth.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit a717856a241763bf7227a8485518dbf38c6db355
Author: Julia Lawall <julia@diku.dk>
Date:   Tue Nov 15 14:53:11 2011 -0800

    drivers/gpu/vga/vgaarb.c: add missing kfree
    
    kbuf is a buffer that is local to this function, so all of the error paths
    leaving the function should release it.
    
    Signed-off-by: Julia Lawall <julia@diku.dk>
    Cc: Jesper Juhl <jj@chaosbits.net>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Dave Airlie <airlied@redhat.com>

 drivers/gpu/vga/vgaarb.c |   18 ++++++++++++------
 1 files changed, 12 insertions(+), 6 deletions(-)

commit 816c0eb7a243d2b367de4fe4f76a7694cd1bce2a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 3 20:44:54 2011 -0500

    Import changes between PaX and grsecurity-2.2.2-2.6.32.49-201112032036.patch

 Documentation/dontdiff                           |    1 +
 Makefile                                         |   12 +-
 arch/arm/kernel/kgdb.c                           |    2 +-
 arch/arm/kernel/traps.c                          |    4 +
 arch/arm/mach-at91/pm.c                          |    2 +-
 arch/arm/mach-omap1/pm.c                         |    2 +-
 arch/arm/mach-omap2/pm24xx.c                     |    2 +-
 arch/arm/mach-omap2/pm34xx.c                     |    2 +-
 arch/arm/mach-pnx4008/pm.c                       |    2 +-
 arch/arm/mach-pxa/pm.c                           |    2 +-
 arch/arm/mach-pxa/sharpsl_pm.c                   |    2 +-
 arch/arm/mach-sa1100/pm.c                        |    2 +-
 arch/arm/plat-s3c/pm.c                           |    2 +-
 arch/avr32/mach-at32ap/pm.c                      |    2 +-
 arch/blackfin/kernel/kgdb.c                      |    2 +-
 arch/blackfin/mach-common/pm.c                   |    2 +-
 arch/ia64/hp/common/hwsw_iommu.c                 |    4 +-
 arch/ia64/hp/common/sba_iommu.c                  |    4 +-
 arch/ia64/include/asm/dma-mapping.h              |   10 +-
 arch/ia64/include/asm/machvec.h                  |    4 +-
 arch/ia64/kernel/dma-mapping.c                   |    4 +-
 arch/ia64/kernel/pci-dma.c                       |   35 +-
 arch/ia64/kernel/pci-swiotlb.c                   |    2 +-
 arch/ia64/kernel/topology.c                      |    2 +-
 arch/ia64/sn/pci/pci_dma.c                       |    2 +-
 arch/mips/Makefile                               |    2 +
 arch/mips/alchemy/devboards/pm.c                 |    2 +-
 arch/mips/include/asm/reboot.h                   |    4 +-
 arch/mips/kernel/kgdb.c                          |    1 +
 arch/mips/kernel/reset.c                         |    7 +-
 arch/powerpc/Makefile                            |    2 +
 arch/powerpc/include/asm/device.h                |    2 +-
 arch/powerpc/include/asm/dma-mapping.h           |   16 +-
 arch/powerpc/include/asm/iommu.h                 |    3 +
 arch/powerpc/include/asm/pci.h                   |    4 +-
 arch/powerpc/include/asm/ptrace.h                |    2 +-
 arch/powerpc/include/asm/swiotlb.h               |    2 +-
 arch/powerpc/kernel/cacheinfo.c                  |    2 +-
 arch/powerpc/kernel/dma-iommu.c                  |    2 +-
 arch/powerpc/kernel/dma-swiotlb.c                |    2 +-
 arch/powerpc/kernel/dma.c                        |    2 +-
 arch/powerpc/kernel/ibmebus.c                    |    2 +-
 arch/powerpc/kernel/kgdb.c                       |    2 +-
 arch/powerpc/kernel/pci-common.c                 |    6 +-
 arch/powerpc/kernel/process.c                    |   10 +-
 arch/powerpc/kernel/ptrace.c                     |    4 +-
 arch/powerpc/kernel/traps.c                      |    4 +
 arch/powerpc/kernel/vio.c                        |    3 +-
 arch/powerpc/mm/mem.c                            |    2 +-
 arch/powerpc/platforms/52xx/lite5200_pm.c        |    2 +-
 arch/powerpc/platforms/52xx/mpc52xx_pm.c         |    2 +-
 arch/powerpc/platforms/83xx/suspend.c            |    2 +-
 arch/powerpc/platforms/cell/iommu.c              |    2 +-
 arch/powerpc/platforms/ps3/system-bus.c          |    4 +-
 arch/sh/boards/mach-hp6xx/pm.c                   |    2 +-
 arch/sh/kernel/cpu/sh4/sq.c                      |    2 +-
 arch/sh/kernel/cpu/shmobile/pm.c                 |    2 +-
 arch/sh/kernel/kgdb.c                            |    2 +-
 arch/sparc/Makefile                              |    2 +-
 arch/sparc/include/asm/dma-mapping.h             |    8 +-
 arch/sparc/include/asm/spinlock_64.h             |    4 +-
 arch/sparc/kernel/iommu.c                        |    4 +-
 arch/sparc/kernel/ioport.c                       |    6 +-
 arch/sparc/kernel/kgdb_32.c                      |    2 +-
 arch/sparc/kernel/kgdb_64.c                      |    2 +-
 arch/sparc/kernel/pci_sun4v.c                    |    2 +-
 arch/sparc/kernel/process_32.c                   |    8 +-
 arch/sparc/kernel/process_64.c                   |    8 +-
 arch/sparc/kernel/sigutil_64.c                   |    1 +
 arch/sparc/kernel/traps_32.c                     |    8 +-
 arch/sparc/kernel/traps_64.c                     |   27 +-
 arch/sparc/kernel/unaligned_64.c                 |    2 +-
 arch/sparc/mm/fault_64.c                         |    2 +-
 arch/x86/Kconfig                                 |    5 +-
 arch/x86/Makefile                                |    2 +-
 arch/x86/boot/compressed/head_64.S               |    2 +-
 arch/x86/ia32/ia32_aout.c                        |    8 +-
 arch/x86/include/asm/device.h                    |    2 +-
 arch/x86/include/asm/dma-mapping.h               |   10 +-
 arch/x86/include/asm/iommu.h                     |    2 +-
 arch/x86/include/asm/kvm_host.h                  |    2 +-
 arch/x86/include/asm/microcode.h                 |   14 +-
 arch/x86/include/asm/mmu_context.h               |    2 +-
 arch/x86/include/asm/pci_x86.h                   |   10 +-
 arch/x86/include/asm/smp.h                       |    5 +-
 arch/x86/include/asm/uaccess_32.h                |    4 +
 arch/x86/include/asm/uaccess_64.h                |    6 +
 arch/x86/kernel/acpi/realmode/wakeup.S           |    4 +
 arch/x86/kernel/acpi/sleep.c                     |    2 +-
 arch/x86/kernel/amd_iommu.c                      |    2 +-
 arch/x86/kernel/apic/apic.c                      |    2 +
 arch/x86/kernel/cpu/intel_cacheinfo.c            |    2 +-
 arch/x86/kernel/cpu/mcheck/mce_amd.c             |    2 +-
 arch/x86/kernel/cpu/mtrr/amd.c                   |    2 +-
 arch/x86/kernel/cpu/mtrr/centaur.c               |    2 +-
 arch/x86/kernel/cpu/mtrr/cyrix.c                 |    2 +-
 arch/x86/kernel/cpu/mtrr/generic.c               |    2 +-
 arch/x86/kernel/cpu/mtrr/main.c                  |    6 +-
 arch/x86/kernel/cpu/mtrr/mtrr.h                  |    6 +-
 arch/x86/kernel/cpu/perfctr-watchdog.c           |   12 +-
 arch/x86/kernel/dumpstack.c                      |   10 +-
 arch/x86/kernel/early_printk.c                   |    2 +
 arch/x86/kernel/entry_32.S                       |    2 +-
 arch/x86/kernel/entry_64.S                       |    2 +-
 arch/x86/kernel/head_32.S                        |   24 +-
 arch/x86/kernel/ioport.c                         |   13 +
 arch/x86/kernel/kgdb.c                           |    2 +-
 arch/x86/kernel/microcode_amd.c                  |    4 +-
 arch/x86/kernel/microcode_core.c                 |    2 +-
 arch/x86/kernel/microcode_intel.c                |    4 +-
 arch/x86/kernel/paravirt.c                       |    4 +-
 arch/x86/kernel/pci-calgary_64.c                 |    2 +-
 arch/x86/kernel/pci-dma.c                        |    4 +-
 arch/x86/kernel/pci-gart_64.c                    |    2 +-
 arch/x86/kernel/pci-nommu.c                      |    2 +-
 arch/x86/kernel/pci-swiotlb.c                    |    2 +-
 arch/x86/kernel/process.c                        |    1 +
 arch/x86/kernel/signal.c                         |    2 +
 arch/x86/kernel/smpboot.c                        |    4 +-
 arch/x86/kernel/trampoline_64.S                  |    2 +-
 arch/x86/kernel/verify_cpu.S                     |  140 +
 arch/x86/kernel/verify_cpu_64.S                  |  105 -
 arch/x86/kernel/vm86_32.c                        |   16 +
 arch/x86/kvm/paging_tmpl.h                       |    2 +
 arch/x86/kvm/svm.c                               |    2 +-
 arch/x86/kvm/vmx.c                               |    2 +-
 arch/x86/kvm/x86.c                               |    4 +-
 arch/x86/lib/copy_user_64.S                      |    2 +-
 arch/x86/mm/fault.c                              |   13 +-
 arch/x86/mm/init.c                               |   17 +-
 arch/x86/pci/common.c                            |    4 +-
 arch/x86/pci/direct.c                            |    6 +-
 arch/x86/pci/mmconfig_32.c                       |    2 +-
 arch/x86/pci/mmconfig_64.c                       |    2 +-
 arch/x86/pci/numaq_32.c                          |    2 +-
 arch/x86/pci/olpc.c                              |    2 +-
 arch/x86/pci/pcbios.c                            |    4 +-
 block/blk-integrity.c                            |    2 +-
 block/blk-sysfs.c                                |    2 +-
 block/elevator.c                                 |    2 +-
 crypto/serpent.c                                 |    3 +
 drivers/acpi/battery.c                           |    2 +-
 drivers/acpi/dock.c                              |    4 +-
 drivers/acpi/sleep.c                             |    8 +-
 drivers/acpi/video.c                             |    2 +-
 drivers/ata/ahci.c                               |    8 +-
 drivers/ata/ata_generic.c                        |    2 +-
 drivers/ata/ata_piix.c                           |   10 +-
 drivers/ata/libata-acpi.c                        |    4 +-
 drivers/ata/libata-core.c                        |    6 +-
 drivers/ata/libata-eh.c                          |    4 +-
 drivers/ata/libata-pmp.c                         |    2 +-
 drivers/ata/pata_acpi.c                          |    2 +-
 drivers/ata/pata_ali.c                           |   10 +-
 drivers/ata/pata_amd.c                           |   12 +-
 drivers/ata/pata_artop.c                         |    4 +-
 drivers/ata/pata_at32.c                          |    2 +-
 drivers/ata/pata_at91.c                          |    2 +-
 drivers/ata/pata_atiixp.c                        |    2 +-
 drivers/ata/pata_atp867x.c                       |    2 +-
 drivers/ata/pata_bf54x.c                         |    2 +-
 drivers/ata/pata_cmd640.c                        |    2 +-
 drivers/ata/pata_cmd64x.c                        |    6 +-
 drivers/ata/pata_cs5520.c                        |    2 +-
 drivers/ata/pata_cs5530.c                        |    2 +-
 drivers/ata/pata_cs5535.c                        |    2 +-
 drivers/ata/pata_cs5536.c                        |    2 +-
 drivers/ata/pata_cypress.c                       |    2 +-
 drivers/ata/pata_efar.c                          |    2 +-
 drivers/ata/pata_hpt366.c                        |    2 +-
 drivers/ata/pata_hpt37x.c                        |    8 +-
 drivers/ata/pata_hpt3x2n.c                       |    2 +-
 drivers/ata/pata_hpt3x3.c                        |    2 +-
 drivers/ata/pata_icside.c                        |    2 +-
 drivers/ata/pata_isapnp.c                        |    4 +-
 drivers/ata/pata_it8213.c                        |    2 +-
 drivers/ata/pata_it821x.c                        |    6 +-
 drivers/ata/pata_ixp4xx_cf.c                     |    2 +-
 drivers/ata/pata_jmicron.c                       |    2 +-
 drivers/ata/pata_legacy.c                        |   26 +-
 drivers/ata/pata_marvell.c                       |    2 +-
 drivers/ata/pata_mpc52xx.c                       |    2 +-
 drivers/ata/pata_mpiix.c                         |    2 +-
 drivers/ata/pata_netcell.c                       |    2 +-
 drivers/ata/pata_ninja32.c                       |    2 +-
 drivers/ata/pata_ns87410.c                       |    2 +-
 drivers/ata/pata_ns87415.c                       |    4 +-
 drivers/ata/pata_octeon_cf.c                     |    1 +
 drivers/ata/pata_oldpiix.c                       |    2 +-
 drivers/ata/pata_opti.c                          |    2 +-
 drivers/ata/pata_optidma.c                       |    4 +-
 drivers/ata/pata_palmld.c                        |    2 +-
 drivers/ata/pata_pcmcia.c                        |    6 +-
 drivers/ata/pata_pdc2027x.c                      |    4 +-
 drivers/ata/pata_pdc202xx_old.c                  |    4 +-
 drivers/ata/pata_platform.c                      |    2 +-
 drivers/ata/pata_qdi.c                           |    4 +-
 drivers/ata/pata_radisys.c                       |    2 +-
 drivers/ata/pata_rb532_cf.c                      |    2 +-
 drivers/ata/pata_rdc.c                           |    2 +-
 drivers/ata/pata_rz1000.c                        |    2 +-
 drivers/ata/pata_sc1200.c                        |    2 +-
 drivers/ata/pata_scc.c                           |    2 +-
 drivers/ata/pata_sch.c                           |    2 +-
 drivers/ata/pata_serverworks.c                   |    4 +-
 drivers/ata/pata_sil680.c                        |    2 +-
 drivers/ata/pata_sis.c                           |   14 +-
 drivers/ata/pata_sl82c105.c                      |    2 +-
 drivers/ata/pata_triflex.c                       |    2 +-
 drivers/ata/pata_via.c                           |    4 +-
 drivers/ata/pata_winbond.c                       |    2 +-
 drivers/ata/pdc_adma.c                           |    2 +-
 drivers/ata/sata_fsl.c                           |    2 +-
 drivers/ata/sata_inic162x.c                      |    2 +-
 drivers/ata/sata_mv.c                            |    6 +-
 drivers/ata/sata_nv.c                            |   10 +-
 drivers/ata/sata_promise.c                       |    6 +-
 drivers/ata/sata_qstor.c                         |    2 +-
 drivers/ata/sata_sil.c                           |    2 +-
 drivers/ata/sata_sil24.c                         |    2 +-
 drivers/ata/sata_sis.c                           |    2 +-
 drivers/ata/sata_svw.c                           |    2 +-
 drivers/ata/sata_sx4.c                           |    2 +-
 drivers/ata/sata_uli.c                           |    2 +-
 drivers/ata/sata_via.c                           |   10 +-
 drivers/ata/sata_vsc.c                           |    2 +-
 drivers/atm/solos-pci.c                          |    2 +
 drivers/base/bus.c                               |    6 +-
 drivers/base/class.c                             |    2 +-
 drivers/base/core.c                              |    4 +-
 drivers/base/memory.c                            |    2 +-
 drivers/base/sys.c                               |    4 +-
 drivers/block/DAC960.c                           |    2 +
 drivers/block/cciss.c                            |    2 +
 drivers/block/cpqarray.c                         |    2 +
 drivers/block/nbd.c                              |    4 +
 drivers/block/pktcdvd.c                          |    2 +-
 drivers/char/Kconfig                             |    4 +-
 drivers/char/briq_panel.c                        |    8 +-
 drivers/char/genrtc.c                            |    1 +
 drivers/char/hpet.c                              |    4 +-
 drivers/char/hvc_beat.c                          |    2 +-
 drivers/char/hvc_console.c                       |    6 +-
 drivers/char/hvc_console.h                       |    6 +-
 drivers/char/hvc_iseries.c                       |    2 +-
 drivers/char/hvc_iucv.c                          |    2 +-
 drivers/char/hvc_rtas.c                          |    2 +-
 drivers/char/hvc_udbg.c                          |    2 +-
 drivers/char/hvc_vio.c                           |    2 +-
 drivers/char/hvc_xen.c                           |    2 +-
 drivers/char/ipmi/ipmi_msghandler.c              |    2 +
 drivers/char/istallion.c                         |    6 +-
 drivers/char/keyboard.c                          |   10 +
 drivers/char/mem.c                               |   17 +
 drivers/char/random.c                            |   12 +
 drivers/char/rocket.c                            |    2 +
 drivers/char/stallion.c                          |    2 +
 drivers/char/tpm/tpm.c                           |    2 +
 drivers/char/tty_io.c                            |    1 +
 drivers/char/vt_ioctl.c                          |   13 +-
 drivers/cpufreq/cpufreq.c                        |    2 +-
 drivers/cpuidle/sysfs.c                          |    4 +-
 drivers/crypto/hifn_795x.c                       |    2 +
 drivers/crypto/padlock-aes.c                     |    2 +
 drivers/dma/ioat/dma.c                           |    2 +-
 drivers/dma/ioat/dma.h                           |    2 +-
 drivers/edac/edac_device_sysfs.c                 |    6 +-
 drivers/edac/edac_mc_sysfs.c                     |    4 +-
 drivers/edac/edac_pci_sysfs.c                    |    4 +-
 drivers/firewire/core-transaction.c              |    2 +
 drivers/firmware/edd.c                           |    2 +-
 drivers/firmware/efivars.c                       |    2 +-
 drivers/firmware/iscsi_ibft.c                    |    2 +-
 drivers/firmware/memmap.c                        |    2 +-
 drivers/gpu/drm/drm_crtc_helper.c                |    2 +
 drivers/gpu/drm/drm_info.c                       |   15 +-
 drivers/gpu/drm/i915/dvo.h                       |   16 +-
 drivers/gpu/drm/i915/dvo_ch7017.c                |    2 +-
 drivers/gpu/drm/i915/dvo_ch7xxx.c                |    2 +-
 drivers/gpu/drm/i915/dvo_ivch.c                  |    2 +-
 drivers/gpu/drm/i915/dvo_sil164.c                |    2 +-
 drivers/gpu/drm/i915/dvo_tfp410.c                |    2 +-
 drivers/gpu/drm/i915/i915_drv.c                  |    2 +-
 drivers/gpu/drm/i915/i915_gem.c                  |   10 -
 drivers/gpu/drm/radeon/atom.c                    |    2 +
 drivers/gpu/drm/radeon/radeon_atombios.c         |    2 +
 drivers/gpu/drm/ttm/ttm_bo.c                     |    2 +-
 drivers/gpu/drm/ttm/ttm_memory.c                 |    2 +-
 drivers/ide/ide-floppy.c                         |    2 +
 drivers/ide/setup-pci.c                          |    2 +
 drivers/infiniband/core/cm.c                     |    2 +-
 drivers/infiniband/core/sysfs.c                  |    2 +-
 drivers/infiniband/core/uverbs_marshall.c        |    4 +
 drivers/infiniband/hw/ipath/ipath_fs.c           |    2 +
 drivers/input/joystick/sidewinder.c              |    2 +
 drivers/isdn/hardware/eicon/capidtmf.c           |    1 +
 drivers/isdn/hardware/eicon/capifunc.c           |    2 +
 drivers/isdn/hardware/eicon/diddfunc.c           |    2 +
 drivers/isdn/hardware/eicon/divasfunc.c          |    2 +
 drivers/isdn/hardware/eicon/idifunc.c            |    2 +
 drivers/isdn/hardware/eicon/message.c            |    8 +
 drivers/isdn/hardware/eicon/mntfunc.c            |    2 +
 drivers/isdn/i4l/isdn_common.c                   |    2 +
 drivers/isdn/mISDN/socket.c                      |    2 +
 drivers/isdn/sc/interrupt.c                      |   18 +-
 drivers/macintosh/via-pmu-backlight.c            |    4 +-
 drivers/macintosh/via-pmu.c                      |    2 +-
 drivers/md/dm-sysfs.c                            |    2 +-
 drivers/md/md.c                                  |    7 +-
 drivers/md/raid5.c                               |    1 +
 drivers/media/common/saa7146_hlp.c               |    2 +
 drivers/media/dvb/dvb-core/dvb_ca_en50221.c      |    4 +
 drivers/media/dvb/dvb-usb/dib0700_core.c         |    2 +
 drivers/media/dvb/frontends/or51211.c            |    2 +
 drivers/media/video/cx18/cx18-driver.c           |    2 +
 drivers/media/video/pvrusb2/pvrusb2-eeprom.c     |    2 +
 drivers/media/video/saa7134/saa6752hs.c          |    2 +
 drivers/media/video/saa7164/saa7164-cmd.c        |    4 +
 drivers/media/video/usbvision/usbvision-core.c   |    2 +
 drivers/media/video/videobuf-dma-sg.c            |    2 +
 drivers/message/fusion/mptbase.c                 |    6 +
 drivers/message/i2o/i2o_config.c                 |    2 +
 drivers/mfd/wm8350-i2c.c                         |    2 +
 drivers/misc/kgdbts.c                            |    4 +-
 drivers/misc/sgi-xp/xpc_sn2.c                    |    6 +-
 drivers/misc/sgi-xp/xpc_uv.c                     |    6 +-
 drivers/mtd/chips/cfi_cmdset_0001.c              |    6 +
 drivers/mtd/chips/cfi_cmdset_0020.c              |   10 +
 drivers/mtd/ftl.c                                |    2 +
 drivers/mtd/inftlcore.c                          |    2 +
 drivers/mtd/inftlmount.c                         |    2 +
 drivers/mtd/lpddr/qinfo_probe.c                  |    2 +
 drivers/mtd/mtdchar.c                            |    2 +
 drivers/mtd/nftlcore.c                           |    2 +
 drivers/mtd/nftlmount.c                          |    2 +
 drivers/net/bnx2.c                               |    2 +
 drivers/net/cxgb3/t3_hw.c                        |    2 +
 drivers/net/e1000e/82571.c                       |   10 +-
 drivers/net/e1000e/e1000.h                       |    6 +-
 drivers/net/e1000e/es2lan.c                      |    6 +-
 drivers/net/e1000e/ich8lan.c                     |    6 +-
 drivers/net/hamradio/6pack.c                     |    2 +
 drivers/net/ibmveth.c                            |    2 +-
 drivers/net/igb/e1000_82575.c                    |    6 +-
 drivers/net/iseries_veth.c                       |    4 +-
 drivers/net/ixgb/ixgb_main.c                     |    2 +
 drivers/net/ixgb/ixgb_param.c                    |    3 +
 drivers/net/mlx4/main.c                          |    2 +
 drivers/net/niu.c                                |    2 +
 drivers/net/tulip/de2104x.c                      |    2 +
 drivers/net/vxge/vxge-main.c                     |    4 +
 drivers/net/wan/cycx_x25.c                       |    2 +
 drivers/net/wimax/i2400m/usb-fw.c                |    2 +
 drivers/net/wireless/airo.c                      |   12 +
 drivers/net/wireless/ath/ath5k/debug.c           |    4 +
 drivers/net/wireless/ath/ath9k/debug.c           |    4 +
 drivers/net/wireless/b43/debugfs.c               |    2 +-
 drivers/net/wireless/b43legacy/debugfs.c         |    2 +-
 drivers/net/wireless/ipw2x00/ipw2100.c           |    4 +
 drivers/net/wireless/ipw2x00/libipw_rx.c         |    2 +
 drivers/net/wireless/iwlwifi/iwl-1000.c          |    2 +-
 drivers/net/wireless/iwlwifi/iwl-3945.c          |    2 +-
 drivers/net/wireless/iwlwifi/iwl-4965.c          |    2 +-
 drivers/net/wireless/iwlwifi/iwl-5000.c          |    4 +-
 drivers/net/wireless/iwlwifi/iwl-6000.c          |    2 +-
 drivers/net/wireless/iwlwifi/iwl-agn-rs.c        |    4 +
 drivers/net/wireless/iwlwifi/iwl-debugfs.c       |    4 +
 drivers/net/wireless/iwlwifi/iwl-dev.h           |    2 +-
 drivers/net/wireless/iwmc3200wifi/debugfs.c      |    2 +
 drivers/net/wireless/libertas/debugfs.c          |    2 +-
 drivers/parisc/pdc_stable.c                      |    2 +-
 drivers/pci/hotplug/acpiphp_glue.c               |    2 +-
 drivers/pci/hotplug/fakephp.c                    |    2 +-
 drivers/pci/intel-iommu.c                        |   16 +-
 drivers/pci/proc.c                               |    9 +
 drivers/pci/slot.c                               |    2 +-
 drivers/platform/x86/acer-wmi.c                  |    2 +-
 drivers/platform/x86/asus-laptop.c               |    2 +-
 drivers/platform/x86/asus_acpi.c                 |    2 +-
 drivers/platform/x86/compal-laptop.c             |    2 +-
 drivers/platform/x86/dell-laptop.c               |    2 +-
 drivers/platform/x86/eeepc-laptop.c              |    2 +-
 drivers/platform/x86/fujitsu-laptop.c            |    2 +-
 drivers/platform/x86/msi-laptop.c                |    2 +-
 drivers/platform/x86/panasonic-laptop.c          |    2 +-
 drivers/platform/x86/sony-laptop.c               |    2 +-
 drivers/platform/x86/thinkpad_acpi.c             |    2 +-
 drivers/platform/x86/toshiba_acpi.c              |    2 +-
 drivers/rtc/rtc-dev.c                            |    3 +
 drivers/scsi/BusLogic.c                          |    2 +
 drivers/scsi/aacraid/commctrl.c                  |    1 +
 drivers/scsi/aic94xx/aic94xx_init.c              |    2 +-
 drivers/scsi/dpt_i2o.c                           |    4 +
 drivers/scsi/eata.c                              |    2 +
 drivers/scsi/fcoe/libfcoe.c                      |    2 +
 drivers/scsi/gdth.c                              |    9 +
 drivers/scsi/gdth_proc.c                         |    5 +
 drivers/scsi/ipr.c                               |    2 +-
 drivers/scsi/libsas/sas_ata.c                    |    2 +-
 drivers/scsi/lpfc/lpfc_debugfs.c                 |    2 +
 drivers/scsi/megaraid/megaraid_mbox.c            |    2 +
 drivers/scsi/osd/osd_initiator.c                 |    2 +
 drivers/scsi/scsi_debug.c                        |    4 +
 drivers/scsi/sg.c                                |    2 +-
 drivers/scsi/sym53c8xx_2/sym_glue.c              |    2 +
 drivers/serial/kgdboc.c                          |    4 +-
 drivers/staging/android/binder.c                 |    2 +-
 drivers/staging/b3dfg/b3dfg.c                    |    4 +-
 drivers/staging/comedi/comedi_fops.c             |    2 +-
 drivers/staging/dream/qdsp5/adsp_driver.c        |    2 +-
 drivers/staging/dream/qdsp5/audio_aac.c          |    2 +-
 drivers/staging/dream/qdsp5/audio_amrnb.c        |    2 +-
 drivers/staging/dream/qdsp5/audio_evrc.c         |    2 +-
 drivers/staging/dream/qdsp5/audio_in.c           |    4 +-
 drivers/staging/dream/qdsp5/audio_mp3.c          |    2 +-
 drivers/staging/dream/qdsp5/audio_out.c          |    4 +-
 drivers/staging/dream/qdsp5/audio_qcelp.c        |    2 +-
 drivers/staging/dream/qdsp5/snd.c                |    2 +-
 drivers/staging/dream/smd/smd_qmi.c              |    2 +-
 drivers/staging/dream/smd/smd_rpcrouter_device.c |    4 +-
 drivers/staging/dst/dcore.c                      |    2 +-
 drivers/staging/go7007/go7007-v4l2.c             |    2 +-
 drivers/staging/hv/blkvsc_drv.c                  |    2 +-
 drivers/staging/panel/panel.c                    |    4 +-
 drivers/staging/phison/phison.c                  |    2 +-
 drivers/staging/poch/poch.c                      |    2 +-
 drivers/staging/sep/sep_driver.c                 |    2 +-
 drivers/staging/vme/devices/vme_user.c           |    2 +-
 drivers/telephony/ixj.c                          |    2 +
 drivers/uio/uio.c                                |    4 +-
 drivers/usb/core/hcd.c                           |    4 +-
 drivers/usb/core/hcd.h                           |   10 +-
 drivers/usb/misc/appledisplay.c                  |    2 +-
 drivers/usb/mon/mon_main.c                       |    2 +-
 drivers/uwb/wlp/sysfs.c                          |    3 +-
 drivers/video/atmel_lcdfb.c                      |    2 +-
 drivers/video/aty/aty128fb.c                     |    2 +-
 drivers/video/aty/atyfb_base.c                   |    2 +-
 drivers/video/aty/radeon_backlight.c             |    2 +-
 drivers/video/backlight/adp5520_bl.c             |    2 +-
 drivers/video/backlight/adx_bl.c                 |    2 +-
 drivers/video/backlight/atmel-pwm-bl.c           |    2 +-
 drivers/video/backlight/backlight.c              |    2 +-
 drivers/video/backlight/corgi_lcd.c              |    2 +-
 drivers/video/backlight/cr_bllcd.c               |    2 +-
 drivers/video/backlight/da903x_bl.c              |    2 +-
 drivers/video/backlight/generic_bl.c             |    2 +-
 drivers/video/backlight/hp680_bl.c               |    2 +-
 drivers/video/backlight/jornada720_bl.c          |    2 +-
 drivers/video/backlight/kb3886_bl.c              |    2 +-
 drivers/video/backlight/locomolcd.c              |    2 +-
 drivers/video/backlight/mbp_nvidia_bl.c          |    2 +-
 drivers/video/backlight/omap1_bl.c               |    2 +-
 drivers/video/backlight/progear_bl.c             |    2 +-
 drivers/video/backlight/pwm_bl.c                 |    2 +-
 drivers/video/backlight/tosa_bl.c                |    2 +-
 drivers/video/backlight/wm831x_bl.c              |    2 +-
 drivers/video/bf54x-lq043fb.c                    |    2 +-
 drivers/video/bfin-t350mcqb-fb.c                 |    2 +-
 drivers/video/fbmem.c                            |    4 +
 drivers/video/logo/logo_linux_clut224.ppm        | 2721 ++++++---------
 drivers/video/nvidia/nv_backlight.c              |    2 +-
 drivers/video/riva/fbdev.c                       |    2 +-
 drivers/xen/sys-hypervisor.c                     |    2 +-
 fs/aio.c                                         |    2 +
 fs/attr.c                                        |    1 +
 fs/binfmt_aout.c                                 |   11 +-
 fs/binfmt_elf.c                                  |   31 +-
 fs/btrfs/disk-io.c                               |    4 +-
 fs/btrfs/extent-tree.c                           |    4 +
 fs/btrfs/extent_io.h                             |   30 +-
 fs/btrfs/inode.c                                 |   17 +-
 fs/btrfs/sysfs.c                                 |    4 +-
 fs/buffer.c                                      |    1 +
 fs/cifs/cifs_debug.c                             |    8 +-
 fs/compat.c                                      |   94 +-
 fs/dlm/lockspace.c                               |    2 +-
 fs/exec.c                                        |  104 +-
 fs/ext2/balloc.c                                 |    2 +-
 fs/ext3/balloc.c                                 |    2 +-
 fs/ext4/balloc.c                                 |    2 +-
 fs/ext4/file.c                                   |    4 +-
 fs/ext4/mballoc.c                                |    2 +
 fs/ext4/super.c                                  |    2 +-
 fs/fcntl.c                                       |    6 +
 fs/file.c                                        |    3 +
 fs/filesystems.c                                 |    5 +
 fs/fs_struct.c                                   |    6 +
 fs/gfs2/ops_inode.c                              |    2 +
 fs/gfs2/sys.c                                    |    4 +-
 fs/hfs/btree.c                                   |   21 +-
 fs/hfsplus/catalog.c                             |    6 +
 fs/hfsplus/dir.c                                 |    2 +
 fs/hfsplus/inode.c                               |    4 +
 fs/hfsplus/ioctl.c                               |    4 +
 fs/hfsplus/super.c                               |    2 +
 fs/hugetlbfs/inode.c                             |    2 +-
 fs/jbd/checkpoint.c                              |    2 +
 fs/jffs2/compr_rtime.c                           |    4 +
 fs/jffs2/compr_rubin.c                           |    2 +
 fs/jffs2/xattr.c                                 |    2 +
 fs/lockd/clntproc.c                              |    2 +
 fs/lockd/svc.c                                   |    2 +-
 fs/locks.c                                       |   30 +-
 fs/namei.c                                       |  203 +-
 fs/namespace.c                                   |   25 +
 fs/ncpfs/dir.c                                   |   14 +-
 fs/ncpfs/inode.c                                 |    2 +
 fs/nfsd/lockd.c                                  |    2 +-
 fs/nfsd/nfs4state.c                              |    2 +
 fs/nfsd/nfs4xdr.c                                |    2 +
 fs/notify/dnotify/dnotify.c                      |    2 +-
 fs/ocfs2/cluster/masklog.c                       |    2 +-
 fs/ocfs2/namei.c                                 |    2 +
 fs/open.c                                        |   67 +-
 fs/partitions/ldm.c                              |    3 +-
 fs/partitions/mac.c                              |    2 +-
 fs/pipe.c                                        |    2 +-
 fs/proc/Kconfig                                  |   10 +-
 fs/proc/array.c                                  |   49 +-
 fs/proc/base.c                                   |  194 +-
 fs/proc/cmdline.c                                |    4 +
 fs/proc/devices.c                                |    4 +
 fs/proc/inode.c                                  |   18 +
 fs/proc/internal.h                               |    3 +
 fs/proc/kcore.c                                  |    5 +
 fs/proc/meminfo.c                                |    2 +
 fs/proc/proc_net.c                               |   11 +
 fs/proc/proc_sysctl.c                            |   26 +-
 fs/proc/root.c                                   |    8 +
 fs/proc/task_mmu.c                               |   43 +-
 fs/readdir.c                                     |   19 +
 fs/reiserfs/dir.c                                |    2 +
 fs/reiserfs/item_ops.c                           |   12 +-
 fs/reiserfs/journal.c                            |    2 +
 fs/reiserfs/namei.c                              |    2 +
 fs/reiserfs/procfs.c                             |    2 +
 fs/reiserfs/stree.c                              |   10 +
 fs/reiserfs/super.c                              |    2 +
 fs/select.c                                      |    8 +
 fs/splice.c                                      |    6 +
 fs/sysfs/file.c                                  |    8 +-
 fs/sysfs/mount.c                                 |    4 +
 fs/udf/inode.c                                   |    2 +
 fs/utimes.c                                      |    7 +
 fs/xattr.c                                       |   20 +-
 fs/xfs/linux-2.6/xfs_ioctl.c                     |    2 +-
 fs/xfs/linux-2.6/xfs_ioctl32.c                   |    1 +
 fs/xfs/xfs_vnodeops.c                            |   10 +-
 grsecurity/Kconfig                               | 1036 ++++++
 grsecurity/Makefile                              |   36 +
 grsecurity/gracl.c                               | 4141 ++++++++++++++++++++++
 grsecurity/gracl_alloc.c                         |  105 +
 grsecurity/gracl_cap.c                           |  101 +
 grsecurity/gracl_fs.c                            |  433 +++
 grsecurity/gracl_ip.c                            |  382 ++
 grsecurity/gracl_learn.c                         |  208 ++
 grsecurity/gracl_res.c                           |   67 +
 grsecurity/gracl_segv.c                          |  284 ++
 grsecurity/gracl_shm.c                           |   40 +
 grsecurity/grsec_chdir.c                         |   19 +
 grsecurity/grsec_chroot.c                        |  386 ++
 grsecurity/grsec_disabled.c                      |  439 +++
 grsecurity/grsec_exec.c                          |  204 ++
 grsecurity/grsec_fifo.c                          |   24 +
 grsecurity/grsec_fork.c                          |   23 +
 grsecurity/grsec_init.c                          |  270 ++
 grsecurity/grsec_link.c                          |   43 +
 grsecurity/grsec_log.c                           |  322 ++
 grsecurity/grsec_mem.c                           |   33 +
 grsecurity/grsec_mount.c                         |   62 +
 grsecurity/grsec_pax.c                           |   36 +
 grsecurity/grsec_ptrace.c                        |   14 +
 grsecurity/grsec_sig.c                           |  205 ++
 grsecurity/grsec_sock.c                          |  275 ++
 grsecurity/grsec_sysctl.c                        |  479 +++
 grsecurity/grsec_time.c                          |   16 +
 grsecurity/grsec_tpe.c                           |   39 +
 grsecurity/grsum.c                               |   61 +
 include/acpi/acpi_drivers.h                      |    8 +-
 include/asm-generic/bug.h                        |    4 +-
 include/asm-generic/dma-mapping-common.h         |   24 +-
 include/asm-generic/emergency-restart.h          |    2 +-
 include/drm/drmP.h                               |    4 +-
 include/linux/backlight.h                        |   12 +-
 include/linux/capability.h                       |    1 +
 include/linux/dma-mapping.h                      |   28 +-
 include/linux/fs.h                               |   98 +-
 include/linux/gracl.h                            |  317 ++
 include/linux/gralloc.h                          |    9 +
 include/linux/grdefs.h                           |  140 +
 include/linux/grinternal.h                       |  218 ++
 include/linux/grmsg.h                            |  108 +
 include/linux/grsecurity.h                       |  218 ++
 include/linux/kallsyms.h                         |   12 +-
 include/linux/kgdb.h                             |    6 +-
 include/linux/kmod.h                             |    2 +
 include/linux/kobject.h                          |   14 +-
 include/linux/libata.h                           |   12 +-
 include/linux/lockd/bind.h                       |    6 +-
 include/linux/netfilter/xt_gradm.h               |    9 +
 include/linux/pagemap.h                          |    1 +
 include/linux/proc_fs.h                          |   13 +
 include/linux/ptrace.h                           |    4 +-
 include/linux/reiserfs_fs.h                      |   24 +-
 include/linux/sched.h                            |   61 +-
 include/linux/security.h                         |    1 +
 include/linux/shm.h                              |    4 +
 include/linux/skbuff.h                           |    1 +
 include/linux/suspend.h                          |   46 +-
 include/linux/sysctl.h                           |    3 +
 include/linux/sysfs.h                            |    4 +-
 include/linux/tty.h                              |    1 -
 include/linux/vermagic.h                         |    9 +-
 include/net/netlink.h                            |    2 +-
 include/net/secure_seq.h                         |    8 +-
 include/net/sock.h                               |    2 +-
 include/sound/ac97_codec.h                       |   16 +-
 init/main.c                                      |    3 +
 ipc/mqueue.c                                     |    1 +
 ipc/sem.c                                        |    4 +
 ipc/shm.c                                        |   28 +
 kernel/audit.c                                   |    6 +-
 kernel/capability.c                              |   18 +-
 kernel/cgroup.c                                  |    2 +
 kernel/configs.c                                 |   11 +
 kernel/cred.c                                    |   36 +-
 kernel/exit.c                                    |   54 +-
 kernel/fork.c                                    |   16 +-
 kernel/futex.c                                   |   12 +
 kernel/futex_compat.c                            |   11 +-
 kernel/kallsyms.c                                |    8 +
 kernel/kgdb.c                                    |    6 +-
 kernel/kmod.c                                    |   65 +-
 kernel/module.c                                  |   70 +-
 kernel/panic.c                                   |    4 +-
 kernel/params.c                                  |    4 +-
 kernel/pid.c                                     |   15 +-
 kernel/posix-cpu-timers.c                        |    1 +
 kernel/posix-timers.c                            |   12 +-
 kernel/power/hibernate.c                         |    4 +-
 kernel/power/suspend.c                           |    4 +-
 kernel/printk.c                                  |    5 +
 kernel/ptrace.c                                  |   52 +-
 kernel/relay.c                                   |    2 +
 kernel/resource.c                                |   10 +
 kernel/sched.c                                   |   10 +-
 kernel/signal.c                                  |   39 +-
 kernel/softirq.c                                 |    2 +-
 kernel/sys.c                                     |   49 +-
 kernel/sysctl.c                                  |   88 +-
 kernel/sysctl_check.c                            |    2 +
 kernel/taskstats.c                               |    6 +
 kernel/time.c                                    |    5 +
 kernel/time/timekeeping.c                        |    3 +
 kernel/time/timer_list.c                         |   12 +
 kernel/time/timer_stats.c                        |    8 +
 kernel/trace/trace.c                             |    4 +
 kernel/trace/trace_workqueue.c                   |    2 +-
 kernel/user.c                                    |    1 +
 lib/Kconfig.debug                                |    2 +-
 lib/kobject.c                                    |    6 +-
 lib/kobject_uevent.c                             |    2 +-
 lib/vsprintf.c                                   |   15 +-
 localversion-grsec                               |    1 +
 mm/Kconfig                                       |    6 +-
 mm/backing-dev.c                                 |    2 +-
 mm/filemap.c                                     |    1 +
 mm/kmemleak.c                                    |    2 +-
 mm/mempolicy.c                                   |   11 +-
 mm/migrate.c                                     |   13 +-
 mm/mlock.c                                       |    3 +
 mm/mmap.c                                        |   28 +-
 mm/mprotect.c                                    |    8 +
 mm/page_alloc.c                                  |    2 +
 mm/shmem.c                                       |    4 +-
 mm/slab.c                                        |   10 +-
 mm/slub.c                                        |   20 +-
 mm/vmstat.c                                      |   18 +-
 net/atm/mpoa_caches.c                            |    2 +
 net/atm/proc.c                                   |    9 +
 net/bridge/br_private.h                          |    2 +-
 net/bridge/br_sysfs_if.c                         |    2 +-
 net/bridge/netfilter/ebtables.c                  |    2 +
 net/can/bcm.c                                    |    6 +
 net/core/dev.c                                   |    4 +
 net/core/secure_seq.c                            |    3 +-
 net/core/skbuff.c                                |    2 +
 net/econet/Kconfig                               |    2 +-
 net/ipv4/inet_diag.c                             |   20 +
 net/ipv4/inet_hashtables.c                       |    5 +
 net/ipv4/inetpeer.c                              |    2 +
 net/ipv4/ip_sockglue.c                           |    2 +
 net/ipv4/netfilter/arp_tables.c                  |    1 +
 net/ipv4/netfilter/ip_queue.c                    |    6 +-
 net/ipv4/netfilter/ip_tables.c                   |    1 +
 net/ipv4/raw.c                                   |   14 +-
 net/ipv4/tcp.c                                   |    4 +
 net/ipv4/tcp_ipv4.c                              |   41 +-
 net/ipv4/tcp_minisocks.c                         |    8 +
 net/ipv4/tcp_output.c                            |    2 +
 net/ipv4/tcp_timer.c                             |   11 +
 net/ipv4/udp.c                                   |   31 +-
 net/ipv6/ipv6_sockglue.c                         |    4 +
 net/ipv6/netfilter/ip6_queue.c                   |    6 +-
 net/ipv6/netfilter/ip6_tables.c                  |    1 +
 net/ipv6/raw.c                                   |   12 +-
 net/ipv6/tcp_ipv6.c                              |   46 +-
 net/ipv6/udp.c                                   |   14 +-
 net/key/af_key.c                                 |    6 +
 net/mac80211/cfg.c                               |    2 +-
 net/mac80211/cfg.h                               |    2 +-
 net/mac80211/debugfs_key.c                       |    6 +-
 net/mac80211/debugfs_sta.c                       |    2 +
 net/mac80211/mlme.c                              |    2 +
 net/netfilter/Kconfig                            |   10 +
 net/netfilter/Makefile                           |    1 +
 net/netfilter/ipvs/ip_vs_ctl.c                   |    2 +
 net/netfilter/xt_gradm.c                         |   51 +
 net/netlink/af_netlink.c                         |    8 +
 net/netrom/af_netrom.c                           |    2 +-
 net/packet/af_packet.c                           |    4 +
 net/phonet/af_phonet.c                           |    4 +-
 net/phonet/socket.c                              |    7 +-
 net/rds/Kconfig                                  |    2 +-
 net/rds/iw_rdma.c                                |    2 +
 net/rxrpc/ar-ack.c                               |    2 +
 net/rxrpc/ar-key.c                               |    8 +-
 net/rxrpc/rxkad.c                                |    4 +
 net/sctp/proc.c                                  |   14 +-
 net/socket.c                                     |   77 +-
 net/sysctl_net.c                                 |    2 +-
 net/unix/af_unix.c                               |   24 +
 net/xfrm/xfrm_user.c                             |    4 +
 samples/kobject/kset-example.c                   |    2 +-
 security/Kconfig                                 |  101 +-
 security/commoncap.c                             |   14 +-
 security/min_addr.c                              |    2 +
 security/security.c                              |    4 +-
 security/selinux/ss/services.c                   |    2 +
 sound/pci/ac97/ac97_codec.c                      |    2 +-
 sound/pci/ac97/ac97_patch.c                      |   64 +-
 tools/gcc/Makefile                               |    2 +-
 743 files changed, 15840 insertions(+), 2861 deletions(-)

commit 6536f7d9837920f0cba1a3071e707c8d9cec03c2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 3 20:21:33 2011 -0500

    Import of pax-linux-2.6.32.48-test130.patch

 arch/x86/include/asm/uaccess_64.h |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit aec65dc958432a54264c94bbfd947e234aa14869
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 10 19:49:18 2011 -0500

    Import changes from pax-linux-2.6.32.50-test133.patch

 arch/x86/include/asm/pgtable_64.h |    3 ++-
 arch/x86/xen/mmu.c                |    6 ++++--
 mm/vmalloc.c                      |    3 ++-
 3 files changed, 8 insertions(+), 4 deletions(-)

commit 290e037ede8cb6ed9214469aea9f72f781fc6fea
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 10 17:57:43 2011 -0500

    Fix PaX build error on x64

 arch/x86/lib/rwlock_64.S |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit f470e9ac2d237bab10bdcb057bb35d5e2bbc1fb8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 10 16:30:30 2011 -0500

    Import changes from pax-linux-2.6.32.48-test132.patch

 arch/x86/include/asm/uaccess_64.h |   45 ++++++++++++++++++-------------------
 arch/x86/kernel/entry_64.S        |    7 ++---
 arch/x86/kernel/head_64.S         |   13 +++++++++-
 arch/x86/lib/rwlock_64.S          |   40 ++++++++++++++++++++++++++++++++
 arch/x86/lib/usercopy_64.c        |    4 +-
 fs/partitions/efi.c               |    8 +++---
 include/asm-generic/atomic64.h    |   12 ++++++++++
 tools/gcc/constify_plugin.c       |    6 ++--
 tools/gcc/stackleak_plugin.c      |    6 ++--
 9 files changed, 100 insertions(+), 41 deletions(-)

commit 165d4688063c2793d2730e15d4c02450e6c55325
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Dec 4 17:05:21 2011 -0500

    Import changes from pax-linux-2.6.32.48-test131.patch

 arch/x86/include/asm/alternative-asm.h |    2 +-
 arch/x86/kernel/entry_64.S             |   43 ++++++++++++++++++++------------
 2 files changed, 28 insertions(+), 17 deletions(-)

commit 99b49cb6a851b4b85fb0fb78d6e3573f86d35112
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 3 20:25:39 2011 -0500

    Port pax-linux-2.6.32.48-test130.patch to 2.6.32.49 kernel

 include/linux/vmalloc.h |    5 +++++
 mm/vmalloc.c            |    7 +++++++
 2 files changed, 12 insertions(+), 0 deletions(-)

commit 02e2d04453c2ef47294dad8cd4f79f38566389a2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Dec 3 20:21:33 2011 -0500

    Import of pax-linux-2.6.32.48-test130.patch

 Documentation/dontdiff                             |   36 ++-
 Documentation/kernel-parameters.txt                |    7 +
 Makefile                                           |   76 ++-
 arch/alpha/include/asm/elf.h                       |    7 +
 arch/alpha/include/asm/pgtable.h                   |   11 +
 arch/alpha/kernel/module.c                         |    2 +-
 arch/alpha/kernel/osf_sys.c                        |   10 +-
 arch/alpha/mm/fault.c                              |  141 +++++-
 arch/arm/include/asm/elf.h                         |    9 +-
 arch/arm/include/asm/kmap_types.h                  |    1 +
 arch/arm/include/asm/uaccess.h                     |   27 +-
 arch/arm/kernel/armksyms.c                         |    4 +-
 arch/arm/lib/copy_from_user.S                      |    6 +-
 arch/arm/lib/copy_to_user.S                        |    6 +-
 arch/arm/lib/uaccess.S                             |   12 +-
 arch/arm/lib/uaccess_with_memcpy.c                 |    2 +-
 arch/arm/mm/fault.c                                |   34 ++
 arch/arm/mm/mmap.c                                 |   19 +-
 arch/avr32/include/asm/elf.h                       |    8 +-
 arch/avr32/include/asm/kmap_types.h                |    3 +-
 arch/avr32/mm/fault.c                              |   27 +
 arch/frv/include/asm/kmap_types.h                  |    1 +
 arch/frv/mm/elf-fdpic.c                            |    7 +-
 arch/ia64/ia32/binfmt_elf32.c                      |    7 +
 arch/ia64/ia32/ia32priv.h                          |    9 +-
 arch/ia64/include/asm/elf.h                        |    7 +
 arch/ia64/include/asm/pgtable.h                    |   13 +-
 arch/ia64/include/asm/spinlock.h                   |    2 +-
 arch/ia64/include/asm/uaccess.h                    |    4 +-
 arch/ia64/kernel/module.c                          |   48 ++-
 arch/ia64/kernel/pci-dma.c                         |   10 +-
 arch/ia64/kernel/sys_ia64.c                        |   13 +-
 arch/ia64/kernel/vmlinux.lds.S                     |    2 +-
 arch/ia64/mm/fault.c                               |   33 +-
 arch/ia64/mm/hugetlbpage.c                         |    2 +-
 arch/ia64/mm/init.c                                |   13 +
 arch/m32r/lib/usercopy.c                           |    6 +
 arch/mips/include/asm/elf.h                        |    7 +
 arch/mips/include/asm/page.h                       |    2 +-
 arch/mips/include/asm/system.h                     |    2 +-
 arch/mips/kernel/binfmt_elfn32.c                   |    7 +
 arch/mips/kernel/binfmt_elfo32.c                   |    7 +
 arch/mips/kernel/process.c                         |   12 -
 arch/mips/kernel/syscall.c                         |   12 +-
 arch/mips/mm/fault.c                               |   17 +
 arch/parisc/include/asm/elf.h                      |    7 +
 arch/parisc/include/asm/pgtable.h                  |   11 +
 arch/parisc/kernel/module.c                        |   50 ++-
 arch/parisc/kernel/sys_parisc.c                    |    6 +-
 arch/parisc/kernel/traps.c                         |    4 +-
 arch/parisc/mm/fault.c                             |  140 +++++-
 arch/powerpc/include/asm/elf.h                     |   18 +-
 arch/powerpc/include/asm/kmap_types.h              |    1 +
 arch/powerpc/include/asm/page.h                    |    8 +-
 arch/powerpc/include/asm/page_64.h                 |    7 +-
 arch/powerpc/include/asm/pgtable.h                 |    1 +
 arch/powerpc/include/asm/pte-hash32.h              |    1 +
 arch/powerpc/include/asm/reg.h                     |    1 +
 arch/powerpc/include/asm/system.h                  |    2 +-
 arch/powerpc/include/asm/uaccess.h                 |  142 +++--
 arch/powerpc/kernel/exceptions-64e.S               |    4 +-
 arch/powerpc/kernel/exceptions-64s.S               |    2 +-
 arch/powerpc/kernel/kgdb.c                         |    2 +-
 arch/powerpc/kernel/module.c                       |   20 +
 arch/powerpc/kernel/module_32.c                    |   13 +-
 arch/powerpc/kernel/process.c                      |   55 --
 arch/powerpc/kernel/signal_32.c                    |    2 +-
 arch/powerpc/kernel/signal_64.c                    |    2 +-
 arch/powerpc/kernel/sys_ppc32.c                    |    4 +-
 arch/powerpc/kernel/vdso.c                         |    5 +-
 arch/powerpc/kernel/vio.c                          |    3 +-
 arch/powerpc/lib/usercopy_64.c                     |   18 -
 arch/powerpc/mm/fault.c                            |   55 ++-
 arch/powerpc/mm/mmap_64.c                          |   12 +
 arch/powerpc/mm/slice.c                            |   23 +-
 arch/powerpc/platforms/pseries/Kconfig             |    2 +
 arch/s390/Kconfig                                  |   18 +-
 arch/s390/include/asm/elf.h                        |    7 +
 arch/s390/include/asm/setup.h                      |    4 +-
 arch/s390/include/asm/uaccess.h                    |   11 +
 arch/s390/kernel/module.c                          |   22 +-
 arch/s390/kernel/setup.c                           |   32 -
 arch/s390/mm/mmap.c                                |   24 +
 arch/score/include/asm/system.h                    |    2 +-
 arch/score/kernel/process.c                        |    5 -
 arch/sh/mm/mmap.c                                  |   24 +-
 arch/sparc/include/asm/atomic_64.h                 |  108 ++++-
 arch/sparc/include/asm/cache.h                     |    2 +-
 arch/sparc/include/asm/elf_32.h                    |    7 +
 arch/sparc/include/asm/elf_64.h                    |    6 +
 arch/sparc/include/asm/pgtable_32.h                |   17 +
 arch/sparc/include/asm/pgtsrmmu.h                  |    7 +
 arch/sparc/include/asm/spinlock_64.h               |   31 +-
 arch/sparc/include/asm/thread_info_32.h            |    2 +
 arch/sparc/include/asm/thread_info_64.h            |    2 +
 arch/sparc/include/asm/uaccess.h                   |    8 +
 arch/sparc/include/asm/uaccess_32.h                |   27 +-
 arch/sparc/include/asm/uaccess_64.h                |   19 +-
 arch/sparc/kernel/Makefile                         |    2 +-
 arch/sparc/kernel/sys_sparc_32.c                   |    4 +-
 arch/sparc/kernel/sys_sparc_64.c                   |   52 +-
 arch/sparc/kernel/traps_64.c                       |   13 +-
 arch/sparc/kernel/una_asm_64.S                     |    2 +-
 arch/sparc/lib/Makefile                            |    2 +-
 arch/sparc/lib/atomic_64.S                         |  148 +++++-
 arch/sparc/lib/ksyms.c                             |    6 +
 arch/sparc/lib/rwsem_64.S                          |   49 ++-
 arch/sparc/mm/Makefile                             |    2 +-
 arch/sparc/mm/fault_32.c                           |  282 +++++++++
 arch/sparc/mm/fault_64.c                           |  476 +++++++++++++++
 arch/sparc/mm/hugetlbpage.c                        |   16 +-
 arch/sparc/mm/init_32.c                            |   15 +-
 arch/sparc/mm/srmmu.c                              |    7 +
 arch/um/Makefile                                   |    4 +
 arch/um/include/asm/kmap_types.h                   |    1 +
 arch/um/include/asm/page.h                         |    3 +
 arch/um/kernel/process.c                           |   16 -
 arch/um/sys-i386/shared/sysdep/system.h            |    2 +-
 arch/um/sys-i386/syscalls.c                        |   15 +
 arch/um/sys-x86_64/shared/sysdep/system.h          |    2 +-
 arch/x86/Kconfig                                   |    9 +-
 arch/x86/Kconfig.cpu                               |    6 +-
 arch/x86/Kconfig.debug                             |    2 +-
 arch/x86/Makefile                                  |   10 +
 arch/x86/boot/Makefile                             |    3 +
 arch/x86/boot/bitops.h                             |    4 +-
 arch/x86/boot/boot.h                               |    4 +-
 arch/x86/boot/compressed/Makefile                  |    3 +
 arch/x86/boot/compressed/head_32.S                 |    7 +-
 arch/x86/boot/compressed/head_64.S                 |    4 +-
 arch/x86/boot/compressed/misc.c                    |    4 +-
 arch/x86/boot/compressed/mkpiggy.c                 |    2 +-
 arch/x86/boot/compressed/relocs.c                  |   86 +++-
 arch/x86/boot/cpucheck.c                           |   28 +-
 arch/x86/boot/header.S                             |    2 +-
 arch/x86/boot/memory.c                             |    2 +-
 arch/x86/boot/video-vesa.c                         |    1 +
 arch/x86/boot/video.c                              |    2 +-
 arch/x86/crypto/aes-x86_64-asm_64.S                |    4 +
 arch/x86/crypto/aesni-intel_asm.S                  |   23 +
 arch/x86/crypto/salsa20-x86_64-asm_64.S            |    5 +
 arch/x86/crypto/twofish-x86_64-asm_64.S            |    3 +
 arch/x86/ia32/ia32_signal.c                        |   20 +-
 arch/x86/ia32/ia32entry.S                          |  130 +++--
 arch/x86/ia32/sys_ia32.c                           |   16 +-
 arch/x86/include/asm/alternative-asm.h             |   39 ++
 arch/x86/include/asm/alternative.h                 |    2 +-
 arch/x86/include/asm/apic.h                        |    2 +-
 arch/x86/include/asm/apm.h                         |    4 +-
 arch/x86/include/asm/atomic_32.h                   |  337 +++++++++++-
 arch/x86/include/asm/atomic_64.h                   |  446 ++++++++++++++-
 arch/x86/include/asm/bitops.h                      |    2 +-
 arch/x86/include/asm/boot.h                        |    7 +-
 arch/x86/include/asm/cache.h                       |    3 +-
 arch/x86/include/asm/cacheflush.h                  |    4 +-
 arch/x86/include/asm/calling.h                     |   42 +-
 arch/x86/include/asm/checksum_32.h                 |   12 +-
 arch/x86/include/asm/desc.h                        |   62 ++-
 arch/x86/include/asm/desc_defs.h                   |    6 +
 arch/x86/include/asm/device.h                      |    2 +-
 arch/x86/include/asm/e820.h                        |    2 +-
 arch/x86/include/asm/elf.h                         |   27 +-
 arch/x86/include/asm/emergency-restart.h           |    2 +-
 arch/x86/include/asm/futex.h                       |   20 +-
 arch/x86/include/asm/hw_irq.h                      |    4 +-
 arch/x86/include/asm/i387.h                        |   21 +-
 arch/x86/include/asm/io_32.h                       |   12 +
 arch/x86/include/asm/io_64.h                       |   11 +
 arch/x86/include/asm/irqflags.h                    |    5 +
 arch/x86/include/asm/kprobes.h                     |    9 +-
 arch/x86/include/asm/kvm_host.h                    |    2 +-
 arch/x86/include/asm/local.h                       |   94 +++-
 arch/x86/include/asm/mman.h                        |   10 +
 arch/x86/include/asm/mmu.h                         |   17 +-
 arch/x86/include/asm/mmu_context.h                 |   76 +++-
 arch/x86/include/asm/module.h                      |   28 +-
 arch/x86/include/asm/page_64_types.h               |    2 +-
 arch/x86/include/asm/paravirt.h                    |   44 ++-
 arch/x86/include/asm/paravirt_types.h              |   19 +-
 arch/x86/include/asm/percpu.h                      |    1 +
 arch/x86/include/asm/pgalloc.h                     |    7 +
 arch/x86/include/asm/pgtable-2level.h              |    2 +
 arch/x86/include/asm/pgtable-3level.h              |    4 +
 arch/x86/include/asm/pgtable.h                     |  110 ++++-
 arch/x86/include/asm/pgtable_32.h                  |   14 +-
 arch/x86/include/asm/pgtable_32_types.h            |   15 +-
 arch/x86/include/asm/pgtable_64.h                  |   16 +-
 arch/x86/include/asm/pgtable_64_types.h            |    5 +
 arch/x86/include/asm/pgtable_types.h               |   44 +-
 arch/x86/include/asm/processor.h                   |   35 +-
 arch/x86/include/asm/ptrace.h                      |   13 +-
 arch/x86/include/asm/reboot.h                      |   12 +-
 arch/x86/include/asm/rwsem.h                       |   68 +++-
 arch/x86/include/asm/segment.h                     |   24 +-
 arch/x86/include/asm/smp.h                         |   14 +-
 arch/x86/include/asm/spinlock.h                    |   37 ++-
 arch/x86/include/asm/stackprotector.h              |    4 +-
 arch/x86/include/asm/system.h                      |   10 +-
 arch/x86/include/asm/thread_info.h                 |   81 ++--
 arch/x86/include/asm/uaccess.h                     |   94 +++-
 arch/x86/include/asm/uaccess_32.h                  |   79 +++-
 arch/x86/include/asm/uaccess_64.h                  |  241 ++++++--
 arch/x86/include/asm/vdso.h                        |    2 +-
 arch/x86/include/asm/vgtod.h                       |    1 +
 arch/x86/include/asm/vmi.h                         |    1 +
 arch/x86/include/asm/vmi_time.h                    |    2 +-
 arch/x86/include/asm/vsyscall.h                    |    7 +-
 arch/x86/include/asm/x86_init.h                    |   18 +-
 arch/x86/include/asm/xsave.h                       |   13 +-
 arch/x86/kernel/acpi/realmode/Makefile             |    3 +
 arch/x86/kernel/acpi/realmode/wakeup.S             |    2 +-
 arch/x86/kernel/acpi/sleep.c                       |   17 +-
 arch/x86/kernel/acpi/wakeup_32.S                   |    6 +-
 arch/x86/kernel/alternative.c                      |   42 +-
 arch/x86/kernel/apic/apic.c                        |    4 +-
 arch/x86/kernel/apic/io_apic.c                     |   12 +-
 arch/x86/kernel/apm_32.c                           |   21 +-
 arch/x86/kernel/asm-offsets_32.c                   |    9 +-
 arch/x86/kernel/asm-offsets_64.c                   |   16 +
 arch/x86/kernel/cpu/Makefile                       |    4 -
 arch/x86/kernel/cpu/amd.c                          |    2 +-
 arch/x86/kernel/cpu/common.c                       |   74 +--
 arch/x86/kernel/cpu/intel.c                        |    2 +-
 arch/x86/kernel/cpu/mcheck/mce-inject.c            |    4 +-
 arch/x86/kernel/cpu/mcheck/mce.c                   |   27 +-
 arch/x86/kernel/cpu/mcheck/p5.c                    |    2 +
 arch/x86/kernel/cpu/mcheck/winchip.c               |    2 +
 arch/x86/kernel/cpu/mtrr/mtrr.h                    |    2 +-
 arch/x86/kernel/cpu/perf_event.c                   |   10 +-
 arch/x86/kernel/crash.c                            |    2 +-
 arch/x86/kernel/doublefault_32.c                   |    8 +-
 arch/x86/kernel/dumpstack.c                        |   21 +-
 arch/x86/kernel/dumpstack.h                        |    2 +-
 arch/x86/kernel/dumpstack_32.c                     |   34 +-
 arch/x86/kernel/dumpstack_64.c                     |   58 ++-
 arch/x86/kernel/e820.c                             |    2 +-
 arch/x86/kernel/early_printk.c                     |    1 +
 arch/x86/kernel/efi_32.c                           |   66 +--
 arch/x86/kernel/efi_stub_32.S                      |   48 +-
 arch/x86/kernel/efi_stub_64.S                      |    8 +
 arch/x86/kernel/entry_32.S                         |  364 ++++++++++--
 arch/x86/kernel/entry_64.S                         |  498 +++++++++++++++--
 arch/x86/kernel/ftrace.c                           |   22 +-
 arch/x86/kernel/head32.c                           |    3 +-
 arch/x86/kernel/head_32.S                          |  254 +++++++--
 arch/x86/kernel/head_64.S                          |  147 ++++--
 arch/x86/kernel/i386_ksyms_32.c                    |    8 +
 arch/x86/kernel/i8259.c                            |    2 +-
 arch/x86/kernel/init_task.c                        |    7 +-
 arch/x86/kernel/ioport.c                           |    2 +-
 arch/x86/kernel/irq.c                              |   10 +-
 arch/x86/kernel/irq_32.c                           |   70 +--
 arch/x86/kernel/kgdb.c                             |    6 +-
 arch/x86/kernel/kprobes.c                          |   31 +-
 arch/x86/kernel/kvm.c                              |    1 +
 arch/x86/kernel/ldt.c                              |   31 +-
 arch/x86/kernel/machine_kexec_32.c                 |    6 +-
 arch/x86/kernel/microcode_intel.c                  |    4 +-
 arch/x86/kernel/module.c                           |   75 +++-
 arch/x86/kernel/paravirt-spinlocks.c               |    2 +-
 arch/x86/kernel/paravirt.c                         |   43 +-
 arch/x86/kernel/process.c                          |   73 ++-
 arch/x86/kernel/process_32.c                       |   27 +-
 arch/x86/kernel/process_64.c                       |   20 +-
 arch/x86/kernel/ptrace.c                           |   20 +-
 arch/x86/kernel/reboot.c                           |   37 +-
 arch/x86/kernel/relocate_kernel_64.S               |    2 +
 arch/x86/kernel/setup.c                            |   10 +-
 arch/x86/kernel/setup_percpu.c                     |   27 +-
 arch/x86/kernel/signal.c                           |   21 +-
 arch/x86/kernel/smpboot.c                          |   23 +-
 arch/x86/kernel/step.c                             |   12 +-
 arch/x86/kernel/sys_i386_32.c                      |  239 +++++++-
 arch/x86/kernel/sys_x86_64.c                       |   52 ++-
 arch/x86/kernel/syscall_table_32.S                 |    1 +
 arch/x86/kernel/tboot.c                            |   12 +-
 arch/x86/kernel/time.c                             |   14 +-
 arch/x86/kernel/tls.c                              |    5 +
 arch/x86/kernel/trampoline_32.S                    |    8 +-
 arch/x86/kernel/trampoline_64.S                    |    4 +-
 arch/x86/kernel/traps.c                            |   77 ++-
 arch/x86/kernel/vm86_32.c                          |    6 +-
 arch/x86/kernel/vmi_32.c                           |   63 ++-
 arch/x86/kernel/vmlinux.lds.S                      |  163 ++++--
 arch/x86/kernel/vsyscall_64.c                      |    3 +-
 arch/x86/kernel/x8664_ksyms_64.c                   |    2 -
 arch/x86/kernel/xsave.c                            |    6 +-
 arch/x86/kvm/emulate.c                             |    8 +-
 arch/x86/kvm/lapic.c                               |    2 +-
 arch/x86/kvm/paging_tmpl.h                         |    1 +
 arch/x86/kvm/svm.c                                 |    4 +
 arch/x86/kvm/vmx.c                                 |   37 +-
 arch/x86/kvm/x86.c                                 |   25 +-
 arch/x86/lguest/boot.c                             |    3 +-
 arch/x86/lib/atomic64_32.c                         |  148 +++++-
 arch/x86/lib/checksum_32.S                         |  116 +++-
 arch/x86/lib/clear_page_64.S                       |    5 +-
 arch/x86/lib/copy_page_64.S                        |   13 +-
 arch/x86/lib/copy_user_64.S                        |   49 +--
 arch/x86/lib/copy_user_nocache_64.S                |   20 +-
 arch/x86/lib/csum-copy_64.S                        |    2 +
 arch/x86/lib/csum-wrappers_64.c                    |   16 +-
 arch/x86/lib/getuser.S                             |   68 +++-
 arch/x86/lib/iomap_copy_64.S                       |    2 +
 arch/x86/lib/memcpy_64.S                           |    5 +-
 arch/x86/lib/memset_64.S                           |    9 +-
 arch/x86/lib/mmx_32.c                              |  243 ++++++---
 arch/x86/lib/msr-reg.S                             |   18 +-
 arch/x86/lib/putuser.S                             |   87 +++-
 arch/x86/lib/rwlock_64.S                           |    2 +
 arch/x86/lib/rwsem_64.S                            |    6 +-
 arch/x86/lib/thunk_64.S                            |    5 +-
 arch/x86/lib/usercopy_32.c                         |  367 ++++++++-----
 arch/x86/lib/usercopy_64.c                         |   30 +-
 arch/x86/mm/extable.c                              |   59 ++-
 arch/x86/mm/fault.c                                |  526 ++++++++++++++++-
 arch/x86/mm/gup.c                                  |    2 +-
 arch/x86/mm/highmem_32.c                           |    3 +
 arch/x86/mm/hugetlbpage.c                          |  111 ++--
 arch/x86/mm/init.c                                 |   96 +++-
 arch/x86/mm/init_32.c                              |  128 +++--
 arch/x86/mm/init_64.c                              |   20 +-
 arch/x86/mm/iomap_32.c                             |    4 +
 arch/x86/mm/ioremap.c                              |   16 +-
 arch/x86/mm/kmemcheck/kmemcheck.c                  |    4 +-
 arch/x86/mm/mmap.c                                 |   41 ++-
 arch/x86/mm/mmio-mod.c                             |    6 +-
 arch/x86/mm/numa_32.c                              |    1 -
 arch/x86/mm/pageattr-test.c                        |    2 +-
 arch/x86/mm/pageattr.c                             |   33 +-
 arch/x86/mm/pat.c                                  |   12 +-
 arch/x86/mm/pf_in.c                                |   10 +-
 arch/x86/mm/pgtable.c                              |  127 +++--
 arch/x86/mm/pgtable_32.c                           |    3 +
 arch/x86/mm/setup_nx.c                             |   31 +-
 arch/x86/mm/tlb.c                                  |    4 +
 arch/x86/oprofile/backtrace.c                      |    4 +-
 arch/x86/oprofile/op_model_p4.c                    |    2 +-
 arch/x86/pci/pcbios.c                              |  146 ++++--
 arch/x86/power/cpu.c                               |    4 +-
 arch/x86/vdso/Makefile                             |    2 +-
 arch/x86/vdso/vclock_gettime.c                     |   54 ++-
 arch/x86/vdso/vdso.lds.S                           |    6 +
 arch/x86/vdso/vdso32-setup.c                       |   23 +-
 arch/x86/vdso/vextern.h                            |    1 -
 arch/x86/vdso/vma.c                                |   40 +-
 arch/x86/xen/enlighten.c                           |   34 +-
 arch/x86/xen/mmu.c                                 |    7 +
 arch/x86/xen/smp.c                                 |   16 +-
 arch/x86/xen/xen-asm_32.S                          |   12 +-
 arch/x86/xen/xen-head.S                            |   11 +
 arch/x86/xen/xen-ops.h                             |    2 -
 block/blk-iopoll.c                                 |    2 +-
 block/blk-map.c                                    |    9 +-
 block/blk-softirq.c                                |    2 +-
 block/bsg.c                                        |   20 +-
 block/compat_ioctl.c                               |    2 +-
 block/scsi_ioctl.c                                 |   27 +-
 crypto/cryptd.c                                    |    2 +-
 crypto/gf128mul.c                                  |    4 +-
 drivers/acpi/acpi_pad.c                            |    2 +-
 drivers/acpi/osl.c                                 |    4 +
 drivers/acpi/power_meter.c                         |    2 -
 drivers/acpi/proc.c                                |   17 +-
 drivers/acpi/processor_core.c                      |    2 +-
 drivers/acpi/sbshc.c                               |    2 +-
 drivers/ata/libata-core.c                          |    8 +-
 drivers/atm/adummy.c                               |    2 +-
 drivers/atm/ambassador.c                           |    8 +-
 drivers/atm/atmtcp.c                               |   14 +-
 drivers/atm/eni.c                                  |   12 +-
 drivers/atm/firestream.c                           |    8 +-
 drivers/atm/fore200e.c                             |   14 +-
 drivers/atm/he.c                                   |   18 +-
 drivers/atm/horizon.c                              |    4 +-
 drivers/atm/idt77252.c                             |   36 +-
 drivers/atm/iphase.c                               |   34 +-
 drivers/atm/lanai.c                                |   12 +-
 drivers/atm/nicstar.c                              |   46 +-
 drivers/atm/solos-pci.c                            |    4 +-
 drivers/atm/suni.c                                 |    4 +-
 drivers/atm/uPD98402.c                             |   16 +-
 drivers/atm/zatm.c                                 |    6 +-
 drivers/block/cciss.c                              |   24 +-
 drivers/block/cciss.h                              |    2 +-
 drivers/block/cpqarray.c                           |   28 +-
 drivers/block/cpqarray.h                           |    2 +-
 drivers/block/loop.c                               |    2 +-
 drivers/char/agp/frontend.c                        |    2 +-
 drivers/char/hpet.c                                |    4 +-
 drivers/char/hvcs.c                                |   23 +-
 drivers/char/ipmi/ipmi_msghandler.c                |    8 +-
 drivers/char/ipmi/ipmi_si_intf.c                   |    8 +-
 drivers/char/keyboard.c                            |    2 +-
 drivers/char/mbcs.c                                |    2 +-
 drivers/char/mem.c                                 |   46 ++-
 drivers/char/pcmcia/ipwireless/tty.c               |   29 +-
 drivers/char/pty.c                                 |    4 +-
 drivers/char/random.c                              |    2 +-
 drivers/char/sonypi.c                              |    9 +-
 drivers/char/tpm/tpm.c                             |    2 +-
 drivers/char/tpm/tpm_bios.c                        |   14 +-
 drivers/char/tty_io.c                              |    8 +-
 drivers/char/tty_ldisc.c                           |   10 +-
 drivers/char/virtio_console.c                      |   16 +-
 drivers/char/vt.c                                  |    2 +-
 drivers/cpuidle/sysfs.c                            |    2 +-
 drivers/dma/ioat/dma_v3.c                          |    8 +-
 drivers/edac/amd64_edac.c                          |    2 +-
 drivers/edac/amd76x_edac.c                         |    2 +-
 drivers/edac/e752x_edac.c                          |    2 +-
 drivers/edac/e7xxx_edac.c                          |    2 +-
 drivers/edac/edac_pci_sysfs.c                      |   20 +-
 drivers/edac/i3000_edac.c                          |    2 +-
 drivers/edac/i3200_edac.c                          |    2 +-
 drivers/edac/i5000_edac.c                          |    2 +-
 drivers/edac/i5100_edac.c                          |    2 +-
 drivers/edac/i5400_edac.c                          |    2 +-
 drivers/edac/i82443bxgx_edac.c                     |    2 +-
 drivers/edac/i82860_edac.c                         |    2 +-
 drivers/edac/i82875p_edac.c                        |    2 +-
 drivers/edac/i82975x_edac.c                        |    2 +-
 drivers/edac/r82600_edac.c                         |    2 +-
 drivers/edac/x38_edac.c                            |    2 +-
 drivers/firewire/core-card.c                       |    2 +-
 drivers/firewire/core-cdev.c                       |    3 +-
 drivers/firewire/core-transaction.c                |    1 +
 drivers/firewire/core.h                            |    1 +
 drivers/firmware/dmi_scan.c                        |    7 +-
 drivers/gpio/vr41xx_giu.c                          |    2 +-
 drivers/gpu/drm/drm_crtc.c                         |   18 +-
 drivers/gpu/drm/drm_crtc_helper.c                  |    2 +-
 drivers/gpu/drm/drm_drv.c                          |    2 +-
 drivers/gpu/drm/drm_fops.c                         |   14 +-
 drivers/gpu/drm/drm_gem.c                          |   10 +-
 drivers/gpu/drm/drm_info.c                         |   20 +-
 drivers/gpu/drm/drm_ioc32.c                        |    4 +-
 drivers/gpu/drm/drm_ioctl.c                        |    2 +-
 drivers/gpu/drm/drm_lock.c                         |    4 +-
 drivers/gpu/drm/i810/i810_dma.c                    |    8 +-
 drivers/gpu/drm/i810/i810_drv.h                    |    4 +-
 drivers/gpu/drm/i830/i830_drv.h                    |    4 +-
 drivers/gpu/drm/i830/i830_irq.c                    |   14 +-
 drivers/gpu/drm/i915/i915_debugfs.c                |    2 +-
 drivers/gpu/drm/i915/i915_drv.h                    |    4 +-
 drivers/gpu/drm/i915/i915_gem.c                    |   26 +-
 drivers/gpu/drm/i915/i915_irq.c                    |    4 +-
 drivers/gpu/drm/i915/intel_sdvo.c                  |    4 +-
 drivers/gpu/drm/mga/mga_drv.h                      |    4 +-
 drivers/gpu/drm/mga/mga_irq.c                      |    8 +-
 drivers/gpu/drm/r128/r128_cce.c                    |    2 +-
 drivers/gpu/drm/r128/r128_drv.h                    |    4 +-
 drivers/gpu/drm/r128/r128_irq.c                    |    4 +-
 drivers/gpu/drm/r128/r128_state.c                  |    4 +-
 drivers/gpu/drm/radeon/mkregtable.c                |    4 +-
 drivers/gpu/drm/radeon/radeon.h                    |    4 +-
 drivers/gpu/drm/radeon/radeon_atombios.c           |    5 +-
 drivers/gpu/drm/radeon/radeon_display.c            |    2 +-
 drivers/gpu/drm/radeon/radeon_drv.h                |    2 +-
 drivers/gpu/drm/radeon/radeon_fence.c              |    4 +-
 drivers/gpu/drm/radeon/radeon_ioc32.c              |    2 +-
 drivers/gpu/drm/radeon/radeon_irq.c                |    6 +-
 drivers/gpu/drm/radeon/radeon_state.c              |    2 +-
 drivers/gpu/drm/radeon/radeon_ttm.c                |   32 +-
 drivers/gpu/drm/radeon/rs690.c                     |    4 +-
 drivers/gpu/drm/ttm/ttm_bo_vm.c                    |    6 +-
 drivers/gpu/drm/ttm/ttm_global.c                   |   14 +-
 drivers/gpu/drm/via/via_drv.h                      |    4 +-
 drivers/gpu/drm/via/via_irq.c                      |   18 +-
 drivers/hid/hid-core.c                             |    4 +-
 drivers/hid/usbhid/hiddev.c                        |    2 +-
 drivers/hwmon/lis3lv02d.c                          |    8 +-
 drivers/hwmon/lis3lv02d.h                          |    2 +-
 drivers/hwmon/sht15.c                              |   12 +-
 drivers/hwmon/w83791d.c                            |    4 +-
 drivers/i2c/busses/i2c-amd756-s4882.c              |    2 +-
 drivers/i2c/busses/i2c-nforce2-s4985.c             |    2 +-
 drivers/ide/aec62xx.c                              |    2 +-
 drivers/ide/alim15x3.c                             |    2 +-
 drivers/ide/amd74xx.c                              |    2 +-
 drivers/ide/atiixp.c                               |    2 +-
 drivers/ide/cmd64x.c                               |    2 +-
 drivers/ide/cs5520.c                               |    2 +-
 drivers/ide/cs5530.c                               |    2 +-
 drivers/ide/cs5535.c                               |    2 +-
 drivers/ide/cy82c693.c                             |    2 +-
 drivers/ide/hpt366.c                               |   24 +-
 drivers/ide/ide-cd.c                               |    2 +-
 drivers/ide/ide-pci-generic.c                      |    2 +-
 drivers/ide/it8172.c                               |    2 +-
 drivers/ide/it8213.c                               |    2 +-
 drivers/ide/it821x.c                               |    2 +-
 drivers/ide/jmicron.c                              |    2 +-
 drivers/ide/ns87415.c                              |    2 +-
 drivers/ide/opti621.c                              |    2 +-
 drivers/ide/pdc202xx_new.c                         |    2 +-
 drivers/ide/pdc202xx_old.c                         |    2 +-
 drivers/ide/piix.c                                 |    2 +-
 drivers/ide/rz1000.c                               |    2 +-
 drivers/ide/sc1200.c                               |    2 +-
 drivers/ide/scc_pata.c                             |    2 +-
 drivers/ide/serverworks.c                          |    2 +-
 drivers/ide/siimage.c                              |    2 +-
 drivers/ide/sis5513.c                              |    2 +-
 drivers/ide/sl82c105.c                             |    2 +-
 drivers/ide/slc90e66.c                             |    2 +-
 drivers/ide/tc86c001.c                             |    2 +-
 drivers/ide/triflex.c                              |    2 +-
 drivers/ide/trm290.c                               |    2 +-
 drivers/ide/via82cxxx.c                            |    2 +-
 drivers/ieee1394/dv1394.c                          |    2 +-
 drivers/ieee1394/hosts.c                           |    1 +
 drivers/ieee1394/init_ohci1394_dma.c               |    2 +-
 drivers/ieee1394/ohci1394.c                        |    4 +-
 drivers/ieee1394/sbp2.c                            |    2 +-
 drivers/infiniband/core/cm.c                       |   32 +-
 drivers/infiniband/core/fmr_pool.c                 |   20 +-
 drivers/infiniband/hw/nes/nes.c                    |    4 +-
 drivers/infiniband/hw/nes/nes.h                    |   32 +-
 drivers/infiniband/hw/nes/nes_cm.c                 |   54 +-
 drivers/infiniband/hw/nes/nes_nic.c                |   32 +-
 drivers/infiniband/hw/nes/nes_verbs.c              |   10 +-
 drivers/input/gameport/gameport.c                  |    4 +-
 drivers/input/input.c                              |    4 +-
 drivers/input/joystick/sidewinder.c                |    1 +
 drivers/input/joystick/xpad.c                      |    4 +-
 drivers/input/serio/serio.c                        |    4 +-
 drivers/isdn/gigaset/common.c                      |    2 +-
 drivers/isdn/gigaset/gigaset.h                     |    3 +-
 drivers/isdn/gigaset/interface.c                   |   22 +-
 drivers/isdn/hardware/avm/b1.c                     |    4 +-
 drivers/isdn/hardware/eicon/divasync.h             |    2 +-
 drivers/isdn/hardware/eicon/xdi_adapter.h          |    2 +-
 drivers/isdn/icn/icn.c                             |    2 +-
 drivers/lguest/core.c                              |   10 +-
 drivers/lguest/x86/core.c                          |   12 +-
 drivers/lguest/x86/switcher_32.S                   |   27 +-
 drivers/macintosh/macio_asic.c                     |    2 +-
 drivers/md/dm-ioctl.c                              |    2 +-
 drivers/md/dm-raid1.c                              |   16 +-
 drivers/md/dm-stripe.c                             |   10 +-
 drivers/md/dm-table.c                              |    2 +-
 drivers/md/dm.c                                    |   16 +-
 drivers/md/md.c                                    |   28 +-
 drivers/md/md.h                                    |    6 +-
 drivers/md/raid1.c                                 |    4 +-
 drivers/md/raid10.c                                |    4 +-
 drivers/md/raid5.c                                 |   10 +-
 drivers/media/dvb/dvb-core/dvb_demux.h             |    2 +-
 drivers/media/dvb/dvb-core/dvbdev.c                |    2 +-
 drivers/media/dvb/dvb-usb/cxusb.c                  |    2 +-
 drivers/media/dvb/dvb-usb/dib0700_devices.c        |    2 +-
 drivers/media/dvb/frontends/dib3000.h              |    2 +-
 drivers/media/radio/radio-cadet.c                  |    2 +-
 drivers/media/video/cx18/cx18-driver.c             |    4 +-
 drivers/media/video/ivtv/ivtv-driver.c             |    2 +-
 drivers/media/video/omap24xxcam.c                  |    2 +-
 drivers/media/video/omap24xxcam.h                  |    2 +-
 drivers/media/video/pvrusb2/pvrusb2-hdw-internal.h |    2 +-
 drivers/media/video/usbvideo/ibmcam.c              |   18 +-
 drivers/media/video/usbvideo/konicawc.c            |   22 +-
 drivers/media/video/usbvideo/quickcam_messenger.c  |    2 +-
 drivers/media/video/usbvideo/ultracam.c            |   16 +-
 drivers/media/video/usbvideo/usbvideo.c            |   10 +-
 drivers/media/video/usbvideo/usbvideo.h            |    2 +-
 drivers/media/video/v4l2-device.c                  |    4 +-
 drivers/message/fusion/mptsas.c                    |   34 +-
 drivers/message/fusion/mptscsih.c                  |   19 +-
 drivers/message/i2o/i2o_proc.c                     |   44 +-
 drivers/message/i2o/iop.c                          |    8 +-
 drivers/mfd/ab3100-core.c                          |    2 +-
 drivers/misc/sgi-gru/gruhandles.c                  |    4 +-
 drivers/misc/sgi-gru/gruprocfs.c                   |    8 +-
 drivers/misc/sgi-gru/grutables.h                   |  158 +++---
 drivers/misc/sgi-xp/xp.h                           |    2 +-
 drivers/misc/sgi-xp/xpc.h                          |    3 +-
 drivers/misc/sgi-xp/xpc_main.c                     |    2 +-
 drivers/mmc/host/sdhci-pci.c                       |    2 +-
 drivers/mtd/devices/doc2000.c                      |    2 +-
 drivers/mtd/devices/doc2001.c                      |    2 +-
 drivers/mtd/nftlmount.c                            |    1 +
 drivers/mtd/ubi/build.c                            |   16 +-
 drivers/net/atlx/atl2.c                            |    2 +-
 drivers/net/cxgb3/l2t.h                            |    2 +-
 drivers/net/e1000e/82571.c                         |    2 +-
 drivers/net/e1000e/es2lan.c                        |    2 +-
 drivers/net/e1000e/hw.h                            |    9 +-
 drivers/net/fealnx.c                               |    2 +-
 drivers/net/igb/e1000_hw.h                         |   12 +-
 drivers/net/igbvf/vf.h                             |    6 +-
 drivers/net/ixgbe/ixgbe_type.h                     |    9 +-
 drivers/net/mlx4/main.c                            |    1 +
 drivers/net/pcnet32.c                              |  200 ++++----
 drivers/net/sis190.c                               |    2 +-
 drivers/net/sundance.c                             |    2 +-
 drivers/net/tg3.h                                  |    1 +
 drivers/net/tokenring/abyss.c                      |    8 +-
 drivers/net/tokenring/madgemc.c                    |    8 +-
 drivers/net/tokenring/proteon.c                    |    8 +-
 drivers/net/tokenring/skisa.c                      |    8 +-
 drivers/net/tulip/de4x5.c                          |    4 +-
 drivers/net/tulip/eeprom.c                         |    2 +-
 drivers/net/tulip/winbond-840.c                    |    2 +-
 drivers/net/usb/hso.c                              |   23 +-
 drivers/net/vxge/vxge-config.h                     |    2 +-
 drivers/net/vxge/vxge-traffic.h                    |    2 +-
 drivers/net/wan/hdlc_x25.c                         |   16 +-
 drivers/net/wireless/iwlwifi/iwl-agn.c             |    4 +-
 drivers/net/wireless/iwlwifi/iwl-debug.h           |    4 +-
 drivers/net/wireless/iwlwifi/iwl3945-base.c        |    4 +-
 drivers/net/wireless/rndis_wlan.c                  |    2 +-
 drivers/oprofile/buffer_sync.c                     |    8 +-
 drivers/oprofile/event_buffer.c                    |    2 +-
 drivers/oprofile/oprof.c                           |    2 +-
 drivers/oprofile/oprofile_stats.c                  |   10 +-
 drivers/oprofile/oprofile_stats.h                  |   10 +-
 drivers/oprofile/oprofilefs.c                      |    2 +-
 drivers/parport/procfs.c                           |    4 +-
 drivers/pci/hotplug/cpci_hotplug.h                 |    2 +-
 drivers/pci/hotplug/cpqphp_nvram.c                 |    4 +
 drivers/pci/pcie/aspm.c                            |    6 +-
 drivers/pci/probe.c                                |    4 +-
 drivers/pcmcia/pcmcia_ioctl.c                      |    2 +-
 drivers/platform/x86/thinkpad_acpi.c               |    2 +-
 drivers/pnp/pnpbios/bioscalls.c                    |   14 +-
 drivers/pnp/resource.c                             |    4 +-
 drivers/power/bq27x00_battery.c                    |    2 +-
 drivers/s390/cio/qdio_perf.c                       |   46 +-
 drivers/s390/cio/qdio_perf.h                       |   50 +-
 drivers/scsi/aacraid/aacraid.h                     |    2 +-
 drivers/scsi/aacraid/linit.c                       |    2 +-
 drivers/scsi/aic94xx/aic94xx_init.c                |    2 +-
 drivers/scsi/bfa/bfa_ioc.h                         |    2 +-
 drivers/scsi/bfa/bfa_iocfc.h                       |    2 +-
 drivers/scsi/fnic/fnic_main.c                      |    2 +-
 drivers/scsi/hosts.c                               |    4 +-
 drivers/scsi/ips.h                                 |    2 +-
 drivers/scsi/libfc/fc_exch.c                       |   38 +-
 drivers/scsi/lpfc/lpfc.h                           |    8 +-
 drivers/scsi/lpfc/lpfc_debugfs.c                   |   18 +-
 drivers/scsi/lpfc/lpfc_init.c                      |    6 +-
 drivers/scsi/lpfc/lpfc_scsi.c                      |   16 +-
 drivers/scsi/pmcraid.c                             |   14 +-
 drivers/scsi/pmcraid.h                             |    6 +-
 drivers/scsi/qla2xxx/qla_def.h                     |    2 +-
 drivers/scsi/qla4xxx/ql4_def.h                     |    2 +-
 drivers/scsi/qla4xxx/ql4_init.c                    |    4 +-
 drivers/scsi/qla4xxx/ql4_os.c                      |    4 +-
 drivers/scsi/scsi.c                                |    2 +-
 drivers/scsi/scsi_lib.c                            |    6 +-
 drivers/scsi/scsi_sysfs.c                          |    2 +-
 drivers/scsi/scsi_tgt_lib.c                        |    2 +-
 drivers/scsi/scsi_transport_fc.c                   |    6 +-
 drivers/scsi/scsi_transport_iscsi.c                |    6 +-
 drivers/scsi/scsi_transport_srp.c                  |    6 +-
 drivers/scsi/sg.c                                  |    4 +-
 drivers/serial/kgdboc.c                            |    2 +-
 drivers/spi/spi.c                                  |    2 +-
 drivers/staging/dst/dcore.c                        |    2 +-
 drivers/staging/dst/trans.c                        |    2 +-
 drivers/staging/et131x/et1310_tx.c                 |    6 +-
 drivers/staging/et131x/et131x_adapter.h            |    6 +-
 drivers/staging/hv/Channel.c                       |    4 +-
 drivers/staging/hv/Hv.c                            |    2 +-
 drivers/staging/hv/VmbusApi.h                      |    2 +-
 drivers/staging/hv/VmbusPrivate.h                  |    2 +-
 drivers/staging/hv/vmbus_drv.c                     |    4 +-
 drivers/staging/iio/ring_generic.h                 |    2 +-
 drivers/staging/octeon/ethernet-rx.c               |   12 +-
 drivers/staging/octeon/ethernet.c                  |    8 +-
 drivers/staging/otus/80211core/pub_zfi.h           |    2 +-
 drivers/staging/pohmelfs/inode.c                   |    4 +-
 drivers/staging/pohmelfs/mcache.c                  |    2 +-
 drivers/staging/pohmelfs/netfs.h                   |    4 +-
 drivers/staging/pohmelfs/trans.c                   |    2 +-
 drivers/staging/usbip/usbip_common.h               |    2 +-
 drivers/staging/usbip/vhci.h                       |    2 +-
 drivers/staging/usbip/vhci_hcd.c                   |    6 +-
 drivers/staging/usbip/vhci_rx.c                    |    2 +-
 drivers/staging/vt6655/hostap.c                    |    2 +-
 drivers/staging/vt6656/hostap.c                    |    2 +-
 drivers/staging/wlan-ng/hfa384x_usb.c              |    2 +-
 drivers/uio/uio.c                                  |   21 +-
 drivers/usb/atm/usbatm.c                           |   24 +-
 drivers/usb/class/cdc-wdm.c                        |    2 +-
 drivers/usb/core/message.c                         |    4 +-
 drivers/usb/wusbcore/wa-hc.h                       |    4 +-
 drivers/usb/wusbcore/wa-xfer.c                     |    2 +-
 drivers/uwb/wlp/messages.c                         |    2 +-
 drivers/video/aty/aty128fb.c                       |    2 +-
 drivers/video/fbcmap.c                             |    3 +-
 drivers/video/fbmem.c                              |    6 +-
 drivers/video/geode/gx1fb_core.c                   |    2 +-
 drivers/video/gxt4500.c                            |    4 +-
 drivers/video/i810/i810_accel.c                    |    1 +
 drivers/video/i810/i810_main.c                     |    2 +-
 drivers/video/uvesafb.c                            |   36 ++-
 drivers/video/vesafb.c                             |   51 ++-
 fs/9p/vfs_inode.c                                  |    2 +-
 fs/Kconfig.binfmt                                  |    2 +-
 fs/aio.c                                           |    9 +-
 fs/autofs/root.c                                   |    3 +-
 fs/autofs4/symlink.c                               |    2 +-
 fs/autofs4/waitq.c                                 |    2 +-
 fs/befs/linuxvfs.c                                 |    2 +-
 fs/binfmt_aout.c                                   |   23 +-
 fs/binfmt_elf.c                                    |  431 +++++++++++++-
 fs/binfmt_flat.c                                   |    6 +
 fs/bio.c                                           |    4 +-
 fs/block_dev.c                                     |    2 +-
 fs/btrfs/ctree.c                                   |   10 +-
 fs/btrfs/free-space-cache.c                        |    4 +-
 fs/btrfs/relocation.c                              |    2 +-
 fs/cachefiles/bind.c                               |    6 +-
 fs/cachefiles/daemon.c                             |    6 +-
 fs/cachefiles/internal.h                           |   12 +-
 fs/cachefiles/namei.c                              |    2 +-
 fs/cachefiles/proc.c                               |   12 +-
 fs/cachefiles/rdwr.c                               |    2 +-
 fs/cifs/cifs_debug.c                               |   86 ++--
 fs/cifs/cifsfs.c                                   |    8 +-
 fs/cifs/cifsglob.h                                 |   50 +-
 fs/cifs/link.c                                     |    2 +-
 fs/cifs/misc.c                                     |    4 +-
 fs/coda/cache.c                                    |   10 +-
 fs/compat.c                                        |   12 +-
 fs/compat_binfmt_elf.c                             |    2 +
 fs/compat_ioctl.c                                  |    6 +-
 fs/configfs/dir.c                                  |   10 +-
 fs/dcache.c                                        |    4 +-
 fs/ecryptfs/inode.c                                |    4 +-
 fs/exec.c                                          |  297 +++++++++--
 fs/ext4/ext4.h                                     |   20 +-
 fs/ext4/mballoc.c                                  |   44 +-
 fs/fcntl.c                                         |    4 +-
 fs/fifo.c                                          |   22 +-
 fs/fs_struct.c                                     |   12 +-
 fs/fscache/cookie.c                                |   34 +-
 fs/fscache/internal.h                              |  182 +++---
 fs/fscache/object.c                                |   26 +-
 fs/fscache/operation.c                             |   28 +-
 fs/fscache/page.c                                  |  106 ++--
 fs/fscache/stats.c                                 |  330 ++++++------
 fs/fuse/cuse.c                                     |   10 +-
 fs/fuse/dev.c                                      |   17 +-
 fs/fuse/dir.c                                      |    2 +-
 fs/ioctl.c                                         |    6 +-
 fs/jffs2/erase.c                                   |    3 +-
 fs/jffs2/wbuf.c                                    |    3 +-
 fs/jfs/super.c                                     |    2 +-
 fs/libfs.c                                         |   10 +-
 fs/lockd/clntproc.c                                |    4 +-
 fs/locks.c                                         |    8 +-
 fs/mbcache.c                                       |    4 +-
 fs/namei.c                                         |   13 +-
 fs/nfs/inode.c                                     |    8 +-
 fs/nfsd/vfs.c                                      |    6 +-
 fs/nilfs2/ioctl.c                                  |    2 +-
 fs/notify/notification.c                           |    4 +-
 fs/ntfs/dir.c                                      |    2 +-
 fs/ntfs/file.c                                     |    4 +-
 fs/ocfs2/localalloc.c                              |    2 +-
 fs/ocfs2/ocfs2.h                                   |   10 +-
 fs/ocfs2/suballoc.c                                |   10 +-
 fs/ocfs2/super.c                                   |   20 +-
 fs/pipe.c                                          |   33 +-
 fs/proc/array.c                                    |   20 +
 fs/proc/base.c                                     |    2 +-
 fs/proc/kcore.c                                    |   32 +-
 fs/proc/meminfo.c                                  |    2 +-
 fs/proc/nommu.c                                    |    2 +-
 fs/proc/task_mmu.c                                 |   41 +-
 fs/proc/task_nommu.c                               |    4 +-
 fs/readdir.c                                       |    2 +-
 fs/reiserfs/do_balan.c                             |    2 +-
 fs/reiserfs/procfs.c                               |    2 +-
 fs/seq_file.c                                      |   14 +-
 fs/smbfs/proc.c                                    |   10 +-
 fs/smbfs/symlink.c                                 |    2 +-
 fs/splice.c                                        |   36 +-
 fs/sysfs/file.c                                    |   10 +-
 fs/sysfs/symlink.c                                 |    2 +-
 fs/udf/balloc.c                                    |    8 +-
 fs/udf/misc.c                                      |    2 +-
 fs/xattr_acl.c                                     |    4 +-
 fs/xfs/linux-2.6/xfs_ioctl.c                       |    4 +-
 fs/xfs/linux-2.6/xfs_iops.c                        |    2 +-
 fs/xfs/xfs_bmap.c                                  |    2 +-
 fs/xfs/xfs_dir2_sf.c                               |   10 +-
 include/acpi/acpi_bus.h                            |    2 +-
 include/asm-generic/atomic-long.h                  |  163 ++++++
 include/asm-generic/cache.h                        |    4 +-
 include/asm-generic/futex.h                        |    4 +-
 include/asm-generic/int-l64.h                      |    2 +
 include/asm-generic/int-ll64.h                     |    2 +
 include/asm-generic/kmap_types.h                   |    3 +-
 include/asm-generic/pgtable-nopmd.h                |   18 +-
 include/asm-generic/pgtable-nopud.h                |   14 +-
 include/asm-generic/pgtable.h                      |    8 +
 include/asm-generic/vmlinux.lds.h                  |   13 +-
 include/drm/drmP.h                                 |   11 +-
 include/drm/drm_crtc_helper.h                      |    4 +-
 include/drm/ttm/ttm_memory.h                       |    2 +-
 include/linux/a.out.h                              |    8 +
 include/linux/atmdev.h                             |    2 +-
 include/linux/binfmts.h                            |    1 +
 include/linux/blkdev.h                             |    2 +-
 include/linux/blktrace_api.h                       |    2 +-
 include/linux/byteorder/little_endian.h            |   24 +-
 include/linux/cache.h                              |    4 +
 include/linux/compiler-gcc4.h                      |   12 +
 include/linux/compiler.h                           |   51 ++-
 include/linux/crypto.h                             |    6 +-
 include/linux/dcache.h                             |    2 +
 include/linux/decompress/mm.h                      |    2 +-
 include/linux/dma-mapping.h                        |    2 +-
 include/linux/dst.h                                |    2 +-
 include/linux/elf.h                                |   30 +
 include/linux/fs.h                                 |    5 +-
 include/linux/fs_struct.h                          |    2 +-
 include/linux/fscache-cache.h                      |    4 +-
 include/linux/ftrace_event.h                       |    2 +-
 include/linux/genhd.h                              |    2 +-
 include/linux/hdpu_features.h                      |    2 +-
 include/linux/highmem.h                            |   12 +
 include/linux/i2c.h                                |    1 +
 include/linux/i2o.h                                |    2 +-
 include/linux/init_task.h                          |    7 +
 include/linux/intel-iommu.h                        |    2 +-
 include/linux/interrupt.h                          |    6 +-
 include/linux/irq.h                                |    2 +-
 include/linux/kgdb.h                               |    8 +-
 include/linux/kvm_host.h                           |    4 +-
 include/linux/libata.h                             |    2 +-
 include/linux/mca.h                                |    2 +-
 include/linux/memory.h                             |    2 +-
 include/linux/mm.h                                 |   29 +-
 include/linux/mm_types.h                           |   20 +
 include/linux/mmu_notifier.h                       |    6 +-
 include/linux/mmzone.h                             |    2 +-
 include/linux/mod_devicetable.h                    |    4 +-
 include/linux/module.h                             |   51 ++-
 include/linux/moduleloader.h                       |   12 +
 include/linux/moduleparam.h                        |    4 +-
 include/linux/mutex.h                              |    2 +-
 include/linux/namei.h                              |    6 +-
 include/linux/netdevice.h                          |    1 +
 include/linux/nodemask.h                           |    8 +-
 include/linux/oprofile.h                           |    4 +-
 include/linux/pagemap.h                            |    1 +
 include/linux/perf_event.h                         |    8 +-
 include/linux/pipe_fs_i.h                          |    6 +-
 include/linux/poison.h                             |    4 +-
 include/linux/posix-timers.h                       |    2 +-
 include/linux/preempt.h                            |    2 +-
 include/linux/proc_fs.h                            |    2 +-
 include/linux/random.h                             |    5 +
 include/linux/reboot.h                             |   14 +-
 include/linux/reiserfs_fs.h                        |    2 +-
 include/linux/reiserfs_fs_sb.h                     |    2 +-
 include/linux/relay.h                              |    2 +-
 include/linux/rfkill.h                             |    1 +
 include/linux/sched.h                              |   71 +++-
 include/linux/screen_info.h                        |    3 +-
 include/linux/seq_file.h                           |    1 +
 include/linux/skbuff.h                             |    8 +-
 include/linux/slab.h                               |   51 ++-
 include/linux/slab_def.h                           |    8 +-
 include/linux/slub_def.h                           |    4 +-
 include/linux/sonet.h                              |    2 +-
 include/linux/sunrpc/cache.h                       |    2 +-
 include/linux/sunrpc/clnt.h                        |    8 +-
 include/linux/sunrpc/svc_rdma.h                    |   18 +-
 include/linux/sysctl.h                             |    6 +-
 include/linux/thread_info.h                        |    2 +-
 include/linux/tty_ldisc.h                          |    2 +-
 include/linux/types.h                              |   16 +
 include/linux/uaccess.h                            |   10 +-
 include/linux/unaligned/access_ok.h                |   12 +-
 include/linux/vermagic.h                           |   21 +-
 include/linux/vmalloc.h                            |   77 +++
 include/linux/vmstat.h                             |   20 +-
 include/media/saa7146_vv.h                         |    2 +-
 include/media/v4l2-dev.h                           |    3 +-
 include/media/v4l2-device.h                        |    2 +-
 include/media/v4l2-ioctl.h                         |    1 +
 include/net/flow.h                                 |    2 +-
 include/net/inetpeer.h                             |    2 +-
 include/net/ip_vs.h                                |    4 +-
 include/net/irda/ircomm_core.h                     |    2 +-
 include/net/irda/ircomm_tty.h                      |    5 +-
 include/net/iucv/af_iucv.h                         |    2 +-
 include/net/lapb.h                                 |    2 +-
 include/net/neighbour.h                            |    2 +-
 include/net/netlink.h                              |    2 +-
 include/net/netns/ipv4.h                           |    2 +-
 include/net/sctp/sctp.h                            |    4 +-
 include/net/sock.h                                 |    2 +-
 include/net/tcp.h                                  |    4 +-
 include/net/udp.h                                  |    4 +-
 include/rdma/iw_cm.h                               |    2 +-
 include/scsi/libfc.h                               |    3 +-
 include/scsi/scsi_device.h                         |    6 +-
 include/scsi/scsi_transport_fc.h                   |    2 +-
 include/sound/ak4xxx-adda.h                        |    2 +-
 include/sound/hwdep.h                              |    2 +-
 include/sound/info.h                               |    2 +-
 include/sound/pcm.h                                |    1 +
 include/sound/sb16_csp.h                           |    2 +-
 include/sound/ymfpci.h                             |    2 +-
 include/trace/events/irq.h                         |    8 +-
 include/video/uvesafb.h                            |    1 +
 init/Kconfig                                       |    2 +-
 init/do_mounts.c                                   |   14 +-
 init/do_mounts.h                                   |    8 +-
 init/do_mounts_initrd.c                            |   30 +-
 init/do_mounts_md.c                                |    6 +-
 init/initramfs.c                                   |   40 +-
 init/main.c                                        |   78 ++-
 init/noinitramfs.c                                 |    4 +-
 ipc/msg.c                                          |   11 +-
 ipc/sem.c                                          |   11 +-
 ipc/shm.c                                          |   11 +-
 kernel/acct.c                                      |    2 +-
 kernel/audit.c                                     |    8 +-
 kernel/auditsc.c                                   |    4 +-
 kernel/compat.c                                    |   42 +-
 kernel/cpu.c                                       |    2 +-
 kernel/exit.c                                      |    4 +-
 kernel/fork.c                                      |   38 +-
 kernel/futex.c                                     |   13 +-
 kernel/gcov/base.c                                 |    7 +-
 kernel/hrtimer.c                                   |    2 +-
 kernel/kallsyms.c                                  |   39 ++-
 kernel/kexec.c                                     |    3 +-
 kernel/kgdb.c                                      |   16 +-
 kernel/kmod.c                                      |    2 +-
 kernel/kprobes.c                                   |    8 +-
 kernel/lockdep.c                                   |   38 +-
 kernel/lockdep_internals.h                         |   40 +-
 kernel/lockdep_proc.c                              |    2 +-
 kernel/module.c                                    |  272 ++++++---
 kernel/mutex-debug.c                               |   14 +-
 kernel/mutex-debug.h                               |    6 +-
 kernel/mutex.c                                     |    9 +-
 kernel/mutex.h                                     |    2 +-
 kernel/panic.c                                     |    3 +-
 kernel/perf_event.c                                |   68 ++--
 kernel/pid.c                                       |    2 +-
 kernel/posix-cpu-timers.c                          |    4 +-
 kernel/posix-timers.c                              |   26 +-
 kernel/power/poweroff.c                            |    2 +-
 kernel/power/process.c                             |   15 +-
 kernel/profile.c                                   |   14 +-
 kernel/ptrace.c                                    |    8 +-
 kernel/rcutorture.c                                |   56 +-
 kernel/rcutree.c                                   |    2 +-
 kernel/rcutree_plugin.h                            |    4 +-
 kernel/relay.c                                     |    3 +-
 kernel/rtmutex-tester.c                            |   24 +-
 kernel/rtmutex.c                                   |    2 +-
 kernel/sched.c                                     |   12 +-
 kernel/signal.c                                    |    8 +-
 kernel/smp.c                                       |    8 +-
 kernel/softirq.c                                   |   14 +-
 kernel/sys.c                                       |   10 +-
 kernel/sysctl.c                                    |   32 +
 kernel/time.c                                      |    4 +-
 kernel/time/tick-broadcast.c                       |    2 +-
 kernel/time/timekeeping.c                          |    2 +-
 kernel/time/timer_stats.c                          |   10 +-
 kernel/timer.c                                     |    2 +-
 kernel/trace/blktrace.c                            |    6 +-
 kernel/trace/ftrace.c                              |    9 +-
 kernel/trace/ring_buffer.c                         |    2 +-
 kernel/trace/trace.c                               |    6 +-
 kernel/trace/trace_events.c                        |   26 +-
 kernel/trace/trace_mmiotrace.c                     |    8 +-
 kernel/trace/trace_output.c                        |    2 +-
 kernel/trace/trace_stack.c                         |    2 +-
 kernel/trace/trace_workqueue.c                     |    6 +-
 lib/bitmap.c                                       |    4 +-
 lib/bug.c                                          |    2 +
 lib/debugobjects.c                                 |    2 +-
 lib/devres.c                                       |    4 +-
 lib/dma-debug.c                                    |    2 +-
 lib/idr.c                                          |    2 +-
 lib/inflate.c                                      |    2 +-
 lib/kref.c                                         |    2 +-
 lib/parser.c                                       |    2 +-
 lib/radix-tree.c                                   |    2 +-
 lib/random32.c                                     |    2 +-
 lib/vsprintf.c                                     |   16 +-
 mm/Kconfig                                         |    6 +-
 mm/backing-dev.c                                   |    2 +-
 mm/filemap.c                                       |    2 +-
 mm/fremap.c                                        |    7 +-
 mm/highmem.c                                       |    7 +-
 mm/hugetlb.c                                       |   51 ++
 mm/internal.h                                      |    1 +
 mm/maccess.c                                       |    8 +-
 mm/madvise.c                                       |   41 ++
 mm/memory-failure.c                                |    6 +-
 mm/memory.c                                        |  345 ++++++++++--
 mm/mempolicy.c                                     |   27 +-
 mm/mlock.c                                         |   37 +-
 mm/mmap.c                                          |  605 +++++++++++++++++---
 mm/mprotect.c                                      |  133 +++++-
 mm/mremap.c                                        |   45 ++-
 mm/nommu.c                                         |   10 -
 mm/page_alloc.c                                    |   21 +-
 mm/percpu.c                                        |    2 +-
 mm/rmap.c                                          |   11 +
 mm/shmem.c                                         |    7 +-
 mm/slab.c                                          |   79 ++-
 mm/slob.c                                          |  180 +++++-
 mm/slub.c                                          |   77 ++-
 mm/swap.c                                          |    3 +
 mm/util.c                                          |    6 +
 mm/vmalloc.c                                       |   93 +++-
 mm/vmstat.c                                        |    6 +-
 net/8021q/vlan.c                                   |    3 +-
 net/9p/trans_fd.c                                  |    2 +-
 net/atm/atm_misc.c                                 |    8 +-
 net/atm/lec.h                                      |    2 +-
 net/atm/mpc.h                                      |    2 +-
 net/atm/proc.c                                     |    6 +-
 net/atm/resources.c                                |    4 +-
 net/bridge/br_stp_if.c                             |    2 +-
 net/compat.c                                       |   26 +-
 net/core/dev.c                                     |    6 +-
 net/core/flow.c                                    |   14 +-
 net/core/rtnetlink.c                               |    2 +-
 net/core/scm.c                                     |    8 +-
 net/core/sock.c                                    |    8 +-
 net/decnet/sysctl_net_decnet.c                     |    4 +-
 net/ieee802154/dgram.c                             |    2 +-
 net/ieee802154/raw.c                               |    2 +-
 net/ipv4/inetpeer.c                                |    2 +-
 net/ipv4/ip_fragment.c                             |    2 +-
 net/ipv4/ip_sockglue.c                             |    2 +-
 net/ipv4/ipconfig.c                                |    6 +-
 net/ipv4/netfilter/nf_nat_snmp_basic.c             |    2 +-
 net/ipv4/raw.c                                     |   16 +-
 net/ipv4/route.c                                   |    6 +-
 net/ipv4/tcp_probe.c                               |    2 +-
 net/ipv4/udp.c                                     |    4 +-
 net/ipv6/addrconf.c                                |    2 +-
 net/ipv6/inet6_connection_sock.c                   |    4 +-
 net/ipv6/inet6_hashtables.c                        |    2 +-
 net/ipv6/ipv6_sockglue.c                           |    2 +-
 net/ipv6/raw.c                                     |   23 +-
 net/ipv6/udp.c                                     |    4 +-
 net/irda/ircomm/ircomm_tty.c                       |   38 +-
 net/iucv/af_iucv.c                                 |    4 +-
 net/lapb/lapb_iface.c                              |   26 +-
 net/mac80211/ieee80211_i.h                         |    3 +-
 net/mac80211/iface.c                               |   12 +-
 net/mac80211/main.c                                |    2 +-
 net/mac80211/pm.c                                  |    2 +-
 net/mac80211/rate.c                                |    2 +-
 net/mac80211/tx.c                                  |    2 +-
 net/mac80211/util.c                                |    2 +-
 net/netfilter/ipvs/ip_vs_app.c                     |    2 +-
 net/netfilter/ipvs/ip_vs_conn.c                    |   12 +-
 net/netfilter/ipvs/ip_vs_core.c                    |    4 +-
 net/netfilter/ipvs/ip_vs_ctl.c                     |   14 +-
 net/netfilter/ipvs/ip_vs_sync.c                    |    2 +-
 net/netfilter/ipvs/ip_vs_xmit.c                    |    4 +-
 net/netfilter/nf_conntrack_netlink.c               |    2 +-
 net/netfilter/nfnetlink_log.c                      |    4 +-
 net/netlink/af_netlink.c                           |    4 +-
 net/phonet/datagram.c                              |    2 +-
 net/phonet/pep.c                                   |    6 +-
 net/phonet/socket.c                                |    2 +-
 net/rds/cong.c                                     |    6 +-
 net/rds/tcp.c                                      |    2 +-
 net/rds/tcp_send.c                                 |    2 +-
 net/rxrpc/af_rxrpc.c                               |    2 +-
 net/rxrpc/ar-ack.c                                 |   14 +-
 net/rxrpc/ar-call.c                                |    2 +-
 net/rxrpc/ar-connection.c                          |    2 +-
 net/rxrpc/ar-connevent.c                           |    2 +-
 net/rxrpc/ar-input.c                               |    4 +-
 net/rxrpc/ar-internal.h                            |    8 +-
 net/rxrpc/ar-local.c                               |    2 +-
 net/rxrpc/ar-output.c                              |    4 +-
 net/rxrpc/ar-peer.c                                |    2 +-
 net/rxrpc/ar-proc.c                                |    4 +-
 net/rxrpc/ar-transport.c                           |    2 +-
 net/rxrpc/rxkad.c                                  |    4 +-
 net/sctp/socket.c                                  |    1 -
 net/socket.c                                       |    2 +-
 net/sunrpc/sched.c                                 |    4 +-
 net/sunrpc/xprtrdma/svc_rdma.c                     |   38 +-
 net/sunrpc/xprtrdma/svc_rdma_recvfrom.c            |    6 +-
 net/sunrpc/xprtrdma/svc_rdma_sendto.c              |    2 +-
 net/sunrpc/xprtrdma/svc_rdma_transport.c           |   10 +-
 net/tipc/link.c                                    |    4 +-
 net/tipc/subscr.c                                  |    2 +-
 net/wireless/core.h                                |    2 +-
 net/wireless/wext.c                                |   19 +-
 net/xfrm/xfrm_policy.c                             |   20 +-
 scripts/Makefile.build                             |    2 +-
 scripts/Makefile.clean                             |    3 +-
 scripts/Makefile.host                              |    2 +
 scripts/basic/fixdep.c                             |   10 +-
 scripts/gcc-plugin.sh                              |    2 +
 scripts/mod/file2alias.c                           |   14 +-
 scripts/mod/modpost.c                              |   25 +-
 scripts/mod/modpost.h                              |    6 +-
 scripts/mod/sumversion.c                           |    2 +-
 scripts/package/mkspec                             |    2 +-
 scripts/pnmtologo.c                                |    6 +-
 scripts/tags.sh                                    |    9 +
 security/Kconfig                                   |  582 +++++++++++++++++++-
 security/capability.c                              |    2 +-
 security/integrity/ima/ima.h                       |    4 +-
 security/integrity/ima/ima_api.c                   |    2 +-
 security/integrity/ima/ima_fs.c                    |    4 +-
 security/integrity/ima/ima_queue.c                 |    2 +-
 security/keys/keyring.c                            |    6 +-
 security/root_plug.c                               |    2 +-
 security/security.c                                |    4 +-
 security/selinux/hooks.c                           |    6 +-
 security/selinux/include/xfrm.h                    |    2 +-
 security/smack/smack_lsm.c                         |    2 +-
 security/tomoyo/tomoyo.c                           |    2 +-
 sound/aoa/codecs/onyx.c                            |    7 +-
 sound/aoa/codecs/onyx.h                            |    1 +
 sound/core/oss/pcm_oss.c                           |    4 +-
 sound/core/pcm_compat.c                            |    2 +-
 sound/core/pcm_native.c                            |    4 +-
 sound/core/seq/seq_device.c                        |    8 +-
 sound/drivers/mts64.c                              |   14 +-
 sound/drivers/opl4/opl4_lib.c                      |    2 +-
 sound/drivers/portman2x4.c                         |    3 +-
 sound/isa/cmi8330.c                                |    2 +-
 sound/oss/sb_audio.c                               |    2 +-
 sound/oss/swarm_cs4297a.c                          |    6 +-
 sound/pci/hda/hda_codec.h                          |    7 +-
 sound/pci/hda/patch_atihdmi.c                      |    2 +-
 sound/pci/hda/patch_intelhdmi.c                    |   10 +-
 sound/pci/hda/patch_nvhdmi.c                       |    4 +-
 sound/pci/hda/patch_sigmatel.c                     |    4 +-
 sound/pci/ice1712/ice1712.h                        |    4 +-
 sound/pci/intel8x0m.c                              |    2 +-
 sound/pci/ymfpci/ymfpci_main.c                     |   12 +-
 sound/soc/soc-core.c                               |    2 +-
 sound/usb/usbaudio.c                               |   18 +-
 tools/gcc/Makefile                                 |   21 +
 tools/gcc/checker_plugin.c                         |  171 ++++++
 tools/gcc/constify_plugin.c                        |  303 ++++++++++
 tools/gcc/kallocstat_plugin.c                      |  167 ++++++
 tools/gcc/kernexec_plugin.c                        |  348 +++++++++++
 tools/gcc/stackleak_plugin.c                       |  291 ++++++++++
 usr/gen_init_cpio.c                                |    7 +-
 virt/kvm/kvm_main.c                                |   14 +-
 1158 files changed, 17506 insertions(+), 5814 deletions(-)
