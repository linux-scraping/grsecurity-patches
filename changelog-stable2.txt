commit 2e14678ba6bf7f4ffc2ececdcc6b3d14002ad869
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 13 19:41:57 2012 -0400

    Add new is_privileged_binary/is_root_privileged_binary functions, make RBAC linking restrictions
    and option-based linking restrictions use it
    Clean up our sgid mode checking

 grsecurity/gracl.c         |    6 +++---
 grsecurity/gracl_fs.c      |    8 +++++---
 grsecurity/grsec_link.c    |    3 +--
 include/linux/capability.h |    3 +++
 security/commoncap.c       |   39 +++++++++++++++++++++++++++++++++++++++
 5 files changed, 51 insertions(+), 8 deletions(-)

commit 3b18bc2a49b11fd01acbc381173b75548deb103f
Merge: a79758b 32a01e6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 12 09:07:25 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	tools/gcc/size_overflow_hash.data

commit 32a01e604a6ec3d3abc977672a440ded1ef73328
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 12 09:05:34 2012 -0400

    Resync with pax-linux-3.2.27-test66.patch

 drivers/char/random.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit f7aa230be1b6840a113c4cb720e8ad36d8bad044
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 12 08:59:46 2012 -0400

    Update to pax-linux-3.2.25-test66.patch:
    - new size overflow plugin from Emese that hopefully fixes most of the false positives and also adds more instrumentation (e.g., type casts)
    - size overflow plugin update from Emese that fixes a false positive
    - a USERCOPY false positive fix reported by Christian Lamparter
    - fixed REFCOUNT on arm
    - fixed size overflow attr placement on alloc_vmap_area

 arch/arm/include/asm/atomic.h     |    8 +-
 arch/x86/kernel/kdebugfs.c        |    4 +-
 arch/x86/lib/usercopy_32.c        |   12 +-
 include/linux/slob_def.h          |    5 +-
 include/linux/slub_def.h          |   11 +-
 mm/vmalloc.c                      |    2 +-
 net/packet/af_packet.c            |    4 +-
 tools/gcc/size_overflow_hash.data |  598 ++++++++++++++++++++++++++++++--
 tools/gcc/size_overflow_plugin.c  |  698 ++++++++++++++++++++++++++++---------
 9 files changed, 1113 insertions(+), 229 deletions(-)

commit a79758b2db5a3fc53a4cbe78bc074f991d4ea391
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 11 19:35:19 2012 -0400

    Compile fix

 fs/namei.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

commit 8576c72583c41311549cce220f1c0a47f8a173e0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 11 19:24:22 2012 -0400

    Compile fix

 fs/namei.c |   17 ++++++++++++-----
 1 files changed, 12 insertions(+), 5 deletions(-)

commit b05ca9cb2ba50775d77181de023437d8497536c3
Merge: 91f315f d9355b0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 11 18:59:32 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit d9355b03dc360fe61ed8853cf60c3e315090c887
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 11 18:58:58 2012 -0400

    Fix compilation error with random backport, to be added to next PaX patch

 drivers/char/random.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 91f315fef436010318ffb766bb3b7050f35ac609
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 11 18:34:48 2012 -0400

    Fix improper log/error about already-created file as the result of a creat()
    on a dangling symlink as part of the recent symlinkown feature
    Found via expanded regression tests
    
    Conflicts:
    
    	fs/namei.c

 fs/namei.c |   37 ++++++++++++++++++++++++-------------
 1 files changed, 24 insertions(+), 13 deletions(-)

commit 33b368d00a1f5f86e4a9c722b067f56e75a00ef6
Merge: 4869880 7efbca5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 11 11:36:06 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 7efbca57cdd3c79370673d4983dbb96df92eb18e
Merge: f3567cf 8524c78
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Aug 11 11:35:57 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2

commit 4869880e88336056e2265df129ce47cf50d17bcd
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Aug 10 18:59:04 2012 -0400

    Check target against NULL for recent symlinkown feature or we'll oops
    on trying to check the ownership of a non-existent symlink target
    Thanks to CloudLinux for reporting

 grsecurity/grsec_link.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 19f1c5d109d8561fdef96f21714aec86a69ada8f
Merge: 5022fc9 f3567cf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 6 20:14:15 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit f3567cf21a05d80e297c4a3f2ae01550fe35542d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 6 20:13:33 2012 -0400

    Update to pax-linux-3.2.25-test65.patch:
    - fixed mm.pax_flags configuration dependency

 include/linux/mm_types.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 5022fc94152a318f0095718682ad3197cf8e9c47
Merge: 2e73a89 f754e20
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 6 17:12:02 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit f754e2099a8d1bc931a84f506b93d0c1b99547ea
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Aug 6 17:11:37 2012 -0400

    Update to pax-linux-3.2.25-test64.patch:
    - fixed another i386/KERNEXEC and EFI boot problem reported by Maxim Kammerer, https://bugs.gentoo.org/show_bug.cgi?id=430122

 arch/x86/platform/efi/efi_stub_32.S |   22 +++++++++++++++++++---
 1 files changed, 19 insertions(+), 3 deletions(-)

commit 2e73a89328e9b3a6dfce6629342b1189bab330c0
Merge: 055825f 7930360
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 5 16:33:35 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 7930360ba4ec9efceeefdf2d9a053b016c25364e
Merge: 8788627 46159f6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 5 16:32:31 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2
    
    Conflicts:
    	include/linux/cpuset.h

commit 8788627d31831ff62c155dba74bdd0ddd69a1cc1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 5 16:30:13 2012 -0400

    Update to pax-linux-3.2.25-test63.patch
    - fixed i386/KERNEXEC and EFI boot problem reported by Maxim Kammerer, https://bugs.gentoo.org/show_bug.cgi?id=428726

 arch/x86/boot/header.S |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

commit 055825ffd4cae340bb3d641204938fd13740b425
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 5 16:15:25 2012 -0400

    Revert use of %pP for /proc/kallsyms (since we also ignore for %pK)

 kernel/kallsyms.c |    5 -----
 1 files changed, 0 insertions(+), 5 deletions(-)

commit 56847a908a5316edca015fd6bddaf329014d28e0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 5 15:57:04 2012 -0400

    Add missing |

 arch/powerpc/include/asm/thread_info.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit aab36907347876f198619246c04a80ecbcca423f
Author: Darren Hart <dvhart@linux.intel.com>
Date:   Fri Jul 20 11:53:29 2012 -0700

    futex: Test for pi_mutex on fault in futex_wait_requeue_pi()
    
    If fixup_pi_state_owner() faults, pi_mutex may be NULL. Test
    for pi_mutex != NULL before testing the owner against current
    and possibly unlocking it.
    
    Signed-off-by: Darren Hart <dvhart@linux.intel.com>
    Cc: Dave Jones <davej@redhat.com>
    Cc: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable@vger.kernel.org
    Link: http://lkml.kernel.org/r/dc59890338fc413606f04e5c5b131530734dae3d.1342809673.git.dvhart@linux.intel.com
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

 kernel/futex.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 3b3b242bc6f0969a05472e955971803aef2035bb
Author: Darren Hart <dvhart@linux.intel.com>
Date:   Fri Jul 20 11:53:31 2012 -0700

    futex: Forbid uaddr == uaddr2 in futex_wait_requeue_pi()
    
    If uaddr == uaddr2, then we have broken the rule of only requeueing
    from a non-pi futex to a pi futex with this call. If we attempt this,
    as the trinity test suite manages to do, we miss early wakeups as
    q.key is equal to key2 (because they are the same uaddr). We will then
    attempt to dereference the pi_mutex (which would exist had the futex_q
    been properly requeued to a pi futex) and trigger a NULL pointer
    dereference.
    
    Signed-off-by: Darren Hart <dvhart@linux.intel.com>
    Cc: Dave Jones <davej@redhat.com>
    Cc: stable@vger.kernel.org
    Link: http://lkml.kernel.org/r/ad82bfe7f7d130247fbe2b5b4275654807774227.1342809673.git.dvhart@linux.intel.com
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

 kernel/futex.c |   13 ++++++++-----
 1 files changed, 8 insertions(+), 5 deletions(-)

commit bc356be3c4ea090f2dae77388bdc9e8fa257907e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Aug 5 13:09:41 2012 -0400

    Ignore extra usercopy check for %pK pointers

 lib/vsprintf.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

commit 21f06451e2966a5828632f8f33ccedc35c53b3b8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Aug 2 15:17:24 2012 -0400

    Use the unchecked function for the unchecked atomic_t

 net/netfilter/nf_conntrack_core.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit d042057c83a3c32a6ccea5629eb8aa0bc4ca9d52
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Aug 1 17:11:37 2012 -0400

    Replace infoleaking slab name with an atomic counter

 net/netfilter/nf_conntrack_core.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

commit bdf961c0ce8c273fec77f9bc5200abe62ff962d9
Author: Kees Cook <keescook@chromium.org>
Date:   Mon Jul 30 14:39:15 2012 -0700

    fs: make dumpable=2 require fully qualified path
    
    When the suid_dumpable sysctl is set to "2", and there is no core dump
    pipe defined in the core_pattern sysctl, a local user can cause core files
    to be written to root-writable directories, potentially with
    user-controlled content.
    
    This means an admin can unknowningly reintroduce a variation of
    CVE-2006-2451, allowing local users to gain root privileges.
    
      $ cat /proc/sys/fs/suid_dumpable
      2
      $ cat /proc/sys/kernel/core_pattern
      core
      $ ulimit -c unlimited
      $ cd /
      $ ls -l core
      ls: cannot access core: No such file or directory
      $ touch core
      touch: cannot touch `core': Permission denied
      $ OHAI="evil-string-here" ping localhost >/dev/null 2>&1 &
      $ pid=$!
      $ sleep 1
      $ kill -SEGV $pid
      $ ls -l core
      -rw------- 1 root kees 458752 Jun 21 11:35 core
      $ sudo strings core | grep evil
      OHAI=evil-string-here
    
    While cron has been fixed to abort reading a file when there is any
    parse error, there are still other sensitive directories that will read
    any file present and skip unparsable lines.
    
    Instead of introducing a suid_dumpable=3 mode and breaking all users of
    mode 2, this only disables the unsafe portion of mode 2 (writing to disk
    via relative path).  Most users of mode 2 (e.g.  Chrome OS) already use
    a core dump pipe handler, so this change will not break them.  For the
    situations where a pipe handler is not defined but mode 2 is still
    active, crash dumps will only be written to fully qualified paths.  If a
    relative path is defined (e.g.  the default "core" pattern), dump
    attempts will trigger a printk yelling about the lack of a fully
    qualified path.
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Cc: Alexander Viro <viro@zeniv.linux.org.uk>
    Cc: Alan Cox <alan@linux.intel.com>
    Cc: "Eric W. Biederman" <ebiederm@xmission.com>
    Cc: Doug Ledford <dledford@redhat.com>
    Cc: Serge Hallyn <serge.hallyn@canonical.com>
    Cc: James Morris <james.l.morris@oracle.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/exec.c

 Documentation/sysctl/fs.txt |   18 ++++++++++++------
 fs/exec.c                   |   17 ++++++++++++++---
 2 files changed, 26 insertions(+), 9 deletions(-)

commit e1d17e6745054cfde649b10df761a3343ad2481a
Author: Kees Cook <keescook@chromium.org>
Date:   Mon Jul 30 14:39:18 2012 -0700

    coredump: warn about unsafe suid_dumpable / core_pattern combo
    
    When suid_dumpable=2, detect unsafe core_pattern settings and warn when
    they are seen.
    
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Suggested-by: Andrew Morton <akpm@linux-foundation.org>
    Cc: Alexander Viro <viro@zeniv.linux.org.uk>
    Cc: Alan Cox <alan@linux.intel.com>
    Cc: "Eric W. Biederman" <ebiederm@xmission.com>
    Cc: Doug Ledford <dledford@redhat.com>
    Cc: Serge Hallyn <serge.hallyn@canonical.com>
    Cc: James Morris <james.l.morris@oracle.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/exec.c             |   10 +++++-----
 include/linux/sched.h |    5 +++++
 kernel/sysctl.c       |   37 +++++++++++++++++++++++++++++++++++--
 3 files changed, 45 insertions(+), 7 deletions(-)

commit 1ff657169a73fd3b867cae8e2ff96e6ae9b787e9
Author: Vikram Mulukutla <markivx@codeaurora.org>
Date:   Mon Jul 30 14:39:58 2012 -0700

    panic: fix a possible deadlock in panic()
    
    panic_lock is meant to ensure that panic processing takes place only on
    one cpu; if any of the other cpus encounter a panic, they will spin
    waiting to be shut down.
    
    However, this causes a regression in this scenario:
    
    1. Cpu 0 encounters a panic and acquires the panic_lock
       and proceeds with the panic processing.
    2. There is an interrupt on cpu 0 that also encounters
       an error condition and invokes panic.
    3. This second invocation fails to acquire the panic_lock
       and enters the infinite while loop in panic_smp_self_stop.
    
    Thus all panic processing is stopped, and the cpu is stuck for eternity
    in the while(1) inside panic_smp_self_stop.
    
    To address this, disable local interrupts with local_irq_disable before
    acquiring the panic_lock.  This will prevent interrupt handlers from
    executing during the panic processing, thus avoiding this particular
    problem.
    
    Signed-off-by: Vikram Mulukutla <markivx@codeaurora.org>
    Reviewed-by: Stephen Boyd <sboyd@codeaurora.org>
    Cc: Michael Holzheu <holzheu@linux.vnet.ibm.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 kernel/panic.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

commit 2fc0903279968f047338bf7b4fd3cb28f3328e31
Author: Alan Cox <alan@linux.intel.com>
Date:   Mon Jul 30 14:40:06 2012 -0700

    drivers/misc/ti-st/st_core.c: missing NULL check
    
    Addresses https://bugzilla.kernel.org/show_bug.cgi?44431
    
    Reported-by: <rucsoftsec@gmail.com>
    Signed-off-by: Alan Cox <alan@linux.intel.com>
    Cc: Pavan Savoy <pavan_savoy@ti.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 drivers/misc/ti-st/st_core.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

commit 978dc4032dc7984c178ad9089e6ca2bb7c0dd3c3
Author: Dan Rosenberg <drosenberg@vsecurity.com>
Date:   Mon Jul 30 14:40:26 2012 -0700

    lib/vsprintf.c: kptr_restrict: fix pK-error in SysRq show-all-timers(Q)
    
    When using ALT+SysRq+Q all the pointers are replaced with "pK-error" like
    this:
    
    	[23153.208033]   .base:               pK-error
    
    with echo h > /proc/sysrq-trigger it works:
    
    	[23107.776363]   .base:       ffff88023e60d540
    
    The intent behind this behavior was to return "pK-error" in cases where
    the %pK format specifier was used in interrupt context, because the
    CAP_SYSLOG check wouldn't be meaningful.  Clearly this should only apply
    when kptr_restrict is actually enabled though.
    
    Reported-by: Stevie Trujillo <stevie.trujillo@gmail.com>
    Signed-off-by: Dan Rosenberg <dan.j.rosenberg@gmail.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 lib/vsprintf.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit d6f435730e9641fb190c4a47fc0236ddfeea1a8f
Author: Alan Cox <alan@linux.intel.com>
Date:   Mon Jul 30 14:43:24 2012 -0700

    drivers/misc/lkdtm.c: fix missing allocation failure check
    
    Addresses https://bugzilla.kernel.org/show_bug.cgi?id=44691
    
    Reported-by: <rucsoftsec@gmail.com>
    Signed-off-by: Alan Cox <alan@linux.intel.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 drivers/misc/lkdtm.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 1bf70dad38818f9094d7f93c8d8468635a617107
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 31 17:59:16 2012 -0400

    Report discovered infoleaks

 lib/vsprintf.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

commit 1d88dc0eb21d4abfde3105730fa4e9798b542a86
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 31 17:52:28 2012 -0400

    Backport HIDESYM improvements

 fs/seq_file.c      |   16 ++++++++++++++++
 grsecurity/Kconfig |    1 +
 kernel/kallsyms.c  |    6 ++++++
 lib/vsprintf.c     |   12 ++++++++++++
 4 files changed, 35 insertions(+), 0 deletions(-)

commit cb070660f50eb5bc1e4bbee4fccd30ff0aeb8f0a
Merge: afa78ca 8bb1d88
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 30 20:47:23 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 8bb1d8886a163f5acd97118891fb91b49e8d65cb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 30 20:46:47 2012 -0400

    Update to pax-linux-3.2.24-test62.patch:
    - fixed two bugs reported by Maxim Kammerer in https://bugs.gentoo.org/show_bug.
    cgi?id=428576
      - i386 percpu data has to be relocated even for !KERNEXEC, a regression after
    2.6.32
      - work around some ld 'smartness' that merges empty sections with symbols, fix
    es relocatable !MODULES i386 builds

 arch/x86/kernel/vmlinux.lds.S |    5 +++--
 arch/x86/tools/relocs.c       |    4 ++--
 2 files changed, 5 insertions(+), 4 deletions(-)

commit afa78ca234749ead28b50598bd3727eef3acb0bd
Author: Weiping Pan <wpan@redhat.com>
Date:   Mon Jul 23 10:37:48 2012 +0800

    rds: set correct msg_namelen
    
    Jay Fenlason (fenlason@redhat.com) found a bug,
    that recvfrom() on an RDS socket can return the contents of random kernel
    memory to userspace if it was called with a address length larger than
    sizeof(struct sockaddr_in).
    rds_recvmsg() also fails to set the addr_len paramater properly before
    returning, but that's just a bug.
    There are also a number of cases wher recvfrom() can return an entirely bogus
    address. Anything in rds_recvmsg() that returns a non-negative value but does
    not go through the "sin = (struct sockaddr_in *)msg->msg_name;" code path
    at the end of the while(1) loop will return up to 128 bytes of kernel memory
    to userspace.
    
    And I write two test programs to reproduce this bug, you will see that in
    rds_server, fromAddr will be overwritten and the following sock_fd will be
    destroyed.
    Yes, it is the programmer's fault to set msg_namelen incorrectly, but it is
    better to make the kernel copy the real length of address to user space in
    such case.
    
    How to run the test programs ?
    I test them on 32bit x86 system, 3.5.0-rc7.
    
    1 compile
    gcc -o rds_client rds_client.c
    gcc -o rds_server rds_server.c
    
    2 run ./rds_server on one console
    
    3 run ./rds_client on another console
    
    4 you will see something like:
    server is waiting to receive data...
    old socket fd=3
    server received data from client:data from client
    msg.msg_namelen=32
    new socket fd=-1067277685
    sendmsg()
    : Bad file descriptor
    
    /***************** rds_client.c ********************/
    
    int main(void)
    {
    	int sock_fd;
    	struct sockaddr_in serverAddr;
    	struct sockaddr_in toAddr;
    	char recvBuffer[128] = "data from client";
    	struct msghdr msg;
    	struct iovec iov;
    
    	sock_fd = socket(AF_RDS, SOCK_SEQPACKET, 0);
    	if (sock_fd < 0) {
    		perror("create socket error\n");
    		exit(1);
    	}
    
    	memset(&serverAddr, 0, sizeof(serverAddr));
    	serverAddr.sin_family = AF_INET;
    	serverAddr.sin_addr.s_addr = inet_addr("127.0.0.1");
    	serverAddr.sin_port = htons(4001);
    
    	if (bind(sock_fd, (struct sockaddr*)&serverAddr, sizeof(serverAddr)) < 0) {
    		perror("bind() error\n");
    		close(sock_fd);
    		exit(1);
    	}
    
    	memset(&toAddr, 0, sizeof(toAddr));
    	toAddr.sin_family = AF_INET;
    	toAddr.sin_addr.s_addr = inet_addr("127.0.0.1");
    	toAddr.sin_port = htons(4000);
    	msg.msg_name = &toAddr;
    	msg.msg_namelen = sizeof(toAddr);
    	msg.msg_iov = &iov;
    	msg.msg_iovlen = 1;
    	msg.msg_iov->iov_base = recvBuffer;
    	msg.msg_iov->iov_len = strlen(recvBuffer) + 1;
    	msg.msg_control = 0;
    	msg.msg_controllen = 0;
    	msg.msg_flags = 0;
    
    	if (sendmsg(sock_fd, &msg, 0) == -1) {
    		perror("sendto() error\n");
    		close(sock_fd);
    		exit(1);
    	}
    
    	printf("client send data:%s\n", recvBuffer);
    
    	memset(recvBuffer, '\0', 128);
    
    	msg.msg_name = &toAddr;
    	msg.msg_namelen = sizeof(toAddr);
    	msg.msg_iov = &iov;
    	msg.msg_iovlen = 1;
    	msg.msg_iov->iov_base = recvBuffer;
    	msg.msg_iov->iov_len = 128;
    	msg.msg_control = 0;
    	msg.msg_controllen = 0;
    	msg.msg_flags = 0;
    	if (recvmsg(sock_fd, &msg, 0) == -1) {
    		perror("recvmsg() error\n");
    		close(sock_fd);
    		exit(1);
    	}
    
    	printf("receive data from server:%s\n", recvBuffer);
    
    	close(sock_fd);
    
    	return 0;
    }
    
    /***************** rds_server.c ********************/
    
    int main(void)
    {
    	struct sockaddr_in fromAddr;
    	int sock_fd;
    	struct sockaddr_in serverAddr;
    	unsigned int addrLen;
    	char recvBuffer[128];
    	struct msghdr msg;
    	struct iovec iov;
    
    	sock_fd = socket(AF_RDS, SOCK_SEQPACKET, 0);
    	if(sock_fd < 0) {
    		perror("create socket error\n");
    		exit(0);
    	}
    
    	memset(&serverAddr, 0, sizeof(serverAddr));
    	serverAddr.sin_family = AF_INET;
    	serverAddr.sin_addr.s_addr = inet_addr("127.0.0.1");
    	serverAddr.sin_port = htons(4000);
    	if (bind(sock_fd, (struct sockaddr*)&serverAddr, sizeof(serverAddr)) < 0) {
    		perror("bind error\n");
    		close(sock_fd);
    		exit(1);
    	}
    
    	printf("server is waiting to receive data...\n");
    	msg.msg_name = &fromAddr;
    
    	/*
    	 * I add 16 to sizeof(fromAddr), ie 32,
    	 * and pay attention to the definition of fromAddr,
    	 * recvmsg() will overwrite sock_fd,
    	 * since kernel will copy 32 bytes to userspace.
    	 *
    	 * If you just use sizeof(fromAddr), it works fine.
    	 * */
    	msg.msg_namelen = sizeof(fromAddr) + 16;
    	/* msg.msg_namelen = sizeof(fromAddr); */
    	msg.msg_iov = &iov;
    	msg.msg_iovlen = 1;
    	msg.msg_iov->iov_base = recvBuffer;
    	msg.msg_iov->iov_len = 128;
    	msg.msg_control = 0;
    	msg.msg_controllen = 0;
    	msg.msg_flags = 0;
    
    	while (1) {
    		printf("old socket fd=%d\n", sock_fd);
    		if (recvmsg(sock_fd, &msg, 0) == -1) {
    			perror("recvmsg() error\n");
    			close(sock_fd);
    			exit(1);
    		}
    		printf("server received data from client:%s\n", recvBuffer);
    		printf("msg.msg_namelen=%d\n", msg.msg_namelen);
    		printf("new socket fd=%d\n", sock_fd);
    		strcat(recvBuffer, "--data from server");
    		if (sendmsg(sock_fd, &msg, 0) == -1) {
    			perror("sendmsg()\n");
    			close(sock_fd);
    			exit(1);
    		}
    	}
    
    	close(sock_fd);
    	return 0;
    }
    
    Signed-off-by: Weiping Pan <wpan@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/rds/recv.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit b7ba29aded22f70984faaa7c9f1b73c3b1288029
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 30 16:59:06 2012 -0400

    Make GRKERNSEC enable PROC_FS

 security/Kconfig |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 2fe098cf8186c44e9054bf09400f74c0d9ad247e
Merge: 6580df1 36d1e9d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 19:42:13 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 36d1e9d0002a5ceb808a69c982dd09ccfb27e6ee
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 19:41:58 2012 -0400

    Initialize mlock error code to 0, fixes erroneous -EINVAL reported with lvm on the forums

 mm/mlock.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 6580df1ae3e40356f1f62eba67f45e7cdd44f096
Merge: 994968f d4eda49
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 19:25:50 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit d4eda493c8d1164a617accf5472e896b5b60f2cf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 19:24:13 2012 -0400

    Update to pax-linux-3.4.6-test25.patch:
    - added emulation for new sparc plt stubs

 arch/sparc/mm/fault_32.c |   25 +++++++++++++++++--------
 arch/sparc/mm/fault_64.c |   25 +++++++++++++++++--------
 2 files changed, 34 insertions(+), 16 deletions(-)

commit 994968fdb7af281b51d49073ff2fef9fc1b031fa
Merge: ad24d29 582536f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 18:20:49 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 582536f50d870e33170f8d84030f558fcb2dd1c5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 18:18:09 2012 -0400

    Backport changes from pax-linux-3.4.6-test25.patch:
    - added emulation for a new sparc plt stub

 arch/sparc/mm/fault_32.c |   14 ++++++++++----
 arch/sparc/mm/fault_64.c |   14 ++++++++++----
 2 files changed, 20 insertions(+), 8 deletions(-)

commit ad24d2998dfc51bbc6606b0351dd7839e79a0643
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 09:49:32 2012 -0400

    Turn on the latent entropy plugin by default

 security/Kconfig |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 7432ac9aa8ab3592cacfd3a11c231c8273739526
Merge: 7290ed7 04a7342
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 09:29:28 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	arch/x86/Kconfig.debug
    	drivers/net/macvtap.c
    	net/ipv4/tcp_input.c
    	security/Kconfig

commit 04a73423b33e31524c3b29f040c51b9a8e91e207
Merge: edde633 f1e79c6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 28 09:15:51 2012 -0400

    Update to pax-linux-3.2.24-test60.patch
    - reorganized the USERCOPY infrastructure so that grsecurity can depend on certain parts of it
    - fix up the last changes as pointed out by spender
    - reworked the latent entropy plugin to use an explicit function attribute
    - fixed a recent REFCOUNT change that broke !X86
    - made the latent entropy plugin sort of LTO compatible
    
    Merge branch 'linux-3.2.y' into pax-stable2
    
    Conflicts:
    	fs/fifo.c

commit 7290ed76c06db017bb2b3bc177d0b35a6272b6f9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 24 20:34:13 2012 -0400

    use min_t instead of min

 fs/proc/base.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 7d380229894aacfb9d0029b0f8c5e87c0337bd7d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 24 20:31:08 2012 -0400

    Move procpidmem task checks to __mem_open

 fs/proc/base.c |   13 +++++++++++--
 1 files changed, 11 insertions(+), 2 deletions(-)

commit dababafd05846780a20edac8c8f6413c592af67b
Author: Cong Wang <xiyou.wangcong@gmail.com>
Date:   Thu May 31 16:26:17 2012 -0700

    proc: remove mm_for_maps()
    
    mm_for_maps() is a simple wrapper for mm_access(), and the name is
    misleading, so just remove it and use mm_access() directly.
    
    Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>
    Cc: Oleg Nesterov <oleg@redhat.com>
    Cc: Alexey Dobriyan <adobriyan@gmail.com>
    Acked-by: Hugh Dickins <hughd@google.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/proc/base.c       |    7 +------
 fs/proc/internal.h   |    2 --
 fs/proc/task_mmu.c   |    4 ++--
 fs/proc/task_nommu.c |    2 +-
 4 files changed, 4 insertions(+), 11 deletions(-)

commit b3550501a3c34bb930714697dd1c82fa85ce0682
Author: Cong Wang <xiyou.wangcong@gmail.com>
Date:   Thu May 31 16:26:17 2012 -0700

    (don't introduce a vuln through use of the poorly-named FMODE_UNSIGNED_OFFSET, as
    fixed in:
    proc-do-not-allow-negative-offsets-on-proc-pid-environ.patch
    )
    
    proc: clean up /proc/<pid>/environ handling
    
    Similar to e268337dfe26 ("proc: clean up and fix /proc/<pid>/mem
    handling"), move the check of permission to open(), this will simplify
    read() code.
    
    [akpm@linux-foundation.org: checkpatch fixes]
    Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>
    Cc: Oleg Nesterov <oleg@redhat.com>
    Cc: Alexey Dobriyan <adobriyan@gmail.com>
    Cc: Hugh Dickins <hughd@google.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/proc/base.c

 fs/proc/base.c |   55 +++++++++++++++++++++++++++++++------------------------
 1 files changed, 31 insertions(+), 24 deletions(-)

commit 6c066f5ce501aeb51562fb198b5d9fc106db0e23
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 23 18:59:53 2012 -0400

    Fix up range checks on environ_read, reported at:
    http://permalink.gmane.org/gmane.linux.kernel.hardened.devel/472

 fs/proc/base.c |   13 +++++++------
 1 files changed, 7 insertions(+), 6 deletions(-)

commit e84fd0c03fabc811a4481637b44486dad94cafe0
Author: J. Bruce Fields <bfields@fieldses.org>
Date:   Mon Jul 23 15:17:17 2012 -0400

    locks: fix checking of fcntl_setlease argument
    
    The only checks of the long argument passed to fcntl(fd,F_SETLEASE,.)
    are done after converting the long to an int.  Thus some illegal values
    may be let through and cause problems in later code.
    
    [ They actually *don't* cause problems in mainline, as of Dave Jones's
      commit 8d657eb3b438 "Remove easily user-triggerable BUG from
      generic_setlease", but we should fix this anyway.  And this patch will
      be necessary to fix real bugs on earlier kernels. ]
    
    Cc: stable@vger.kernel.org
    Signed-off-by: J. Bruce Fields <bfields@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/locks.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

commit 5dc9bde08d3134aaad24ebd7d207cca74a7b7e05
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 21 12:42:17 2012 -0400

    Add second fs/bio.c overflow check

 fs/bio.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit aabe2561926257b774f3800f46f0679b4c85b862
Author: Anders Kaseorg <andersk@MIT.EDU>
Date:   Sun Jul 15 17:14:25 2012 -0400

    fifo: Do not restart open() if it already found a partner
    
    If a parent and child process open the two ends of a fifo, and the
    child immediately exits, the parent may receive a SIGCHLD before its
    open() returns.  In that case, we need to make sure that open() will
    return successfully after the SIGCHLD handler returns, instead of
    throwing EINTR or being restarted.  Otherwise, the restarted open()
    would incorrectly wait for a second partner on the other end.
    
    The following test demonstrates the EINTR that was wrongly thrown from
    the parent’s open().  Change .sa_flags = 0 to .sa_flags = SA_RESTART
    to see a deadlock instead, in which the restarted open() waits for a
    second reader that will never come.  (On my systems, this happens
    pretty reliably within about 5 to 500 iterations.  Others report that
    it manages to loop ~forever sometimes; YMMV.)
    
      #include <sys/stat.h>
      #include <sys/types.h>
      #include <sys/wait.h>
      #include <fcntl.h>
      #include <signal.h>
      #include <stdio.h>
      #include <stdlib.h>
      #include <unistd.h>
    
      #define CHECK(x) do if ((x) == -1) {perror(#x); abort();} while(0)
    
      void handler(int signum) {}
    
      int main()
      {
          struct sigaction act = {.sa_handler = handler, .sa_flags = 0};
          CHECK(sigaction(SIGCHLD, &act, NULL));
          CHECK(mknod("fifo", S_IFIFO | S_IRWXU, 0));
          for (;;) {
              int fd;
              pid_t pid;
              putc('.', stderr);
              CHECK(pid = fork());
              if (pid == 0) {
                  CHECK(fd = open("fifo", O_RDONLY));
                  _exit(0);
              }
              CHECK(fd = open("fifo", O_WRONLY));
              CHECK(close(fd));
              CHECK(waitpid(pid, NULL, 0));
          }
      }
    
    This is what I suspect was causing the Git test suite to fail in
    t9010-svn-fe.sh:
    
    	http://bugs.debian.org/678852
    
    Signed-off-by: Anders Kaseorg <andersk@mit.edu>
    Reviewed-by: Jonathan Nieder <jrnieder@gmail.com>
    Cc: stable@kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/fifo.c

 fs/fifo.c |    9 ++++-----
 1 files changed, 4 insertions(+), 5 deletions(-)

commit 8c4c2265fd1117ac6a0aa0b4b42903bce0b1af56
Author: Lin Ming <mlin@ss.pku.edu.cn>
Date:   Sat Jul 7 18:26:10 2012 +0800

    ipvs: fix oops on NAT reply in br_nf context
    
    IPVS should not reset skb->nf_bridge in FORWARD hook
    by calling nf_reset for NAT replies. It triggers oops in
    br_nf_forward_finish.
    
    [  579.781508] BUG: unable to handle kernel NULL pointer dereference at 0000000000000004
    [  579.781669] IP: [<ffffffff817b1ca5>] br_nf_forward_finish+0x58/0x112
    [  579.781792] PGD 218f9067 PUD 0
    [  579.781865] Oops: 0000 [#1] SMP
    [  579.781945] CPU 0
    [  579.781983] Modules linked in:
    [  579.782047]
    [  579.782080]
    [  579.782114] Pid: 4644, comm: qemu Tainted: G        W    3.5.0-rc5-00006-g95e69f9 #282 Hewlett-Packard  /30E8
    [  579.782300] RIP: 0010:[<ffffffff817b1ca5>]  [<ffffffff817b1ca5>] br_nf_forward_finish+0x58/0x112
    [  579.782455] RSP: 0018:ffff88007b003a98  EFLAGS: 00010287
    [  579.782541] RAX: 0000000000000008 RBX: ffff8800762ead00 RCX: 000000000001670a
    [  579.782653] RDX: 0000000000000000 RSI: 000000000000000a RDI: ffff8800762ead00
    [  579.782845] RBP: ffff88007b003ac8 R08: 0000000000016630 R09: ffff88007b003a90
    [  579.782957] R10: ffff88007b0038e8 R11: ffff88002da37540 R12: ffff88002da01a02
    [  579.783066] R13: ffff88002da01a80 R14: ffff88002d83c000 R15: ffff88002d82a000
    [  579.783177] FS:  0000000000000000(0000) GS:ffff88007b000000(0063) knlGS:00000000f62d1b70
    [  579.783306] CS:  0010 DS: 002b ES: 002b CR0: 000000008005003b
    [  579.783395] CR2: 0000000000000004 CR3: 00000000218fe000 CR4: 00000000000027f0
    [  579.783505] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
    [  579.783684] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
    [  579.783795] Process qemu (pid: 4644, threadinfo ffff880021b20000, task ffff880021aba760)
    [  579.783919] Stack:
    [  579.783959]  ffff88007693cedc ffff8800762ead00 ffff88002da01a02 ffff8800762ead00
    [  579.784110]  ffff88002da01a02 ffff88002da01a80 ffff88007b003b18 ffffffff817b26c7
    [  579.784260]  ffff880080000000 ffffffff81ef59f0 ffff8800762ead00 ffffffff81ef58b0
    [  579.784477] Call Trace:
    [  579.784523]  <IRQ>
    [  579.784562]
    [  579.784603]  [<ffffffff817b26c7>] br_nf_forward_ip+0x275/0x2c8
    [  579.784707]  [<ffffffff81704b58>] nf_iterate+0x47/0x7d
    [  579.784797]  [<ffffffff817ac32e>] ? br_dev_queue_push_xmit+0xae/0xae
    [  579.784906]  [<ffffffff81704bfb>] nf_hook_slow+0x6d/0x102
    [  579.784995]  [<ffffffff817ac32e>] ? br_dev_queue_push_xmit+0xae/0xae
    [  579.785175]  [<ffffffff8187fa95>] ? _raw_write_unlock_bh+0x19/0x1b
    [  579.785179]  [<ffffffff817ac417>] __br_forward+0x97/0xa2
    [  579.785179]  [<ffffffff817ad366>] br_handle_frame_finish+0x1a6/0x257
    [  579.785179]  [<ffffffff817b2386>] br_nf_pre_routing_finish+0x26d/0x2cb
    [  579.785179]  [<ffffffff817b2cf0>] br_nf_pre_routing+0x55d/0x5c1
    [  579.785179]  [<ffffffff81704b58>] nf_iterate+0x47/0x7d
    [  579.785179]  [<ffffffff817ad1c0>] ? br_handle_local_finish+0x44/0x44
    [  579.785179]  [<ffffffff81704bfb>] nf_hook_slow+0x6d/0x102
    [  579.785179]  [<ffffffff817ad1c0>] ? br_handle_local_finish+0x44/0x44
    [  579.785179]  [<ffffffff81551525>] ? sky2_poll+0xb35/0xb54
    [  579.785179]  [<ffffffff817ad62a>] br_handle_frame+0x213/0x229
    [  579.785179]  [<ffffffff817ad417>] ? br_handle_frame_finish+0x257/0x257
    [  579.785179]  [<ffffffff816e3b47>] __netif_receive_skb+0x2b4/0x3f1
    [  579.785179]  [<ffffffff816e69fc>] process_backlog+0x99/0x1e2
    [  579.785179]  [<ffffffff816e6800>] net_rx_action+0xdf/0x242
    [  579.785179]  [<ffffffff8107e8a8>] __do_softirq+0xc1/0x1e0
    [  579.785179]  [<ffffffff8135a5ba>] ? trace_hardirqs_off_thunk+0x3a/0x6c
    [  579.785179]  [<ffffffff8188812c>] call_softirq+0x1c/0x30
    
    The steps to reproduce as follow,
    
    1. On Host1, setup brige br0(192.168.1.106)
    2. Boot a kvm guest(192.168.1.105) on Host1 and start httpd
    3. Start IPVS service on Host1
       ipvsadm -A -t 192.168.1.106:80 -s rr
       ipvsadm -a -t 192.168.1.106:80 -r 192.168.1.105:80 -m
    4. Run apache benchmark on Host2(192.168.1.101)
       ab -n 1000 http://192.168.1.106/
    
    ip_vs_reply4
      ip_vs_out
        handle_response
          ip_vs_notrack
            nf_reset()
            {
              skb->nf_bridge = NULL;
            }
    
    Actually, IPVS wants in this case just to replace nfct
    with untracked version. So replace the nf_reset(skb) call
    in ip_vs_notrack() with a nf_conntrack_put(skb->nfct) call.
    
    Signed-off-by: Lin Ming <mlin@ss.pku.edu.cn>
    Signed-off-by: Julian Anastasov <ja@ssi.bg>
    Signed-off-by: Simon Horman <horms@verge.net.au>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

 include/net/ip_vs.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit c54dafbf667b537bf41c024db4de3f8400023250
Author: Mark Rustad <mark.d.rustad@intel.com>
Date:   Fri Jul 13 18:18:04 2012 -0700

    tcm_fc: Fix crash seen with aborts and large reads
    
    This patch fixes a crash seen when large reads have their exchange
    aborted by either timing out or being reset. Because the exchange
    abort results in the seq pointer being set to NULL, because the
    sequence is no longer valid, it must not be dereferenced. This
    patch changes the function ft_get_task_tag to return ~0 if it is
    unable to get the tag for this reason. Because the get_task_tag
    interface provides no means of returning an error, this seems
    like the best way to fix this issue at the moment.
    
    Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>

 drivers/target/tcm_fc/tfc_cmd.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit f6c4047f04bba1f0efbcd15b55640a71125a3235
Author: Roland Dreier <roland@purestorage.com>
Date:   Mon Jul 16 15:17:10 2012 -0700

    target: Clean up returning errors in PR handling code
    
     - instead of (PTR_ERR(file) < 0) just use IS_ERR(file)
     - return -EINVAL instead of EINVAL
     - all other error returns in target_scsi3_emulate_pr_out() use
       "goto out" -- get rid of the one remaining straight "return."
    
    Signed-off-by: Roland Dreier <roland@purestorage.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>

 drivers/target/target_core_pr.c |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

commit 2c353510c25a0039ac925e9e128d1a81bb3cf061
Author: Roland Dreier <roland@purestorage.com>
Date:   Mon Jul 16 17:10:17 2012 -0700

    target: Fix range calculation in WRITE SAME emulation when num blocks == 0
    
    When NUMBER OF LOGICAL BLOCKS is 0, WRITE SAME is supposed to write
    all the blocks from the specified LBA through the end of the device.
    However, dev->transport->get_blocks(dev) (perhaps confusingly) returns
    the last valid LBA rather than the number of blocks, so the correct
    number of blocks to write starting with lba is
    
    dev->transport->get_blocks(dev) - lba + 1
    
    (nab: Backport roland's for-3.6 patch to for-3.5)
    
    Signed-off-by: Roland Dreier <roland@purestorage.com>
    Cc: Cc: <stable@vger.kernel.org>
    Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>

 drivers/target/target_core_cdb.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 8c9a9d8125df2d33be1a1ac876f50b5e73d2f25a
Author: Sjur Brændeland <sjur.brandeland@stericsson.com>
Date:   Sun Jul 15 10:10:14 2012 +0000

    caif: Fix access to freed pernet memory
    
    unregister_netdevice_notifier() must be called before
    unregister_pernet_subsys() to avoid accessing already freed
    pernet memory. This fixes the following oops when doing rmmod:
    
    Call Trace:
     [<ffffffffa0f802bd>] caif_device_notify+0x4d/0x5a0 [caif]
     [<ffffffff81552ba9>] unregister_netdevice_notifier+0xb9/0x100
     [<ffffffffa0f86dcc>] caif_device_exit+0x1c/0x250 [caif]
     [<ffffffff810e7734>] sys_delete_module+0x1a4/0x300
     [<ffffffff810da82d>] ? trace_hardirqs_on_caller+0x15d/0x1e0
     [<ffffffff813517de>] ? trace_hardirqs_on_thunk+0x3a/0x3
     [<ffffffff81696bad>] system_call_fastpath+0x1a/0x1f
    
    RIP
     [<ffffffffa0f7f561>] caif_get+0x51/0xb0 [caif]
    
    Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com>
    Acked-by: "Eric W. Biederman" <ebiederm@xmission.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/caif/caif_dev.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit c69afd8f712c25c2bf218fa31d908679c38bc220
Author: Narendra K <narendra_k@dell.com>
Date:   Mon Jul 16 15:24:41 2012 +0000

    ixgbevf: Prevent RX/TX statistics getting reset to zero
    
    The commit 4197aa7bb81877ebb06e4f2cc1b5fea2da23a7bd implements 64 bit
    per ring statistics. But the driver resets the 'total_bytes' and
    'total_packets' from RX and TX rings in the RX and TX interrupt
    handlers to zero. This results in statistics being lost and user space
    reporting RX and TX statistics as zero. This patch addresses the
    issue by preventing the resetting of RX and TX ring statistics to
    zero.
    
    Signed-off-by: Narendra K <narendra_k@dell.com>
    Tested-by: Sibai Li <sibai.li@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/ethernet/intel/ixgbevf/ixgbevf_main.c |   12 ------------
 1 files changed, 0 insertions(+), 12 deletions(-)

commit 3319a04a4f5583a620639f6170caf4e075bddef9
Author: Neil Horman <nhorman@tuxdriver.com>
Date:   Mon Jul 16 09:13:51 2012 +0000

    sctp: Fix list corruption resulting from freeing an association on a list
    
    A few days ago Dave Jones reported this oops:
    
    [22766.294255] general protection fault: 0000 [#1] PREEMPT SMP
    [22766.295376] CPU 0
    [22766.295384] Modules linked in:
    [22766.387137]  ffffffffa169f292 6b6b6b6b6b6b6b6b ffff880147c03a90
    ffff880147c03a74
    [22766.387135] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 00000000000
    [22766.387136] Process trinity-watchdo (pid: 10896, threadinfo ffff88013e7d2000,
    [22766.387137] Stack:
    [22766.387140]  ffff880147c03a10
    [22766.387140]  ffffffffa169f2b6
    [22766.387140]  ffff88013ed95728
    [22766.387143]  0000000000000002
    [22766.387143]  0000000000000000
    [22766.387143]  ffff880003fad062
    [22766.387144]  ffff88013c120000
    [22766.387144]
    [22766.387145] Call Trace:
    [22766.387145]  <IRQ>
    [22766.387150]  [<ffffffffa169f292>] ? __sctp_lookup_association+0x62/0xd0
    [sctp]
    [22766.387154]  [<ffffffffa169f2b6>] __sctp_lookup_association+0x86/0xd0 [sctp]
    [22766.387157]  [<ffffffffa169f597>] sctp_rcv+0x207/0xbb0 [sctp]
    [22766.387161]  [<ffffffff810d4da8>] ? trace_hardirqs_off_caller+0x28/0xd0
    [22766.387163]  [<ffffffff815827e3>] ? nf_hook_slow+0x133/0x210
    [22766.387166]  [<ffffffff815902fc>] ? ip_local_deliver_finish+0x4c/0x4c0
    [22766.387168]  [<ffffffff8159043d>] ip_local_deliver_finish+0x18d/0x4c0
    [22766.387169]  [<ffffffff815902fc>] ? ip_local_deliver_finish+0x4c/0x4c0
    [22766.387171]  [<ffffffff81590a07>] ip_local_deliver+0x47/0x80
    [22766.387172]  [<ffffffff8158fd80>] ip_rcv_finish+0x150/0x680
    [22766.387174]  [<ffffffff81590c54>] ip_rcv+0x214/0x320
    [22766.387176]  [<ffffffff81558c07>] __netif_receive_skb+0x7b7/0x910
    [22766.387178]  [<ffffffff8155856c>] ? __netif_receive_skb+0x11c/0x910
    [22766.387180]  [<ffffffff810d423e>] ? put_lock_stats.isra.25+0xe/0x40
    [22766.387182]  [<ffffffff81558f83>] netif_receive_skb+0x23/0x1f0
    [22766.387183]  [<ffffffff815596a9>] ? dev_gro_receive+0x139/0x440
    [22766.387185]  [<ffffffff81559280>] napi_skb_finish+0x70/0xa0
    [22766.387187]  [<ffffffff81559cb5>] napi_gro_receive+0xf5/0x130
    [22766.387218]  [<ffffffffa01c4679>] e1000_receive_skb+0x59/0x70 [e1000e]
    [22766.387242]  [<ffffffffa01c5aab>] e1000_clean_rx_irq+0x28b/0x460 [e1000e]
    [22766.387266]  [<ffffffffa01c9c18>] e1000e_poll+0x78/0x430 [e1000e]
    [22766.387268]  [<ffffffff81559fea>] net_rx_action+0x1aa/0x3d0
    [22766.387270]  [<ffffffff810a495f>] ? account_system_vtime+0x10f/0x130
    [22766.387273]  [<ffffffff810734d0>] __do_softirq+0xe0/0x420
    [22766.387275]  [<ffffffff8169826c>] call_softirq+0x1c/0x30
    [22766.387278]  [<ffffffff8101db15>] do_softirq+0xd5/0x110
    [22766.387279]  [<ffffffff81073bc5>] irq_exit+0xd5/0xe0
    [22766.387281]  [<ffffffff81698b03>] do_IRQ+0x63/0xd0
    [22766.387283]  [<ffffffff8168ee2f>] common_interrupt+0x6f/0x6f
    [22766.387283]  <EOI>
    [22766.387284]
    [22766.387285]  [<ffffffff8168eed9>] ? retint_swapgs+0x13/0x1b
    [22766.387285] Code: c0 90 5d c3 66 0f 1f 44 00 00 4c 89 c8 5d c3 0f 1f 00 55 48
    89 e5 48 83
    ec 20 48 89 5d e8 4c 89 65 f0 4c 89 6d f8 66 66 66 66 90 <0f> b7 87 98 00 00 00
    48 89 fb
    49 89 f5 66 c1 c0 08 66 39 46 02
    [22766.387307]
    [22766.387307] RIP
    [22766.387311]  [<ffffffffa168a2c9>] sctp_assoc_is_match+0x19/0x90 [sctp]
    [22766.387311]  RSP <ffff880147c039b0>
    [22766.387142]  ffffffffa16ab120
    [22766.599537] ---[ end trace 3f6dae82e37b17f5 ]---
    [22766.601221] Kernel panic - not syncing: Fatal exception in interrupt
    
    It appears from his analysis and some staring at the code that this is likely
    occuring because an association is getting freed while still on the
    sctp_assoc_hashtable.  As a result, we get a gpf when traversing the hashtable
    while a freed node corrupts part of the list.
    
    Nominally I would think that an mibalanced refcount was responsible for this,
    but I can't seem to find any obvious imbalance.  What I did note however was
    that the two places where we create an association using
    sctp_primitive_ASSOCIATE (__sctp_connect and sctp_sendmsg), have failure paths
    which free a newly created association after calling sctp_primitive_ASSOCIATE.
    sctp_primitive_ASSOCIATE brings us into the sctp_sf_do_prm_asoc path, which
    issues a SCTP_CMD_NEW_ASOC side effect, which in turn adds a new association to
    the aforementioned hash table.  the sctp command interpreter that process side
    effects has not way to unwind previously processed commands, so freeing the
    association from the __sctp_connect or sctp_sendmsg error path would lead to a
    freed association remaining on this hash table.
    
    I've fixed this but modifying sctp_[un]hash_established to use hlist_del_init,
    which allows us to proerly use hlist_unhashed to check if the node is on a
    hashlist safely during a delete.  That in turn alows us to safely call
    sctp_unhash_established in the __sctp_connect and sctp_sendmsg error paths
    before freeing them, regardles of what the associations state is on the hash
    list.
    
    I noted, while I was doing this, that the __sctp_unhash_endpoint was using
    hlist_unhsashed in a simmilar fashion, but never nullified any removed nodes
    pointers to make that function work properly, so I fixed that up in a simmilar
    fashion.
    
    I attempted to test this using a virtual guest running the SCTP_RR test from
    netperf in a loop while running the trinity fuzzer, both in a loop.  I wasn't
    able to recreate the problem prior to this fix, nor was I able to trigger the
    failure after (neither of which I suppose is suprising).  Given the trace above
    however, I think its likely that this is what we hit.
    
    Signed-off-by: Neil Horman <nhorman@tuxdriver.com>
    Reported-by: davej@redhat.com
    CC: davej@redhat.com
    CC: "David S. Miller" <davem@davemloft.net>
    CC: Vlad Yasevich <vyasevich@gmail.com>
    CC: Sridhar Samudrala <sri@us.ibm.com>
    CC: linux-sctp@vger.kernel.org
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/sctp/input.c  |    7 ++-----
 net/sctp/socket.c |   12 ++++++++++--
 2 files changed, 12 insertions(+), 7 deletions(-)

commit 53df13f85dc0a81d996f574a5db10e753746e442
Author: Aaditya Kumar <aaditya.kumar.30@gmail.com>
Date:   Tue Jul 17 15:48:07 2012 -0700

    mm: fix lost kswapd wakeup in kswapd_stop()
    
    Offlining memory may block forever, waiting for kswapd() to wake up
    because kswapd() does not check the event kthread->should_stop before
    sleeping.
    
    The proper pattern, from Documentation/memory-barriers.txt, is:
    
       ---  waker  ---
       event_indicated = 1;
       wake_up_process(event_daemon);
    
       ---  sleeper  ---
       for (;;) {
          set_current_state(TASK_UNINTERRUPTIBLE);
          if (event_indicated)
             break;
          schedule();
       }
    
       set_current_state() may be wrapped by:
          prepare_to_wait();
    
    In the kswapd() case, event_indicated is kthread->should_stop.
    
      === offlining memory (waker) ===
       kswapd_stop()
          kthread_stop()
             kthread->should_stop = 1
             wake_up_process()
             wait_for_completion()
    
      ===  kswapd_try_to_sleep (sleeper) ===
       kswapd_try_to_sleep()
          prepare_to_wait()
               .
               .
          schedule()
               .
               .
          finish_wait()
    
    The schedule() needs to be protected by a test of kthread->should_stop,
    which is wrapped by kthread_should_stop().
    
    Reproducer:
       Do heavy file I/O in background.
       Do a memory offline/online in a tight loop
    
    Signed-off-by: Aaditya Kumar <aaditya.kumar@ap.sony.com>
    Acked-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Reviewed-by: Minchan Kim <minchan@kernel.org>
    Acked-by: Mel Gorman <mel@csn.ul.ie>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/vmscan.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

commit 98e62ae3e96c1243a8a7cc464c3ce093dab10df1
Author: Ezequiel Garcia <elezegarcia@gmail.com>
Date:   Wed Jul 18 10:05:26 2012 -0300

    cx25821: Remove bad strcpy to read-only char*
    
    The strcpy was being used to set the name of the board.  Since the
    destination char* was read-only and the name is set statically at
    compile time; this was both wrong and redundant.
    
    The type of char* is changed to const char* to prevent future errors.
    
    Reported-by: Radek Masin <radek@masin.eu>
    Signed-off-by: Ezequiel Garcia <elezegarcia@gmail.com>
    [ Taking directly due to vacations   - Linus ]
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 drivers/media/video/cx25821/cx25821-core.c |    3 ---
 drivers/media/video/cx25821/cx25821.h      |    2 +-
 2 files changed, 1 insertions(+), 4 deletions(-)

commit 5ca9fa8356928fd44b61234e50574e65423f9428
Author: NeilBrown <neilb@suse.de>
Date:   Thu Jul 19 15:59:18 2012 +1000

    md: avoid crash when stopping md array races with closing other open fds.
    
    md will refuse to stop an array if any other fd (or mounted fs) is
    using it.
    When any fs is unmounted of when the last open fd is closed all
    pending IO will be flushed (e.g. sync_blockdev call in __blkdev_put)
    so there will be no pending IO to worry about when the array is
    stopped.
    
    However in order to send the STOP_ARRAY ioctl to stop the array one
    must first get and open fd on the block device.
    If some fd is being used to write to the block device and it is closed
    after mdadm open the block device, but before mdadm issues the
    STOP_ARRAY ioctl, then there will be no last-close on the md device so
    __blkdev_put will not call sync_blockdev.
    
    If this happens, then IO can still be in-flight while md tears down
    the array and bad things can happen (use-after-free and subsequent
    havoc).
    
    So in the case where do_md_stop is being called from an open file
    descriptor, call sync_block after taking the mutex to ensure there
    will be no new openers.
    
    This is needed when setting a read-write device to read-only too.
    
    Cc: stable@vger.kernel.org
    Reported-by: majianpeng <majianpeng@gmail.com>
    Signed-off-by: NeilBrown <neilb@suse.de>

 drivers/md/md.c |   36 +++++++++++++++++++++++-------------
 1 files changed, 23 insertions(+), 13 deletions(-)

commit 3e42455a58d31023dd30f7093459f1aefd99c164
Author: Paul Moore <pmoore@redhat.com>
Date:   Tue Jul 17 11:07:47 2012 +0000

    cipso: don't follow a NULL pointer when setsockopt() is called
    
    As reported by Alan Cox, and verified by Lin Ming, when a user
    attempts to add a CIPSO option to a socket using the CIPSO_V4_TAG_LOCAL
    tag the kernel dies a terrible death when it attempts to follow a NULL
    pointer (the skb argument to cipso_v4_validate() is NULL when called via
    the setsockopt() syscall).
    
    This patch fixes this by first checking to ensure that the skb is
    non-NULL before using it to find the incoming network interface.  In
    the unlikely case where the skb is NULL and the user attempts to add
    a CIPSO option with the _TAG_LOCAL tag we return an error as this is
    not something we want to allow.
    
    A simple reproducer, kindly supplied by Lin Ming, although you must
    have the CIPSO DOI #3 configure on the system first or you will be
    caught early in cipso_v4_validate():
    
    	#include <sys/types.h>
    	#include <sys/socket.h>
    	#include <linux/ip.h>
    	#include <linux/in.h>
    	#include <string.h>
    
    	struct local_tag {
    		char type;
    		char length;
    		char info[4];
    	};
    
    	struct cipso {
    		char type;
    		char length;
    		char doi[4];
    		struct local_tag local;
    	};
    
    	int main(int argc, char **argv)
    	{
    		int sockfd;
    		struct cipso cipso = {
    			.type = IPOPT_CIPSO,
    			.length = sizeof(struct cipso),
    			.local = {
    				.type = 128,
    				.length = sizeof(struct local_tag),
    			},
    		};
    
    		memset(cipso.doi, 0, 4);
    		cipso.doi[3] = 3;
    
    		sockfd = socket(AF_INET, SOCK_DGRAM, 0);
    		#define SOL_IP 0
    		setsockopt(sockfd, SOL_IP, IP_OPTIONS,
    			&cipso, sizeof(struct cipso));
    
    		return 0;
    	}
    
    CC: Lin Ming <mlin@ss.pku.edu.cn>
    Reported-by: Alan Cox <alan@lxorguk.ukuu.org.uk>
    Signed-off-by: Paul Moore <pmoore@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/cipso_ipv4.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

commit 74140833624b90c7ca907abdbd65893f429946dc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jul 17 16:21:01 2012 -0400

    Fix mangled backport introduced during recent merge of upstream backports for mm/madvise.c
    Thanks to Kamil Kaczkowski for the report

 mm/madvise.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

commit 1f765b879a08c85a955b67b4e7f6d63184b32df2
Author: Dave Jones <davej@redhat.com>
Date:   Fri Jul 13 13:35:36 2012 -0400

    Remove easily user-triggerable BUG from generic_setlease
    
    This can be trivially triggered from userspace by passing in something unexpected.
    
        kernel BUG at fs/locks.c:1468!
        invalid opcode: 0000 [#1] SMP
        RIP: 0010:generic_setlease+0xc2/0x100
        Call Trace:
          __vfs_setlease+0x35/0x40
          fcntl_setlease+0x76/0x150
          sys_fcntl+0x1c6/0x810
          system_call_fastpath+0x1a/0x1f
    
    Signed-off-by: Dave Jones <davej@redhat.com>
    Cc: stable@kernel.org # 3.2+
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/locks.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit b05706884cf503a0a761a40397031ad702acb26b
Author: Jeff Moyer <jmoyer@redhat.com>
Date:   Thu Jul 12 09:43:14 2012 -0400

    block: fix infinite loop in __getblk_slow
    
    Commit 080399aaaf35 ("block: don't mark buffers beyond end of disk as
    mapped") exposed a bug in __getblk_slow that causes mount to hang as it
    loops infinitely waiting for a buffer that lies beyond the end of the
    disk to become uptodate.
    
    The problem was initially reported by Torsten Hilbrich here:
    
        https://lkml.org/lkml/2012/6/18/54
    
    and also reported independently here:
    
        http://www.sysresccd.org/forums/viewtopic.php?f=13&t=4511
    
    and then Richard W.M.  Jones and Marcos Mello noted a few separate
    bugzillas also associated with the same issue.  This patch has been
    confirmed to fix:
    
        https://bugzilla.redhat.com/show_bug.cgi?id=835019
    
    The main problem is here, in __getblk_slow:
    
            for (;;) {
                    struct buffer_head * bh;
                    int ret;
    
                    bh = __find_get_block(bdev, block, size);
                    if (bh)
                            return bh;
    
                    ret = grow_buffers(bdev, block, size);
                    if (ret < 0)
                            return NULL;
                    if (ret == 0)
                            free_more_memory();
            }
    
    __find_get_block does not find the block, since it will not be marked as
    mapped, and so grow_buffers is called to fill in the buffers for the
    associated page.  I believe the for (;;) loop is there primarily to
    retry in the case of memory pressure keeping grow_buffers from
    succeeding.  However, we also continue to loop for other cases, like the
    block lying beond the end of the disk.  So, the fix I came up with is to
    only loop when grow_buffers fails due to memory allocation issues
    (return value of 0).
    
    The attached patch was tested by myself, Torsten, and Rich, and was
    found to resolve the problem in call cases.
    
    Signed-off-by: Jeff Moyer <jmoyer@redhat.com>
    Reported-and-Tested-by: Torsten Hilbrich <torsten.hilbrich@secunet.com>
    Tested-by: Richard W.M. Jones <rjones@redhat.com>
    Reviewed-by: Josh Boyer <jwboyer@redhat.com>
    Cc: Stable <stable@vger.kernel.org>  # 3.0+
    [ Jens is on vacation, taking this directly  - Linus ]
    --
    Stable Notes: this patch requires backport to 3.0, 3.2 and 3.3.
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/buffer.c |   22 +++++++++++++---------
 1 files changed, 13 insertions(+), 9 deletions(-)

commit 7fb30431d5ed3c724c7f3f0eeae70bb08497cb4d
Author: Jiang Liu <jiang.liu@huawei.com>
Date:   Wed Jul 11 14:01:52 2012 -0700

    memory hotplug: fix invalid memory access caused by stale kswapd pointer
    
    kswapd_stop() is called to destroy the kswapd work thread when all memory
    of a NUMA node has been offlined.  But kswapd_stop() only terminates the
    work thread without resetting NODE_DATA(nid)->kswapd to NULL.  The stale
    pointer will prevent kswapd_run() from creating a new work thread when
    adding memory to the memory-less NUMA node again.  Eventually the stale
    pointer may cause invalid memory access.
    
    An example stack dump as below. It's reproduced with 2.6.32, but latest
    kernel has the same issue.
    
      BUG: unable to handle kernel NULL pointer dereference at (null)
      IP: [<ffffffff81051a94>] exit_creds+0x12/0x78
      PGD 0
      Oops: 0000 [#1] SMP
      last sysfs file: /sys/devices/system/memory/memory391/state
      CPU 11
      Modules linked in: cpufreq_conservative cpufreq_userspace cpufreq_powersave acpi_cpufreq microcode fuse loop dm_mod tpm_tis rtc_cmos i2c_i801 rtc_core tpm serio_raw pcspkr sg tpm_bios igb i2c_core iTCO_wdt rtc_lib mptctl iTCO_vendor_support button dca bnx2 usbhid hid uhci_hcd ehci_hcd usbcore sd_mod crc_t10dif edd ext3 mbcache jbd fan ide_pci_generic ide_core ata_generic ata_piix libata thermal processor thermal_sys hwmon mptsas mptscsih mptbase scsi_transport_sas scsi_mod
      Pid: 7949, comm: sh Not tainted 2.6.32.12-qiuxishi-5-default #92 Tecal RH2285
      RIP: 0010:exit_creds+0x12/0x78
      RSP: 0018:ffff8806044f1d78  EFLAGS: 00010202
      RAX: 0000000000000000 RBX: ffff880604f22140 RCX: 0000000000019502
      RDX: 0000000000000000 RSI: 0000000000000202 RDI: 0000000000000000
      RBP: ffff880604f22150 R08: 0000000000000000 R09: ffffffff81a4dc10
      R10: 00000000000032a0 R11: ffff880006202500 R12: 0000000000000000
      R13: 0000000000c40000 R14: 0000000000008000 R15: 0000000000000001
      FS:  00007fbc03d066f0(0000) GS:ffff8800282e0000(0000) knlGS:0000000000000000
      CS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b
      CR2: 0000000000000000 CR3: 000000060f029000 CR4: 00000000000006e0
      DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
      DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
      Process sh (pid: 7949, threadinfo ffff8806044f0000, task ffff880603d7c600)
      Stack:
       ffff880604f22140 ffffffff8103aac5 ffff880604f22140 ffffffff8104d21e
       ffff880006202500 0000000000008000 0000000000c38000 ffffffff810bd5b1
       0000000000000000 ffff880603d7c600 00000000ffffdd29 0000000000000003
      Call Trace:
        __put_task_struct+0x5d/0x97
        kthread_stop+0x50/0x58
        offline_pages+0x324/0x3da
        memory_block_change_state+0x179/0x1db
        store_mem_state+0x9e/0xbb
        sysfs_write_file+0xd0/0x107
        vfs_write+0xad/0x169
        sys_write+0x45/0x6e
        system_call_fastpath+0x16/0x1b
      Code: ff 4d 00 0f 94 c0 84 c0 74 08 48 89 ef e8 1f fd ff ff 5b 5d 31 c0 41 5c c3 53 48 8b 87 20 06 00 00 48 89 fb 48 8b bf 18 06 00 00 <8b> 00 48 c7 83 18 06 00 00 00 00 00 00 f0 ff 0f 0f 94 c0 84 c0
      RIP  exit_creds+0x12/0x78
       RSP <ffff8806044f1d78>
      CR2: 0000000000000000
    
    [akpm@linux-foundation.org: add pglist_data.kswapd locking comments]
    Signed-off-by: Xishi Qiu <qiuxishi@huawei.com>
    Signed-off-by: Jiang Liu <jiang.liu@huawei.com>
    Acked-by: KAMEZAWA Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com>
    Acked-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Acked-by: Mel Gorman <mgorman@suse.de>
    Acked-by: David Rientjes <rientjes@google.com>
    Reviewed-by: Minchan Kim <minchan@kernel.org>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 include/linux/mmzone.h |    2 +-
 mm/vmscan.c            |    7 +++++--
 2 files changed, 6 insertions(+), 3 deletions(-)

commit 18f26f8086dc95f0db4247960636b47eff2f94de
Author: Luis Henriques <luis.henriques@canonical.com>
Date:   Wed Jul 11 14:02:10 2012 -0700

    ocfs2: fix NULL pointer dereference in __ocfs2_change_file_space()
    
    As ocfs2_fallocate() will invoke __ocfs2_change_file_space() with a NULL
    as the first parameter (file), it may trigger a NULL pointer dereferrence
    due to a missing check.
    
    Addresses http://bugs.launchpad.net/bugs/1006012
    
    Signed-off-by: Luis Henriques <luis.henriques@canonical.com>
    Reported-by: Bret Towe <magnade@gmail.com>
    Tested-by: Bret Towe <magnade@gmail.com>
    Cc: Sunil Mushran <sunil.mushran@oracle.com>
    Acked-by: Joel Becker <jlbec@evilplan.org>
    Acked-by: Mark Fasheh <mfasheh@suse.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/ocfs2/file.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 5c5021e8231e345eb2c9fbe02480dddc82c062eb
Author: Salman Qazi <sqazi@google.com>
Date:   Mon Jun 25 18:18:15 2012 -0700

    sched: Fix fork() error path to not crash
    
    In dup_task_struct(), if arch_dup_task_struct() fails, the clean up
    code fails to clean up correctly.  That's because the clean up
    code depends on unininitalized ti->task pointer.  We fix this
    by making sure that the task and thread_info know about each other
    before we attempt to take the error path.
    
    Signed-off-by: Salman Qazi <sqazi@google.com>
    Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Link: http://lkml.kernel.org/r/20120626011815.11323.5533.stgit@dungbeetle.mtv.corp.google.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>

 kernel/fork.c |   11 ++++++++---
 1 files changed, 8 insertions(+), 3 deletions(-)

commit 1cd7ca006456c1a0760d34b75484b594593faea5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 12 21:53:37 2012 -0400

    Force STOP_MACHINE on if grsecurity is enabled

 init/Kconfig     |    2 +-
 security/Kconfig |    1 +
 2 files changed, 2 insertions(+), 1 deletions(-)

commit cbcdd659a4d5a91f951cfccb34e346a221981888
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 12 21:14:51 2012 -0400

    Fix possible race on RBAC disable by ensuring all other
    CPUs are forced out of the kernel -- this is preferable to
    other locking methods that would impact performance of common paths
    for what should be a very infrequent operation that doesn't
    need to be fast
    Thanks to Mark Moseley for reporting and testing

 grsecurity/gracl.c |   33 +++++++++++++++++----------------
 1 files changed, 17 insertions(+), 16 deletions(-)

commit 5f733a29308f3298e0826db157309edfa990ee4b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 12 20:46:54 2012 -0400

    Fix RBAC enable / special role exit race with fork
    Thanks to Mark Moseley for reporting and testing
    
    race looked like:
    >   cpu 1                               cpu 2
    >   fork begins
    >   fork calls dup_task_struct
    >                                       RBAC sets ->acl on all procs in tasklist
    >   fork completes, adds to tasklist
    >                                       RBAC sets enabled flag
    >   process exists with RBAC enabled
    >   and NULL ->acl

 grsecurity/gracl.c |   11 +++++------
 kernel/fork.c      |    5 +++--
 2 files changed, 8 insertions(+), 8 deletions(-)

commit 0675c57fab0447841bcef5b841d59b9fdec20bff
Merge: af6b0e7 edde633
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 12 18:26:54 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	fs/udf/super.c
    	mm/madvise.c

commit edde633952f42afc9fcd2554cefa096177dfd2cd
Merge: 66d3813 8432d22
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Jul 12 18:09:13 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2

commit af6b0e7802053b7d4e7a21348d708c6d3bbfbf2f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 7 20:30:28 2012 -0400

    Backport security fix:
    http://git.kernel.org/?p=linux/kernel/git/torvalds/linux.git;a=commitdiff;h=9ab4233dd08036fe34a89c7dc6f47a8bf2eb29eb
    
    author	Andy Lutomirski <luto@amacapital.net>
    Thu, 5 Jul 2012 23:00:11 +0000 (16:00 -0700)
    committer	Linus Torvalds <torvalds@linux-foundation.org>
    Fri, 6 Jul 2012 17:34:38 +0000 (10:34 -0700)
    Otherwise the code races with munmap (causing a use-after-free
    of the vma) or with close (causing a use-after-free of the struct
    file).
    
    The bug was introduced by commit 90ed52ebe481 ("[PATCH] holepunch: fix
    mmap_sem i_mutex deadlock")
    
    Cc: Hugh Dickins <hugh@veritas.com>
    Cc: Miklos Szeredi <mszeredi@suse.cz>
    Cc: Badari Pulavarty <pbadari@us.ibm.com>
    Cc: Nick Piggin <npiggin@suse.de>
    Cc: stable@vger.kernel.org
    Signed-off-by: Andy Lutomirski <luto@amacapital.net>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	mm/madvise.c

 mm/madvise.c |   19 ++++++++++++++-----
 1 files changed, 14 insertions(+), 5 deletions(-)

commit 99427d1d593377881fd0a62d65274d408a2e2516
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jul 2 18:36:51 2012 -0400

    Introduce kernel-enforced SymlinksIfOwnerMatch feature
    (Highly desirable feature for webhosting companies)

 fs/namei.c                 |   14 +++++++++++++-
 grsecurity/Kconfig         |   27 ++++++++++++++++++++++++++-
 grsecurity/grsec_init.c    |    6 ++++++
 grsecurity/grsec_link.c    |   16 ++++++++++++++++
 grsecurity/grsec_sysctl.c  |   16 ++++++++++++++++
 include/linux/grinternal.h |    2 ++
 include/linux/grmsg.h      |    1 +
 include/linux/grsecurity.h |    1 +
 security/Kconfig           |   11 +++++++++++
 9 files changed, 92 insertions(+), 2 deletions(-)

commit 228af76d73f7802d6f1db5e7224d7c3d89278d62
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jul 7 15:24:59 2012 -0400

    Fix compilation failure when !GRKERNSEC

 security/Kconfig |   38 +++++++++++++++++++-------------------
 1 files changed, 19 insertions(+), 19 deletions(-)

commit 9da90a1e927f92c0ae1933de35b238fc70e5d9e9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 25 17:10:14 2012 -0400

    Introduce new configuration system
    make the strict copy checks depend on !PAX_SIZE_OVERFLOW

 grsecurity/Kconfig |  252 +++++++++-------------------------------------------
 security/Kconfig   |  215 +++++++++++++++++++++++++++++++++++++++++++-
 2 files changed, 256 insertions(+), 211 deletions(-)

commit 17a4d416e072da590ae05a8c9c4c5a31c8d45616
Author: Jason Baron <jbaron@redhat.com>
Date:   Wed Apr 25 16:01:47 2012 -0700

    epoll: clear the tfile_check_list on -ELOOP
    
    An epoll_ctl(,EPOLL_CTL_ADD,,) operation can return '-ELOOP' to prevent
    circular epoll dependencies from being created.  However, in that case we
    do not properly clear the 'tfile_check_list'.  Thus, add a call to
    clear_tfile_check_list() for the -ELOOP case.
    
    Signed-off-by: Jason Baron <jbaron@redhat.com>
    Reported-by: Yurij M. Plotnikov <Yurij.Plotnikov@oktetlabs.ru>
    Cc: Nelson Elhage <nelhage@nelhage.com>
    Cc: Davide Libenzi <davidel@xmailserver.org>
    Tested-by: Alexandra N. Kossovsky <Alexandra.Kossovsky@oktetlabs.ru>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/eventpoll.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

commit 969779709e786803920a55e4a22c597a94a12a53
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Sat Jun 9 19:08:25 2012 +0300

    mtd: cafe_nand: fix an & vs | mistake
    
    The intent here was clearly to set result to true if the 0x40000000 flag
    was set.  But instead there was a | vs & typo and we always set result
    to true.
    
    Artem: check the spec at
    wiki.laptop.org/images/5/5c/88ALP01_Datasheet_July_2007.pdf
    and this fix looks correct.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
    Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>

 drivers/mtd/nand/cafe_nand.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 9338e671cd241539df9d85b3904ad3f73a7cc2ea
Author: Jan Kara <jack@suse.cz>
Date:   Wed Jun 27 20:20:22 2012 +0200

    udf: Avoid run away loop when partition table length is corrupted
    
    Check provided length of partition table so that (possibly maliciously)
    corrupted partition table cannot cause accessing data beyond current buffer.
    
    Signed-off-by: Jan Kara <jack@suse.cz>

 fs/udf/super.c |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

commit ab9c7cc60774aae84ec05a31a553741dc4dd9bdf
Author: Jan Kara <jack@suse.cz>
Date:   Wed Jun 27 21:23:07 2012 +0200

    udf: Fortify loading of sparing table
    
    Add sanity checks when loading sparing table from disk to avoid accessing
    unallocated memory or writing to it.
    
    Signed-off-by: Jan Kara <jack@suse.cz>

 fs/udf/super.c |   86 ++++++++++++++++++++++++++++++++++---------------------
 1 files changed, 53 insertions(+), 33 deletions(-)

commit eb3e6e93154e28337143f79a228988448f4a6d44
Merge: 5f2495a 66d3813
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jul 4 15:12:28 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	arch/x86/include/asm/pgtable-3level.h
    	include/asm-generic/pgtable.h

commit 66d38134b3356aebfaa1ab9dbf2cc7c6d3315330
Merge: 3da88ee 1990855
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jul 4 15:06:59 2012 -0400

    Update to pax-linux-3.2.22-test58.patch
    
    Merge branch 'linux-3.2.y' into pax-stable2
    
    Conflicts:
    	drivers/gpu/drm/i915/intel_display.c

commit 5f2495a10894ca92c2dc53bcdf3f31ec31153045
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 1 19:58:41 2012 -0400

    Add missing read lock in recent filldir code

 grsecurity/gracl.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

commit c65f59b5941496c8585b2426c2a9522e15102bb2
Merge: f804be6 3da88ee
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 1 20:01:12 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 3da88ee91ccee20387578dacfdccac492e580f7c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jul 1 19:51:52 2012 -0400

    Update to pax-linux-3.2.21-test58.patch
    
    moved some ifdef's around to fix compiler warnings in the ELF loader hunks,
    thanks to Thiébaud Weksteen for raising the problem and providing the
    initial patch.

 fs/binfmt_elf.c |  164 +++++++++++++++++++++++++++----------------------------
 1 files changed, 81 insertions(+), 83 deletions(-)

commit f804be60ef79efc704b7da5497cbab567ea25fb0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 25 17:14:00 2012 -0400

    Make strict checks depend on !PAX_SIZE_OVERFLOW

 arch/x86/Kconfig.debug |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 2df1af968c02425cdca5acb209fa489b897d55f8
Merge: 8e4af78 5faf4e1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jun 22 18:41:56 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 5faf4e1da0f8ef7247c0c52d5f4f1a97a7d0fa6a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jun 22 18:41:22 2012 -0400

    Update to pax-linux-3.2.21-test57.patch

 scripts/gcc-plugin.sh            |    6 +++---
 tools/gcc/size_overflow_plugin.c |    2 ++
 2 files changed, 5 insertions(+), 3 deletions(-)

commit 8e4af78bb25887da94a228c4447371d69ecc07bc
Merge: 6de9710 f94ec8d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 20 18:05:00 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit f94ec8d006dd557f4f2956eb01027b121e2e6b94
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 20 18:04:41 2012 -0400

    Update to pax-linux-3.2.21-test56.patch

 Makefile |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit d99bd4dbd2e332d65f2ea797c422ea66e5a21965
Merge: 1497d5e 8499e79
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 20 18:03:03 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2

commit 6de97109ae0e44e5bd710d5c275894cecf404c58
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 20 17:55:07 2012 -0400

    revert sort change

 tools/gcc/generate_size_overflow_hash.sh |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit ce7da256bdfba37295da1a9921b29a2989a89a4b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jun 19 21:45:50 2012 -0400

    Add grsecurity allocators to size_overflow plugin
    change range used for sorting overflow table

 tools/gcc/generate_size_overflow_hash.sh |    2 +-
 tools/gcc/size_overflow_hash.data        |    4 ++++
 2 files changed, 5 insertions(+), 1 deletions(-)

commit d4f97a7324bd34676a7fe0ae4035fc58f33650fb
Merge: 3c286bc 1497d5e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jun 19 20:09:52 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 1497d5e5a9864542dbfb9e5a4cb2ac6dcc6187eb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jun 19 20:09:36 2012 -0400

    Update to pax-linux-3.2.20-test55.patch

 Documentation/dontdiff                   |    1 +
 arch/x86/tools/relocs.c                  |    4 +-
 tools/gcc/Makefile                       |   10 +
 tools/gcc/generate_size_overflow_hash.sh |   94 +
 tools/gcc/size_overflow_hash.data        | 2388 +++++
 tools/gcc/size_overflow_hash.h           |16685 ------------------------------
 tools/gcc/size_overflow_plugin.c         |   15 +-
 7 files changed, 2502 insertions(+), 16695 deletions(-)

commit 3c286bc9765b9df15ca80013c6dc5587852c2d47
Merge: d240764 3c05eb4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 18 20:21:29 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 3c05eb4bdf944054112476abb781b016e5a36058
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 18 20:20:48 2012 -0400

    Update to pax-linux-3.2.20-test54.patch

 arch/parisc/include/asm/uaccess.h |    4 ++--
 arch/s390/include/asm/uaccess.h   |    4 ++--
 arch/tile/include/asm/uaccess.h   |    4 ++--
 arch/x86/include/asm/uaccess_32.h |    8 ++++----
 arch/x86/include/asm/uaccess_64.h |    8 ++++----
 tools/gcc/size_overflow_plugin.c  |    2 +-
 6 files changed, 15 insertions(+), 15 deletions(-)

commit d240764bafc86d44fb5893f3225aa6f683a707b8
Merge: 9766a3c 15d876b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jun 17 19:21:33 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	Makefile
    	tools/gcc/Makefile

commit 15d876bd3448dc0d9f164a9ba5d59c9ca75bb6db
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jun 17 19:09:12 2012 -0400

    Update to pax-linux-3.2.20-test53.patch

 Makefile                          |    5 +-
 arch/x86/include/asm/uaccess_64.h |   24 ++++++++---
 arch/x86/lib/usercopy_64.c        |   12 ++++++
 scripts/Makefile.build            |    2 +-
 scripts/Makefile.host             |   26 +++++++++++-
 scripts/gcc-plugin.sh             |   17 +++++++-
 tools/gcc/Makefile                |   23 ++++++----
 tools/gcc/colorize_plugin.c       |    1 +
 tools/gcc/size_overflow_plugin.c  |   80 ++++++++++++++----------------------
 9 files changed, 120 insertions(+), 70 deletions(-)

commit 9766a3ce395482f66db16e40866f9556bc4231e8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jun 16 08:34:16 2012 -0400

    change bounds checks

 drivers/media/radio/radio-cadet.c  |    2 +-
 net/mac80211/rc80211_pid_debugfs.c |    2 +-
 net/packet/af_packet.c             |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

commit 630a3d7839c4e8d8ca3734b312717e1979486059
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jun 15 19:18:29 2012 -0400

    Fix latency spikes:
    http://www.mail-archive.com/e1000-devel@lists.sourceforge.net/msg05591.html

 drivers/net/ethernet/intel/e1000e/e1000.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 9080d7caa19f2e55789da251b34d889cf79c2273
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 13 23:01:28 2012 -0400

    eliminate gcc warnings

 drivers/media/radio/radio-cadet.c  |    2 +-
 net/mac80211/rc80211_pid_debugfs.c |    2 +-
 net/packet/af_packet.c             |    6 +++++-
 3 files changed, 7 insertions(+), 3 deletions(-)

commit d36187d5baad31c79461a930e802b7a96a3db955
Merge: 5599bb3 642d7f3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 13 21:11:05 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 642d7f3fefc9eb9daa777ccd6832cdc028361152
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jun 13 21:10:48 2012 -0400

    Update to pax-linux-3.2.20-test52.patch

 Documentation/dontdiff           |    1 +
 arch/arm/include/asm/atomic.h    |   24 +-
 fs/exec.c                        |    7 +-
 kernel/jump_label.c              |    1 +
 tools/gcc/size_overflow_hash.h   |17485 ++++++++++++++++++++++----------------
 tools/gcc/size_overflow_plugin.c |  191 +-
 6 files changed, 10320 insertions(+), 7389 deletions(-)

commit 5599bb353f9d4ec95104865217ba8e4ec5a37686
Merge: 82c2b19 661e4d1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 11 18:00:04 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	kernel/fork.c

commit 661e4d15955c254e8829256864cd58583c4bfba5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 11 17:56:32 2012 -0400

    Update to pax-linux-3.2.20-test49.patch

 arch/x86/tools/relocs.c      |    8 ++++----
 fs/aio.c                     |    1 -
 kernel/fork.c                |    3 ++-
 scripts/Makefile.headersinst |   10 ++++++++--
 4 files changed, 14 insertions(+), 8 deletions(-)

commit 3d5156e7e511ec4d59b9958abd443e39f80a0e65
Merge: 9dc7f86 7313dd1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 11 17:52:46 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2
    
    Conflicts:
    	kernel/fork.c

commit 82c2b196ef6bc834b2b16812e95de3e3768998ed
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 11 17:23:28 2012 -0400

    make filename const

 include/trace/events/fs.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 05694214e6ea6d59f729fd79b62fba619794badc
Merge: 77d2bb9 9dc7f86
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 11 17:40:21 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 77d2bb98cc4965b9151d30384f9d38a89b5e6a1d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jun 9 15:58:21 2012 -0400

    Add (a correct) Ubuntu ureadahead patch
    
    Conflicts:
    
    	fs/open.c

 fs/exec.c                 |    4 +++
 fs/open.c                 |    3 ++
 include/trace/events/fs.h |   53 +++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 60 insertions(+), 0 deletions(-)

commit 9dc7f8641044251954b25606dd45d74fe8e6c720
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jun 9 14:51:07 2012 -0400

    resync relocs.c with test8 from 3.4

 arch/x86/tools/relocs.c |   15 +++++++--------
 1 files changed, 7 insertions(+), 8 deletions(-)

commit bd9b63dcc615ded7e95bb546a6e7290de95dbc74
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jun 9 14:23:05 2012 -0400

    hide cs base/limit

 fs/proc/task_mmu.c |   15 ++++++++-------
 1 files changed, 8 insertions(+), 7 deletions(-)

commit a1994f0b5d829c0f5dd6749cd5e3351391095f5e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jun 9 13:42:35 2012 -0400

    Bump grsecurity version

 include/linux/gracl.h |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit edb515e38940369402416a9c4511fc0ed121a66b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 20:40:38 2012 -0400

    make check unsigned

 drivers/media/radio/radio-cadet.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit aae13117148b8ff6f70d3cddf68afe07975ae17d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 20:13:49 2012 -0400

    shut gcc up

 drivers/media/radio/radio-cadet.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit fa6122804601e64a9002b20c2940a3c450c1aa4b
Merge: 8cc619f 003d74f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 20:00:00 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 003d74fde81c380c9db5923291d91c44f7f2d40f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 19:59:17 2012 -0400

    Fix x64 compilation

 arch/x86/tools/relocs.c |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)

commit 8cc619fc341a21684ddd6d90745ef71f2f3f7453
Merge: ca812f6 e24cfb6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 19:10:54 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit e24cfb6a4c72e0bee3a14b5585c34f370ae22bec
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 19:10:40 2012 -0400

    Fix backport

 fs/aio.c |   10 ++++------
 1 files changed, 4 insertions(+), 6 deletions(-)

commit ca812f6e46dc67689bd664cc343ee4015c039d96
Merge: 1de7bb1 dcb6621
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 18:57:54 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit dcb66213aea5d213f8a88311a83d1b3cfaac248a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 18:57:38 2012 -0400

    reference correct autoconf.h

 arch/x86/tools/relocs.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 1de7bb1d4f3ddf6f24b9bed74a7bf741334a67a1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 18:13:02 2012 -0400

    Revert "ipc/mqueue: enforce hard limits"
    
    This reverts commit 02234cf7c659f0ba0e4771cacca28a3f350e96bd.

 ipc/mqueue.c |    8 +++-----
 1 files changed, 3 insertions(+), 5 deletions(-)

commit 0c3102c7c63c26561929444041e6257bf262d2c0
Author: Konrad Rzeszutek Wilk <konrad@darnok.org>
Date:   Wed May 30 18:23:56 2012 -0400

    x86, amd, xen: Avoid NULL pointer paravirt references
    
    Stub out MSR methods that aren't actually needed.  This fixes a crash
    as Xen Dom0 on AMD Trinity systems.  A bigger patch should be added to
    remove the paravirt machinery completely for the methods which
    apparently have no users!
    
    Reported-by: Andre Przywara <andre.przywara@amd.com>
    Link: http://lkml.kernel.org/r/20120530222356.GA28417@andromeda.dapyr.net
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>
    Cc: <stable@vger.kernel.org>

 arch/x86/xen/enlighten.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit 2abc999f39344b2fcb00d2c55ac119781c20dba5
Author: Doug Ledford <dledford@redhat.com>
Date:   Thu May 31 16:26:29 2012 -0700

    ipc/mqueue: enforce hard limits
    
    In two places we don't enforce the hard limits for CAP_SYS_RESOURCE apps.
    In preparation for making more reasonable hard limits, start enforcing
    them even on CAP_SYS_RESOURCE.
    
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Cc: Serge E. Hallyn <serue@us.ibm.com>
    Cc: Amerigo Wang <amwang@redhat.com>
    Cc: Joe Korty <joe.korty@ccur.com>
    Cc: Jiri Slaby <jslaby@suse.cz>
    Acked-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Cc: Manfred Spraul <manfred@colorfullife.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 ipc/mqueue.c |    8 +++++---
 1 files changed, 5 insertions(+), 3 deletions(-)

commit 9fc1f6589dc73f5553c98a4611d8aa62bdbbbb40
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 17:39:36 2012 -0400

    drop additional invalid states

 net/ipv4/tcp_input.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit dde777d48360d76ba2a9c98ae4f60ecab2cb65cc
Merge: 24c93a7 b0b6a13
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 17:19:23 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	fs/nfs/nfs4xdr.c

commit b0b6a1338d49fecefa8d85c13f0c70e43c290b82
Merge: 180f875 563b326
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jun 4 17:18:37 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2
    
    Conflicts:
    	arch/x86/tools/relocs.c
    	fs/aio.c
    	kernel/compat.c

commit 24c93a7b387a6934435966757e652463cfb20aae
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jun 3 09:01:18 2012 -0400

    Fix compilation error reported by Huub Reuver

 arch/x86/mm/init.c |    5 ++---
 1 files changed, 2 insertions(+), 3 deletions(-)

commit 4b329e2d59d9a77b65a4feac31034d9febbf399a
Merge: fc7c32c 180f875
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jun 1 19:32:32 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 180f875b5dea6d108574b9d2615e4c915c9390c3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jun 1 19:32:03 2012 -0400

    Update to pax-linux-3.2.18-test49.patch

 Makefile                         |   22 ++++++++++------------
 include/linux/Kbuild             |    2 +-
 scripts/Makefile.lib             |    6 +++---
 tools/gcc/size_overflow_plugin.c |    2 +-
 4 files changed, 15 insertions(+), 17 deletions(-)

commit fc7c32c2712241e3699f03fcd7ed5779ea68bddf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 18:12:30 2012 -0400

    fix compiler warning

 arch/x86/mm/init.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit ced5e20c92304dd614ab894f2a03632ccf7161d2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 18:07:32 2012 -0400

    compile fixes

 arch/x86/mm/init.c |   13 +++++++------
 kernel/sysctl.c    |    2 --
 2 files changed, 7 insertions(+), 8 deletions(-)

commit 72ecba18078818ea8e96cb47281bf1c99faa6f92
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 17:51:27 2012 -0400

    don't allow HWPOISON_INJECT with GRKERNSEC

 mm/Kconfig |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 6527d9e2787232b61305abea971e1d6551aac380
Merge: b73d861 c82de04
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 17:49:20 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit c82de046aae7fe7319e05adc7c336f868aa4f2b1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 17:49:02 2012 -0400

    Update to pax-linux-3.2.18-test47.patch

 include/linux/Kbuild        |    2 +-
 tools/gcc/constify_plugin.c |   61 ++++++++++++++++++++++++++++++------------
 2 files changed, 44 insertions(+), 19 deletions(-)

commit b73d8617c678f56e082b20191e6c06ff4d4533e5
Author: Thomas Meyer <thomas@m3y3r.de>
Date:   Tue May 29 15:07:27 2012 -0700

    leds: Use kcalloc instead of kzalloc to allocate array
    
    The advantage of kcalloc is that will prevent integer overflows which
    could result from the multiplication of number of elements and size and it
    is also a bit nicer to read.
    
    The semantic patch that makes this change is available
    in https://lkml.org/lkml/2011/11/25/107
    
    Signed-off-by: Thomas Meyer <thomas@m3y3r.de>
    Cc: Bryan Wu <bryan.wu@canonical.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 drivers/leds/leds-mc13783.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 18f3320c10982caed7370eee08f3b056f2aed674
Author: Thomas Meyer <thomas@m3y3r.de>
Date:   Tue May 29 15:06:21 2012 -0700

    mm: use kcalloc() instead of kzalloc() to allocate array
    
    The advantage of kcalloc is, that will prevent integer overflows which
    could result from the multiplication of number of elements and size and
    it is also a bit nicer to read.
    
    The semantic patch that makes this change is available in
    https://lkml.org/lkml/2011/11/25/107
    
    Signed-off-by: Thomas Meyer <thomas@m3y3r.de>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/vmalloc.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 8a659f203b8de28286c33c4506f2c2168dec4ebb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 17:29:12 2012 -0400

    Introduce change similar to 7edc8b0ac16cbaed7cb4ea4c6b95ce98d2997e84

 kernel/fork.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit a72105ef7e0429fb78dd5a3fa2d53e705d09a992
Author: Ryota Ozaki <ozaki.ryota@gmail.com>
Date:   Tue May 29 15:06:20 2012 -0700

    mm: fix off-by-one bug in print_nodes_state()
    
    /sys/devices/system/node/{online,possible} outputs a garbage byte
    because print_nodes_state() returns content size + 1.  To fix the bug,
    the patch changes the use of cpuset_sprintf_cpulist to follow the use at
    other places, which is clearer and safer.
    
    This bug was introduced in v2.6.24 (commit bde631a51876: "mm: add node
    states sysfs class attributeS").
    
    Signed-off-by: Ryota Ozaki <ozaki.ryota@gmail.com>
    Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 drivers/base/node.c |    8 +++-----
 1 files changed, 3 insertions(+), 5 deletions(-)

commit c03faae78d219d3db9f1e85d0d5e7442129fb4d5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 30 17:17:56 2012 -0400

    Vanilla kernel makes kptr_restrict depend on CONFIG_PRINTK.
    This is wrong.  Thanks to Dominic Chen for pointing out a compiler
    error caused by grsec exposing kptr_restrict to !CONFIG_PRINTK

 include/linux/printk.h |    3 ++-
 kernel/sysctl.c        |    2 --
 2 files changed, 2 insertions(+), 3 deletions(-)

commit 624f583e36ff374a9d644a120994398a440a29da
Author: Dave Hansen <dave@linux.vnet.ibm.com>
Date:   Wed May 30 07:51:07 2012 -0700

    mm: fix vma_resv_map() NULL pointer
    
    hugetlb_reserve_pages() can be used for either normal file-backed
    hugetlbfs mappings, or MAP_HUGETLB.  In the MAP_HUGETLB, semi-anonymous
    mode, there is not a VMA around.  The new call to resv_map_put() assumed
    that there was, and resulted in a NULL pointer dereference:
    
      BUG: unable to handle kernel NULL pointer dereference at 0000000000000030
      IP: vma_resv_map+0x9/0x30
      PGD 141453067 PUD 1421e1067 PMD 0
      Oops: 0000 [#1] PREEMPT SMP
      ...
      Pid: 14006, comm: trinity-child6 Not tainted 3.4.0+ #36
      RIP: vma_resv_map+0x9/0x30
      ...
      Process trinity-child6 (pid: 14006, threadinfo ffff8801414e0000, task ffff8801414f26b0)
      Call Trace:
        resv_map_put+0xe/0x40
        hugetlb_reserve_pages+0xa6/0x1d0
        hugetlb_file_setup+0x102/0x2c0
        newseg+0x115/0x360
        ipcget+0x1ce/0x310
        sys_shmget+0x5a/0x60
        system_call_fastpath+0x16/0x1b
    
    This was reported by Dave Jones, but was reproducible with the
    libhugetlbfs test cases, so shame on me for not running them in the
    first place.
    
    With this, the oops is gone, and the output of libhugetlbfs's
    run_tests.py is identical to plain 3.4 again.
    
    [ Marked for stable, since this was introduced by commit c50ac050811d
      ("hugetlb: fix resv_map leak in error path") which was also marked for
      stable ]
    
    Reported-by: Dave Jones <davej@redhat.com>
    Cc: Mel Gorman <mel@csn.ul.ie>
    Cc: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Cc: Christoph Lameter <cl@linux.com>
    Cc: Andrea Arcangeli <aarcange@redhat.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: <stable@vger.kernel.org>        [2.6.32+]
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/hugetlb.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit e72a936cea5b2c2a935a49d47ad937f38da02f84
Author: Eric Dumazet <eric.dumazet@gmail.com>
Date:   Fri Dec 2 23:41:42 2011 +0000

    tcp: drop SYN+FIN messages
    
    Denys Fedoryshchenko reported that SYN+FIN attacks were bringing his
    linux machines to their limits.
    
    Dont call conn_request() if the TCP flags includes SYN flag
    
    Reported-by: Denys Fedoryshchenko <denys@visp.net.lb>
    Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/tcp_input.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 99064bd96d9eb23fed38764be0c5275e4e1db294
Merge: 578ea62 5317994
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun May 27 18:50:04 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 5317994e79a6deff5cf41934dfd60c87ff86c4aa
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun May 27 18:49:46 2012 -0400

    Update to pax-linux-3.2.18-test46.patch

 Makefile                           |   18 ++++++++++--------
 arch/x86/include/asm/mmu_context.h |    8 ++++----
 arch/x86/include/asm/pgtable.h     |    6 +++---
 arch/x86/mm/pgtable.c              |    8 ++++++--
 4 files changed, 23 insertions(+), 17 deletions(-)

commit 578ea626a00101f18e22c0ef47d42d12756aa7d7
Author: Djalal Harouni <tixxdz@opendz.org>
Date:   Sun May 20 13:55:30 2012 +0000

    drivers/net/stmmac: seq_file fix memory leak
    
    Use single_release() instead of seq_release() to free memory allocated
    by single_open().
    
    Signed-off-by: Djalal Harouni <tixxdz@opendz.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/ethernet/stmicro/stmmac/stmmac_main.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 9b6c957fa2babe43aca097dce87a54ed544d214a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 26 11:48:22 2012 -0400

    From dave@linux.vnet.ibm.com Fri May 18 13:50:17 2012
    Date: Fri, 18 May 2012 11:46:30 -0700
    From: Dave Hansen <dave@linux.vnet.ibm.com>
    To: cl@linux.com
    Cc: linux-kernel@vger.kernel.org, linux-mm@kvack.org, aarcange@redhat.com, kosaki.motohiro@jp.fujitsu.com, hughd@google.com, rientjes@google.com, adobriyan@gmail.com, akpm@linux-foundation.org, mel@csn.ul.ie, Dave Hansen <dave@linux.vnet.ibm.com>
    Subject: [RFC][PATCH] hugetlb: fix resv_map leak in error path
    
    When called for anonymous (non-shared) mappings,
    hugetlb_reserve_pages() does a resv_map_alloc().  It depends on
    code in hugetlbfs's vm_ops->close() to release that allocation.
    
    However, in the mmap() failure path, we do a plain unmap_region()
    without the remove_vma() which actually calls vm_ops->close().
    
    This is a decent fix.  This leak could get reintroduced if
    new code (say, after hugetlb_reserve_pages() in
    hugetlbfs_file_mmap()) decides to return an error.  But, I think
    it would have to unroll the reservation anyway.
    
    This hasn't been extensively tested.  Pretty much compile and
    boot tested along with Christoph's test case.
    
    Comments?
    
    Signed-off-by: Dave Hansen <dave@linux.vnet.ibm.com>

 mm/hugetlb.c |   28 ++++++++++++++++++++++------
 1 files changed, 22 insertions(+), 6 deletions(-)

commit 0752aad5990d7064b63ae82902d479e890426986
Merge: 027ab05 6facb1d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 26 11:40:19 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 6facb1df7857882d230e96fc846c33aae324cbe9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 26 11:39:43 2012 -0400

    Update to pax-linux-3.2.18-test45.patch

 include/linux/mtd/map.h |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

commit 89aa6ace15d03b0b88faa7634880e3579dacb91e
Merge: 086b4b6 52c6b95
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 26 11:38:34 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2

commit 086b4b6655d59b34c2456c620cdb63ebd8c21f36
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 26 11:37:59 2012 -0400

    Update to pax-linux-3.2.17-test45.patch

 Makefile                                           |    4 +-
 arch/x86/crypto/aesni-intel_glue.c                 |    2 -
 arch/x86/include/asm/floppy.h                      |    1 -
 arch/x86/include/asm/kvm_host.h                    |    6 +-
 arch/x86/include/asm/syscalls.h                    |    2 +-
 arch/x86/include/asm/uaccess_32.h                  |   21 +-
 arch/x86/include/asm/uaccess_64.h                  |   18 -
 arch/x86/kernel/cpu/mcheck/mce-inject.c            |    2 -
 arch/x86/kernel/cpu/mtrr/if.c                      |    2 -
 arch/x86/kernel/dumpstack_64.c                     |    3 +
 arch/x86/kernel/i387.c                             |   20 -
 arch/x86/kernel/ldt.c                              |    2 -
 arch/x86/kernel/microcode_intel.c                  |    1 -
 arch/x86/kernel/ptrace.c                           |    4 -
 arch/x86/kernel/setup_percpu.c                     |    4 -
 arch/x86/kernel/tls.h                              |    2 +-
 arch/x86/kernel/vm86_32.c                          |    3 -
 arch/x86/kvm/mmu.c                                 |    2 -
 arch/x86/kvm/x86.c                                 |   21 -
 arch/x86/kvm/x86.h                                 |    4 +-
 arch/x86/platform/uv/tlb_uv.c                      |    4 -
 crypto/ablkcipher.c                                |    4 -
 crypto/aead.c                                      |    3 -
 crypto/blkcipher.c                                 |    3 -
 crypto/cipher.c                                    |    3 -
 drivers/acpi/battery.c                             |    3 -
 drivers/acpi/sbs.c                                 |    3 -
 drivers/infiniband/hw/ipath/ipath_fs.c             |    2 -
 drivers/infiniband/hw/qib/qib_fs.c                 |    2 -
 drivers/lguest/lguest_user.c                       |    1 -
 drivers/mtd/ubi/debug.c                            |    2 -
 drivers/net/ethernet/chelsio/cxgb/sge.c            |    2 -
 drivers/net/ethernet/chelsio/cxgb3/sge.c           |    2 -
 drivers/net/ethernet/chelsio/cxgb4/sge.c           |    3 -
 drivers/net/ethernet/chelsio/cxgb4vf/sge.c         |    3 -
 drivers/net/wireless/ath/ath5k/debug.c             |    3 -
 drivers/net/wireless/ath/ath9k/debug.c             |    2 -
 drivers/net/wireless/ath/ath9k/htc_drv_debug.c     |    2 -
 drivers/oprofile/oprofile_files.c                  |    5 -
 drivers/oprofile/oprofilefs.c                      |    1 -
 drivers/platform/x86/asus_acpi.c                   |    2 -
 drivers/platform/x86/toshiba_acpi.c                |    2 -
 drivers/staging/rtl8192e/rtllib_module.c           |    2 -
 .../staging/rtl8192u/ieee80211/ieee80211_module.c  |    2 -
 fs/cifs/asn1.c                                     |    3 -
 fs/configfs/file.c                                 |    2 -
 fs/ncpfs/ncplib_kernel.h                           |    4 +-
 fs/sysfs/bin.c                                     |    2 -
 fs/ubifs/debug.c                                   |    3 -
 include/asm-generic/pgtable-nopud.h                |    1 +
 include/asm-generic/uaccess.h                      |   11 -
 include/linux/moduleloader.h                       |    2 +-
 include/linux/slub_def.h                           |    1 +
 net/ipv4/ah4.c                                     |    2 -
 net/ipv4/netfilter/arp_tables.c                    |   10 -
 net/ipv4/netfilter/ip_tables.c                     |   11 -
 net/ipv4/netfilter/nf_nat_snmp_basic.c             |    4 -
 net/ipv6/ah6.c                                     |    2 -
 net/ipv6/netfilter/ip6_tables.c                    |   11 -
 scripts/Makefile.lib                               |    6 +-
 tools/gcc/size_overflow_hash.h                     |13806 ++++++++++++++++++++
 tools/gcc/size_overflow_hash1.h                    | 2940 -----
 tools/gcc/size_overflow_hash2.h                    |   41 -
 tools/gcc/size_overflow_plugin.c                   |  158 +-
 64 files changed, 13926 insertions(+), 3279 deletions(-)

commit 027ab05e00fd456c7100ae75ded1a5f8d060df2f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 19 10:47:15 2012 -0400

    init ebda range earlier in boot
    
    Conflicts:
    
    	arch/x86/mm/init.c

 arch/x86/mm/init.c |   48 +++++++++++++++++++++++++++++-------------------
 1 files changed, 29 insertions(+), 19 deletions(-)

commit 0afb4c1646ad32e13c44592e8893441c15c3abd3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 19 09:19:42 2012 -0400

    [PATCH] mm: read_pmd_atomic: fix 32bit PAE pmd walk vs pmd_populate SMP race condition
    
    When holding the mmap_sem for reading, pmd_offset_map_lock should only
    run on a pmd_t that has been read atomically from the pmdp
    pointer, otherwise we may read only half of it leading to this crash.
    
    PID: 11679  TASK: f06e8000  CPU: 3   COMMAND: "do_race_2_panic"
     #0 [f06a9dd8] crash_kexec at c049b5ec
     #1 [f06a9e2c] oops_end at c083d1c2
     #2 [f06a9e40] no_context at c0433ded
     #3 [f06a9e64] bad_area_nosemaphore at c043401a
     #4 [f06a9e6c] __do_page_fault at c0434493
     #5 [f06a9eec] do_page_fault at c083eb45
     #6 [f06a9f04] error_code (via page_fault) at c083c5d5
        EAX: 01fb470c EBX: fff35000 ECX: 00000003 EDX: 00000100 EBP:
        00000000
        DS:  007b     ESI: 9e201000 ES:  007b     EDI: 01fb4700 GS:  00e0
        CS:  0060     EIP: c083bc14 ERR: ffffffff EFLAGS: 00010246
     #7 [f06a9f38] _spin_lock at c083bc14
     #8 [f06a9f44] sys_mincore at c0507b7d
     #9 [f06a9fb0] system_call at c083becd
                             start           len
        EAX: ffffffda  EBX: 9e200000  ECX: 00001000  EDX: 6228537f
        DS:  007b      ESI: 00000000  ES:  007b      EDI: 003d0f00
        SS:  007b      ESP: 62285354  EBP: 62285388  GS:  0033
        CS:  0073      EIP: 00291416  ERR: 000000da  EFLAGS: 00000286
    
    This should be a longstanding bug affecting x86 32bit PAE without
    THP. Only archs with 64bit large pmd_t and 32bit unsigned long should
    be affected.
    
    With THP enabled the barrier() in
    pmd_none_or_trans_huge_or_clear_bad() would partly hide the bug when
    the pmd transition from none to stable, by forcing a re-read of the
    *pmd in pmd_offset_map_lock, but when THP is enabled a new set of
    problem arises by the fact could then transition freely in any of the
    none, pmd_trans_huge or pmd_trans_stable states. So making the barrier
    in pmd_none_or_trans_huge_or_clear_bad() unconditional isn't good idea
    and it would be a flakey solution.
    
    This should be fully fixed by introducing a read_pmd_atomic that reads
    the pmd in order with THP disabled, or by reading the pmd atomically
    with cmpxchg8b with THP enabled.
    
    Luckily this new race condition only triggers in the places that must
    already be covered by pmd_none_or_trans_huge_or_clear_bad() so the fix
    is localized there but this bug is not related to THP.
    
    NOTE: this can trigger on x86 32bit systems with PAE enabled with more
    than 4G of ram, otherwise the high part of the pmd will never risk to
    be truncated because it would be zero at all times, in turn so hiding
    the SMP race.
    
    This bug was discovered and fully debugged by Ulrich, quote:
    
    ----
    [..]
    pmd_none_or_trans_huge_or_clear_bad() loads the content of edx and
    eax.
    
        496 static inline int pmd_none_or_trans_huge_or_clear_bad(pmd_t
        *pmd)
        497 {
        498         /* depend on compiler for an atomic pmd read */
        499         pmd_t pmdval = *pmd;
    
                                    // edi = pmd pointer
    0xc0507a74 <sys_mincore+548>:   mov    0x8(%esp),%edi
    ...
                                    // edx = PTE page table high address
    0xc0507a84 <sys_mincore+564>:   mov    0x4(%edi),%edx
    ...
                                    // eax = PTE page table low address
    0xc0507a8e <sys_mincore+574>:   mov    (%edi),%eax
    
    [..]
    
    Please note that the PMD is not read atomically. These are two "mov"
    instructions where the high order bits of the PMD entry are fetched
    first. Hence, the above machine code is prone to the following race.
    
    -  The PMD entry {high|low} is 0x0000000000000000.
       The "mov" at 0xc0507a84 loads 0x00000000 into edx.
    
    -  A page fault (on another CPU) sneaks in between the two "mov"
       instructions and instantiates the PMD.
    
    -  The PMD entry {high|low} is now 0x00000003fda38067.
       The "mov" at 0xc0507a8e loads 0xfda38067 into eax.
    ----
    
    Reported-by: Ulrich Obergfell <uobergfe <at> redhat.com>
    Signed-off-by: Andrea Arcangeli <aarcange <at> redhat.com>
    ---
     arch/x86/include/asm/pgtable-3level.h |   50 +++++++++++++++++++++++++++++++++
     include/asm-generic/pgtable.h         |   22 +++++++++++++-
     2 files changed, 70 insertions(+), 2 deletions(-)

 arch/x86/include/asm/pgtable-3level.h |   50 +++++++++++++++++++++++++++++++++
 include/asm-generic/pgtable.h         |   22 +++++++++++++-
 2 files changed, 70 insertions(+), 2 deletions(-)

commit 3f31d02bce19b538fde14e3b5668be809685c022
Author: Tushar Dave <tushar.n.dave@intel.com>
Date:   Thu May 17 01:04:50 2012 +0000

    e1000: Prevent reset task killing itself.
    
    Killing reset task while adapter is resetting causes deadlock.
    Only kill reset task if adapter is not resetting.
    Ref bug #43132 on bugzilla.kernel.org
    
    CC: stable@vger.kernel.org
    Signed-off-by: Tushar Dave <tushar.n.dave@intel.com>
    Tested-by: Aaron Brown <aaron.f.brown@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/ethernet/intel/e1000/e1000_main.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

commit daa5f43856b4553c6340d88e872776d739d2160e
Author: Willy Tarreau <w@1wt.eu>
Date:   Thu May 17 11:14:14 2012 +0000

    tcp: do_tcp_sendpages() must try to push data out on oom conditions
    
    Since recent changes on TCP splicing (starting with commits 2f533844
    "tcp: allow splice() to build full TSO packets" and 35f9c09f "tcp:
    tcp_sendpages() should call tcp_push() once"), I started seeing
    massive stalls when forwarding traffic between two sockets using
    splice() when pipe buffers were larger than socket buffers.
    
    Latest changes (net: netdev_alloc_skb() use build_skb()) made the
    problem even more apparent.
    
    The reason seems to be that if do_tcp_sendpages() fails on out of memory
    condition without being able to send at least one byte, tcp_push() is not
    called and the buffers cannot be flushed.
    
    After applying the attached patch, I cannot reproduce the stalls at all
    and the data rate it perfectly stable and steady under any condition
    which previously caused the problem to be permanent.
    
    The issue seems to have been there since before the kernel migrated to
    git, which makes me think that the stalls I occasionally experienced
    with tux during stress-tests years ago were probably related to the
    same issue.
    
    This issue was first encountered on 3.0.31 and 3.2.17, so please backport
    to -stable.
    
    Signed-off-by: Willy Tarreau <w@1wt.eu>
    Acked-by: Eric Dumazet <edumazet@google.com>
    Cc: <stable@vger.kernel.org>

 net/ipv4/tcp.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

commit 62288bce99ba29e6ad8974b978d777688cbdbacd
Author: Sachin Prabhu <sprabhu@redhat.com>
Date:   Tue Apr 17 14:35:39 2012 +0100

    Avoid reading past buffer when calling GETACL
    
    Bug noticed in commit
    bf118a342f10dafe44b14451a1392c3254629a1f
    
    When calling GETACL, if the size of the bitmap array, the length
    attribute and the acl returned by the server is greater than the
    allocated buffer(args.acl_len), we can Oops with a General Protection
    fault at _copy_from_pages() when we attempt to read past the pages
    allocated.
    
    This patch allocates an extra PAGE for the bitmap and checks to see that
    the bitmap + attribute_length + ACLs don't exceed the buffer space
    allocated to it.
    
    Signed-off-by: Sachin Prabhu <sprabhu@redhat.com>
    Reported-by: Jian Li <jiali@redhat.com>
    [Trond: Fixed a size_t vs unsigned int printk() warning]
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>

 fs/nfs/nfs4proc.c |   16 ++++++++++------
 fs/nfs/nfs4xdr.c  |   18 +++++++++++-------
 2 files changed, 21 insertions(+), 13 deletions(-)

commit c79bfd258f89880b9874aeb4ebe7715d5f3edbd9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 19 08:30:54 2012 -0400

    Precompute _start/_end

 arch/x86/mm/init.c |   25 ++++++++++++-------------
 1 files changed, 12 insertions(+), 13 deletions(-)

commit 0b3ba52e7dc575243bd1edcb36885a5ed09bdf58
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 19 07:45:06 2012 -0400

    Use new method of EBDA detection
    Resolves issue from: https://bugs.gentoo.org/show_bug.cgi?id=416415

 arch/x86/mm/init.c |   28 +++++++++++++++++++++++++++-
 1 files changed, 27 insertions(+), 1 deletions(-)

commit 045e3efcace3f222f9e2c0e4555ba197d0d406ae
Author: Eric W. Biederman <ebiederm@xmission.com>
Date:   Fri May 4 11:34:03 2012 +0000

    connector/userns: replace netlink uses of cap_raised() with capable()
    
    In 2009 Philip Reiser notied that a few users of netlink connector
    interface needed a capability check and added the idiom
    cap_raised(nsp->eff_cap, CAP_SYS_ADMIN) to a few of them, on the premise
    that netlink was asynchronous.
    
    In 2011 Patrick McHardy noticed we were being silly because netlink is
    synchronous and removed eff_cap from the netlink_skb_params and changed
    the idiom to cap_raised(current_cap(), CAP_SYS_ADMIN).
    
    Looking at those spots with a fresh eye we should be calling
    capable(CAP_SYS_ADMIN).  The only reason I can see for not calling capable
    is that it once appeared we were not in the same task as the caller which
    would have made calling capable() impossible.
    
    In the initial user_namespace the only difference between between
    cap_raised(current_cap(), CAP_SYS_ADMIN) and capable(CAP_SYS_ADMIN) are a
    few sanity checks and the fact that capable(CAP_SYS_ADMIN) sets
    PF_SUPERPRIV if we use the capability.
    
    Since we are going to be using root privilege setting PF_SUPERPRIV seems
    the right thing to do.
    
    The motivation for this that patch is that in a child user namespace
    cap_raised(current_cap(),...) tests your capabilities with respect to that
    child user namespace not capabilities in the initial user namespace and
    thus will allow processes that should be unprivielged to use the kernel
    services that are only protected with cap_raised(current_cap(),..).
    
    To fix possible user_namespace issues and to just clean up the code
    replace cap_raised(current_cap(), CAP_SYS_ADMIN) with
    capable(CAP_SYS_ADMIN).
    
    Signed-off-by: Eric W. Biederman <ebiederm@xmission.com>
    Cc: Patrick McHardy <kaber@trash.net>
    Cc: Philipp Reisner <philipp.reisner@linbit.com>
    Acked-by: Serge E. Hallyn <serge.hallyn@canonical.com>
    Acked-by: Andrew G. Morgan <morgan@kernel.org>
    Cc: Vasiliy Kulikov <segoon@openwall.com>
    Cc: David Howells <dhowells@redhat.com>
    Reviewed-by: James Morris <james.l.morris@oracle.com>
    Cc: David Miller <davem@davemloft.net>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/block/drbd/drbd_nl.c           |    2 +-
 drivers/md/dm-log-userspace-transfer.c |    2 +-
 drivers/video/uvesafb.c                |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

commit d65ad9026b7f848ed4d2edebee98a0c0f36cf68b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun May 13 15:42:34 2012 -0400

    Add MIPS support to GRKERNSEC_SETXID, choose a thread info flag bit
    for each of our supported architectures that can be properly expressed
    within the instruction making use of an immediate value:
    < 12 on sparc64
    < 32 on mips
    < 16 on powerpc
    < 8 or expressable within 8 bits with a shift amount on arm
    
    (different values required for this kernel due to 3.2 feature additions)
    
    Conflicts:
    
    	arch/arm/include/asm/thread_info.h
    	arch/mips/kernel/entry.S
    	arch/mips/kernel/ptrace.c
    	arch/powerpc/include/asm/thread_info.h
    	arch/sparc/include/asm/thread_info_64.h

 arch/arm/include/asm/thread_info.h      |    7 ++++++-
 arch/mips/include/asm/thread_info.h     |    9 +++++++--
 arch/mips/kernel/ptrace.c               |    9 +++++++++
 arch/mips/kernel/scall32-o32.S          |    2 +-
 arch/mips/kernel/scall64-64.S           |    2 +-
 arch/mips/kernel/scall64-n32.S          |    2 +-
 arch/mips/kernel/scall64-o32.S          |    2 +-
 arch/powerpc/include/asm/thread_info.h  |    5 +++--
 arch/sparc/include/asm/thread_info_64.h |    4 ++--
 arch/x86/include/asm/thread_info.h      |    3 ++-
 grsecurity/Kconfig                      |    4 ++--
 11 files changed, 35 insertions(+), 14 deletions(-)

commit e3f38c0989ce2cd3b54f1cfb80367c8c36223e70
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun May 13 14:21:06 2012 -0400

    Add arm/ppc/sparc64 support to GRKERNSEC_SETXID
    (backported from my 3.3 branch)
    
    Conflicts:
    
    	arch/arm/include/asm/thread_info.h
    	arch/arm/kernel/ptrace.c
    	arch/powerpc/kernel/ptrace.c
    	arch/sparc/include/asm/thread_info_64.h
    	arch/sparc/kernel/ptrace_64.c

 arch/arm/include/asm/thread_info.h      |    5 +++++
 arch/arm/kernel/entry-common.S          |    4 ++--
 arch/arm/kernel/ptrace.c                |    9 +++++++++
 arch/powerpc/include/asm/thread_info.h  |    6 +++++-
 arch/powerpc/kernel/ptrace.c            |   14 ++++++++++++++
 arch/sparc/include/asm/thread_info_64.h |    7 +++++++
 arch/sparc/kernel/ptrace_64.c           |   14 ++++++++++++++
 arch/sparc/kernel/syscalls.S            |   10 +++++-----
 arch/x86/include/asm/thread_info.h      |    2 +-
 grsecurity/Kconfig                      |    4 ++--
 10 files changed, 64 insertions(+), 11 deletions(-)

commit 86d7185f4c862e259fa03067eb349a06a891224c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 12 23:24:22 2012 -0400

    Make CONFIG_GRKERNSEC_SETXID depend on X86 for now, more architectures to
    be added later
    Speeds up implementation by using existing thread info flag check
    Will also apply the new credentials faster than the previous method, either
    upon the next syscall entry or exit
    Resolves oops triggerable by root reported by Pavel Labushev
    
    Conflicts:
    
    	arch/x86/kernel/ptrace.c

 arch/x86/include/asm/thread_info.h |    8 +++++---
 arch/x86/kernel/ptrace.c           |   14 ++++++++++++++
 grsecurity/Kconfig                 |    3 ++-
 kernel/cred.c                      |   11 ++++++++++-
 kernel/sched.c                     |   15 ---------------
 5 files changed, 31 insertions(+), 20 deletions(-)

commit b723fe28fbbdaf79171af295dcf68720994b34a6
Merge: 40460a5 75dc29a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 12 17:12:03 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 75dc29a8d45a24660af6b7c2730089e966696d28
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 12 17:11:41 2012 -0400

    Update to pax-linux-3.2.17-test43.patch

 arch/x86/kernel/entry_32.S     |    2 +-
 arch/x86/lib/atomic64_cx8_32.S |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

commit 40460a58c42d973a321ce8e0002c4e2aed66f6c7
Merge: 9db4a7a 13bdf78
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 12 15:55:37 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 13bdf78f4fa796dc369668d0dd93b1d16802befe
Merge: 2767369 a2cfa87
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat May 12 15:55:25 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2
    
    Conflicts:
    	arch/x86/boot/compressed/relocs.c

commit 9db4a7a097e5cfa9ededa8b66726b24e5f067235
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 9 17:22:32 2012 -0400

    No need to perform descendent checks on anything but PTRACE_ATTACH/PTRACE_SEIZE
    resolves issue with strace -f v4.7

 grsecurity/gracl.c |   25 +++++++++++++------------
 1 files changed, 13 insertions(+), 12 deletions(-)

commit 72515f1e2dfc19a07c07b5b8eec100c4523b89b1
Merge: 41c4b12 2767369
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 9 17:30:58 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 2767369db58c7f839fa3447d215ddff4b1667de2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed May 9 17:30:38 2012 -0400

    Update to pax-linux-3.2.16-test42.patch

 arch/x86/mm/hugetlbpage.c |    7 ++++++-
 arch/x86/mm/init_64.c     |    2 +-
 lib/ioremap.c             |    4 ++--
 mm/memory.c               |    8 ++++++--
 4 files changed, 15 insertions(+), 6 deletions(-)

commit 41c4b12408183ed03ff8627f89ea15d3f80c5143
Author: Jeff Mahoney <jeffm@suse.com>
Date:   Wed Apr 25 14:32:09 2012 +0000

    dl2k: Clean up rio_ioctl
    
    The dl2k driver's rio_ioctl call has a few issues:
    - No permissions checking
    - Implements SIOCGMIIREG and SIOCGMIIREG using the SIOCDEVPRIVATE numbers
    - Has a few ioctls that may have been used for debugging at one point
      but have no place in the kernel proper.
    
    This patch removes all but the MII ioctls, renumbers them to use the
    standard ones, and adds the proper permission check for SIOCSMIIREG.
    
    We can also get rid of the dl2k-specific struct mii_data in favor of
    the generic struct mii_ioctl_data.
    
    Since we have the phyid on hand, we can add the SIOCGMIIPHY ioctl too.
    
    Most of the MII code for the driver could probably be converted to use
    the generic MII library but I don't have a device to test the results.
    
    Reported-by: Stephan Mueller <stephan.mueller@atsec.com>
    Signed-off-by: Jeff Mahoney <jeffm@suse.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/ethernet/dlink/dl2k.c |   52 ++++++------------------------------
 drivers/net/ethernet/dlink/dl2k.h |    7 -----
 2 files changed, 9 insertions(+), 50 deletions(-)

commit 8a2d9e61be994c51e21816fa6330d71ab84584e5
Author: David Vrabel <david.vrabel@citrix.com>
Date:   Thu Apr 26 19:44:06 2012 +0100

    xen: correctly check for pending events when restoring irq flags
    
    In xen_restore_fl_direct(), xen_force_evtchn_callback() was being
    called even if no events were pending.  This resulted in (depending on
    workload) about a 100 times as many xen_version hypercalls as
    necessary.
    
    Fix this by correcting the sense of the conditional jump.
    
    This seems to give a significant performance benefit for some
    workloads.
    
    There is some subtle tricksy "..since the check here is trying to
    check both pending and masked in a single cmpw, but I think this is
    correct. It will call check_events now only when the combined
    mask+pending word is 0x0001 (aka unmasked, pending)." (Ian)
    
    CC: stable@kernel.org
    Acked-by: Ian Campbell <ian.campbell@citrix.com>
    Signed-off-by: David Vrabel <david.vrabel@citrix.com>
    Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>

 arch/x86/xen/xen-asm.S |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit db23373132d3c2c00a20b8e5597da8d69c164976
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Fri May 4 12:09:39 2012 -0700

    hfsplus: Fix potential buffer overflows
    
    Commit ec81aecb2966 ("hfs: fix a potential buffer overflow") fixed a few
    potential buffer overflows in the hfs filesystem.  But as Timo Warns
    pointed out, these changes also need to be made on the hfsplus
    filesystem as well.
    
    Reported-by: Timo Warns <warns@pre-sense.de>
    Acked-by: WANG Cong <amwang@redhat.com>
    Cc: Alexey Khoroshilov <khoroshilov@ispras.ru>
    Cc: Miklos Szeredi <mszeredi@suse.cz>
    Cc: Sage Weil <sage@newdream.net>
    Cc: Eugene Teo <eteo@redhat.com>
    Cc: Roman Zippel <zippel@linux-m68k.org>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Cc: Christoph Hellwig <hch@lst.de>
    Cc: Alexey Dobriyan <adobriyan@gmail.com>
    Cc: Dave Anderson <anderson@redhat.com>
    Cc: stable <stable@vger.kernel.org>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/hfsplus/catalog.c |    4 ++++
 fs/hfsplus/dir.c     |   11 +++++++++++
 2 files changed, 15 insertions(+), 0 deletions(-)

commit 2372641fad38c46ecbbcaac3906ccf20e74c6e2f
Merge: 840869d afba274
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon May 7 17:46:21 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit afba274d630e612c82f444c601c4c5f013451902
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon May 7 17:46:04 2012 -0400

    Update to pax-linux-3.2.16-test41.patch

 arch/alpha/include/asm/pgalloc.h      |    6 +++
 arch/arm/include/asm/pgalloc.h        |    1 +
 arch/ia64/include/asm/pgalloc.h       |   12 ++++++
 arch/mips/include/asm/pgalloc.h       |    5 ++
 arch/parisc/include/asm/pgalloc.h     |    6 +++
 arch/powerpc/include/asm/pgalloc-64.h |    7 +++
 arch/sparc/include/asm/pgalloc_32.h   |    1 +
 arch/sparc/include/asm/pgalloc_64.h   |    1 +
 arch/um/include/asm/pgtable-3level.h  |    1 +
 arch/x86/include/asm/pgalloc.h        |   16 ++++++++
 arch/x86/include/asm/pgtable_64.h     |    2 +
 arch/x86/mm/init_64.c                 |    6 +-
 fs/binfmt_elf.c                       |    6 ++-
 include/linux/mm.h                    |   26 ++++++++++++
 mm/memory.c                           |   41 ++++++++++++++++++++
 mm/sparse-vmemmap.c                   |    4 +-
 mm/vmalloc.c                          |    4 +-
 tools/gcc/size_overflow_plugin.c      |   68 ++++++++++++++++++++++++++-------
 18 files changed, 191 insertions(+), 22 deletions(-)

commit 840869d00e754e6787bbfd019ba9fdba9ce01207
Merge: a3846ee e928972
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 27 17:55:52 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit e928972cb8c4754ee2adc6bc54f1737f9542a13a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 27 17:55:15 2012 -0400

    Update to pax-linux-3.2.16-test40.patch

 arch/arm/include/asm/atomic.h |    2 +-
 tools/perf/util/hist.c        |    4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

commit a3846eeb3d2e025baf4fee3277174bf1543dd45c
Merge: 37ade40 675e897
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Apr 23 18:09:08 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	security/Kconfig

commit 675e8974019af64eb161a59bf57ae80a4da54b19
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Apr 23 17:54:20 2012 -0400

    Update to pax-linux-3.2.16-test39.patch

 arch/x86/kvm/svm.c                   |    1 -
 drivers/gpu/drm/i915/intel_display.c |    8 +++++++-
 drivers/video/uvesafb.c              |    5 +++--
 security/Kconfig                     |    1 +
 tools/gcc/constify_plugin.c          |    2 +-
 5 files changed, 12 insertions(+), 5 deletions(-)

commit 37ade405a9e576f21c86cb4bddb694c18abe4e9b
Merge: 34863d3 d6ffbcc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 22 20:57:27 2012 -0400

    Upstream finally got around to fixing the ASLR infoleak I found and fixed
    in grsecurity in 2009.  Three years with the fix in plain sight in the patch,
    yet still it wasn't known or fixed until I explicitly mentioned it to Kees.
    (this seems to be a recurring theme)
    
    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	kernel/futex.c
    	kernel/futex_compat.c
    	security/commoncap.c

commit d6ffbcc3cb15c9daa8277f956176c03c5c32fcb8
Merge: dd13dd1 b1be7dd
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 22 20:46:33 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2

commit 34863d3657ad46ccd27e6de0af359098d35c3805
Author: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Date:   Fri Apr 13 03:35:13 2012 +0000

    sparc64: Eliminate obsolete __handle_softirq() function
    
    The invocation of softirq is now handled by irq_exit(), so there is no
    need for sparc64 to invoke it on the trap-return path.  In fact, doing so
    is a bug because if the trap occurred in the idle loop, this invocation
    can result in lockdep-RCU failures.  The problem is that RCU ignores idle
    CPUs, and the sparc64 trap-return path to the softirq handlers fails to
    tell RCU that the CPU must be considered non-idle while those handlers
    are executing.  This means that RCU is ignoring any RCU read-side critical
    sections in those handlers, which in turn means that RCU-protected data
    can be yanked out from under those read-side critical sections.
    
    The shiny new lockdep-RCU ability to detect RCU read-side critical sections
    that RCU is ignoring located this problem.
    
    The fix is straightforward: Make sparc64 stop manually invoking the
    softirq handlers.
    
    Reported-by: Meelis Roos <mroos@linux.ee>
    Suggested-by: David Miller <davem@davemloft.net>
    Signed-off-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
    Tested-by: Meelis Roos <mroos@linux.ee>
    Cc: stable@vger.kernel.org
    Signed-off-by: David S. Miller <davem@davemloft.net>

 arch/sparc/kernel/rtrap_64.S |    7 -------
 1 files changed, 0 insertions(+), 7 deletions(-)

commit 7c4fab2f07a49c4d77f07c50ed0d15cc05439746
Author: David S. Miller <davem@davemloft.net>
Date:   Fri Apr 13 11:56:22 2012 -0700

    sparc64: Fix bootup crash on sun4v.
    
    The DS driver registers as a subsys_initcall() but this can be too
    early, in particular this risks registering before we've had a chance
    to allocate and setup module_kset in kernel/params.c which is
    performed also as a subsyts_initcall().
    
    Register DS using device_initcall() insteal.
    
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Cc: stable@vger.kernel.org

 arch/sparc/kernel/ds.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 44335120501da9d5442e0906282253db1e22652a
Author: Lubos Lunak <l.lunak@suse.cz>
Date:   Wed Mar 21 14:08:24 2012 +0100

    do not export kernel's NULL #define to userspace
    
    GCC's NULL is actually __null, which allows detecting some questionable
    NULL usage and warn about it.  Moreover each platform/compiler should
    have its own stddef.h anyway (which is different from linux/stddef.h).
    
    So there's no good reason to leak kernel's NULL to userspace and
    override what the compiler provides.
    
    Signed-off-by: Luboš Luňák <l.lunak@suse.cz>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 include/linux/stddef.h |    8 ++------
 1 files changed, 2 insertions(+), 6 deletions(-)

commit 1be77a2739e36c6cfb18f26e5bb8f5e190e19198
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Apr 19 20:27:57 2012 -0400

    http://marc.info/?l=linux-kernel&m=133455712201581&w=2
    
    Currently we do not validate the vector length before calling
    get_user_pages_fast(), host stack would be easily overflowed by
    malicious guest driver who give us a descriptor with length greater
    than MAX_SKB_FRAGS. Solve this problem by checking the free entries
    before trying to pin user pages.
    
    Signed-off-by: Jason Wang <jasowang@redhat.com>

 drivers/net/macvtap.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit cd31d27c60df414967759e87387870a411cb7167
Author: Eric Paris <eparis@redhat.com>
Date:   Tue Apr 17 16:26:54 2012 -0400

    fcaps: clear the same personality flags as suid when fcaps are used
    
    If a process increases permissions using fcaps all of the dangerous
    personality flags which are cleared for suid apps should also be cleared.
    Thus programs given priviledge with fcaps will continue to have address space
    randomization enabled even if the parent tried to disable it to make it
    easier to attack.
    
    Signed-off-by: Eric Paris <eparis@redhat.com>
    Reviewed-by: Serge Hallyn <serge.hallyn@canonical.com>
    Signed-off-by: James Morris <james.l.morris@oracle.com>

 security/commoncap.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

commit 773470237ced146ad5351aa30649aa4018cb01fc
Merge: 9f09ae7 dd13dd1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 15 11:10:23 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit dd13dd1d43abd6c60bf254ecf7131f1686bf20f2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 15 11:09:56 2012 -0400

    Update to pax-linux-3.2.15-test38.patch

 include/asm-generic/pgtable.h |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 9f09ae7431d00d41447009fbb74bfb0e075fcc45
Merge: 73ef9f7 d4abce8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 13 16:46:04 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit d4abce84e8e8f5d5ea4f2f7d7b91f48c19f9e734
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 13 16:45:12 2012 -0400

    Remove size_overflow checks from vmx_set_msr and kvm_set_msr_common

 arch/x86/include/asm/kvm_host.h |    2 +-
 arch/x86/kvm/vmx.c              |    1 -
 2 files changed, 1 insertions(+), 2 deletions(-)

commit 73ef9f7325e55aba185ab79db04a11d771f2b090
Author: Jason Wessel <jason.wessel@windriver.com>
Date:   Thu Apr 12 12:49:17 2012 -0700

    panic: fix stack dump print on direct call to panic()
    
    Commit 6e6f0a1f0fa6 ("panic: don't print redundant backtraces on oops")
    causes a regression where no stack trace will be printed at all for the
    case where kernel code calls panic() directly while not processing an
    oops, and of course there are 100's of instances of this type of call.
    
    The original commit executed the check (!oops_in_progress), but this will
    always be false because just before the dump_stack() there is a call to
    bust_spinlocks(1), which does the following:
    
      void __attribute__((weak)) bust_spinlocks(int yes)
      {
    	if (yes) {
    		++oops_in_progress;
    
    The proper way to resolve the problem that original commit tried to
    solve is to avoid printing a stack dump from panic() when the either of
    the following conditions is true:
    
      1) TAINT_DIE has been set (this is done by oops_end())
         This indicates and oops has already been printed.
      2) oops_in_progress > 1
         This guards against the rare case where panic() is invoked
         a second time, or in between oops_begin() and oops_end()
    
    Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: <stable@vger.kernel.org>	[3.3+]
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 kernel/panic.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 6ac886c970ac614e583e285472d628a950066f35
Author: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date:   Thu Apr 12 12:49:12 2012 -0700

    drivers/char/random.c: fix boot id uniqueness race
    
    /proc/sys/kernel/random/boot_id can be read concurrently by userspace
    processes.  If two (or more) user-space processes concurrently read
    boot_id when sysctl_bootid is not yet assigned, a race can occur making
    boot_id differ between the reads.  Because the whole point of the boot id
    is to be unique across a kernel execution, fix this by protecting this
    operation with a spinlock.
    
    Given that this operation is not frequently used, hitting the spinlock
    on each call should not be an issue.
    
    Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
    Cc: "Theodore Ts'o" <tytso@mit.edu>
    Cc: Matt Mackall <mpm@selenic.com>
    Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
    Cc: Greg Kroah-Hartman <greg@kroah.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 drivers/char/random.c |   11 ++++++++---
 1 files changed, 8 insertions(+), 3 deletions(-)

commit ce7d39c207b12e1a667acde98d82c894e3875ab9
Merge: 6ec2b43 910af23
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 13 16:11:53 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	kernel/sysctl.c

commit 910af236bd0cb8d9de8ac26ae31ace12e3c6f145
Merge: 075bd64 0147c2a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 13 16:10:59 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2

commit 6ec2b43204b799925ab52f655e49650ac7235747
Merge: 8295969 075bd64
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Apr 9 17:02:37 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 075bd6459ae80a9c53f7d8fb172f8d8777e68003
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Apr 9 17:02:19 2012 -0400

    Update to pax-linux-3.2.14-test38.patch

 arch/x86/mm/pgtable.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

commit 8295969574219974a9c53d6c0c8dc906b307c6c2
Merge: caf3de7 970a4d6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 18:06:14 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2
    
    Conflicts:
    	mm/mmap.c

commit 970a4d6d0f2d1112b1212f7bc74d275fb08f72d9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 18:05:25 2012 -0400

    Update to pax-linux-3.2.14-test37.patch

 arch/x86/crypto/aesni-intel_glue.c      |    2 +
 arch/x86/kernel/kdebugfs.c              |    2 +
 arch/x86/kernel/ldt.c                   |    1 +
 arch/x86/kernel/module.c                |    3 +
 arch/x86/kernel/vm86_32.c               |    3 +
 arch/x86/kvm/mmu.c                      |    2 +
 arch/x86/kvm/x86.c                      |    1 +
 drivers/net/ethernet/chelsio/cxgb/sge.c |    2 +
 fs/binfmt_elf.c                         |    1 +
 fs/configfs/file.c                      |    2 +
 include/linux/mm_types.h                |    4 +-
 mm/mmap.c                               |    5 +
 net/ipv4/netfilter/arp_tables.c         |    3 +
 net/ipv4/netfilter/ip_tables.c          |    4 +
 net/ipv6/netfilter/ip6_tables.c         |    4 +
 security/Kconfig                        |    1 +
 tools/gcc/size_overflow_hash1.h         | 1764 +++++++++++++++++--------------
 tools/gcc/size_overflow_hash2.h         |   45 +-
 tools/gcc/size_overflow_plugin.c        |   47 +-
 19 files changed, 1061 insertions(+), 835 deletions(-)

commit caf3de72f7e12cedabd1fe9b8e68f3375d40a837
Merge: 6a441a3 82cd359
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 16:10:03 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 6a441a3cc2a1bd7c4720ae13d1a8ea913b01fbf6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 16:09:54 2012 -0400

    Revert "Fix RLIMIT_AS accounting with brk randomization"
    
    This reverts commit b7c7a761adda43e1c5f6106c8c514c9dd6f7ca6b.

 fs/binfmt_elf.c |    2 +-
 mm/mmap.c       |    2 --
 2 files changed, 1 insertions(+), 3 deletions(-)

commit 12925c8fd177e35ac4c3bac8779e8624ca82200a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 16:09:36 2012 -0400

    Revert "Fix RLIMIT_AS checking with brk randomization"
    
    This reverts commit 0d65cdf0bc27c6d68c4b7b870c06a1e964a74000.

 fs/binfmt_elf.c |    2 --
 mm/mmap.c       |    5 +----
 2 files changed, 1 insertions(+), 6 deletions(-)

commit 807bac6a4cae833247fb83a24d741a38c5e5d071
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 16:09:20 2012 -0400

    Revert "Fix RLIMIT_AS checking with brk randomization"
    
    This reverts commit f71a43aa4787cba5f75de79831f7736791920a1d.

 fs/binfmt_elf.c |    2 ++
 mm/mmap.c       |    2 +-
 2 files changed, 3 insertions(+), 1 deletions(-)

commit 071e6d21eb279badcb957c4be50e7937ea605ce4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 16:09:04 2012 -0400

    Revert "fix wraparound"
    
    This reverts commit 245cc576662df68ae18fe81ebef2547afad20138.

 fs/binfmt_elf.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

commit 904135be7a69cf9a33fa113413009942f2fa4b6e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 16:08:51 2012 -0400

    Revert "fake start_brk value before mmap is processed"
    
    This reverts commit 2eee63c329d03b2e1e1a55b3c74c8d06c9ecc7cb.

 fs/binfmt_elf.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

commit 82cd359c19b5acc2dc8aa3e41298bb2a34bb964c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 16:06:22 2012 -0400

    Update to pax-linux-3.2.14-test36.patch

 arch/x86/mm/pgtable.c            |   12 +-
 drivers/mtd/ubi/build.c          |   16 +-
 include/linux/mm_types.h         |    2 +-
 scripts/mod/modpost.c            |    2 +-
 scripts/tags.sh                  |    2 +-
 tools/gcc/kernexec_plugin.c      |    2 +-
 tools/gcc/size_overflow_plugin.c |  501 +++++++++++++++++++++-----------------
 7 files changed, 295 insertions(+), 242 deletions(-)

commit e03fb7bed70f5b7d06542b7f9aa2a3063a6a94af
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 15:40:58 2012 -0400

    Always allow use of AF_UNSPEC for already-connected sockets to disconnect

 grsecurity/gracl_ip.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit 5fbf54ee990823c7fc19ac81ce7212169b3d1a13
Author: Eric Dumazet <eric.dumazet@gmail.com>
Date:   Fri Apr 6 10:49:10 2012 +0200

    net: fix a race in sock_queue_err_skb()
    
    As soon as an skb is queued into socket error queue, another thread
    can consume it, so we are not allowed to reference skb anymore, or risk
    use after free.
    
    Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/core/skbuff.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

commit 893ff59430868ce338eaeb779effb10d17f3d7f8
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 10:13:28 2012 -0400

    always allow admin to follow ptrace'd execs
    no need for task_lock

 grsecurity/gracl.c |   19 ++++++++++++++++---
 1 files changed, 16 insertions(+), 3 deletions(-)

commit 9b667afc56cbb37560b776a8829a472b956f2f21
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 06:58:58 2012 -0400

    Require CAP_SYS_ADMIN for /proc/sysrq-trigger

 drivers/tty/sysrq.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 0f278125322183aba42314483ee1afe89656d39c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Apr 8 07:01:20 2012 -0400

    Require CAP_SYS_ADMIN for /sys/kernel/uevent_helper

 kernel/ksysfs.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 2eee63c329d03b2e1e1a55b3c74c8d06c9ecc7cb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 6 19:45:36 2012 -0400

    fake start_brk value before mmap is processed

 fs/binfmt_elf.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 245cc576662df68ae18fe81ebef2547afad20138
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 6 18:56:24 2012 -0400

    fix wraparound
    
    Conflicts:
    
    	fs/binfmt_elf.c

 fs/binfmt_elf.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit f71a43aa4787cba5f75de79831f7736791920a1d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Apr 6 18:14:20 2012 -0400

    Fix RLIMIT_AS checking with brk randomization

 fs/binfmt_elf.c |    2 --
 mm/mmap.c       |    2 +-
 2 files changed, 1 insertions(+), 3 deletions(-)

commit 0d65cdf0bc27c6d68c4b7b870c06a1e964a74000
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Apr 5 20:54:16 2012 -0400

    Fix RLIMIT_AS checking with brk randomization

 fs/binfmt_elf.c |    2 ++
 mm/mmap.c       |    5 ++++-
 2 files changed, 6 insertions(+), 1 deletions(-)

commit b7c7a761adda43e1c5f6106c8c514c9dd6f7ca6b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Apr 5 19:53:46 2012 -0400

    Fix RLIMIT_AS accounting with brk randomization

 fs/binfmt_elf.c |    2 +-
 mm/mmap.c       |    2 ++
 2 files changed, 3 insertions(+), 1 deletions(-)

commit a9bfc047db1a2d3c8e5c385667c4a69cc99d50b0
Merge: 181ee55 1a61e24
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Apr 2 17:40:11 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 1a61e242ebb26fb7e093225a79ad4c8c900d62aa
Merge: 9cd5531 23d8c3f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Apr 2 17:39:50 2012 -0400

    Merge branch 'linux-3.2.y' into pax-stable2
    
    Conflicts:
    	arch/x86/net/bpf_jit_comp.c

commit 181ee556441c3fd84a312b1a4d554f0b8f14d2d3
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Sat Mar 24 10:52:50 2012 +0300

    x86, tls: Off by one limit check
    
    These are used as offsets into an array of GDT_ENTRY_TLS_ENTRIES members
    so GDT_ENTRY_TLS_ENTRIES is one past the end of the array.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Link: http://lkml.kernel.org/r/20120324075250.GA28258@elgon.mountain
    Cc: <stable@vger.kernel.org>
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>

 arch/x86/kernel/tls.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit a59823ae623bda736762f26a6baa0dbf924363e9
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Mon Mar 19 16:19:53 2012 -0700

    vfs: get rid of batshit-insane pointless dentry hash calculations
    
    For some odd historical reason, the final mixing round for the dentry
    cache hash table lookup had an insane "xor with big constant" logic.  In
    two places.
    
    The big constant that is being xor'ed is GOLDEN_RATIO_PRIME, which is a
    fairly random-looking number that is designed to be *multiplied* with so
    that the bits get spread out over a whole long-word.
    
    But xor'ing with it is insane.  It doesn't really even change the hash -
    it really only shifts the hash around in the hash table.  To make
    matters worse, the insane big constant is different on 32-bit and 64-bit
    builds, even though the name hash bits we use are always 32-bit (and the
    bits from the pointer we mix in effectively are too).
    
    It's all total voodoo programming, in other words.
    
    Now, some testing and analysis of the hash chains shows that the rest of
    the hash function seems to be fairly good.  It does pick the right bits
    of the parent dentry pointer, for example, and while it's generally a
    bad idea to use an xor to mix down the upper bits (because if there is a
    repeating pattern, the xor can cause "destructive interference"), it
    seems to not have been a disaster.
    
    For example, replacing the hash with the normal "hash_long()" code (that
    uses the GOLDEN_RATIO_PRIME constant correctly, btw) actually just makes
    the hash worse.  The hand-picked hash knew which bits of the pointer had
    the highest entropy, and hash_long() ends up mixing bits less optimally
    at least in some trivial tests.
    
    So the hash function overall seems fine, it just has that really odd
    "shift result around by a constant xor".
    
    So get rid of the silly xor, and replace the down-mixing of the bits
    with an add instead of an xor that tends to not have the same kind of
    destructive interference issues.  Some stats on the resulting hash
    chains shows that they look statistically identical before and after,
    but the code is simpler and no longer makes you go "WTF?".
    
    Also, the incoming hash really is just "unsigned int", not a long, and
    there's no real point to worry about the high 26 bits of the dentry
    pointer for the 64-bit case, because they are all going to be identical
    anyway.
    
    So also change the hashing to be done in the more natural 'unsigned int'
    that is the real size of the actual hashed data anyway.
    
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/dcache.c

 fs/dcache.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

commit 6d95bf70848ab665cbf4ecd4b32c1f7d89f81988
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Fri Mar 23 15:02:40 2012 -0700

    ptrace: don't send SIGTRAP on exec if SEIZED
    
    ptrace_event(PTRACE_EVENT_EXEC) sends SIGTRAP if PT_TRACE_EXEC is not
    set.  This is because this SIGTRAP predates PTRACE_O_TRACEEXEC option,
    we do not need/want this with PT_SEIZED which can set the options during
    attach.
    
    Suggested-by: Pedro Alves <palves@redhat.com>
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Cc: Chris Evans <scarybeasts@gmail.com>
    Cc: Indan Zupancic <indan@nul.nu>
    Cc: Denys Vlasenko <vda.linux@googlemail.com>
    Cc: Tejun Heo <tj@kernel.org>
    Cc: Pedro Alves <palves@redhat.com>
    Cc: Jan Kratochvil <jan.kratochvil@redhat.com>
    Cc: Steven Rostedt <rostedt@goodmis.org>
    Cc: Frederic Weisbecker <fweisbec@gmail.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 include/linux/ptrace.h |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

commit eaa35dd4dcece42ce9c0c4d7844c8caf0342b646
Author: Dmitry Adamushko <dmitry.adamushko@gmail.com>
Date:   Thu Mar 22 21:39:25 2012 +0100

    x86-32: Fix endless loop when processing signals for kernel tasks
    
    The problem occurs on !CONFIG_VM86 kernels [1] when a kernel-mode task
    returns from a system call with a pending signal.
    
    A real-life scenario is a child of 'khelper' returning from a failed
    kernel_execve() in ____call_usermodehelper() [ kernel/kmod.c ].
    kernel_execve() fails due to a pending SIGKILL, which is the result of
    "kill -9 -1" (at least, busybox's init does it upon reboot).
    
    The loop is as follows:
    
    * syscall_exit_work:
     - work_pending:            // start_of_the_loop
     - work_notify_sig:
       - do_notify_resume()
         - do_signal()
           - if (!user_mode(regs)) return;
     - resume_userspace         // TIF_SIGPENDING is still set
     - work_pending             // so we call work_pending => goto
                                // start_of_the_loop
    
    More information can be found in another LKML thread:
    http://www.serverphorums.com/read.php?12,457826
    
    [1] the problem was also seen on MIPS.
    
    Signed-off-by: Dmitry Adamushko <dmitry.adamushko@gmail.com>
    Link: http://lkml.kernel.org/r/1332448765.2299.68.camel@dimm
    Cc: Oleg Nesterov <oleg@redhat.com>
    Cc: Roland McGrath <roland@hack.frob.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>

 arch/x86/kernel/entry_32.S |   17 ++++++++++-------
 1 files changed, 10 insertions(+), 7 deletions(-)

commit 18d04080aa3d0ba1438f1fe9dabb7f06354b5803
Merge: 71305d0 9cd5531
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 25 18:34:54 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 9cd55317fdaeed9dac90176677db0e71e61bf3f0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 25 18:34:39 2012 -0400

    Update to pax-linux-3.2.13-test35.patch

 fs/binfmt_elf.c         |    8 ++++----
 kernel/rcutiny_plugin.h |    2 +-
 2 files changed, 5 insertions(+), 5 deletions(-)

commit 71305d02029dc5baf75df7de41922ed683796fcb
Merge: 2c40c52 49c761c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 24 19:36:30 2012 -0400

    Merge branch 'pax-stable2' into grsec-stable2

commit 49c761c7a2f9e27c10e73bf488e2fbcb9fc008d7
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 24 19:35:57 2012 -0400

    Update to pax-linux-3.2.13-test34.patch
    reduces overcommit amount from recently increased brk entropy

 arch/arm/include/asm/atomic.h |    5 +++++
 fs/binfmt_elf.c               |   27 ++++++++++++++++++++++-----
 fs/bio.c                      |    2 +-
 3 files changed, 28 insertions(+), 6 deletions(-)

commit 2c40c52551d2d3eabe8eb5058feac286e313bc2d
Merge: a00016a bae758f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 24 14:43:05 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit bae758f6711fbf19acf5b4657013f1507945e2d8
Merge: fc53d63 0290590
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 24 14:43:02 2012 -0400

    Merge branch 'linux-3.2.y' into pax-test

commit a00016a11e35e91aec8e2d9b6ec4c6fbb11d6d2b
Merge: 0949bd4 fc53d63
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 22 19:03:44 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit fc53d6338964741b368070ec5c935bc579b8c2a6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 22 19:02:45 2012 -0400

    Update to pax-linux-3.2.12-test33.patch

 arch/x86/include/asm/uaccess_32.h |    6 +++---
 arch/x86/include/asm/uaccess_64.h |    8 ++++----
 arch/x86/lib/usercopy_32.c        |    6 +++---
 arch/x86/lib/usercopy_64.c        |    8 ++++----
 4 files changed, 14 insertions(+), 14 deletions(-)

commit 0949bd46a6455b308f66ad7c993bfee62412db35
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 22 16:56:09 2012 -0400

    Use current_umask() instead of current->fs->umask

 fs/ceph/dir.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 22f6432d0fe733619cfcb523782ed7d80c46d645
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 21 19:42:42 2012 -0400

    compile fix

 grsecurity/gracl.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 0cad49d6b8fbb32395da924c1665a1110a9a9eef
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 21 19:34:56 2012 -0400

    Resolve some very tricky hash table manipulations that resulted in an infinite loop in certain
    uses of domains with particular hash collisions

 grsecurity/gracl.c |   62 +++++++++++++++++++++++++++++++++++++++++----------
 1 files changed, 50 insertions(+), 12 deletions(-)

commit 47fc52e0a068a29d6cca2f809daf0679cba33c44
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 20:25:49 2012 -0400

    zero kernel_role

 grsecurity/gracl.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit b00953b43c69238d181d21121ef1577c988d5f6b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 19:29:34 2012 -0400

    zero real_root after releasing it

 grsecurity/gracl.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 0b3ab73ce5d34a2c3206955cd65eddd6bdfd32a1
Merge: b724f59 273f98e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 19:11:26 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit 273f98e58cdac555d3b5dce5c1ca168349f95878
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 19:10:52 2012 -0400

    Temporary workaround for (most) size_overflow plugin false-positives
    Increase randomization for brk-managed heap to 21 bits
    Update to pax-linux-3.2.12-test32.patch

 arch/x86/include/asm/uaccess_32.h |    4 ++--
 arch/x86/include/asm/uaccess_64.h |    4 ++--
 fs/binfmt_elf.c                   |    2 +-
 include/asm-generic/uaccess.h     |    4 ----
 4 files changed, 5 insertions(+), 9 deletions(-)

commit b724f59125304460c2af8bd4b02921993afbb5d3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 18:58:53 2012 -0400

    compile fix

 grsecurity/gracl.c |    9 +++------
 1 files changed, 3 insertions(+), 6 deletions(-)

commit 329f1a9d0f137d0a973316c53bbec18a6eeecd4f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 18:52:23 2012 -0400

    Require default and kernel role

 grsecurity/gracl.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

commit a7c5c4f55bdd61cfcd0fb1be7a67160429409878
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 20 18:47:28 2012 -0400

    Allow policies without special roles
    don't call free_variables in error path of copy_user_acl, we'll call it later (triggered by a policy without special roles)

 grsecurity/gracl.c |  113 +++++++++++++++++++---------------------------------
 1 files changed, 41 insertions(+), 72 deletions(-)

commit 402ec3d24d66d38403dc543c84851f5e72d39e22
Merge: 8e012dc f14661a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 19 18:06:59 2012 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	fs/namei.c

commit f14661aaf202155c97f66626cea0269017bb7775
Merge: eae671f 058b017
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 19 18:05:44 2012 -0400

    Merge branch 'linux-3.2.y' into pax-test

commit 8e012dcf7a50b7cde34c2cec93ecedd049123b75
Author: Ryusuke Konishi <konishi.ryusuke@lab.ntt.co.jp>
Date:   Fri Mar 16 17:08:39 2012 -0700

    nilfs2: fix NULL pointer dereference in nilfs_load_super_block()
    
    According to the report from Slicky Devil, nilfs caused kernel oops at
    nilfs_load_super_block function during mount after he shrank the
    partition without resizing the filesystem:
    
     BUG: unable to handle kernel NULL pointer dereference at 00000048
     IP: [<d0d7a08e>] nilfs_load_super_block+0x17e/0x280 [nilfs2]
     *pde = 00000000
     Oops: 0000 [#1] PREEMPT SMP
     ...
     Call Trace:
      [<d0d7a87b>] init_nilfs+0x4b/0x2e0 [nilfs2]
      [<d0d6f707>] nilfs_mount+0x447/0x5b0 [nilfs2]
      [<c0226636>] mount_fs+0x36/0x180
      [<c023d961>] vfs_kern_mount+0x51/0xa0
      [<c023ddae>] do_kern_mount+0x3e/0xe0
      [<c023f189>] do_mount+0x169/0x700
      [<c023fa9b>] sys_mount+0x6b/0xa0
      [<c04abd1f>] sysenter_do_call+0x12/0x28
     Code: 53 18 8b 43 20 89 4b 18 8b 4b 24 89 53 1c 89 43 24 89 4b 20 8b 43
     20 c7 43 2c 00 00 00 00 23 75 e8 8b 50 68 89 53 28 8b 54 b3 20 <8b> 72
     48 8b 7a 4c 8b 55 08 89 b3 84 00 00 00 89 bb 88 00 00 00
     EIP: [<d0d7a08e>] nilfs_load_super_block+0x17e/0x280 [nilfs2] SS:ESP 0068:ca9bbdcc
     CR2: 0000000000000048
    
    This turned out due to a defect in an error path which runs if the
    calculated location of the secondary super block was invalid.
    
    This patch fixes it and eliminates the reported oops.
    
    Reported-by: Slicky Devil <slicky.dvl@gmail.com>
    Signed-off-by: Ryusuke Konishi <konishi.ryusuke@lab.ntt.co.jp>
    Tested-by: Slicky Devil <slicky.dvl@gmail.com>
    Cc: <stable@vger.kernel.org>	[2.6.30+]
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/nilfs2/the_nilfs.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 8067d7f69bf27dc08057a771cf125e71e4575bf2
Author: Haogang Chen <haogangchen@gmail.com>
Date:   Fri Mar 16 17:08:38 2012 -0700

    nilfs2: clamp ns_r_segments_percentage to [1, 99]
    
    ns_r_segments_percentage is read from the disk.  Bogus or malicious
    value could cause integer overflow and malfunction due to meaningless
    disk usage calculation.  This patch reports error when mounting such
    bogus volumes.
    
    Signed-off-by: Haogang Chen <haogangchen@gmail.com>
    Signed-off-by: Ryusuke Konishi <konishi.ryusuke@lab.ntt.co.jp>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/nilfs2/the_nilfs.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

commit e1a90645643f9b0194a5984ec8febd06360d5c8b
Author: Eric Dumazet <eric.dumazet@gmail.com>
Date:   Sat Mar 10 09:20:21 2012 +0000

    tcp: fix syncookie regression
    
    commit ea4fc0d619 (ipv4: Don't use rt->rt_{src,dst} in ip_queue_xmit())
    added a serious regression on synflood handling.
    
    Simon Kirby discovered a successful connection was delayed by 20 seconds
    before being responsive.
    
    In my tests, I discovered that xmit frames were lost, and needed ~4
    retransmits and a socket dst rebuild before being really sent.
    
    In case of syncookie initiated connection, we use a different path to
    initialize the socket dst, and inet->cork.fl.u.ip4 is left cleared.
    
    As ip_queue_xmit() now depends on inet flow being setup, fix this by
    copying the temp flowi4 we use in cookie_v4_check().
    
    Reported-by: Simon Kirby <sim@netnation.com>
    Bisected-by: Simon Kirby <sim@netnation.com>
    Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
    Tested-by: Eric Dumazet <eric.dumazet@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 net/ipv4/syncookies.c |   30 ++++++++++++++++--------------
 net/ipv4/tcp_ipv4.c   |   10 +++++++---
 2 files changed, 23 insertions(+), 17 deletions(-)

commit 06c6c8628bf38b08b4d97f4c55cde9fdecfb5d65
Author: Stanislav Kinsbursky <skinsbursky@parallels.com>
Date:   Mon Mar 12 02:59:41 2012 +0000

    tun: don't hold network namespace by tun sockets
    
    v3: added previously removed sock_put() to the tun_release() callback, because
    sk_release_kernel() doesn't drop the socket reference.
    
    v2: sk_release_kernel() used for socket release. Dummy tun_release() is
    required for sk_release_kernel() ---> sock_release() ---> sock->ops->release()
    call.
    
    TUN was designed to destroy it's socket on network namesapce shutdown. But this
    will never happen for persistent device, because it's socket holds network
    namespace.
    This patch removes of holding network namespace by TUN socket and replaces it
    by creating socket in init_net and then changing it's net it to desired one. On
    shutdown socket is moved back to init_net prior to final put.
    
    Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/tun.c |   15 ++++++++++++---
 1 files changed, 12 insertions(+), 3 deletions(-)

commit 46ae7374bd387c58d673a9e58852a9fd31042c5c
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Mon Dec 12 10:02:30 2011 -0600

    vfs: Correctly set the dir i_mutex lockdep class
    
    9a7aa12f3911853a introduced additional logic around setting the i_mutex
    lockdep class for directory inodes. The idea was that some filesystems
    may want their own special lockdep class for different directory
    inodes and calling unlock_new_inode() should not clobber one of
    those special classes.
    
    I believe that the added conditional, around the *negated* return value
    of lockdep_match_class(), caused directory inodes to be placed in the
    wrong lockdep class.
    
    inode_init_always() sets the i_mutex lockdep class with i_mutex_key for
    all inodes. If the filesystem did not change the class during inode
    initialization, then the conditional mentioned above was false and the
    directory inode was incorrectly left in the non-directory lockdep class.
    If the filesystem did set a special lockdep class, then the conditional
    mentioned above was true and that class was clobbered with
    i_mutex_dir_key.
    
    This patch removes the negation from the conditional so that the i_mutex
    lockdep class is properly set for directory inodes. Special classes are
    preserved and directory inodes with unmodified classes are set with
    i_mutex_dir_key.
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reviewed-by: Jan Kara <jack@suse.cz>
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

 fs/inode.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

commit 603590b0d2eca61ce26499eac9c563bc567a18c9
Author: Jan Kara <jack@suse.cz>
Date:   Mon Feb 20 17:54:00 2012 +0100

    udf: Fix deadlock in udf_release_file()
    
    udf_release_file() can be called from munmap() path with mmap_sem held.  Thus
    we cannot take i_mutex there because that ranks above mmap_sem. Luckily,
    i_mutex is not needed in udf_release_file() anymore since protection by
    i_data_sem is enough to protect from races with write and truncate.
    
    Reported-by: Al Viro <viro@ZenIV.linux.org.uk>
    Reviewed-by: Namjae Jeon <linkinjeon@gmail.com>
    Signed-off-by: Jan Kara <jack@suse.cz>
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

 fs/udf/file.c |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

commit ca79ab9034f3c2f7e3f65c35e0d9ed3ecea529bf
Author: Miklos Szeredi <mszeredi@suse.cz>
Date:   Tue Mar 6 13:56:33 2012 +0100

    vfs: fix double put after complete_walk()
    
    complete_walk() already puts nd->path, no need to do it again at cleanup time.
    
    This would result in Oopses if triggered, apparently the codepath is not too
    well exercised.
    
    Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
    CC: stable@vger.kernel.org
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

 fs/namei.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 13885ba2b18400f3ef6540497d30f1af896605e5
Author: Miklos Szeredi <mszeredi@suse.cz>
Date:   Tue Mar 6 13:56:34 2012 +0100

    vfs: fix return value from do_last()
    
    complete_walk() returns either ECHILD or ESTALE.  do_last() turns this into
    ECHILD unconditionally.  If not in RCU mode, this error will reach userspace
    which is complete nonsense.
    
    Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
    CC: stable@vger.kernel.org
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    
    Conflicts:
    
    	fs/namei.c

 fs/namei.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit f5ab7572c99ffb58953eb1070622307e904c3b7f
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Sat Mar 10 17:07:28 2012 -0500

    restore smp_mb() in unlock_new_inode()
    
    wait_on_inode() doesn't have ->i_lock
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

 fs/inode.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit f3e758cd08e3881982d4b78eb72fe8a1ead6b872
Author: David S. Miller <davem@davemloft.net>
Date:   Tue Mar 13 18:19:51 2012 -0700

    sparc32: Add -Av8 to assembler command line.
    
    Newer version of binutils are more strict about specifying the
    correct options to enable certain classes of instructions.
    
    The sparc32 build is done for v7 in order to support sun4c systems
    which lack hardware integer multiply and divide instructions.
    
    So we have to pass -Av8 when building the assembler routines that
    use these instructions and get patched into the kernel when we find
    out that we have a v8 capable cpu.
    
    Reported-by: Paul Gortmaker <paul.gortmaker@windriver.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 arch/sparc/Makefile |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 66276ec78b2a971d2e704e5ef963cdc8b6a049a4
Author: Thomas Gleixner <tglx@linutronix.de>
Date:   Fri Mar 9 20:55:10 2012 +0100

    x86: Derandom delay_tsc for 64 bit
    
    Commit f0fbf0abc093 ("x86: integrate delay functions") converted
    delay_tsc() into a random delay generator for 64 bit.  The reason is
    that it merged the mostly identical versions of delay_32.c and
    delay_64.c.  Though the subtle difference of the result was:
    
     static void delay_tsc(unsigned long loops)
     {
    -	unsigned bclock, now;
    +	unsigned long bclock, now;
    
    Now the function uses rdtscl() which returns the lower 32bit of the
    TSC. On 32bit that's not problematic as unsigned long is 32bit. On 64
    bit this fails when the lower 32bit are close to wrap around when
    bclock is read, because the following check
    
           if ((now - bclock) >= loops)
           	  	break;
    
    evaluated to true on 64bit for e.g. bclock = 0xffffffff and now = 0
    because the unsigned long (now - bclock) of these values results in
    0xffffffff00000001 which is definitely larger than the loops
    value. That explains Tvortkos observation:
    
    "Because I am seeing udelay(500) (_occasionally_) being short, and
     that by delaying for some duration between 0us (yep) and 491us."
    
    Make those variables explicitely u32 again, so this works for both 32
    and 64 bit.
    
    Reported-by: Tvrtko Ursulin <tvrtko.ursulin@onelan.co.uk>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: stable@vger.kernel.org # >= 2.6.27
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 arch/x86/lib/delay.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 2d0ddb60f5031bdf79b4d51225f9f2d5856255bf
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Thu Mar 8 17:51:19 2012 +0000

    aio: fix the "too late munmap()" race
    
    Current code has put_ioctx() called asynchronously from aio_fput_routine();
    that's done *after* we have killed the request that used to pin ioctx,
    so there's nothing to stop io_destroy() waiting in wait_for_all_aios()
    from progressing.  As the result, we can end up with async call of
    put_ioctx() being the last one and possibly happening during exit_mmap()
    or elf_core_dump(), neither of which expects stray munmap() being done
    to them...
    
    We do need to prevent _freeing_ ioctx until aio_fput_routine() is done
    with that, but that's all we care about - neither io_destroy() nor
    exit_aio() will progress past wait_for_all_aios() until aio_fput_routine()
    does really_put_req(), so the ioctx teardown won't be done until then
    and we don't care about the contents of ioctx past that point.
    
    Since actual freeing of these suckers is RCU-delayed, we don't need to
    bump ioctx refcount when request goes into list for async removal.
    All we need is rcu_read_lock held just over the ->ctx_lock-protected
    area in aio_fput_routine().
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Reviewed-by: Jeff Moyer <jmoyer@redhat.com>
    Acked-by: Benjamin LaHaise <bcrl@kvack.org>
    Cc: stable@vger.kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/aio.c |   14 ++++++--------
 1 files changed, 6 insertions(+), 8 deletions(-)

commit 002124c055afbf09b52226af65621999e8316448
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Wed Mar 7 05:16:35 2012 +0000

    aio: fix io_setup/io_destroy race
    
    Have ioctx_alloc() return an extra reference, so that caller would drop it
    on success and not bother with re-grabbing it on failure exit.  The current
    code is obviously broken - io_destroy() from another thread that managed
    to guess the address io_setup() would've returned would free ioctx right
    under us; gets especially interesting if aio_context_t * we pass to
    io_setup() points to PROT_READ mapping, so put_user() fails and we end
    up doing io_destroy() on kioctx another thread has just got freed...
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Acked-by: Benjamin LaHaise <bcrl@kvack.org>
    Reviewed-by: Jeff Moyer <jmoyer@redhat.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/aio.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

commit a1cd2719b8ed8e40dbd98c87713ac23a2169f6d8
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Mar 15 15:17:12 2012 -0700

    drivers/video/backlight/s6e63m0.c: fix corruption storing gamma mode
    
    strict_strtoul() writes a long but ->gamma_mode only has space to store an
    int, so on 64 bit systems we end up scribbling over ->gamma_table_count as
    well.  I've changed it to use kstrtouint() instead.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Inki Dae <inki.dae@samsung.com>
    Signed-off-by: Florian Tobias Schandinat <FlorianSchandinat@gmx.de>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 drivers/video/backlight/s6e63m0.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit cf83f735a5571f4341ee6eab947a1f7d833cea6e
Merge: e4b05b6 eae671f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 16 21:04:27 2012 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	security/Kconfig

commit eae671fafe93f04685c04a089cc13efebc05d600
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 16 20:58:01 2012 -0400

    Update to pax-linux-3.2.11-test31.patch
    Introduction of the size_overflow plugin from Emese Revfy
    Many thanks to Emese for her hard work :)

 Documentation/dontdiff                             |    1 +
 Makefile                                           |    7 +-
 arch/x86/include/asm/floppy.h                      |    1 +
 arch/x86/include/asm/kvm_host.h                    |    8 +-
 arch/x86/include/asm/syscalls.h                    |    2 +-
 arch/x86/include/asm/uaccess_32.h                  |   37 +-
 arch/x86/include/asm/uaccess_64.h                  |   46 +-
 arch/x86/kernel/cpu/mcheck/mce-inject.c            |    2 +
 arch/x86/kernel/cpu/mtrr/if.c                      |    2 +
 arch/x86/kernel/i387.c                             |   20 +
 arch/x86/kernel/ldt.c                              |    1 +
 arch/x86/kernel/microcode_intel.c                  |    1 +
 arch/x86/kernel/ptrace.c                           |    4 +
 arch/x86/kernel/setup_percpu.c                     |    4 +
 arch/x86/kernel/tls.h                              |    2 +-
 arch/x86/kvm/svm.c                                 |    1 +
 arch/x86/kvm/vmx.c                                 |    1 +
 arch/x86/kvm/x86.c                                 |   20 +
 arch/x86/kvm/x86.h                                 |    4 +-
 arch/x86/lib/usercopy_32.c                         |   12 +-
 arch/x86/lib/usercopy_64.c                         |    8 +-
 arch/x86/platform/uv/tlb_uv.c                      |    4 +
 crypto/ablkcipher.c                                |    4 +
 crypto/aead.c                                      |    3 +
 crypto/blkcipher.c                                 |    3 +
 crypto/cipher.c                                    |    3 +
 drivers/acpi/battery.c                             |    3 +
 drivers/acpi/sbs.c                                 |    3 +
 drivers/infiniband/hw/ipath/ipath_fs.c             |    2 +
 drivers/infiniband/hw/qib/qib_fs.c                 |    2 +
 drivers/lguest/lguest_user.c                       |    1 +
 drivers/media/video/omap/omap_vout.c               |   13 +-
 drivers/media/video/saa7164/saa7164-encoder.c      |    2 +
 drivers/media/video/saa7164/saa7164-vbi.c          |    2 +
 drivers/mtd/ubi/build.c                            |    2 +-
 drivers/mtd/ubi/debug.c                            |    2 +
 drivers/net/ethernet/chelsio/cxgb3/sge.c           |    2 +
 drivers/net/ethernet/chelsio/cxgb4/sge.c           |    3 +
 drivers/net/ethernet/chelsio/cxgb4vf/sge.c         |    3 +
 drivers/net/wireless/ath/ath5k/debug.c             |    3 +
 drivers/net/wireless/ath/ath9k/debug.c             |    2 +
 drivers/net/wireless/ath/ath9k/htc_drv_debug.c     |    2 +
 drivers/oprofile/oprofile_files.c                  |    5 +
 drivers/oprofile/oprofilefs.c                      |    1 +
 drivers/platform/x86/asus_acpi.c                   |    2 +
 drivers/platform/x86/toshiba_acpi.c                |    2 +
 drivers/staging/rtl8192e/rtllib_module.c           |    2 +
 .../staging/rtl8192u/ieee80211/ieee80211_module.c  |    2 +
 drivers/usb/core/message.c                         |    4 +-
 fs/cifs/asn1.c                                     |    3 +
 fs/exec.c                                          |   10 +
 fs/ncpfs/ncplib_kernel.h                           |    4 +-
 fs/seq_file.c                                      |   12 +-
 fs/sysfs/bin.c                                     |    2 +
 fs/ubifs/debug.c                                   |    3 +
 include/asm-generic/int-l64.h                      |    2 -
 include/asm-generic/int-ll64.h                     |    2 -
 include/asm-generic/uaccess.h                      |   15 +
 include/linux/compiler-gcc4.h                      |    3 +
 include/linux/compiler.h                           |    3 +
 include/linux/crash_dump.h                         |    2 +-
 include/linux/kvm_host.h                           |   14 +-
 include/linux/moduleloader.h                       |    2 +-
 include/linux/oprofile.h                           |    2 +-
 include/linux/slab.h                               |   63 +-
 include/linux/slab_def.h                           |    6 +-
 include/linux/slob_def.h                           |    5 +-
 include/linux/slub_def.h                           |   10 +-
 include/linux/uaccess.h                            |    2 +-
 include/linux/vmalloc.h                            |  123 +-
 mm/util.c                                          |    2 -
 mm/vmalloc.c                                       |    9 -
 net/ipv4/ah4.c                                     |    2 +
 net/ipv4/netfilter/arp_tables.c                    |    7 +
 net/ipv4/netfilter/ip_tables.c                     |    7 +
 net/ipv4/netfilter/nf_nat_snmp_basic.c             |    6 +-
 net/ipv6/ah6.c                                     |    2 +
 net/ipv6/netfilter/ip6_tables.c                    |    7 +
 security/Kconfig                                   |   14 +-
 tools/gcc/Makefile                                 |    3 +
 tools/gcc/size_overflow_hash1.h                    | 2760 ++++++++++++++++++++
 tools/gcc/size_overflow_hash2.h                    |   44 +
 tools/gcc/size_overflow_plugin.c                   | 1042 ++++++++
 tools/gcc/stackleak_plugin.c                       |    4 +-
 84 files changed, 4199 insertions(+), 264 deletions(-)

commit e4b05b65c645c412eceb9c950ee7b4771627e6b1
Merge: e55aa68 258c015
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 15 20:59:19 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit 258c0159fa6dd5044ca984eeaad57bb6e21bacea
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 15 20:59:05 2012 -0400

    fix ARM compilation

 drivers/media/video/omap/omap_vout.c |   13 +++++++------
 1 files changed, 7 insertions(+), 6 deletions(-)

commit e55aa68f4bb20e75cd7423123aa612c2a69590c0
Merge: 8f95ea9 55b7573
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 14 19:33:41 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit 55b7573f6c2f3be26fb39c7bd6a9d742d02811ca
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Mar 14 19:33:15 2012 -0400

    Update to pax-linux-3.2.10-test28.patch

 Documentation/dontdiff                         |    1 +
 arch/arm/mach-omap2/board-n8x0.c               |    2 +-
 drivers/media/video/omap/omap_vout.c           |   11 +++---
 drivers/net/ethernet/faraday/ftgmac100.c       |    2 +
 drivers/net/ethernet/faraday/ftmac100.c        |    2 +
 drivers/net/ethernet/stmicro/stmmac/mmc_core.c |    4 +-
 include/asm-generic/local.h                    |    1 +
 include/linux/mtd/map.h                        |    1 +
 kernel/rcutiny.c                               |    4 +-
 tools/gcc/stackleak_plugin.c                   |   41 +++++++----------------
 10 files changed, 31 insertions(+), 38 deletions(-)

commit 8f95ea9f718c293794a1f6bdd2a5f5f336f7bd64
Merge: c8786a2 886ac5e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:38:13 2012 -0400

    Merge branch 'pax-test' into grsec-test
    
    Greets and thanks to snq for his assistance in testing/debugging REFCOUNT on ARM :)

commit 886ac5eeb1835e87cf7398b8aae9e9ba6b36bf77
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:37:44 2012 -0400

    Update to pax-linux-3.2.10-test26.patch

 arch/arm/include/asm/atomic.h |   79 ++++++++++++++++++++++++----------------
 1 files changed, 47 insertions(+), 32 deletions(-)

commit c8786a2abed5e5327f68efa520c04db99bb6a63a
Merge: 219c982 c061fcf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:25:06 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit c061fcfa6b78f3774800821144d8ac2d94d7da3e
Merge: 89373d2 3f4b3b2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Mar 13 17:25:02 2012 -0400

    Merge branch 'linux-3.2.y' into pax-test

commit 219c982a05abe47be4ea7d749e1b408e0cb86f1f
Merge: 54e19a3 89373d2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 12 17:23:57 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit 89373d2abafb9bda97f78bdb157d1d05cf21e008
Merge: a778588 7459f11
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 12 17:23:49 2012 -0400

    Merge branch 'linux-3.2.y' into pax-test

commit 54e19a3979978fca902b14ae25125f26fbbbc7a7
Merge: c4650f1 a778588
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 12 16:51:25 2012 -0400

    Merge branch 'pax-test' into grsec-test

commit a778588c9d1b75c48c1f09aac98c1b28bd87a749
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 12 16:51:12 2012 -0400

    Update to pax-linux-3.2.9-test24.patch

 arch/arm/include/asm/atomic.h |  150 ++++++++++++++++++++++++++++++++++-------
 arch/arm/include/asm/system.h |    7 ++
 arch/arm/mm/fault.c           |   14 ++++
 3 files changed, 147 insertions(+), 24 deletions(-)

commit c4650f14b13f84735fe3de06a1f3ff5776473eff
Merge: fb2abee 1015790
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 21:08:28 2012 -0400

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	security/Kconfig

commit 101579028a736c224e590c7e12a7357018c424e1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 21:07:27 2012 -0400

    Update to pax-linux-3.2.9-test22.patch

 Documentation/dontdiff                       |    1 +
 arch/arm/include/asm/atomic.h                |  241 ++++++++++++++++++++++++-
 arch/arm/include/asm/cache.h                 |    2 +-
 arch/arm/include/asm/cacheflush.h            |    2 +-
 arch/arm/include/asm/outercache.h            |    2 +-
 arch/arm/include/asm/page.h                  |    2 +-
 arch/arm/include/asm/system.h                |    4 +-
 arch/arm/kernel/process.c                    |    5 +-
 arch/arm/kernel/setup.c                      |    6 +-
 arch/arm/lib/copy_page.S                     |    1 +
 arch/arm/plat-samsung/include/plat/dma-ops.h |    2 +-
 arch/arm/plat-samsung/include/plat/ehci.h    |    2 +-
 arch/powerpc/kernel/irq.c                    |   10 +-
 include/asm-generic/emergency-restart.h      |    2 +-
 security/Kconfig                             |    2 +-
 15 files changed, 256 insertions(+), 28 deletions(-)

commit fb2abee4b9b49f5f18342a8cdf7aa3ba2b7c9100
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 11:02:17 2012 -0400

    Allow 4096 CPUs

 fs/exec.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 96bae28cbe6a41d48e3b56e5904814096e956000
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Mar 11 10:25:58 2012 -0400

    Use a per-cpu 48-bit counter instead of a global atomic64
    Initialize each counter to have the cpu number in the lower 16 bits
    instead of incrementing the counter each time by 1, perform the increments
    above the cpu number so that wrapping/exhausting the counter doesn't corrupt
    any state
    idea from PaX Team

 fs/exec.c |   24 ++++++++++++++++++++----
 1 files changed, 20 insertions(+), 4 deletions(-)

commit b975688101da6e966aebb1bc6b8c5c5983974f9c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 10 20:33:12 2012 -0500

    Special vnsec edition! :)
    Further reduce argv/env allowance for suid/sgid apps to 512KB
    Clamp suid/sgid stack resource limit to 8MB (preventing compat mmap layout fallback/too large stack gap)
    Clear 3GB personality on suid/sgid binaries
    Restore 4 bits entropy in the lowest bits of arg/env strings (now 28 bits on x86, 39 bits on x64)
      with the main purpose of throwing off program stack -> arg/env alignment
    Update documentation

 fs/exec.c                   |   64 ++++++++++++++++++++++++-------------------
 grsecurity/Kconfig          |   15 ++++++----
 include/linux/personality.h |    1 +
 3 files changed, 46 insertions(+), 34 deletions(-)

commit e5cfa902c4e891d11dd2086543d2555aa0c27d33
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Mar 10 19:54:47 2012 -0500

    Resolve skbuff.h warnings that turn into errors during compilation in
    the grsecurity directory with -Werror

 arch/alpha/include/asm/cache.h                     |    4 ++--
 arch/arm/include/asm/cache.h                       |    4 +++-
 arch/avr32/include/asm/cache.h                     |    4 +++-
 arch/blackfin/include/asm/cache.h                  |    3 ++-
 arch/cris/include/arch-v10/arch/cache.h            |    3 ++-
 arch/cris/include/arch-v32/arch/cache.h            |    3 ++-
 arch/frv/include/asm/cache.h                       |    3 ++-
 arch/h8300/include/asm/cache.h                     |    4 +++-
 arch/hexagon/include/asm/cache.h                   |    6 ++++--
 arch/ia64/include/asm/cache.h                      |    3 ++-
 arch/m32r/include/asm/cache.h                      |    4 +++-
 arch/m68k/include/asm/cache.h                      |    4 +++-
 arch/microblaze/include/asm/cache.h                |    3 ++-
 arch/mips/include/asm/cache.h                      |    3 ++-
 arch/mn10300/proc-mn103e010/include/proc/cache.h   |    4 +++-
 arch/mn10300/proc-mn2ws0050/include/proc/cache.h   |    4 +++-
 arch/openrisc/include/asm/cache.h                  |    4 +++-
 arch/parisc/include/asm/cache.h                    |    5 +++--
 arch/powerpc/include/asm/cache.h                   |    3 ++-
 arch/s390/include/asm/cache.h                      |    4 +++-
 arch/score/include/asm/cache.h                     |    4 +++-
 arch/sh/include/asm/cache.h                        |    3 ++-
 arch/sparc/include/asm/cache.h                     |    4 +++-
 arch/tile/include/asm/cache.h                      |    3 ++-
 arch/um/include/asm/cache.h                        |    3 ++-
 arch/unicore32/include/asm/cache.h                 |    6 ++++--
 arch/xtensa/variants/dc232b/include/variant/core.h |    2 +-
 arch/xtensa/variants/fsf/include/variant/core.h    |    3 ++-
 arch/xtensa/variants/s6000/include/variant/core.h  |    3 ++-
 grsecurity/Makefile                                |    2 --
 30 files changed, 73 insertions(+), 35 deletions(-)

commit 2023210ad43a944033fcacc660ce410888f562ee
Merge: ece4383 5f66adf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 9 19:48:01 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 5f66adf72f83730a07bc79a2fab56afed6dbbd0e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 9 19:47:06 2012 -0500

    Add colorize plugin

 tools/gcc/colorize_plugin.c |  147 +++++++++++++++++++++++++++++++++++++++++++
 1 files changed, 147 insertions(+), 0 deletions(-)

commit ece4383e5e91c92d138c4df84225a70b552f4d69
Merge: a366d0e ab4a5a1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 9 17:56:46 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit ab4a5a1a67289c3585e2ff8aa64ecece7bd17eea
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 9 17:56:26 2012 -0500

    Update to pax-linux-3.2.9-test21.patch

 Makefile                           |    4 +++-
 arch/sparc/include/asm/atomic.h    |    1 -
 arch/sparc/include/asm/atomic_32.h |    2 ++
 fs/exec.c                          |    2 +-
 include/linux/sched.h              |    4 ++--
 kernel/exit.c                      |    2 +-
 mm/mmap.c                          |   11 ++++++++++-
 tools/gcc/Makefile                 |    2 ++
 tools/gcc/stackleak_plugin.c       |    4 ++--
 9 files changed, 23 insertions(+), 9 deletions(-)

commit a366d0ed963ce93fce10121c1100989d5f064e75
Author: Mikulas Patocka <mpatocka@redhat.com>
Date:   Sun Mar 4 19:52:03 2012 -0500

    mm: fix find_vma_prev
    
    Commit 6bd4837de96e ("mm: simplify find_vma_prev()") broke memory
    management on PA-RISC.
    
    After application of the patch, programs that allocate big arrays on the
    stack crash with segfault, for example, this will crash if compiled
    without optimization:
    
      int main()
      {
    	char array[200000];
    	array[199999] = 0;
    	return 0;
      }
    
    The reason is that PA-RISC has up-growing stack and the stack is usually
    the last memory area.  In the above example, a page fault happens above
    the stack.
    
    Previously, if we passed too high address to find_vma_prev, it returned
    NULL and stored the last VMA in *pprev.  After "simplify find_vma_prev"
    change, it stores NULL in *pprev.  Consequently, the stack area is not
    found and it is not expanded, as it used to be before the change.
    
    This patch restores the old behavior and makes it return the last VMA in
    *pprev if the requested address is higher than address of any other VMA.
    
    Signed-off-by: Mikulas Patocka <mpatocka@redhat.com>
    Acked-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/mmap.c |   12 ++++++++++--
 1 files changed, 10 insertions(+), 2 deletions(-)

commit 9cd8dd4d56051099f11563f72fcd91cd0ce19604
Author: Hugh Dickins <hughd@google.com>
Date:   Tue Mar 6 12:28:52 2012 -0800

    mmap: EINVAL not ENOMEM when rejecting VM_GROWS
    
    Currently error is -ENOMEM when rejecting VM_GROWSDOWN|VM_GROWSUP
    from shared anonymous: hoist the file case's -EINVAL up for both.
    
    Signed-off-by: Hugh Dickins <hughd@google.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/mmap.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 97745dce6c87f9d9ca5b4be9bd4c2fc1684ca04c
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Mon Mar 5 06:38:42 2012 +0000

    aout: move setup_arg_pages() prior to reading/mapping the binary
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 arch/x86/ia32/ia32_aout.c |   14 +++++++-------
 fs/binfmt_aout.c          |   14 +++++++-------
 2 files changed, 14 insertions(+), 14 deletions(-)

commit 3b20ce55ae8cffee43cb4afdf5be438b5ac4fef0
Author: Jan Beulich <JBeulich@suse.com>
Date:   Mon Mar 5 16:49:24 2012 +0000

    vsprintf: make %pV handling compatible with kasprintf()
    
    kasprintf() (and potentially other functions that I didn't run across so
    far) want to evaluate argument lists twice.  Caring to do so for the
    primary list is obviously their job, but they can't reasonably be
    expected to check the format string for instances of %pV, which however
    need special handling too: On architectures like x86-64 (as opposed to
    e.g.  ix86), using the same argument list twice doesn't produce the
    expected results, as an internally managed cursor gets updated during
    the first run.
    
    Fix the problem by always acting on a copy of the original list when
    handling %pV.
    
    Signed-off-by: Jan Beulich <jbeulich@suse.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 lib/vsprintf.c |   12 +++++++++---
 1 files changed, 9 insertions(+), 3 deletions(-)

commit 4146896ab9674f51d4909f3a52bc7fe80f04e4cb
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Mon Mar 5 06:39:47 2012 +0000

    VM_GROWS{UP,DOWN} shouldn't be set on shmem VMAs
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 mm/mmap.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit a831bd53764695ea680cc1fa3c98759a610ed2ac
Author: Christian König <deathsimple@vodafone.de>
Date:   Tue Feb 28 23:19:20 2012 +0100

    drm/radeon: fix uninitialized variable
    
    Without this fix the driver randomly treats
    textures as arrays and I'm really wondering
    why gcc isn't complaining about it.
    
    Signed-off-by: Christian König <deathsimple@vodafone.de>
    Reviewed-by: Jerome Glisse <jglisse@redhat.com>
    Signed-off-by: Dave Airlie <airlied@redhat.com>

 drivers/gpu/drm/radeon/r600_cs.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit aa2cd55f97f3cc03bdd895b6e8ba99619ee69dfc
Author: H. Peter Anvin <hpa@zytor.com>
Date:   Fri Mar 2 10:43:48 2012 -0800

    regset: Prevent null pointer reference on readonly regsets
    
    The regset common infrastructure assumed that regsets would always
    have .get and .set methods, but not necessarily .active methods.
    Unfortunately people have since written regsets without .set methods.
    
    Rather than putting in stub functions everywhere, handle regsets with
    null .get or .set methods explicitly.
    
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>
    Reviewed-by: Oleg Nesterov <oleg@redhat.com>
    Acked-by: Roland McGrath <roland@hack.frob.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/binfmt_elf.c        |    2 +-
 include/linux/regset.h |    6 ++++++
 2 files changed, 7 insertions(+), 1 deletions(-)

commit 072ddd99401c79b53c6bf6bff9deb93022124c79
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 18:12:57 2012 -0500

    Fix compiler errors reported on forums

 grsecurity/gracl.c |    5 ++---
 1 files changed, 2 insertions(+), 3 deletions(-)

commit 1606774b48af24e6f99d99c624c0e447d4b66474
Merge: 3127bd5 4ca2ffd
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 17:31:35 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 4ca2ffd9da024f4ba2d0cb6245ba1b2726169452
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Mar 5 17:31:21 2012 -0500

    Update to pax-linux-3.2.9-test20.patch

 tools/gcc/Makefile |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 3127bd581a292966b1057c7433219dac188c3720
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 2 21:30:37 2012 -0500

    Fix memory leak on logged exec_id check failure in /proc/pid/statm
    Thanks to Djalal Harouni for the report

 fs/proc/array.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit d9f1a3be0e97e0632f97379322712d8deeb3ce23
Merge: 0a56be8 9aa8288
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 2 18:38:22 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 9aa8288a09e6e03ce37c08136b26bff17a093b5c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Mar 2 18:37:43 2012 -0500

    Update to pax-linux-3.2.9-test19.patch

 fs/binfmt_elf.c              |    2 +-
 tools/gcc/stackleak_plugin.c |   59 ++++++++++++++++++++++++++++++++----------
 2 files changed, 46 insertions(+), 15 deletions(-)

commit 0a56be884bbd7ce733cac0b879c45383494d73b0
Merge: 9e66745 3f5c52a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 1 20:18:01 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 3f5c52aba100b3bb252980f9d363aafde52da1a2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 1 20:16:56 2012 -0500

    Update to pax-linux-3.2.9-test18.patch

 tools/gcc/Makefile |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit ae53ec231d12719a36bf871f8c5841020ed692ee
Merge: b255baf 44fb317
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Mar 1 20:15:31 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test

commit 9e667456c03eadea2f305be761abe4de9a5877a3
Merge: 5e4e200 b255baf
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 27 20:53:59 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit b255baf50365d39b406f43aab2c64745607baaa2
Merge: 340ce90 1de504e
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 27 20:53:29 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test
    Update to pax-linux-3.2.8-test17.patch
    
    Conflicts:
    	arch/x86/include/asm/i387.h
    	arch/x86/kernel/process_32.c
    	arch/x86/kernel/traps.c

commit 5e4e200ac530452884b625cb75de240e1e98c731
Merge: 44306d7 340ce90
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 27 18:02:13 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 340ce90d98a043fa8e4ed9ffc229d4c1f86e2fec
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 27 18:01:48 2012 -0500

    Update to pax-linux-3.2.7-test17.patch

 fs/binfmt_elf.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 44306d7b3097f77e73040dd25f4f6750751bae7a
Merge: 29d0b07 521c411
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 26 19:04:15 2012 -0500

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	Makefile

commit 521c411bb4ca66ce01146fde8bac9dd22414076d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 26 19:03:33 2012 -0500

    Update to pax-linux-3.2.7-test16.patch

 Makefile |   41 +++++++++++++++++++++++++----------------
 1 files changed, 25 insertions(+), 16 deletions(-)

commit 29d0b07290bb9a10cdfcc3c30058e16265330dea
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 26 17:12:44 2012 -0500

    fix typo

 include/linux/grmsg.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 344f6d84e5d3fdc6ec40a078fc2f5861d340b2ef
Merge: f45b3be caa8f83
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 20:59:27 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit caa8f83456c4d0b204beefffaa1d1993f2348d08
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 20:59:12 2012 -0500

    Update to pax-linux-3.2.7-test15.patch

 Makefile                               |    2 +-
 arch/x86/include/asm/alternative-asm.h |    2 +-
 arch/x86/kernel/kprobes.c              |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

commit f45b3be34a345502a302e736af9a65742ddef7cb
Merge: 62f35fd 9f1309b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 11:40:15 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 9f1309b0b935e3b30fc87a9e3009b84cf943ef47
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 11:39:57 2012 -0500

    Update to pax-linux-3.2.7-test14.patch

 arch/alpha/include/asm/atomic.h   |   18 +++++++++---------
 arch/arm/include/asm/atomic.h     |   22 +++++++++++++---------
 arch/frv/include/asm/atomic.h     |   18 +++++++++---------
 arch/ia64/include/asm/atomic.h    |   18 +++++++++---------
 arch/mips/include/asm/atomic.h    |   22 +++++++++++++---------
 arch/parisc/include/asm/atomic.h  |   18 +++++++++---------
 arch/powerpc/include/asm/atomic.h |   18 +++++++++---------
 arch/s390/include/asm/atomic.h    |   18 +++++++++---------
 arch/sparc/Kconfig                |    1 +
 arch/sparc/include/asm/atomic.h   |    1 +
 arch/sparc/include/asm/page_32.h  |    2 ++
 arch/tile/include/asm/atomic_64.h |   18 +++++++++---------
 tools/gcc/Makefile                |    4 ++--
 13 files changed, 95 insertions(+), 83 deletions(-)

commit 62f35fdbecc58f2988fe13638d907b87a15776bb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 09:08:55 2012 -0500

    We could log on attempted exploits of writing /proc/self/mem, but the current
    log function declares the access a read, so just swap the ordering for now

 fs/proc/base.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

commit 066ee8f9c26f1549b4ad893508777b549c8d4b79
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 08:46:14 2012 -0500

    Log /proc/pid/mem attempts

 fs/proc/base.c |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

commit 674471e581893a94d475acac3e3c4496209b3ac9
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 25 08:15:00 2012 -0500

    Make use of f_version for protecting /proc file structs (fine since we're not a directory
    or seq_file)

 fs/proc/base.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

commit eab42cfdd237ffcdd8ec24bedecc275a3a9e987f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 20:02:19 2012 -0500

    Fix ia64 compilation

 grsecurity/Makefile |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 50dfea412fd395e0183c2ade368efa525d38b267
Merge: 12db845 4c6f99b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:00:53 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 4c6f99bf338e03966356b147d0360cb3b522a44f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 24 19:00:36 2012 -0500

    (6:57:09 PM) pipacs: but you can be proactive
    (Fix other-arch atomic64/REFCOUNT compilation failures)

 arch/alpha/include/asm/atomic.h   |   10 ++++++++++
 arch/arm/include/asm/atomic.h     |   10 ++++++++++
 arch/frv/include/asm/atomic.h     |   10 ++++++++++
 arch/ia64/include/asm/atomic.h    |   10 ++++++++++
 arch/mips/include/asm/atomic.h    |   10 ++++++++++
 arch/parisc/include/asm/atomic.h  |   10 ++++++++++
 arch/powerpc/include/asm/atomic.h |   10 ++++++++++
 arch/s390/include/asm/atomic.h    |   10 ++++++++++
 arch/tile/include/asm/atomic_64.h |   10 ++++++++++
 9 files changed, 90 insertions(+), 0 deletions(-)

commit 12db8453f6bb0a756f369c9151668ba1249bc478
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 21:10:12 2012 -0500

    Remove unnecessary copies, as suggested by solar

 grsecurity/gracl.c |   11 ++++++-----
 kernel/fork.c      |    4 ----
 2 files changed, 6 insertions(+), 9 deletions(-)

commit cc02cab84368467ea03cb35f861a8a7092d91ab4
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 20:59:35 2012 -0500

    Make global_exec_counter static, as suggested by solar

 fs/exec.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit e642091a475ebb3a30e81f85e7751233d0c2af43
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 19:00:26 2012 -0500

    sync with stable tree

 grsecurity/grsec_disabled.c |    2 +-
 include/linux/grsecurity.h  |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

commit 6df09c3d8e371905b7b8fe90c4188f23614c6be5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 18:48:47 2012 -0500

    Remove unneeded gr_acl_handle_fchmod, as the code is shared now by gr_acl_handle_chmod
    Remove handling of old kludge in chmod/fchmod

 fs/open.c                   |    2 +-
 grsecurity/gracl_fs.c       |   18 +++---------------
 grsecurity/grsec_disabled.c |    9 +--------
 include/linux/grmsg.h       |    1 -
 include/linux/grsecurity.h  |    4 +---
 5 files changed, 6 insertions(+), 28 deletions(-)

commit 815cb62f2ca7b58efc39778b3a855feb675ab56c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 23 18:18:49 2012 -0500

    Apply umask checks to chmod/fchmod as well, as requested by sponsor
    Union the enforced umask with the existing one to produce minimal privilege
    Change umask type to u16

 fs/fs_struct.c              |    2 +-
 fs/open.c                   |    2 +-
 grsecurity/gracl_fs.c       |   11 ++++++++---
 grsecurity/grsec_disabled.c |    4 ++--
 include/linux/gracl.h       |    3 ++-
 include/linux/grsecurity.h  |    2 +-
 6 files changed, 15 insertions(+), 9 deletions(-)

commit 0e7668c6abbdbcd3f7f9759e3994d6f4bc9953f0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Feb 22 18:16:11 2012 -0500

    Add per-role umask enforcement to RBAC, requested by a sponsor

 fs/fs_struct.c              |    2 +-
 grsecurity/gracl_fs.c       |    9 +++++++++
 grsecurity/grsec_disabled.c |    5 +++++
 include/linux/gracl.h       |    5 +++--
 include/linux/grsecurity.h  |    2 ++
 5 files changed, 20 insertions(+), 3 deletions(-)

commit ad5ac943fe58199f1cc475912a39edb157acb77b
Merge: dda0bb5 41722e3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 20:04:42 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 41722e342e116d95f3d3556d66c97c888d752d39
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 20:04:00 2012 -0500

    Merge changes from pax-linux-3.2.7-test12.patch, fixes KVM incompatibility with
    KERNEXEC plugin

 arch/x86/include/asm/uaccess_64.h |    2 +-
 kernel/panic.c                    |    6 ++-
 mm/mmap.c                         |   36 +++----------
 tools/gcc/kernexec_plugin.c       |  101 +++++++++++++++++++++++++++++++++----
 tools/gcc/stackleak_plugin.c      |   20 ++++---
 5 files changed, 116 insertions(+), 49 deletions(-)

commit dda0bb57137846a476a866c60db2681aaf6052c0
Merge: 4fd554e d70927a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 20:01:41 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit d70927afec977d489a54c106a3c3ddc32e953050
Merge: 1daebf1 9d0231c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 20:01:33 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test

commit 4fd554e3a097b22c5049fcdc423897477deff5ef
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 20 09:17:57 2012 -0500

    Fix wrong logic on capability checks for switching roles, broke policies
    Thanks to Richard Kojedzinszky for reporting

 grsecurity/gracl.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 12f97d52ac603f24344f8d71569c412a307e9422
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 21:20:10 2012 -0500

    sparc64 compile fix

 fs/seq_file.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit 07af3d8e76a6a47ce1836e5b20ed8c0f879c8201
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 18:38:32 2012 -0500

    Update configuration help and name for GRKERNSEC_PROC_MEMMAP

 grsecurity/Kconfig |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

commit 5ced6f8def06c2176b40b5fa07345fc723dc4dcb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 18:18:01 2012 -0500

    optimize the check a bit

 fs/exec.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 03159050f64989be44ae03be769cbed62a7cd2e5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 18:00:45 2012 -0500

    smile VUPEN :D
    (limit argv+env to 1MB for suid/sgid binaries)

 fs/exec.c |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)

commit dd759d8800d225a397e4de49fe729c7d601298d2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 17:49:33 2012 -0500

    Address Space Protection -> Memory Protections (suggested on IRC for consistency)

 grsecurity/Kconfig |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 4de635bda8ebfb85312e3bf851bdbff93de400da
Author: Brad Spengler <spender@grsecurity.net>
Date:   Thu Feb 16 17:45:06 2012 -0500

    Change the long long type for exec_id to the proper u64

 include/linux/sched.h    |    2 +-
 include/linux/seq_file.h |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

commit 4feb07e7cb64b3d0f0f8cca1aef70bc725cae6fa
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Feb 9 00:46:47 2012 +0000

    isdn: type bug in isdn_net_header()
    
    We use len to store the return value from eth_header().  eth_header()
    can return -ETH_HLEN (-14).  We want to pass this back instead of
    truncating it to 65522 and returning that.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Neil Horman <nhorman@tuxdriver.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/isdn/i4l/isdn_net.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 134ac8545b47f0f27d550ea6e1edb3a1ed7a9748
Author: Heiko Carstens <heiko.carstens@de.ibm.com>
Date:   Sat Feb 4 10:47:10 2012 +0100

    exec: fix use-after-free bug in setup_new_exec()
    
    Setting the task name is done within setup_new_exec() by accessing
    bprm->filename. However this happens after flush_old_exec().
    This may result in a use after free bug, flush_old_exec() may
    "complete" vfork_done, which will wake up the parent which in turn
    may free the passed in filename.
    To fix this add a new tcomm field in struct linux_binprm which
    contains the now early generated task name until it is used.
    
    Fixes this bug on s390:
    
      Unable to handle kernel pointer dereference at virtual kernel address 0000000039768000
      Process kworker/u:3 (pid: 245, task: 000000003a3dc840, ksp: 0000000039453818)
      Krnl PSW : 0704000180000000 0000000000282e94 (setup_new_exec+0xa0/0x374)
      Call Trace:
      ([<0000000000282e2c>] setup_new_exec+0x38/0x374)
       [<00000000002dd12e>] load_elf_binary+0x402/0x1bf4
       [<0000000000280a42>] search_binary_handler+0x38e/0x5bc
       [<0000000000282b6c>] do_execve_common+0x410/0x514
       [<0000000000282cb6>] do_execve+0x46/0x58
       [<00000000005bce58>] kernel_execve+0x28/0x70
       [<000000000014ba2e>] ____call_usermodehelper+0x102/0x140
       [<00000000005bc8da>] kernel_thread_starter+0x6/0xc
       [<00000000005bc8d4>] kernel_thread_starter+0x0/0xc
      Last Breaking-Event-Address:
       [<00000000002830f0>] setup_new_exec+0x2fc/0x374
    
      Kernel panic - not syncing: Fatal exception: panic_on_oops
    
    Reported-by: Sebastian Ott <sebott@linux.vnet.ibm.com>
    Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/exec.c               |   33 +++++++++++++++++----------------
 include/linux/binfmts.h |    3 ++-
 2 files changed, 19 insertions(+), 17 deletions(-)

commit d758ee9f5230893dabb5aab737b3109684bde196
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Feb 10 09:03:58 2012 +0100

    relay: prevent integer overflow in relay_open()
    
    "subbuf_size" and "n_subbufs" come from the user and they need to be
    capped to prevent an integer overflow.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable@kernel.org
    Signed-off-by: Jens Axboe <axboe@kernel.dk>

 kernel/relay.c |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

commit 40ed7b34848b8e0d7bf9a3fc21a7c75ce1ae507c
Merge: b1baadf 1daebf1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 13 17:47:04 2012 -0500

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	fs/proc/base.c

commit 1daebf1d623fe5b0efdd329f78562eb7078bc772
Merge: 1413df2 c2db2e2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 13 17:45:54 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test

commit b1baadf5047ab67cf61cd20bf58c6afb09c37c7d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 12 16:44:05 2012 -0500

    add missing declaration

 grsecurity/gracl.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

commit 3981059c35e8463002517935c28f3d74b8e3703c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 12 16:36:04 2012 -0500

    Require CAP_SETUID/CAP_SETGID in a subject in order to change roles
    in addition to existing checks (this handles the setresuid ruid = euid case)

 grsecurity/gracl.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

commit 0beab03263c773f463412c350ad9064b44b6ede0
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 12 16:13:40 2012 -0500

    Revert setreuid changes when RBAC is enabled, breaks freeradius
    I'll fix the learning issue Lavish reported a different way through
    gradm modifications
    
    This reverts commit d54ec64b7078f1dcb71b5d8a29e47d4a0f46c111.

 kernel/sys.c |   30 ++++++------------------------
 1 files changed, 6 insertions(+), 24 deletions(-)

commit 0c61cb1cfbbfec7d07647268c922d51434d22621
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 11 14:22:46 2012 -0500

    copy exec_id on fork

 kernel/fork.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

commit 000c08e0890630086b2ed04084050ed856a7ec31
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 10 20:00:36 2012 -0500

    compile fix

 fs/proc/task_mmu.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

commit 54b8c8f54484e5ee18040657827158bc4b63bccc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 10 19:19:52 2012 -0500

    Introduce enhancement to CONFIG_GRKERNSEC_PROC_MEMMAP
    denies reading of sensitive /proc/pid entries where the file descriptor
    was opened in a different task than the one performing the read

 fs/exec.c                  |    8 ++++++++
 fs/proc/array.c            |   14 ++++++++++++++
 fs/proc/task_mmu.c         |   21 +++++++++++++++++++++
 fs/seq_file.c              |    3 +++
 grsecurity/Kconfig         |    4 ++++
 grsecurity/Makefile        |    2 ++
 grsecurity/grsec_mem.c     |    7 +++++++
 include/linux/grmsg.h      |    1 +
 include/linux/grsecurity.h |    2 ++
 include/linux/sched.h      |    3 +++
 include/linux/seq_file.h   |    3 +++
 11 files changed, 68 insertions(+), 0 deletions(-)

commit dd19579049186e2648b9ae5e42af04cfda7ab2dc
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 10 17:43:24 2012 -0500

    Remove duplicate signal check

 fs/ecryptfs/read_write.c |    5 -----
 1 files changed, 0 insertions(+), 5 deletions(-)

commit 6ff60c34155bb73a4eec7bbfe6f59e9d35e1c0c6
Merge: 4eba97e 1413df2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Feb 8 19:24:34 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 1413df258d4664d928b876ffb57e1bdc1ccd06f6
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Feb 8 19:24:08 2012 -0500

    Merge changes from pax-linux-3.2.4-test11.patch

 arch/s390/include/asm/elf.h |    4 ++--
 arch/x86/kernel/entry_64.S  |    2 +-
 arch/x86/mm/fault.c         |    2 +-
 arch/x86/mm/init.c          |    2 +-
 arch/x86/mm/init_64.c       |    2 +-
 arch/x86/mm/pageattr.c      |    2 +-
 arch/x86/mm/pgtable.c       |    4 ++--
 arch/x86/net/bpf_jit_comp.c |    2 +-
 arch/x86/pci/pcbios.c       |    2 +-
 drivers/acpi/ec_sys.c       |    2 +-
 fs/binfmt_elf.c             |    5 ++++-
 init/main.c                 |    2 +-
 mm/slob.c                   |    2 +-
 13 files changed, 18 insertions(+), 15 deletions(-)

commit 4eba97eda7f7d25b7ab6ad5c9de094545e749044
Merge: 0e058dd 8dd90a2
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 6 17:50:12 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 8dd90a21adfeefd86134d1fedf77b958bc59eaa3
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 6 17:49:07 2012 -0500

    Merge changes from pax-linux-3.2.4-test10.patch, fixes BPF JIT double-free

 arch/x86/net/bpf_jit_comp.c |   18 +++++++++---------
 1 files changed, 9 insertions(+), 9 deletions(-)

commit a6b5dfed0937a0eb386b4b519a387f8e8177ffdc
Merge: 7e4169c 6133971
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Feb 6 17:48:57 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test

commit 0e058dd6d14e0c67c44dd332a871f1fe1bb06095
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 5 19:24:45 2012 -0500

    We now allow configurations with no PaX markings, giving the system no way to override the defaults

 include/linux/grsecurity.h |    6 ------
 1 files changed, 0 insertions(+), 6 deletions(-)

commit 9afb0110287e31c3c56d861b4927f64f8dbd7857
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Feb 5 10:01:23 2012 -0500

    Increase the buffer size of logged TPE reason, otherwise we could truncate the "y" in directory

 grsecurity/grsec_tpe.c |    2 +-
 include/linux/grmsg.h  |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

commit a6a0ad24a5f7bef90236d94c1bdfe21d291fc834
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Feb 4 21:01:16 2012 -0500

    Improve security of ptrace-based monitoring/sandboxing
    See:
    http://article.gmane.org/gmane.linux.kernel.lsm/15156

 include/linux/tracehook.h |    9 +++++----
 1 files changed, 5 insertions(+), 4 deletions(-)

commit ca4ca5a1027b41f9528794e52a53ce9c47926101
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:42:55 2012 -0500

    fix typo

 fs/proc/base.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

commit d54ec64b7078f1dcb71b5d8a29e47d4a0f46c111
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:25:38 2012 -0500

    Reported by lavish on IRC:
    If a suid/sgid binary did not learn any setuid/setgid call during learning,
    we would not any CAP_SETUID/CAP_SETGID capability to the task, nor
    any restrictions on uid/gid changes.  uid and gid can however be changed
    within a suid/sgid binary via setresuid/setresgid with ruid/rgid set to
    euid/egid.
    
    My fix:
    POSIX doesn't specify whether unprivileged users can perform the above
    setresuid/setresgid as an unprivileged user, though Linux has historically
    permitted them.  Modify this behavior when RBAC is enabled to require
    CAP_SETUID/CAP_SETGID for these operations.
    
    Thanks to Lavish for the report!
    
    Conflicts:
    
    	kernel/sys.c

 kernel/sys.c |   30 ++++++++++++++++++++++++------
 1 files changed, 24 insertions(+), 6 deletions(-)

commit e55be1f30908f1ad4450cb0558cde71ff5c7247f
Merge: ba586eb 7e4169c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:10:21 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 7e4169c6c880ec9641f1178c88545913c8a21e1f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 20:10:05 2012 -0500

    Merge changes from pax-linux-3.2.4-test9.patch

 arch/x86/kernel/cpu/mcheck/p5.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

commit ba586ebbcd0ed781e38a99c580a757a00347c6eb
Author: Christopher Yeoh <cyeoh@au1.ibm.com>
Date:   Thu Feb 2 11:34:09 2012 +1030

    Fix race in process_vm_rw_core
    
    This fixes the race in process_vm_core found by Oleg (see
    
      http://article.gmane.org/gmane.linux.kernel/1235667/
    
    for details).
    
    This has been updated since I last sent it as the creation of the new
    mm_access() function did almost exactly the same thing as parts of the
    previous version of this patch did.
    
    In order to use mm_access() even when /proc isn't enabled, we move it to
    kernel/fork.c where other related process mm access functions already
    are.
    
    Signed-off-by: Chris Yeoh <yeohc@au1.ibm.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/proc/base.c
    	mm/process_vm_access.c

 fs/proc/base.c         |   22 ----------------------
 include/linux/sched.h  |    6 ++++++
 kernel/fork.c          |   20 ++++++++++++++++++++
 mm/process_vm_access.c |   23 +++++++++--------------
 4 files changed, 35 insertions(+), 36 deletions(-)

commit b9194d60fb9fe579f5c34817ed822abde18939a0
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Tue Jan 31 17:15:11 2012 +0100

    proc: make sure mem_open() doesn't pin the target's memory
    
    Once /proc/pid/mem is opened, the memory can't be released until
    mem_release() even if its owner exits.
    
    Change mem_open() to do atomic_inc(mm_count) + mmput(), this only
    pins mm_struct. Change mem_rw() to do atomic_inc_not_zero(mm_count)
    before access_remote_vm(), this verifies that this mm is still alive.
    
    I am not sure what should mem_rw() return if atomic_inc_not_zero()
    fails. With this patch it returns zero to match the "mm == NULL" case,
    may be it should return -EINVAL like it did before e268337d.
    
    Perhaps it makes sense to add the additional fatal_signal_pending()
    check into the main loop, to ensure we do not hold this memory if
    the target task was oom-killed.
    
    Cc: stable@kernel.org
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/proc/base.c |   14 +++++++++++++-
 1 files changed, 13 insertions(+), 1 deletions(-)

commit d4500134f9363bc79556e0e7a1fd811cd8552cc4
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Tue Jan 31 17:14:38 2012 +0100

    proc: mem_release() should check mm != NULL
    
    mem_release() can hit mm == NULL, add the necessary check.
    
    Cc: stable@kernel.org
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/proc/base.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 5d1c11221a86f233fdbb232312a561f85d0a3a05
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Tue Jan 31 17:14:54 2012 +0100

    note: redisabled mem_write
    
    proc: unify mem_read() and mem_write()
    
    No functional changes, cleanup and preparation.
    
    mem_read() and mem_write() are very similar. Move this code into the
    new common helper, mem_rw(), which takes the additional "int write"
    argument.
    
    Cc: stable@kernel.org
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    
    Conflicts:
    
    	fs/proc/base.c

 fs/proc/base.c |   99 +++++++++++++++++++++-----------------------------------
 1 files changed, 37 insertions(+), 62 deletions(-)

commit af966b421d9f55ab7e1a8b2741beba44b22bc2e0
Merge: 3903f01 01fee18
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 19:50:40 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 01fee1851aef26b898ccba5312cabf1f919b74cb
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 19:49:46 2012 -0500

    Merge changes from pax-linux-3.2.4-test8.patch

 arch/x86/mm/ioremap.c |    3 +++
 security/Kconfig      |    1 +
 2 files changed, 4 insertions(+), 0 deletions(-)

commit c2490ddbfc3f5dd664dd0e1b8575856c3be01879
Merge: 201c0db 141936c
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Feb 3 19:49:01 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test

commit 3903f0172ecadf7a575ba3535402a1506133640a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Mon Jan 30 23:26:44 2012 -0500

    Implement new version of CONFIG_GRKERNSEC_SYSFS_RESTRICT
    
    We'll whitelist required directories for compatibility instead of requiring
    that people disable the feature entirely if they use SELinux, fuse, etc
    
    Conflicts:
    
    	fs/sysfs/mount.c

 fs/debugfs/inode.c |    4 ++++
 fs/sysfs/dir.c     |   12 ++++++++++++
 fs/sysfs/mount.c   |    4 ----
 grsecurity/Kconfig |   10 +++++++---
 4 files changed, 23 insertions(+), 7 deletions(-)

commit e3618feaa7e63807f1b88c199882075b3ec9bd05
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 29 01:12:19 2012 -0500

    perform RBAC check if TPE is on but match fails, matches previous behavior

 grsecurity/grsec_tpe.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit 627b7fe22799a86e2f81a74f0e0c53474bec3100
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sat Jan 28 13:17:06 2012 -0500

    log more information about the reason for a TPE denial for novice users, requested by a sponsor

 grsecurity/grsec_tpe.c |   57 +++++++++++++++++++++++++++++++++++++----------
 include/linux/grmsg.h  |    2 +-
 2 files changed, 46 insertions(+), 13 deletions(-)

commit efefd67008cbad8a8591e2484410966a300a39a5
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:58:53 2012 -0500

    merge upstream sha512 changes

 crypto/sha512_generic.c |   62 +++++++++++++++++++++++++---------------------
 1 files changed, 34 insertions(+), 28 deletions(-)

commit 8a79280377db78fb2091fe01eddb9e24f75d9fe1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:49:07 2012 -0500

    drop lock on error in xfs_readlink
    
    http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=aaad641eadfd3e74b0fbb68fcf539b9cef0415d0

 fs/xfs/xfs_vnodeops.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

commit aa5f2f63e37f426bf2211c5fb8f7bc70de14f08a
Author: Li Wang <liwang@nudt.edu.cn>
Date:   Thu Jan 19 09:44:36 2012 +0800

    eCryptfs: Infinite loop due to overflow in ecryptfs_write()
    
    ecryptfs_write() can enter an infinite loop when truncating a file to a
    size larger than 4G. This only happens on architectures where size_t is
    represented by 32 bits.
    
    This was caused by a size_t overflow due to it incorrectly being used to
    store the result of a calculation which uses potentially large values of
    type loff_t.
    
    [tyhicks@canonical.com: rewrite subject and commit message]
    Signed-off-by: Li Wang <liwang@nudt.edu.cn>
    Signed-off-by: Yunchuan Wen <wenyunchuan@kylinos.com.cn>
    Reviewed-by: Cong Wang <xiyou.wangcong@gmail.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>

 fs/ecryptfs/read_write.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit a7607747d0f74f357d78bb796d70635dd05f46e8
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Thu Jan 19 20:33:44 2012 -0600

    eCryptfs: Check inode changes in setattr
    
    Most filesystems call inode_change_ok() very early in ->setattr(), but
    eCryptfs didn't call it at all. It allowed the lower filesystem to make
    the call in its ->setattr() function. Then, eCryptfs would copy the
    appropriate inode attributes from the lower inode to the eCryptfs inode.
    
    This patch changes that and actually calls inode_change_ok() on the
    eCryptfs inode, fairly early in ecryptfs_setattr(). Ideally, the call
    would happen earlier in ecryptfs_setattr(), but there are some possible
    inode initialization steps that must happen first.
    
    Since the call was already being made on the lower inode, the change in
    functionality should be minimal, except for the case of a file extending
    truncate call. In that case, inode_newsize_ok() was never being
    called on the eCryptfs inode. Rather than inode_newsize_ok() catching
    maximum file size errors early on, eCryptfs would encrypt zeroed pages
    and write them to the lower filesystem until the lower filesystem's
    write path caught the error in generic_write_checks(). This patch
    introduces a new function, called ecryptfs_inode_newsize_ok(), which
    checks if the new lower file size is within the appropriate limits when
    the truncate operation will be growing the lower file.
    
    In summary this change prevents eCryptfs truncate operations (and the
    resulting page encryptions), which would exceed the lower filesystem
    limits or FSIZE rlimits, from ever starting.
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reviewed-by: Li Wang <liwang@nudt.edu.cn>
    Cc: <stable@vger.kernel.org>

 fs/ecryptfs/inode.c |   48 ++++++++++++++++++++++++++++++++++++------------
 1 files changed, 36 insertions(+), 12 deletions(-)

commit 0d96f190a39505254ace4e9330219aaeda9b64e3
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Wed Jan 18 18:30:04 2012 -0600

    eCryptfs: Make truncate path killable
    
    ecryptfs_write() handles the truncation of eCryptfs inodes. It grabs a
    page, zeroes out the appropriate portions, and then encrypts the page
    before writing it to the lower filesystem. It was unkillable and due to
    the lack of sparse file support could result in tying up a large portion
    of system resources, while encrypting pages of zeros, with no way for
    the truncate operation to be stopped from userspace.
    
    This patch adds the ability for ecryptfs_write() to detect a pending
    fatal signal and return as gracefully as possible. The intent is to
    leave the lower file in a useable state, while still allowing a user to
    break out of the encryption loop. If a pending fatal signal is detected,
    the eCryptfs inode size is updated to reflect the modified inode size
    and then -EINTR is returned.
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Cc: <stable@vger.kernel.org>

 fs/ecryptfs/read_write.c |   19 ++++++++++++++-----
 1 files changed, 14 insertions(+), 5 deletions(-)

commit a02d0d2516b9e92edffeb8fca87462bca49c1f6f
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Tue Jan 24 10:02:22 2012 -0600

    eCryptfs: Fix oops when printing debug info in extent crypto functions
    
    If pages passed to the eCryptfs extent-based crypto functions are not
    mapped and the module parameter ecryptfs_verbosity=1 was specified at
    loading time, a NULL pointer dereference will occur.
    
    Note that this wouldn't happen on a production system, as you wouldn't
    pass ecryptfs_verbosity=1 on a production system. It leaks private
    information to the system logs and is for debugging only.
    
    The debugging info printed in these messages is no longer very useful
    and rather than doing a kmap() in these debugging paths, it will be
    better to simply remove the debugging paths completely.
    
    https://launchpad.net/bugs/913651
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reported-by: Daniel DeFreez
    Cc: <stable@vger.kernel.org>

 fs/ecryptfs/crypto.c |   40 ----------------------------------------
 1 files changed, 0 insertions(+), 40 deletions(-)

commit b1c44d3054dc7f293b2e0a98c0e9e5e03e01f04c
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Thu Jan 12 11:30:44 2012 +0100

    eCryptfs: Sanitize write counts of /dev/ecryptfs
    
    A malicious count value specified when writing to /dev/ecryptfs may
    result in a a very large kernel memory allocation.
    
    This patch peeks at the specified packet payload size, adds that to the
    size of the packet headers and compares the result with the write count
    value. The resulting maximum memory allocation size is approximately 532
    bytes.
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Reported-by: Sasha Levin <levinsasha928@gmail.com>
    Cc: <stable@vger.kernel.org>

 fs/ecryptfs/miscdev.c |   56 +++++++++++++++++++++++++++++++++---------------
 1 files changed, 38 insertions(+), 18 deletions(-)

commit 96dcb7282d323813181a1791f51c0ab7696b675b
Merge: 6c09fa5 201c0db
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:44:15 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 201c0dbf177527367676028151e36d340923f033
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:43:24 2012 -0500

    Merge changes from pax-linux-3.2.2-test6.patch, fixes 0 order vmalloc allocation errors
    on loading modules with empty sections

 arch/x86/kernel/module.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 6c09fa566a7c29f00556ca12f343f2db91c4f42b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:42:13 2012 -0500

    compile fix

 grsecurity/gracl.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

commit 917ae526b4fcec2b3e1afefa13de9dff7d8a5423
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 19:39:28 2012 -0500

    use LSM flags instead of duplicating checks

 fs/exec.c                  |    2 +-
 grsecurity/gracl.c         |    9 ++++-----
 include/linux/grsecurity.h |    2 +-
 3 files changed, 6 insertions(+), 7 deletions(-)

commit 0cf3be2ea2ae43c9dd4933fb26c0429041b8acb8
Merge: 44b9f11 558718b
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 18:56:23 2012 -0500

    Merge branch 'pax-test' into grsec-test

commit 558718b2217beff69edf60f34a6f9893d910e9ac
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 18:56:04 2012 -0500

    Merge changes from pax-linux-3.2.2-test6.patch

 arch/x86/kernel/cpu/mcheck/p5.c      |    2 +-
 arch/x86/kernel/cpu/mcheck/winchip.c |    1 +
 include/linux/netdevice.h            |    2 +-
 mm/process_vm_access.c               |    2 ++
 net/core/dev.c                       |   10 +++++-----
 5 files changed, 10 insertions(+), 7 deletions(-)

commit 44b9f1132b2de7cbf5f57525fe0f7f9fb0a76507
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 18:53:55 2012 -0500

    don't increase the size of task_struct when unnecessary
    change ptrace_readexec log message

 include/linux/grmsg.h |    2 +-
 include/linux/sched.h |    2 ++
 2 files changed, 3 insertions(+), 1 deletions(-)

commit a9c9626e054adb885883aa64f85506852894dd33
Author: Brad Spengler <spender@grsecurity.net>
Date:   Fri Jan 27 18:16:28 2012 -0500

    Update documentation for CONFIG_GRKERNSEC_PTRACE_READEXEC --
    the protection applies to all unreadable binaries.

 grsecurity/Kconfig |   10 ++++------
 1 files changed, 4 insertions(+), 6 deletions(-)

commit 98fdf4ab69eba7a72efb2054295daafdbbc2fb8f
Merge: 7b3f3af 05a1349
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 25 20:52:09 2012 -0500

    Merge branch 'pax-test' into grsec-test
    
    Conflicts:
    	block/scsi_ioctl.c
    	drivers/scsi/sd.c
    	fs/proc/base.c

commit 05a134966efb9cb9346ad3422888969ffc79ac1d
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 25 20:47:36 2012 -0500

    Resync with pax-linux-3.2.2-test5.patch

 ipc/shm.c |    4 +---
 1 files changed, 1 insertions(+), 3 deletions(-)

commit 5ecaafd81b229aeeb5656df36f9c8da86307f82a
Merge: c6d443d 3499d64
Author: Brad Spengler <spender@grsecurity.net>
Date:   Wed Jan 25 20:45:16 2012 -0500

    Merge branch 'linux-3.2.y' into pax-test (and pax-linux-3.2.2-test5.patch)
    
    Conflicts:
    	ipc/shm.c

commit 7b3f3afd7444613c759d68ff8c2efaebfae3bab1
Author: Brad Spengler <spender@grsecurity.net>
Date:   Tue Jan 24 19:42:01 2012 -0500

    Add two new features, one is automatic by enabling CONFIG_GRKERNSEC
    (may be changed if it breaks some userland), the other has its own
    config option
    
    First feature requires CAP_SYS_ADMIN to write to any sysctl entry via
    the syscall or /proc/sys.
    
    Second feature requires read access to a suid/sgid binary in order
    to ptrace it, preventing infoleaking of binaries in situations where
    the admin has specified 4711 or 2711 perms.  Feature has been
    given the config option CONFIG_GRKERNSEC_PTRACE_READEXEC and
    a sysctl entry of ptrace_readexec

 fs/exec.c                  |    5 +++++
 fs/proc/proc_sysctl.c      |    6 ++++++
 grsecurity/Kconfig         |   16 ++++++++++++++++
 grsecurity/grsec_init.c    |    4 ++++
 grsecurity/grsec_ptrace.c  |   18 +++++++++++++++++-
 grsecurity/grsec_sysctl.c  |    9 +++++++++
 include/linux/grinternal.h |    1 +
 include/linux/grmsg.h      |    1 +
 include/linux/grsecurity.h |    2 ++
 9 files changed, 61 insertions(+), 1 deletions(-)

commit 11a7bb25c411c9dccfdca5718639b4becdffd388
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 22 14:37:10 2012 -0500

    Compilation fixes

 include/linux/ptrace.h |    2 ++
 kernel/pid.c           |    4 +++-
 kernel/ptrace.c        |    5 +++++
 mm/process_vm_access.c |    2 +-
 4 files changed, 11 insertions(+), 2 deletions(-)

commit cd400e21c7c352baba47d6f375297a7847afb33a
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 22 14:20:27 2012 -0500

    Initial port of grsecurity 2.2.2 for Linux 3.2.1
    Note that the new syscalls added to this kernel for remote process read/write
    are subject to ptrace hardening/other relevant RBAC features
    /proc/slabinfo is S_IRUSR via mainline now, so I made slab_allocators S_IRUSR by default
    as well
    pax_track_stack has been removed from support for this kernel -- if you're running this kernel
    you should be using a version of gcc with plugin support

 Makefile                                  |    8 +-
 arch/arm/kernel/traps.c                   |    5 +
 arch/arm/mach-ux500/mbox-db5500.c         |    2 +-
 arch/powerpc/kernel/process.c             |   10 +-
 arch/powerpc/kernel/traps.c               |    4 +
 arch/sparc/Makefile                       |    2 +-
 arch/sparc/kernel/process_32.c            |    8 +-
 arch/sparc/kernel/process_64.c            |    8 +-
 arch/sparc/kernel/traps_32.c              |    8 +-
 arch/sparc/kernel/traps_64.c              |   28 +-
 arch/sparc/kernel/unaligned_64.c          |    2 +-
 arch/sparc/mm/fault_64.c                  |    2 +-
 arch/x86/Kconfig                          |    5 +-
 arch/x86/ia32/ia32_aout.c                 |    2 +
 arch/x86/kernel/acpi/realmode/wakeup.S    |    4 +
 arch/x86/kernel/dumpstack.c               |    8 +
 arch/x86/kernel/entry_32.S                |    2 +-
 arch/x86/kernel/entry_64.S                |    2 +-
 arch/x86/kernel/ioport.c                  |   13 +
 arch/x86/kernel/verify_cpu.S              |    1 +
 arch/x86/kernel/vm86_32.c                 |   16 +
 arch/x86/mm/fault.c                       |   11 +-
 arch/x86/mm/init.c                        |   15 +
 block/scsi_ioctl.c                        |   52 +
 drivers/block/cciss.c                     |    8 +-
 drivers/block/ub.c                        |    3 +-
 drivers/block/virtio_blk.c                |    4 +-
 drivers/cdrom/cdrom.c                     |    3 +-
 drivers/char/Kconfig                      |    4 +-
 drivers/char/briq_panel.c                 |    8 +-
 drivers/char/genrtc.c                     |    1 +
 drivers/char/mem.c                        |   17 +
 drivers/char/random.c                     |   12 +
 drivers/gpu/drm/drm_info.c                |    4 +
 drivers/ide/ide-floppy_ioctl.c            |    3 +-
 drivers/media/dvb/frontends/ds3000.c      |    2 +-
 drivers/message/fusion/mptbase.c          |    5 +
 drivers/pci/proc.c                        |    9 +
 drivers/rtc/rtc-dev.c                     |    3 +
 drivers/scsi/sd.c                         |   13 +-
 drivers/tty/vt/keyboard.c                 |   10 +
 drivers/tty/vt/vt_ioctl.c                 |   12 +-
 drivers/video/logo/logo_linux_clut224.ppm | 2721 ++++++++-----------
 fs/attr.c                                 |    1 +
 fs/binfmt_aout.c                          |    7 +
 fs/binfmt_elf.c                           |    6 +
 fs/btrfs/inode.c                          |   10 +-
 fs/btrfs/ioctl.c                          |    6 +-
 fs/compat.c                               |   18 +
 fs/exec.c                                 |   99 +-
 fs/ext2/balloc.c                          |    2 +-
 fs/ext3/balloc.c                          |    5 +-
 fs/ext4/balloc.c                          |    4 +-
 fs/fcntl.c                                |    6 +
 fs/file.c                                 |    2 +
 fs/filesystems.c                          |    5 +
 fs/fs_struct.c                            |    9 +
 fs/hugetlbfs/inode.c                      |    2 +-
 fs/namei.c                                |  226 ++-
 fs/namespace.c                            |   24 +
 fs/notify/mark.c                          |    8 +-
 fs/open.c                                 |   35 +
 fs/partitions/ldm.c                       |    2 +-
 fs/pipe.c                                 |    2 +-
 fs/proc/Kconfig                           |   10 +-
 fs/proc/array.c                           |   45 +
 fs/proc/base.c                            |  344 ++-
 fs/proc/cmdline.c                         |    4 +
 fs/proc/devices.c                         |    4 +
 fs/proc/inode.c                           |   17 +
 fs/proc/internal.h                        |    3 +
 fs/proc/kcore.c                           |    3 +
 fs/proc/proc_net.c                        |   11 +
 fs/proc/proc_sysctl.c                     |   25 +-
 fs/proc/root.c                            |    8 +
 fs/proc/task_mmu.c                        |   42 +-
 fs/readdir.c                              |   19 +
 fs/select.c                               |    2 +
 fs/sysfs/mount.c                          |    4 +
 fs/utimes.c                               |    7 +
 fs/xattr.c                                |   20 +-
 grsecurity/Kconfig                        | 1051 ++++++++
 grsecurity/Makefile                       |   36 +
 grsecurity/gracl.c                        | 4156 +++++++++++++++++++++++++++++
 grsecurity/gracl_alloc.c                  |  105 +
 grsecurity/gracl_cap.c                    |  101 +
 grsecurity/gracl_fs.c                     |  433 +++
 grsecurity/gracl_ip.c                     |  381 +++
 grsecurity/gracl_learn.c                  |  207 ++
 grsecurity/gracl_res.c                    |   68 +
 grsecurity/gracl_segv.c                   |  299 +++
 grsecurity/gracl_shm.c                    |   40 +
 grsecurity/grsec_chdir.c                  |   19 +
 grsecurity/grsec_chroot.c                 |  351 +++
 grsecurity/grsec_disabled.c               |  439 +++
 grsecurity/grsec_exec.c                   |  146 +
 grsecurity/grsec_fifo.c                   |   24 +
 grsecurity/grsec_fork.c                   |   23 +
 grsecurity/grsec_init.c                   |  273 ++
 grsecurity/grsec_link.c                   |   43 +
 grsecurity/grsec_log.c                    |  322 +++
 grsecurity/grsec_mem.c                    |   33 +
 grsecurity/grsec_mount.c                  |   62 +
 grsecurity/grsec_pax.c                    |   36 +
 grsecurity/grsec_ptrace.c                 |   14 +
 grsecurity/grsec_sig.c                    |  207 ++
 grsecurity/grsec_sock.c                   |  244 ++
 grsecurity/grsec_sysctl.c                 |  442 +++
 grsecurity/grsec_time.c                   |   16 +
 grsecurity/grsec_tpe.c                    |   39 +
 grsecurity/grsum.c                        |   61 +
 include/linux/blkdev.h                    |    3 +
 include/linux/capability.h                |    3 +
 include/linux/cred.h                      |    3 +
 include/linux/gracl.h                     |  317 +++
 include/linux/gralloc.h                   |    9 +
 include/linux/grdefs.h                    |  140 +
 include/linux/grinternal.h                |  220 ++
 include/linux/grmsg.h                     |  108 +
 include/linux/grsecurity.h                |  231 ++
 include/linux/grsock.h                    |   19 +
 include/linux/kallsyms.h                  |   13 +-
 include/linux/kmod.h                      |    2 +
 include/linux/netfilter/xt_gradm.h        |    9 +
 include/linux/proc_fs.h                   |   13 +
 include/linux/ptrace.h                    |    4 +-
 include/linux/sched.h                     |   49 +-
 include/linux/security.h                  |    1 +
 include/linux/shm.h                       |    4 +
 include/linux/sysctl.h                    |    2 +
 include/linux/vermagic.h                  |    9 +-
 init/main.c                               |    4 +
 ipc/mqueue.c                              |    1 +
 ipc/shm.c                                 |   28 +
 kernel/audit.c                            |    5 +-
 kernel/auditsc.c                          |    4 +-
 kernel/capability.c                       |   29 +-
 kernel/compat.c                           |    1 +
 kernel/configs.c                          |   11 +
 kernel/cred.c                             |   99 +-
 kernel/exit.c                             |   25 +-
 kernel/fork.c                             |   11 +
 kernel/futex.c                            |    5 +
 kernel/futex_compat.c                     |    8 +-
 kernel/kallsyms.c                         |    8 +
 kernel/kmod.c                             |   64 +-
 kernel/module.c                           |   80 +-
 kernel/panic.c                            |   10 +-
 kernel/pid.c                              |   17 +-
 kernel/posix-cpu-timers.c                 |    1 +
 kernel/posix-timers.c                     |    8 +
 kernel/printk.c                           |    5 +
 kernel/ptrace.c                           |   43 +-
 kernel/resource.c                         |   10 +
 kernel/sched.c                            |   21 +-
 kernel/signal.c                           |   37 +-
 kernel/sys.c                              |   43 +-
 kernel/sysctl.c                           |   51 +-
 kernel/sysctl_check.c                     |    1 +
 kernel/taskstats.c                        |    6 +
 kernel/time.c                             |    5 +
 kernel/time/timekeeping.c                 |    3 +
 kernel/time/timer_list.c                  |   12 +
 kernel/time/timer_stats.c                 |    8 +
 lib/Kconfig.debug                         |    1 +
 lib/is_single_threaded.c                  |    3 +
 lib/vsprintf.c                            |   18 +-
 localversion-grsec                        |    1 +
 mm/Kconfig                                |    2 +-
 mm/filemap.c                              |    1 +
 mm/kmemleak.c                             |    2 +-
 mm/mempolicy.c                            |   11 +-
 mm/migrate.c                              |   11 +-
 mm/mlock.c                                |    3 +
 mm/mmap.c                                 |   30 +-
 mm/mprotect.c                             |    8 +
 mm/page_alloc.c                           |    6 +
 mm/process_vm_access.c                    |    6 +
 mm/shmem.c                                |    2 +-
 mm/slab.c                                 |    2 +-
 mm/slub.c                                 |   14 +-
 mm/vmstat.c                               |   18 +-
 net/core/dev.c                            |    4 +
 net/core/sock.c                           |    2 +-
 net/econet/Kconfig                        |    2 +-
 net/ipv4/inet_diag.c                      |   21 +
 net/ipv4/inet_hashtables.c                |    5 +
 net/ipv4/ip_sockglue.c                    |    3 +-
 net/ipv4/raw.c                            |    8 +-
 net/ipv4/tcp_ipv4.c                       |   42 +-
 net/ipv4/tcp_minisocks.c                  |    8 +
 net/ipv4/tcp_timer.c                      |   11 +
 net/ipv4/udp.c                            |   31 +-
 net/ipv6/raw.c                            |    8 +-
 net/ipv6/tcp_ipv6.c                       |   46 +-
 net/ipv6/udp.c                            |   14 +-
 net/netfilter/Kconfig                     |   10 +
 net/netfilter/Makefile                    |    1 +
 net/netfilter/xt_gradm.c                  |   51 +
 net/netrom/af_netrom.c                    |    2 +-
 net/phonet/af_phonet.c                    |    4 +-
 net/phonet/socket.c                       |    7 +-
 net/sctp/proc.c                           |    3 +-
 net/socket.c                              |   62 +-
 net/sysctl_net.c                          |    2 +-
 net/unix/af_unix.c                        |   20 +
 scripts/Makefile.build                    |    2 +-
 security/Kconfig                          |   87 +-
 security/apparmor/lsm.c                   |    2 +-
 security/commoncap.c                      |    6 +-
 security/integrity/ima/ima_audit.c        |    8 +-
 security/lsm_audit.c                      |   23 +-
 security/min_addr.c                       |    2 +
 security/security.c                       |    2 -
 security/selinux/hooks.c                  |    2 -
 tools/gcc/Makefile                        |    2 +-
 216 files changed, 14214 insertions(+), 2029 deletions(-)

commit c6d443d1270f455c56a4ffe0f1dd3d3e7ec12a2f
Author: Brad Spengler <spender@grsecurity.net>
Date:   Sun Jan 22 11:47:31 2012 -0500

    Import pax-linux-3.2.1-test5.patch

 Documentation/dontdiff                             |   27 +-
 Documentation/kernel-parameters.txt                |    7 +
 Makefile                                           |   72 ++-
 arch/alpha/include/asm/elf.h                       |    7 +
 arch/alpha/include/asm/pgtable.h                   |   11 +
 arch/alpha/kernel/module.c                         |    2 +-
 arch/alpha/kernel/osf_sys.c                        |   10 +-
 arch/alpha/mm/fault.c                              |  141 +++++-
 arch/arm/include/asm/atomic.h                      |    8 +
 arch/arm/include/asm/elf.h                         |   13 +-
 arch/arm/include/asm/kmap_types.h                  |    1 +
 arch/arm/include/asm/uaccess.h                     |   27 +-
 arch/arm/kernel/armksyms.c                         |    4 +-
 arch/arm/kernel/process.c                          |    7 -
 arch/arm/lib/copy_from_user.S                      |    6 +-
 arch/arm/lib/copy_to_user.S                        |    6 +-
 arch/arm/lib/uaccess.S                             |   12 +-
 arch/arm/lib/uaccess_with_memcpy.c                 |    2 +-
 arch/arm/mm/fault.c                                |   34 +
 arch/arm/mm/mmap.c                                 |   19 +-
 arch/avr32/include/asm/elf.h                       |    8 +-
 arch/avr32/include/asm/kmap_types.h                |    3 +-
 arch/avr32/mm/fault.c                              |   27 +
 arch/frv/include/asm/kmap_types.h                  |    1 +
 arch/frv/mm/elf-fdpic.c                            |    7 +-
 arch/ia64/include/asm/elf.h                        |    7 +
 arch/ia64/include/asm/pgtable.h                    |   13 +-
 arch/ia64/include/asm/spinlock.h                   |    2 +-
 arch/ia64/include/asm/uaccess.h                    |    4 +-
 arch/ia64/kernel/module.c                          |   48 ++-
 arch/ia64/kernel/sys_ia64.c                        |   13 +-
 arch/ia64/kernel/vmlinux.lds.S                     |    2 +-
 arch/ia64/mm/fault.c                               |   33 +-
 arch/ia64/mm/hugetlbpage.c                         |    2 +-
 arch/ia64/mm/init.c                                |   13 +
 arch/m32r/lib/usercopy.c                           |    6 +
 arch/mips/include/asm/elf.h                        |   11 +-
 arch/mips/include/asm/page.h                       |    2 +-
 arch/mips/include/asm/system.h                     |    2 +-
 arch/mips/kernel/binfmt_elfn32.c                   |    7 +
 arch/mips/kernel/binfmt_elfo32.c                   |    7 +
 arch/mips/kernel/process.c                         |   12 -
 arch/mips/mm/fault.c                               |   17 +
 arch/mips/mm/mmap.c                                |   41 +-
 arch/parisc/include/asm/elf.h                      |    7 +
 arch/parisc/include/asm/pgtable.h                  |   11 +
 arch/parisc/kernel/module.c                        |   50 ++-
 arch/parisc/kernel/sys_parisc.c                    |    6 +-
 arch/parisc/kernel/traps.c                         |    4 +-
 arch/parisc/mm/fault.c                             |  140 +++++-
 arch/powerpc/include/asm/elf.h                     |   18 +-
 arch/powerpc/include/asm/kmap_types.h              |    1 +
 arch/powerpc/include/asm/mman.h                    |    2 +-
 arch/powerpc/include/asm/page.h                    |    8 +-
 arch/powerpc/include/asm/page_64.h                 |    7 +-
 arch/powerpc/include/asm/pgtable.h                 |    1 +
 arch/powerpc/include/asm/pte-hash32.h              |    1 +
 arch/powerpc/include/asm/reg.h                     |    1 +
 arch/powerpc/include/asm/system.h                  |    2 +-
 arch/powerpc/include/asm/uaccess.h                 |  142 +++--
 arch/powerpc/kernel/exceptions-64e.S               |    4 +-
 arch/powerpc/kernel/exceptions-64s.S               |    2 +-
 arch/powerpc/kernel/module_32.c                    |   13 +-
 arch/powerpc/kernel/process.c                      |   55 --
 arch/powerpc/kernel/signal_32.c                    |    2 +-
 arch/powerpc/kernel/signal_64.c                    |    2 +-
 arch/powerpc/kernel/vdso.c                         |    5 +-
 arch/powerpc/lib/usercopy_64.c                     |   18 -
 arch/powerpc/mm/fault.c                            |   55 ++-
 arch/powerpc/mm/mmap_64.c                          |   12 +
 arch/powerpc/mm/slice.c                            |   23 +-
 arch/s390/include/asm/elf.h                        |   13 +-
 arch/s390/include/asm/system.h                     |    2 +-
 arch/s390/include/asm/uaccess.h                    |   11 +
 arch/s390/kernel/module.c                          |   22 +-
 arch/s390/kernel/process.c                         |   36 --
 arch/s390/mm/mmap.c                                |   24 +
 arch/score/include/asm/system.h                    |    2 +-
 arch/score/kernel/process.c                        |    5 -
 arch/sh/mm/mmap.c                                  |   24 +-
 arch/sparc/include/asm/atomic_64.h                 |  106 +++-
 arch/sparc/include/asm/cache.h                     |    2 +-
 arch/sparc/include/asm/elf_32.h                    |    7 +
 arch/sparc/include/asm/elf_64.h                    |    7 +
 arch/sparc/include/asm/pgtable_32.h                |   17 +
 arch/sparc/include/asm/pgtsrmmu.h                  |    7 +
 arch/sparc/include/asm/spinlock_64.h               |   35 +-
 arch/sparc/include/asm/thread_info_32.h            |    2 +
 arch/sparc/include/asm/thread_info_64.h            |    2 +
 arch/sparc/include/asm/uaccess.h                   |    8 +
 arch/sparc/include/asm/uaccess_32.h                |   27 +-
 arch/sparc/include/asm/uaccess_64.h                |   19 +-
 arch/sparc/kernel/Makefile                         |    2 +-
 arch/sparc/kernel/sys_sparc_32.c                   |    4 +-
 arch/sparc/kernel/sys_sparc_64.c                   |   52 +-
 arch/sparc/kernel/traps_64.c                       |   13 +-
 arch/sparc/lib/Makefile                            |    2 +-
 arch/sparc/lib/atomic_64.S                         |  148 +++++-
 arch/sparc/lib/ksyms.c                             |    6 +
 arch/sparc/mm/Makefile                             |    2 +-
 arch/sparc/mm/fault_32.c                           |  283 +++++++++
 arch/sparc/mm/fault_64.c                           |  477 +++++++++++++++
 arch/sparc/mm/hugetlbpage.c                        |   16 +-
 arch/sparc/mm/init_32.c                            |   15 +-
 arch/sparc/mm/srmmu.c                              |    7 +
 arch/um/Makefile                                   |    4 +
 arch/um/include/asm/kmap_types.h                   |    1 +
 arch/um/include/asm/page.h                         |    3 +
 arch/um/kernel/process.c                           |   16 -
 arch/x86/Kconfig                                   |    9 +-
 arch/x86/Kconfig.cpu                               |    6 +-
 arch/x86/Kconfig.debug                             |    4 +-
 arch/x86/Makefile                                  |   10 +
 arch/x86/boot/Makefile                             |    3 +
 arch/x86/boot/bitops.h                             |    4 +-
 arch/x86/boot/boot.h                               |    4 +-
 arch/x86/boot/compressed/Makefile                  |    3 +
 arch/x86/boot/compressed/head_32.S                 |    7 +-
 arch/x86/boot/compressed/head_64.S                 |    4 +-
 arch/x86/boot/compressed/misc.c                    |    4 +-
 arch/x86/boot/compressed/relocs.c                  |   85 +++-
 arch/x86/boot/cpucheck.c                           |   28 +-
 arch/x86/boot/header.S                             |    2 +-
 arch/x86/boot/memory.c                             |    2 +-
 arch/x86/boot/video-vesa.c                         |    1 +
 arch/x86/boot/video.c                              |    2 +-
 arch/x86/crypto/aes-x86_64-asm_64.S                |    4 +
 arch/x86/crypto/aesni-intel_asm.S                  |   31 +
 arch/x86/crypto/blowfish-x86_64-asm_64.S           |    8 +
 arch/x86/crypto/salsa20-x86_64-asm_64.S            |    5 +
 arch/x86/crypto/sha1_ssse3_asm.S                   |    3 +
 arch/x86/crypto/twofish-x86_64-asm_64-3way.S       |    5 +
 arch/x86/crypto/twofish-x86_64-asm_64.S            |    3 +
 arch/x86/ia32/ia32_signal.c                        |   20 +-
 arch/x86/ia32/ia32entry.S                          |  133 +++--
 arch/x86/ia32/sys_ia32.c                           |   18 +-
 arch/x86/include/asm/alternative-asm.h             |   43 ++-
 arch/x86/include/asm/alternative.h                 |    2 +-
 arch/x86/include/asm/apic.h                        |    2 +-
 arch/x86/include/asm/apm.h                         |    4 +-
 arch/x86/include/asm/atomic.h                      |  285 +++++++++-
 arch/x86/include/asm/atomic64_32.h                 |  100 +++
 arch/x86/include/asm/atomic64_64.h                 |  202 ++++++-
 arch/x86/include/asm/bitops.h                      |    2 +-
 arch/x86/include/asm/boot.h                        |    7 +-
 arch/x86/include/asm/cache.h                       |    5 +-
 arch/x86/include/asm/cacheflush.h                  |    2 +-
 arch/x86/include/asm/checksum_32.h                 |   12 +-
 arch/x86/include/asm/cmpxchg.h                     |   32 +
 arch/x86/include/asm/cpufeature.h                  |    2 +-
 arch/x86/include/asm/desc.h                        |   61 ++-
 arch/x86/include/asm/desc_defs.h                   |    6 +
 arch/x86/include/asm/e820.h                        |    2 +-
 arch/x86/include/asm/elf.h                         |   27 +-
 arch/x86/include/asm/emergency-restart.h           |    2 +-
 arch/x86/include/asm/futex.h                       |   14 +-
 arch/x86/include/asm/hw_irq.h                      |    4 +-
 arch/x86/include/asm/i387.h                        |   21 +-
 arch/x86/include/asm/io.h                          |   11 +
 arch/x86/include/asm/irqflags.h                    |    5 +
 arch/x86/include/asm/kprobes.h                     |    9 +-
 arch/x86/include/asm/kvm_host.h                    |    4 +-
 arch/x86/include/asm/local.h                       |   94 +++-
 arch/x86/include/asm/mman.h                        |   10 +
 arch/x86/include/asm/mmu.h                         |   16 +-
 arch/x86/include/asm/mmu_context.h                 |   76 +++-
 arch/x86/include/asm/module.h                      |   17 +-
 arch/x86/include/asm/page_64_types.h               |    2 +-
 arch/x86/include/asm/paravirt.h                    |   44 ++-
 arch/x86/include/asm/paravirt_types.h              |   19 +-
 arch/x86/include/asm/pgalloc.h                     |    7 +
 arch/x86/include/asm/pgtable-2level.h              |    2 +
 arch/x86/include/asm/pgtable-3level.h              |    4 +
 arch/x86/include/asm/pgtable.h                     |  110 ++++-
 arch/x86/include/asm/pgtable_32.h                  |   14 +-
 arch/x86/include/asm/pgtable_32_types.h            |   15 +-
 arch/x86/include/asm/pgtable_64.h                  |   17 +-
 arch/x86/include/asm/pgtable_64_types.h            |    5 +
 arch/x86/include/asm/pgtable_types.h               |   36 +-
 arch/x86/include/asm/processor.h                   |   35 +-
 arch/x86/include/asm/ptrace.h                      |   18 +-
 arch/x86/include/asm/reboot.h                      |   12 +-
 arch/x86/include/asm/rwsem.h                       |   60 ++-
 arch/x86/include/asm/segment.h                     |   22 +-
 arch/x86/include/asm/smp.h                         |   14 +-
 arch/x86/include/asm/spinlock.h                    |   36 +-
 arch/x86/include/asm/stackprotector.h              |    4 +-
 arch/x86/include/asm/stacktrace.h                  |   32 +-
 arch/x86/include/asm/sys_ia32.h                    |    2 +-
 arch/x86/include/asm/system.h                      |   10 +-
 arch/x86/include/asm/thread_info.h                 |   81 +--
 arch/x86/include/asm/uaccess.h                     |   93 +++-
 arch/x86/include/asm/uaccess_32.h                  |   95 +++-
 arch/x86/include/asm/uaccess_64.h                  |  270 +++++++---
 arch/x86/include/asm/vdso.h                        |    2 +-
 arch/x86/include/asm/x86_init.h                    |   26 +-
 arch/x86/include/asm/xsave.h                       |   12 +-
 arch/x86/kernel/acpi/realmode/Makefile             |    3 +
 arch/x86/kernel/acpi/sleep.c                       |    4 +
 arch/x86/kernel/acpi/wakeup_32.S                   |    6 +-
 arch/x86/kernel/alternative.c                      |   65 ++-
 arch/x86/kernel/apic/apic.c                        |    4 +-
 arch/x86/kernel/apic/io_apic.c                     |    8 +-
 arch/x86/kernel/apm_32.c                           |   19 +-
 arch/x86/kernel/asm-offsets.c                      |   20 +
 arch/x86/kernel/asm-offsets_64.c                   |    1 +
 arch/x86/kernel/cpu/Makefile                       |    4 -
 arch/x86/kernel/cpu/amd.c                          |    2 +-
 arch/x86/kernel/cpu/common.c                       |   74 +--
 arch/x86/kernel/cpu/intel.c                        |    2 +-
 arch/x86/kernel/cpu/mcheck/mce.c                   |   27 +-
 arch/x86/kernel/cpu/mcheck/p5.c                    |    2 +
 arch/x86/kernel/cpu/mcheck/winchip.c               |    2 +
 arch/x86/kernel/cpu/mtrr/main.c                    |    2 +-
 arch/x86/kernel/cpu/mtrr/mtrr.h                    |    2 +-
 arch/x86/kernel/cpu/perf_event.c                   |    2 +-
 arch/x86/kernel/crash.c                            |    4 +-
 arch/x86/kernel/doublefault_32.c                   |    8 +-
 arch/x86/kernel/dumpstack.c                        |   29 +-
 arch/x86/kernel/dumpstack_32.c                     |   32 +-
 arch/x86/kernel/dumpstack_64.c                     |   58 ++-
 arch/x86/kernel/early_printk.c                     |    1 +
 arch/x86/kernel/entry_32.S                         |  377 ++++++++++--
 arch/x86/kernel/entry_64.S                         |  509 ++++++++++++++--
 arch/x86/kernel/ftrace.c                           |   14 +-
 arch/x86/kernel/head32.c                           |    3 +-
 arch/x86/kernel/head_32.S                          |  244 +++++++--
 arch/x86/kernel/head_64.S                          |  156 ++++--
 arch/x86/kernel/i386_ksyms_32.c                    |    8 +
 arch/x86/kernel/i8259.c                            |    2 +-
 arch/x86/kernel/init_task.c                        |    7 +-
 arch/x86/kernel/ioport.c                           |    2 +-
 arch/x86/kernel/irq.c                              |   10 +-
 arch/x86/kernel/irq_32.c                           |   69 +--
 arch/x86/kernel/irq_64.c                           |    2 +-
 arch/x86/kernel/kgdb.c                             |   10 +-
 arch/x86/kernel/kprobes.c                          |   34 +-
 arch/x86/kernel/kvm.c                              |    1 +
 arch/x86/kernel/ldt.c                              |   31 +-
 arch/x86/kernel/machine_kexec_32.c                 |    6 +-
 arch/x86/kernel/microcode_intel.c                  |    4 +-
 arch/x86/kernel/module.c                           |   74 ++-
 arch/x86/kernel/nmi.c                              |   11 +
 arch/x86/kernel/paravirt-spinlocks.c               |    2 +-
 arch/x86/kernel/paravirt.c                         |   43 +-
 arch/x86/kernel/pci-iommu_table.c                  |    2 +-
 arch/x86/kernel/process.c                          |   81 ++-
 arch/x86/kernel/process_32.c                       |   21 +-
 arch/x86/kernel/process_64.c                       |   18 +-
 arch/x86/kernel/ptrace.c                           |    8 +-
 arch/x86/kernel/pvclock.c                          |    8 +-
 arch/x86/kernel/reboot.c                           |   51 ++-
 arch/x86/kernel/relocate_kernel_64.S               |    4 +-
 arch/x86/kernel/setup.c                            |   14 +-
 arch/x86/kernel/setup_percpu.c                     |   27 +-
 arch/x86/kernel/signal.c                           |   21 +-
 arch/x86/kernel/smpboot.c                          |   15 +-
 arch/x86/kernel/step.c                             |   10 +-
 arch/x86/kernel/sys_i386_32.c                      |  231 +++++++-
 arch/x86/kernel/sys_x86_64.c                       |   52 +-
 arch/x86/kernel/syscall_table_32.S                 |    1 +
 arch/x86/kernel/tboot.c                            |   12 +-
 arch/x86/kernel/time.c                             |   10 +-
 arch/x86/kernel/tls.c                              |    5 +
 arch/x86/kernel/trampoline_32.S                    |    8 +-
 arch/x86/kernel/trampoline_64.S                    |    4 +-
 arch/x86/kernel/traps.c                            |   64 ++-
 arch/x86/kernel/vm86_32.c                          |    6 +-
 arch/x86/kernel/vmlinux.lds.S                      |  147 ++++--
 arch/x86/kernel/vsyscall_64.c                      |   14 +-
 arch/x86/kernel/x8664_ksyms_64.c                   |    2 -
 arch/x86/kernel/xsave.c                            |    6 +-
 arch/x86/kvm/emulate.c                             |    4 +-
 arch/x86/kvm/lapic.c                               |    2 +-
 arch/x86/kvm/mmu.c                                 |    4 +-
 arch/x86/kvm/paging_tmpl.h                         |    4 +-
 arch/x86/kvm/svm.c                                 |    8 +
 arch/x86/kvm/vmx.c                                 |   35 +-
 arch/x86/kvm/x86.c                                 |   31 +-
 arch/x86/lguest/boot.c                             |    3 +-
 arch/x86/lib/atomic64_32.c                         |   32 +
 arch/x86/lib/atomic64_386_32.S                     |  164 +++++
 arch/x86/lib/atomic64_cx8_32.S                     |  103 +++-
 arch/x86/lib/checksum_32.S                         |  100 +++-
 arch/x86/lib/clear_page_64.S                       |    5 +-
 arch/x86/lib/cmpxchg16b_emu.S                      |    2 +
 arch/x86/lib/copy_page_64.S                        |   12 +-
 arch/x86/lib/copy_user_64.S                        |   47 +--
 arch/x86/lib/copy_user_nocache_64.S                |   20 +-
 arch/x86/lib/csum-copy_64.S                        |    2 +
 arch/x86/lib/csum-wrappers_64.c                    |   16 +-
 arch/x86/lib/getuser.S                             |   68 ++-
 arch/x86/lib/insn.c                                |    9 +-
 arch/x86/lib/iomap_copy_64.S                       |    2 +
 arch/x86/lib/memcpy_64.S                           |   18 +-
 arch/x86/lib/memmove_64.S                          |   34 +-
 arch/x86/lib/memset_64.S                           |    7 +-
 arch/x86/lib/mmx_32.c                              |  243 +++++---
 arch/x86/lib/msr-reg.S                             |   18 +-
 arch/x86/lib/putuser.S                             |   87 +++-
 arch/x86/lib/rwlock.S                              |   42 ++
 arch/x86/lib/rwsem.S                               |    6 +-
 arch/x86/lib/thunk_64.S                            |    2 +
 arch/x86/lib/usercopy_32.c                         |  379 ++++++++-----
 arch/x86/lib/usercopy_64.c                         |   32 +-
 arch/x86/mm/extable.c                              |    2 +-
 arch/x86/mm/fault.c                                |  551 ++++++++++++++++-
 arch/x86/mm/gup.c                                  |    2 +-
 arch/x86/mm/highmem_32.c                           |    4 +
 arch/x86/mm/hugetlbpage.c                          |  111 ++--
 arch/x86/mm/init.c                                 |   91 +++-
 arch/x86/mm/init_32.c                              |  122 ++--
 arch/x86/mm/init_64.c                              |   40 +-
 arch/x86/mm/iomap_32.c                             |    4 +
 arch/x86/mm/ioremap.c                              |    7 +-
 arch/x86/mm/kmemcheck/kmemcheck.c                  |    4 +-
 arch/x86/mm/mmap.c                                 |   41 +-
 arch/x86/mm/mmio-mod.c                             |    6 +-
 arch/x86/mm/pageattr-test.c                        |    2 +-
 arch/x86/mm/pageattr.c                             |   33 +-
 arch/x86/mm/pat.c                                  |   12 +-
 arch/x86/mm/pf_in.c                                |   10 +-
 arch/x86/mm/pgtable.c                              |  125 +++--
 arch/x86/mm/pgtable_32.c                           |    3 +
 arch/x86/mm/setup_nx.c                             |    7 +
 arch/x86/mm/tlb.c                                  |    4 +
 arch/x86/net/bpf_jit.S                             |   10 +
 arch/x86/net/bpf_jit_comp.c                        |   26 +-
 arch/x86/oprofile/backtrace.c                      |    8 +-
 arch/x86/pci/mrst.c                                |    4 +-
 arch/x86/pci/pcbios.c                              |  146 ++++-
 arch/x86/platform/efi/efi_32.c                     |   19 +
 arch/x86/platform/efi/efi_stub_32.S                |   48 +-
 arch/x86/platform/efi/efi_stub_64.S                |    8 +
 arch/x86/platform/mrst/mrst.c                      |    6 +-
 arch/x86/power/cpu.c                               |    4 +-
 arch/x86/vdso/Makefile                             |    2 +-
 arch/x86/vdso/vdso32-setup.c                       |   23 +-
 arch/x86/vdso/vma.c                                |   30 +-
 arch/x86/xen/enlighten.c                           |   29 +-
 arch/x86/xen/mmu.c                                 |    9 +
 arch/x86/xen/smp.c                                 |   16 +-
 arch/x86/xen/xen-asm_32.S                          |   12 +-
 arch/x86/xen/xen-head.S                            |   11 +
 arch/x86/xen/xen-ops.h                             |    2 -
 block/blk-iopoll.c                                 |    2 +-
 block/blk-map.c                                    |    2 +-
 block/blk-softirq.c                                |    2 +-
 block/bsg.c                                        |   12 +-
 block/compat_ioctl.c                               |    2 +-
 block/scsi_ioctl.c                                 |   27 +-
 crypto/cryptd.c                                    |    4 +-
 drivers/acpi/apei/cper.c                           |    8 +-
 drivers/acpi/ec_sys.c                              |   12 +-
 drivers/acpi/proc.c                                |   18 +-
 drivers/acpi/processor_driver.c                    |    2 +-
 drivers/ata/libata-core.c                          |    8 +-
 drivers/ata/pata_arasan_cf.c                       |    4 +-
 drivers/atm/adummy.c                               |    2 +-
 drivers/atm/ambassador.c                           |    8 +-
 drivers/atm/atmtcp.c                               |   14 +-
 drivers/atm/eni.c                                  |   12 +-
 drivers/atm/firestream.c                           |    8 +-
 drivers/atm/fore200e.c                             |   14 +-
 drivers/atm/he.c                                   |   18 +-
 drivers/atm/horizon.c                              |    4 +-
 drivers/atm/idt77252.c                             |   36 +-
 drivers/atm/iphase.c                               |   34 +-
 drivers/atm/lanai.c                                |   12 +-
 drivers/atm/nicstar.c                              |   46 +-
 drivers/atm/solos-pci.c                            |    4 +-
 drivers/atm/suni.c                                 |    4 +-
 drivers/atm/uPD98402.c                             |   16 +-
 drivers/atm/zatm.c                                 |    6 +-
 drivers/base/devtmpfs.c                            |    2 +-
 drivers/base/power/wakeup.c                        |    8 +-
 drivers/block/cciss.c                              |   28 +-
 drivers/block/cciss.h                              |    2 +-
 drivers/block/cpqarray.c                           |   28 +-
 drivers/block/cpqarray.h                           |    2 +-
 drivers/block/drbd/drbd_int.h                      |   20 +-
 drivers/block/drbd/drbd_main.c                     |   10 +-
 drivers/block/drbd/drbd_nl.c                       |   10 +-
 drivers/block/drbd/drbd_receiver.c                 |   20 +-
 drivers/block/loop.c                               |    2 +-
 drivers/char/agp/frontend.c                        |    2 +-
 drivers/char/hpet.c                                |    2 +-
 drivers/char/ipmi/ipmi_msghandler.c                |    8 +-
 drivers/char/ipmi/ipmi_si_intf.c                   |    8 +-
 drivers/char/mbcs.c                                |    2 +-
 drivers/char/mem.c                                 |   41 ++-
 drivers/char/nvram.c                               |    2 +-
 drivers/char/random.c                              |    4 +-
 drivers/char/sonypi.c                              |    9 +-
 drivers/char/tpm/tpm.c                             |    2 +-
 drivers/char/tpm/tpm_bios.c                        |   14 +-
 drivers/char/virtio_console.c                      |    4 +-
 drivers/dma/dmatest.c                              |    2 +-
 drivers/edac/amd64_edac.c                          |    2 +-
 drivers/edac/amd76x_edac.c                         |    2 +-
 drivers/edac/e752x_edac.c                          |    2 +-
 drivers/edac/e7xxx_edac.c                          |    2 +-
 drivers/edac/edac_pci_sysfs.c                      |   20 +-
 drivers/edac/i3000_edac.c                          |    2 +-
 drivers/edac/i3200_edac.c                          |    2 +-
 drivers/edac/i5000_edac.c                          |    2 +-
 drivers/edac/i5100_edac.c                          |    2 +-
 drivers/edac/i5400_edac.c                          |    2 +-
 drivers/edac/i7300_edac.c                          |    2 +-
 drivers/edac/i7core_edac.c                         |    2 +-
 drivers/edac/i82443bxgx_edac.c                     |    2 +-
 drivers/edac/i82860_edac.c                         |    2 +-
 drivers/edac/i82875p_edac.c                        |    2 +-
 drivers/edac/i82975x_edac.c                        |    2 +-
 drivers/edac/mce_amd.h                             |    2 +-
 drivers/edac/r82600_edac.c                         |    2 +-
 drivers/edac/x38_edac.c                            |    2 +-
 drivers/firewire/core-card.c                       |    2 +-
 drivers/firewire/core-cdev.c                       |    3 +-
 drivers/firewire/core-transaction.c                |    1 +
 drivers/firewire/core.h                            |    1 +
 drivers/firmware/dmi_scan.c                        |    7 +-
 drivers/gpio/gpio-vr41xx.c                         |    2 +-
 drivers/gpu/drm/drm_crtc.c                         |   22 +-
 drivers/gpu/drm/drm_crtc_helper.c                  |    2 +-
 drivers/gpu/drm/drm_drv.c                          |    4 +-
 drivers/gpu/drm/drm_fops.c                         |   14 +-
 drivers/gpu/drm/drm_global.c                       |   14 +-
 drivers/gpu/drm/drm_info.c                         |   14 +-
 drivers/gpu/drm/drm_ioc32.c                        |    4 +-
 drivers/gpu/drm/drm_ioctl.c                        |    2 +-
 drivers/gpu/drm/drm_lock.c                         |    4 +-
 drivers/gpu/drm/i810/i810_dma.c                    |    8 +-
 drivers/gpu/drm/i810/i810_drv.h                    |    4 +-
 drivers/gpu/drm/i915/i915_debugfs.c                |    4 +-
 drivers/gpu/drm/i915/i915_dma.c                    |    2 +-
 drivers/gpu/drm/i915/i915_drv.h                    |    8 +-
 drivers/gpu/drm/i915/i915_gem_execbuffer.c         |    6 +-
 drivers/gpu/drm/i915/i915_irq.c                    |   10 +-
 drivers/gpu/drm/i915/intel_display.c               |   10 +-
 drivers/gpu/drm/mga/mga_drv.h                      |    4 +-
 drivers/gpu/drm/mga/mga_irq.c                      |    8 +-
 drivers/gpu/drm/nouveau/nouveau_bios.c             |    4 +-
 drivers/gpu/drm/nouveau/nouveau_drv.h              |   12 +-
 drivers/gpu/drm/nouveau/nouveau_fence.c            |    4 +-
 drivers/gpu/drm/nouveau/nouveau_gem.c              |    2 +-
 drivers/gpu/drm/nouveau/nouveau_state.c            |    2 +-
 drivers/gpu/drm/nouveau/nv04_graph.c               |    2 +-
 drivers/gpu/drm/r128/r128_cce.c                    |    2 +-
 drivers/gpu/drm/r128/r128_drv.h                    |    4 +-
 drivers/gpu/drm/r128/r128_irq.c                    |    4 +-
 drivers/gpu/drm/r128/r128_state.c                  |    4 +-
 drivers/gpu/drm/radeon/mkregtable.c                |    4 +-
 drivers/gpu/drm/radeon/radeon.h                    |    6 +-
 drivers/gpu/drm/radeon/radeon_device.c             |    2 +-
 drivers/gpu/drm/radeon/radeon_drv.h                |    2 +-
 drivers/gpu/drm/radeon/radeon_fence.c              |    4 +-
 drivers/gpu/drm/radeon/radeon_ioc32.c              |    2 +-
 drivers/gpu/drm/radeon/radeon_irq.c                |    6 +-
 drivers/gpu/drm/radeon/radeon_state.c              |    4 +-
 drivers/gpu/drm/radeon/radeon_ttm.c                |    6 +-
 drivers/gpu/drm/radeon/rs690.c                     |    4 +-
 drivers/gpu/drm/ttm/ttm_page_alloc.c               |    4 +-
 drivers/gpu/drm/via/via_drv.h                      |    4 +-
 drivers/gpu/drm/via/via_irq.c                      |   18 +-
 drivers/gpu/drm/vmwgfx/vmwgfx_drv.h                |    2 +-
 drivers/gpu/drm/vmwgfx/vmwgfx_fifo.c               |    8 +-
 drivers/gpu/drm/vmwgfx/vmwgfx_irq.c                |    4 +-
 drivers/gpu/drm/vmwgfx/vmwgfx_marker.c             |    2 +-
 drivers/hid/hid-core.c                             |    4 +-
 drivers/hid/usbhid/hiddev.c                        |    2 +-
 drivers/hv/channel.c                               |    4 +-
 drivers/hv/hv.c                                    |    2 +-
 drivers/hv/hyperv_vmbus.h                          |    2 +-
 drivers/hv/vmbus_drv.c                             |    4 +-
 drivers/hwmon/acpi_power_meter.c                   |    2 -
 drivers/hwmon/sht15.c                              |   12 +-
 drivers/i2c/busses/i2c-amd756-s4882.c              |    2 +-
 drivers/i2c/busses/i2c-nforce2-s4985.c             |    2 +-
 drivers/i2c/i2c-mux.c                              |    2 +-
 drivers/ide/aec62xx.c                              |    2 +-
 drivers/ide/alim15x3.c                             |    2 +-
 drivers/ide/amd74xx.c                              |    2 +-
 drivers/ide/atiixp.c                               |    2 +-
 drivers/ide/cmd64x.c                               |    2 +-
 drivers/ide/cs5520.c                               |    2 +-
 drivers/ide/cs5530.c                               |    2 +-
 drivers/ide/cs5535.c                               |    2 +-
 drivers/ide/cy82c693.c                             |    2 +-
 drivers/ide/hpt366.c                               |   24 +-
 drivers/ide/ide-cd.c                               |    2 +-
 drivers/ide/ide-pci-generic.c                      |    2 +-
 drivers/ide/it8172.c                               |    2 +-
 drivers/ide/it8213.c                               |    2 +-
 drivers/ide/it821x.c                               |    2 +-
 drivers/ide/jmicron.c                              |    2 +-
 drivers/ide/ns87415.c                              |    2 +-
 drivers/ide/opti621.c                              |    2 +-
 drivers/ide/pdc202xx_new.c                         |    2 +-
 drivers/ide/pdc202xx_old.c                         |    2 +-
 drivers/ide/piix.c                                 |    2 +-
 drivers/ide/rz1000.c                               |    2 +-
 drivers/ide/sc1200.c                               |    2 +-
 drivers/ide/scc_pata.c                             |    2 +-
 drivers/ide/serverworks.c                          |    2 +-
 drivers/ide/siimage.c                              |    2 +-
 drivers/ide/sis5513.c                              |    2 +-
 drivers/ide/sl82c105.c                             |    2 +-
 drivers/ide/slc90e66.c                             |    2 +-
 drivers/ide/tc86c001.c                             |    2 +-
 drivers/ide/triflex.c                              |    2 +-
 drivers/ide/trm290.c                               |    2 +-
 drivers/ide/via82cxxx.c                            |    2 +-
 drivers/ieee802154/fakehard.c                      |    2 +-
 drivers/infiniband/core/cm.c                       |   32 +-
 drivers/infiniband/core/fmr_pool.c                 |   20 +-
 drivers/infiniband/hw/cxgb4/mem.c                  |    4 +-
 drivers/infiniband/hw/ipath/ipath_rc.c             |    6 +-
 drivers/infiniband/hw/ipath/ipath_ruc.c            |    6 +-
 drivers/infiniband/hw/nes/nes.c                    |    4 +-
 drivers/infiniband/hw/nes/nes.h                    |   40 +-
 drivers/infiniband/hw/nes/nes_cm.c                 |   62 +-
 drivers/infiniband/hw/nes/nes_mgt.c                |    8 +-
 drivers/infiniband/hw/nes/nes_nic.c                |   40 +-
 drivers/infiniband/hw/nes/nes_verbs.c              |   10 +-
 drivers/infiniband/hw/qib/qib.h                    |    1 +
 drivers/input/gameport/gameport.c                  |    4 +-
 drivers/input/input.c                              |    4 +-
 drivers/input/joystick/sidewinder.c                |    1 +
 drivers/input/joystick/xpad.c                      |    4 +-
 drivers/input/mousedev.c                           |    2 +-
 drivers/input/serio/serio.c                        |    4 +-
 drivers/isdn/capi/capi.c                           |   10 +-
 drivers/isdn/gigaset/common.c                      |    2 +-
 drivers/isdn/gigaset/gigaset.h                     |    3 +-
 drivers/isdn/gigaset/interface.c                   |   22 +-
 drivers/isdn/hardware/avm/b1.c                     |    4 +-
 drivers/isdn/hardware/eicon/divasync.h             |    2 +-
 drivers/isdn/hardware/eicon/xdi_adapter.h          |    2 +-
 drivers/isdn/icn/icn.c                             |    2 +-
 drivers/lguest/core.c                              |   10 +-
 drivers/lguest/x86/core.c                          |   12 +-
 drivers/lguest/x86/switcher_32.S                   |   27 +-
 drivers/macintosh/macio_asic.c                     |    2 +-
 drivers/md/dm-ioctl.c                              |    2 +-
 drivers/md/dm-raid1.c                              |   16 +-
 drivers/md/dm-stripe.c                             |   10 +-
 drivers/md/dm-table.c                              |    2 +-
 drivers/md/dm-thin-metadata.c                      |    4 +-
 drivers/md/dm.c                                    |   16 +-
 drivers/md/md.c                                    |   28 +-
 drivers/md/md.h                                    |    6 +-
 drivers/md/persistent-data/dm-space-map-checker.c  |    2 +-
 drivers/md/persistent-data/dm-space-map-disk.c     |    2 +-
 drivers/md/persistent-data/dm-space-map-metadata.c |    2 +-
 drivers/md/persistent-data/dm-space-map.h          |    1 +
 drivers/md/raid1.c                                 |    4 +-
 drivers/md/raid10.c                                |   16 +-
 drivers/md/raid5.c                                 |   10 +-
 drivers/media/dvb/ddbridge/ddbridge-core.c         |    2 +-
 drivers/media/dvb/dvb-core/dvb_demux.h             |    2 +-
 drivers/media/dvb/dvb-core/dvbdev.c                |    2 +-
 drivers/media/dvb/dvb-usb/cxusb.c                  |    2 +-
 drivers/media/dvb/dvb-usb/dw2102.c                 |    2 +-
 drivers/media/dvb/frontends/dib3000.h              |    2 +-
 drivers/media/dvb/ngene/ngene-cards.c              |    2 +-
 drivers/media/radio/radio-cadet.c                  |    2 +
 drivers/media/rc/redrat3.c                         |    2 +-
 drivers/media/video/au0828/au0828.h                |    2 +-
 drivers/media/video/cx88/cx88-alsa.c               |    2 +-
 drivers/media/video/pvrusb2/pvrusb2-hdw-internal.h |    2 +-
 drivers/media/video/timblogiw.c                    |    4 +-
 drivers/message/fusion/mptsas.c                    |   34 +-
 drivers/message/fusion/mptscsih.c                  |   19 +-
 drivers/message/i2o/i2o_proc.c                     |   44 +-
 drivers/message/i2o/iop.c                          |    8 +-
 drivers/mfd/abx500-core.c                          |    2 +-
 drivers/mfd/janz-cmodio.c                          |    1 +
 drivers/misc/lis3lv02d/lis3lv02d.c                 |    8 +-
 drivers/misc/lis3lv02d/lis3lv02d.h                 |    2 +-
 drivers/misc/sgi-gru/gruhandles.c                  |    4 +-
 drivers/misc/sgi-gru/gruprocfs.c                   |    8 +-
 drivers/misc/sgi-gru/grutables.h                   |  154 +++---
 drivers/misc/sgi-xp/xp.h                           |    2 +-
 drivers/misc/sgi-xp/xpc.h                          |    3 +-
 drivers/misc/sgi-xp/xpc_main.c                     |    2 +-
 drivers/mmc/host/sdhci-pci.c                       |    2 +-
 drivers/mtd/devices/doc2000.c                      |    2 +-
 drivers/mtd/devices/doc2001.c                      |    2 +-
 drivers/mtd/nand/denali.c                          |    1 +
 drivers/mtd/nftlmount.c                            |    1 +
 drivers/mtd/ubi/build.c                            |   16 +-
 drivers/net/ethernet/atheros/atlx/atl2.c           |    2 +-
 drivers/net/ethernet/broadcom/bnx2x/bnx2x_sp.h     |    2 +-
 drivers/net/ethernet/broadcom/tg3.h                |    1 +
 drivers/net/ethernet/chelsio/cxgb3/l2t.h           |    2 +-
 drivers/net/ethernet/dec/tulip/de4x5.c             |    4 +-
 drivers/net/ethernet/dec/tulip/eeprom.c            |    2 +-
 drivers/net/ethernet/dec/tulip/winbond-840.c       |    2 +-
 drivers/net/ethernet/dlink/sundance.c              |    2 +-
 drivers/net/ethernet/emulex/benet/be_main.c        |    2 +-
 drivers/net/ethernet/fealnx.c                      |    2 +-
 drivers/net/ethernet/intel/e1000e/80003es2lan.c    |    2 +-
 drivers/net/ethernet/intel/e1000e/82571.c          |    2 +-
 drivers/net/ethernet/intel/e1000e/hw.h             |    9 +-
 drivers/net/ethernet/intel/igb/e1000_hw.h          |   12 +-
 drivers/net/ethernet/intel/igbvf/vf.h              |    6 +-
 drivers/net/ethernet/intel/ixgbe/ixgbe_type.h      |   12 +-
 drivers/net/ethernet/intel/ixgbevf/vf.h            |    6 +-
 drivers/net/ethernet/mellanox/mlx4/main.c          |    1 +
 drivers/net/ethernet/neterion/vxge/vxge-config.h   |    2 +-
 drivers/net/ethernet/neterion/vxge/vxge-traffic.h  |    2 +-
 drivers/net/ethernet/realtek/r8169.c               |    6 +-
 drivers/net/ethernet/sis/sis190.c                  |    2 +-
 drivers/net/ppp/ppp_generic.c                      |    4 +-
 drivers/net/tokenring/abyss.c                      |    8 +-
 drivers/net/tokenring/madgemc.c                    |    8 +-
 drivers/net/tokenring/proteon.c                    |    8 +-
 drivers/net/tokenring/skisa.c                      |    8 +-
 drivers/net/usb/hso.c                              |   25 +-
 drivers/net/vmxnet3/vmxnet3_ethtool.c              |    3 +-
 drivers/net/wireless/ath/ath.h                     |    1 +
 drivers/net/wireless/ath/ath9k/ar9002_mac.c        |   30 +-
 drivers/net/wireless/ath/ath9k/ar9003_mac.c        |   58 +-
 drivers/net/wireless/ath/ath9k/hw.h                |    6 +-
 .../net/wireless/brcm80211/brcmsmac/phy/phy_int.h  |    2 +-
 drivers/net/wireless/iwlegacy/iwl3945-base.c       |    4 +-
 drivers/net/wireless/iwlwifi/iwl-debug.h           |    4 +-
 drivers/net/wireless/mac80211_hwsim.c              |    8 +-
 drivers/net/wireless/mwifiex/main.h                |    2 +-
 drivers/net/wireless/rndis_wlan.c                  |    2 +-
 drivers/net/wireless/wl1251/wl1251.h               |    2 +-
 drivers/oprofile/buffer_sync.c                     |    8 +-
 drivers/oprofile/event_buffer.c                    |    2 +-
 drivers/oprofile/oprof.c                           |    2 +-
 drivers/oprofile/oprofile_stats.c                  |   10 +-
 drivers/oprofile/oprofile_stats.h                  |   10 +-
 drivers/oprofile/oprofilefs.c                      |    2 +-
 drivers/parport/procfs.c                           |    4 +-
 drivers/pci/hotplug/cpci_hotplug.h                 |    2 +-
 drivers/pci/hotplug/cpqphp_nvram.c                 |    4 +
 drivers/pci/pcie/aspm.c                            |    6 +-
 drivers/pci/probe.c                                |    2 +-
 drivers/platform/x86/thinkpad_acpi.c               |   70 ++-
 drivers/pnp/pnpbios/bioscalls.c                    |   14 +-
 drivers/pnp/resource.c                             |    4 +-
 drivers/power/bq27x00_battery.c                    |    2 +-
 drivers/regulator/max8660.c                        |    6 +-
 drivers/regulator/mc13892-regulator.c              |    6 +-
 drivers/scsi/aacraid/aacraid.h                     |    2 +-
 drivers/scsi/aacraid/linit.c                       |    2 +-
 drivers/scsi/aic94xx/aic94xx_init.c                |    2 +-
 drivers/scsi/bfa/bfa.h                             |    2 +-
 drivers/scsi/bfa/bfa_fcpim.c                       |    4 +-
 drivers/scsi/bfa/bfa_fcpim.h                       |    3 +-
 drivers/scsi/bfa/bfa_ioc.h                         |    4 +-
 drivers/scsi/hosts.c                               |    4 +-
 drivers/scsi/hpsa.c                                |   30 +-
 drivers/scsi/hpsa.h                                |    2 +-
 drivers/scsi/ips.h                                 |    2 +-
 drivers/scsi/libfc/fc_exch.c                       |   38 +-
 drivers/scsi/libsas/sas_ata.c                      |    2 +-
 drivers/scsi/lpfc/lpfc.h                           |    8 +-
 drivers/scsi/lpfc/lpfc_debugfs.c                   |   18 +-
 drivers/scsi/lpfc/lpfc_init.c                      |    6 +-
 drivers/scsi/lpfc/lpfc_scsi.c                      |   16 +-
 drivers/scsi/pmcraid.c                             |   20 +-
 drivers/scsi/pmcraid.h                             |    8 +-
 drivers/scsi/qla2xxx/qla_def.h                     |    2 +-
 drivers/scsi/qla4xxx/ql4_def.h                     |    2 +-
 drivers/scsi/qla4xxx/ql4_os.c                      |    6 +-
 drivers/scsi/scsi.c                                |    2 +-
 drivers/scsi/scsi_lib.c                            |    6 +-
 drivers/scsi/scsi_sysfs.c                          |    2 +-
 drivers/scsi/scsi_tgt_lib.c                        |    2 +-
 drivers/scsi/scsi_transport_fc.c                   |    8 +-
 drivers/scsi/scsi_transport_iscsi.c                |    6 +-
 drivers/scsi/scsi_transport_srp.c                  |    6 +-
 drivers/scsi/sg.c                                  |    6 +-
 drivers/spi/spi-dw-pci.c                           |    2 +-
 drivers/spi/spi.c                                  |    2 +-
 drivers/staging/gma500/power.c                     |    2 +-
 drivers/staging/hv/rndis_filter.c                  |    6 +-
 drivers/staging/iio/buffer_generic.h               |    2 +-
 drivers/staging/octeon/ethernet-rx.c               |   12 +-
 drivers/staging/octeon/ethernet.c                  |    8 +-
 drivers/staging/pohmelfs/inode.c                   |    4 +-
 drivers/staging/pohmelfs/mcache.c                  |    2 +-
 drivers/staging/pohmelfs/netfs.h                   |    4 +-
 drivers/staging/pohmelfs/trans.c                   |    2 +-
 drivers/staging/rtl8712/rtl871x_io.h               |    2 +-
 drivers/staging/sbe-2t3e3/netdev.c                 |    2 +-
 drivers/staging/usbip/usbip_common.h               |    2 +-
 drivers/staging/usbip/vhci.h                       |    2 +-
 drivers/staging/usbip/vhci_hcd.c                   |    6 +-
 drivers/staging/usbip/vhci_rx.c                    |    2 +-
 drivers/staging/vt6655/hostap.c                    |    7 +-
 drivers/staging/vt6656/hostap.c                    |    7 +-
 drivers/staging/wlan-ng/hfa384x_usb.c              |    2 +-
 drivers/staging/zcache/tmem.c                      |    4 +-
 drivers/staging/zcache/tmem.h                      |    2 +
 drivers/target/iscsi/iscsi_target.c                |    2 +-
 drivers/target/target_core_tmr.c                   |    6 +-
 drivers/target/target_core_transport.c             |   16 +-
 drivers/tty/hvc/hvcs.c                             |   23 +-
 drivers/tty/ipwireless/tty.c                       |   29 +-
 drivers/tty/n_gsm.c                                |    2 +-
 drivers/tty/n_tty.c                                |    3 +-
 drivers/tty/pty.c                                  |    4 +-
 drivers/tty/serial/kgdboc.c                        |   32 +-
 drivers/tty/tty_io.c                               |    2 +-
 drivers/tty/tty_ldisc.c                            |   10 +-
 drivers/uio/uio.c                                  |   21 +-
 drivers/usb/atm/cxacru.c                           |    2 +-
 drivers/usb/atm/usbatm.c                           |   24 +-
 drivers/usb/core/devices.c                         |    6 +-
 drivers/usb/core/message.c                         |    4 +-
 drivers/usb/early/ehci-dbgp.c                      |   16 +-
 drivers/usb/wusbcore/wa-hc.h                       |    4 +-
 drivers/usb/wusbcore/wa-xfer.c                     |    2 +-
 drivers/vhost/vhost.c                              |    2 +-
 drivers/video/aty/aty128fb.c                       |    2 +-
 drivers/video/fbcmap.c                             |    3 +-
 drivers/video/fbmem.c                              |    6 +-
 drivers/video/geode/gx1fb_core.c                   |    2 +-
 drivers/video/gxt4500.c                            |    4 +-
 drivers/video/i810/i810_accel.c                    |    1 +
 drivers/video/i810/i810_main.c                     |    2 +-
 drivers/video/jz4740_fb.c                          |    2 +-
 drivers/video/udlfb.c                              |   32 +-
 drivers/video/uvesafb.c                            |   36 ++-
 drivers/video/vesafb.c                             |   51 ++-
 drivers/video/via/via_clock.h                      |    2 +-
 drivers/xen/xen-pciback/conf_space.h               |    6 +-
 fs/9p/vfs_inode.c                                  |    2 +-
 fs/Kconfig.binfmt                                  |    2 +-
 fs/aio.c                                           |   11 +-
 fs/autofs4/waitq.c                                 |    2 +-
 fs/befs/linuxvfs.c                                 |    2 +-
 fs/binfmt_aout.c                                   |   23 +-
 fs/binfmt_elf.c                                    |  606 ++++++++++++++++++-
 fs/binfmt_flat.c                                   |    6 +
 fs/bio.c                                           |    2 +-
 fs/block_dev.c                                     |    2 +-
 fs/btrfs/ctree.c                                   |    9 +-
 fs/btrfs/ioctl.c                                   |    2 +-
 fs/btrfs/relocation.c                              |    2 +-
 fs/cachefiles/bind.c                               |    6 +-
 fs/cachefiles/daemon.c                             |    8 +-
 fs/cachefiles/internal.h                           |   12 +-
 fs/cachefiles/namei.c                              |    2 +-
 fs/cachefiles/proc.c                               |   12 +-
 fs/cachefiles/rdwr.c                               |    2 +-
 fs/ceph/dir.c                                      |    2 +-
 fs/cifs/cifs_debug.c                               |   86 ++--
 fs/cifs/cifsfs.c                                   |    8 +-
 fs/cifs/cifsglob.h                                 |   50 +-
 fs/cifs/link.c                                     |    2 +-
 fs/cifs/misc.c                                     |    4 +-
 fs/coda/cache.c                                    |   10 +-
 fs/compat.c                                        |   10 +-
 fs/compat_binfmt_elf.c                             |    2 +
 fs/compat_ioctl.c                                  |   10 +-
 fs/configfs/dir.c                                  |   10 +-
 fs/dcache.c                                        |    2 +-
 fs/ecryptfs/inode.c                                |    6 +-
 fs/ecryptfs/miscdev.c                              |    2 +-
 fs/ecryptfs/read_write.c                           |    4 +-
 fs/exec.c                                          |  317 +++++++++--
 fs/ext4/ext4.h                                     |   20 +-
 fs/ext4/mballoc.c                                  |   44 +-
 fs/fcntl.c                                         |    4 +-
 fs/fifo.c                                          |   22 +-
 fs/fs_struct.c                                     |   12 +-
 fs/fscache/cookie.c                                |   34 +-
 fs/fscache/internal.h                              |  182 +++---
 fs/fscache/object.c                                |   26 +-
 fs/fscache/operation.c                             |   28 +-
 fs/fscache/page.c                                  |  106 ++--
 fs/fscache/stats.c                                 |  330 +++++-----
 fs/fuse/cuse.c                                     |   10 +-
 fs/fuse/dev.c                                      |    2 +-
 fs/fuse/dir.c                                      |    2 +-
 fs/gfs2/inode.c                                    |    2 +-
 fs/inode.c                                         |    4 +-
 fs/jffs2/erase.c                                   |    3 +-
 fs/jffs2/wbuf.c                                    |    3 +-
 fs/jfs/super.c                                     |    2 +-
 fs/libfs.c                                         |   10 +-
 fs/lockd/clntproc.c                                |    4 +-
 fs/locks.c                                         |    8 +-
 fs/namei.c                                         |   13 +-
 fs/nfs/blocklayout/blocklayout.c                   |    2 +-
 fs/nfs/inode.c                                     |    8 +-
 fs/nfsd/vfs.c                                      |    6 +-
 fs/notify/fanotify/fanotify_user.c                 |    3 +-
 fs/notify/notification.c                           |    4 +-
 fs/ntfs/dir.c                                      |    2 +-
 fs/ntfs/file.c                                     |    4 +-
 fs/ocfs2/localalloc.c                              |    2 +-
 fs/ocfs2/ocfs2.h                                   |   10 +-
 fs/ocfs2/suballoc.c                                |   12 +-
 fs/ocfs2/super.c                                   |   20 +-
 fs/ocfs2/symlink.c                                 |    2 +-
 fs/partitions/efi.c                                |    8 +-
 fs/pipe.c                                          |   33 +-
 fs/proc/array.c                                    |   20 +
 fs/proc/base.c                                     |    2 +-
 fs/proc/kcore.c                                    |   32 +-
 fs/proc/meminfo.c                                  |    2 +-
 fs/proc/nommu.c                                    |    2 +-
 fs/proc/task_mmu.c                                 |   39 +-
 fs/proc/task_nommu.c                               |    4 +-
 fs/quota/netlink.c                                 |    4 +-
 fs/readdir.c                                       |    2 +-
 fs/reiserfs/do_balan.c                             |    2 +-
 fs/reiserfs/procfs.c                               |    2 +-
 fs/seq_file.c                                      |   14 +-
 fs/splice.c                                        |   36 +-
 fs/sysfs/file.c                                    |   10 +-
 fs/sysfs/symlink.c                                 |    2 +-
 fs/udf/misc.c                                      |    2 +-
 fs/xattr_acl.c                                     |    4 +-
 fs/xfs/xfs_bmap.c                                  |    2 +-
 fs/xfs/xfs_dir2_sf.c                               |   10 +-
 fs/xfs/xfs_ioctl.c                                 |    2 +-
 fs/xfs/xfs_iops.c                                  |    2 +-
 include/acpi/acpi_bus.h                            |    2 +-
 include/asm-generic/atomic-long.h                  |  183 ++++++
 include/asm-generic/atomic64.h                     |   12 +
 include/asm-generic/cache.h                        |    4 +-
 include/asm-generic/int-l64.h                      |    2 +
 include/asm-generic/int-ll64.h                     |    2 +
 include/asm-generic/kmap_types.h                   |    3 +-
 include/asm-generic/pgtable-nopmd.h                |   18 +-
 include/asm-generic/pgtable-nopud.h                |   14 +-
 include/asm-generic/pgtable.h                      |    8 +
 include/asm-generic/vmlinux.lds.h                  |   10 +-
 include/drm/drmP.h                                 |    5 +-
 include/drm/drm_crtc_helper.h                      |    4 +-
 include/drm/ttm/ttm_memory.h                       |    2 +-
 include/linux/a.out.h                              |    8 +
 include/linux/atmdev.h                             |    2 +-
 include/linux/binfmts.h                            |    1 +
 include/linux/blkdev.h                             |    2 +-
 include/linux/blktrace_api.h                       |    2 +-
 include/linux/byteorder/little_endian.h            |   24 +-
 include/linux/cache.h                              |    4 +
 include/linux/cleancache.h                         |    2 +-
 include/linux/compiler-gcc4.h                      |   11 +
 include/linux/compiler.h                           |   60 ++-
 include/linux/cpuset.h                             |    2 +-
 include/linux/crypto.h                             |    6 +-
 include/linux/decompress/mm.h                      |    2 +-
 include/linux/dma-mapping.h                        |    2 +-
 include/linux/efi.h                                |    2 +-
 include/linux/elf.h                                |   30 +
 include/linux/filter.h                             |    4 +
 include/linux/firewire.h                           |    2 +-
 include/linux/fs.h                                 |    3 +-
 include/linux/fs_struct.h                          |    2 +-
 include/linux/fscache-cache.h                      |    4 +-
 include/linux/fsnotify.h                           |    2 +-
 include/linux/fsnotify_backend.h                   |    1 +
 include/linux/ftrace_event.h                       |    4 +-
 include/linux/genhd.h                              |    2 +-
 include/linux/hid.h                                |    2 +-
 include/linux/highmem.h                            |   12 +
 include/linux/i2c.h                                |    1 +
 include/linux/i2o.h                                |    2 +-
 include/linux/init.h                               |    4 +-
 include/linux/init_task.h                          |    7 +
 include/linux/intel-iommu.h                        |    2 +-
 include/linux/interrupt.h                          |    6 +-
 include/linux/kgdb.h                               |    6 +-
 include/linux/kvm_host.h                           |    4 +-
 include/linux/libata.h                             |    2 +-
 include/linux/mca.h                                |    2 +-
 include/linux/memory.h                             |    2 +-
 include/linux/mfd/abx500.h                         |    1 +
 include/linux/mm.h                                 |   66 +--
 include/linux/mm_types.h                           |   20 +
 include/linux/mmu_notifier.h                       |    6 +-
 include/linux/mmzone.h                             |    2 +-
 include/linux/mod_devicetable.h                    |    4 +-
 include/linux/module.h                             |   54 ++-
 include/linux/moduleloader.h                       |   12 +
 include/linux/moduleparam.h                        |    4 +-
 include/linux/namei.h                              |    6 +-
 include/linux/netdevice.h                          |    1 +
 include/linux/of_pdt.h                             |    2 +-
 include/linux/oprofile.h                           |    4 +-
 include/linux/padata.h                             |    2 +-
 include/linux/perf_event.h                         |    8 +-
 include/linux/pipe_fs_i.h                          |    6 +-
 include/linux/pm_runtime.h                         |    2 +-
 include/linux/poison.h                             |    4 +-
 include/linux/preempt.h                            |    2 +-
 include/linux/proc_fs.h                            |    2 +-
 include/linux/random.h                             |    7 +-
 include/linux/reboot.h                             |   14 +-
 include/linux/reiserfs_fs.h                        |    2 +-
 include/linux/reiserfs_fs_sb.h                     |    2 +-
 include/linux/relay.h                              |    2 +-
 include/linux/rfkill.h                             |    1 +
 include/linux/rio.h                                |    2 +-
 include/linux/rmap.h                               |    4 +-
 include/linux/sched.h                              |   69 ++-
 include/linux/screen_info.h                        |    3 +-
 include/linux/seq_file.h                           |    1 +
 include/linux/skbuff.h                             |    8 +-
 include/linux/slab.h                               |   73 +++-
 include/linux/slab_def.h                           |    8 +-
 include/linux/slub_def.h                           |    4 +-
 include/linux/sonet.h                              |    2 +-
 include/linux/sunrpc/clnt.h                        |    8 +-
 include/linux/sunrpc/sched.h                       |    1 +
 include/linux/sunrpc/svc_rdma.h                    |   18 +-
 include/linux/sysctl.h                             |    6 +-
 include/linux/tty_ldisc.h                          |    2 +-
 include/linux/types.h                              |   16 +
 include/linux/uaccess.h                            |    6 +-
 include/linux/unaligned/access_ok.h                |   12 +-
 include/linux/usb/renesas_usbhs.h                  |    4 +-
 include/linux/vermagic.h                           |   21 +-
 include/linux/vmalloc.h                            |  104 ++++
 include/linux/vmstat.h                             |   20 +-
 include/linux/xattr.h                              |    5 +
 include/media/saa7146_vv.h                         |    2 +-
 include/media/v4l2-dev.h                           |    3 +-
 include/media/v4l2-ioctl.h                         |    2 +-
 include/net/caif/caif_hsi.h                        |    2 +-
 include/net/caif/cfctrl.h                          |    6 +-
 include/net/flow.h                                 |    2 +-
 include/net/inetpeer.h                             |    8 +-
 include/net/ip_fib.h                               |    2 +-
 include/net/ip_vs.h                                |    4 +-
 include/net/irda/ircomm_core.h                     |    2 +-
 include/net/irda/ircomm_tty.h                      |    5 +-
 include/net/iucv/af_iucv.h                         |    2 +-
 include/net/neighbour.h                            |    2 +-
 include/net/netlink.h                              |    2 +-
 include/net/netns/ipv4.h                           |    4 +-
 include/net/sctp/sctp.h                            |    6 +-
 include/net/sock.h                                 |    4 +-
 include/net/tcp.h                                  |    2 +-
 include/net/udp.h                                  |    2 +-
 include/net/xfrm.h                                 |    2 +-
 include/rdma/iw_cm.h                               |    2 +-
 include/scsi/libfc.h                               |    3 +-
 include/scsi/scsi_device.h                         |    6 +-
 include/scsi/scsi_transport_fc.h                   |    2 +-
 include/sound/ak4xxx-adda.h                        |    2 +-
 include/sound/hwdep.h                              |    2 +-
 include/sound/info.h                               |    2 +-
 include/sound/pcm.h                                |    1 +
 include/sound/sb16_csp.h                           |    2 +-
 include/sound/soc.h                                |    2 +-
 include/sound/ymfpci.h                             |    2 +-
 include/target/target_core_base.h                  |    8 +-
 include/trace/events/irq.h                         |    4 +-
 include/video/udlfb.h                              |    8 +-
 include/video/uvesafb.h                            |    1 +
 init/Kconfig                                       |    2 +-
 init/do_mounts.c                                   |   14 +-
 init/do_mounts.h                                   |    8 +-
 init/do_mounts_initrd.c                            |   28 +-
 init/do_mounts_md.c                                |    6 +-
 init/initramfs.c                                   |   40 +-
 init/main.c                                        |   56 ++-
 ipc/msg.c                                          |   11 +-
 ipc/sem.c                                          |   11 +-
 ipc/shm.c                                          |   19 +-
 kernel/acct.c                                      |    2 +-
 kernel/audit.c                                     |    8 +-
 kernel/auditsc.c                                   |    4 +-
 kernel/capability.c                                |    3 +
 kernel/compat.c                                    |   44 +-
 kernel/debug/debug_core.c                          |   16 +-
 kernel/debug/kdb/kdb_main.c                        |    4 +-
 kernel/events/core.c                               |   28 +-
 kernel/exit.c                                      |    2 +-
 kernel/fork.c                                      |  165 ++++--
 kernel/futex.c                                     |    9 +
 kernel/gcov/base.c                                 |    7 +-
 kernel/hrtimer.c                                   |    2 +-
 kernel/jump_label.c                                |    4 +
 kernel/kallsyms.c                                  |   39 ++-
 kernel/kexec.c                                     |    3 +-
 kernel/kmod.c                                      |    2 +-
 kernel/kprobes.c                                   |    8 +-
 kernel/lockdep.c                                   |    7 +-
 kernel/lockdep_proc.c                              |    2 +-
 kernel/module.c                                    |  324 +++++++----
 kernel/mutex-debug.c                               |   12 +-
 kernel/mutex-debug.h                               |    4 +-
 kernel/mutex.c                                     |    7 +-
 kernel/padata.c                                    |    8 +-
 kernel/panic.c                                     |    3 +-
 kernel/pid.c                                       |    2 +-
 kernel/posix-cpu-timers.c                          |    4 +-
 kernel/posix-timers.c                              |   20 +-
 kernel/power/poweroff.c                            |    2 +-
 kernel/power/process.c                             |   13 +-
 kernel/profile.c                                   |   14 +-
 kernel/ptrace.c                                    |    6 +-
 kernel/rcutorture.c                                |   56 +-
 kernel/rcutree.c                                   |   24 +-
 kernel/rcutree.h                                   |    2 +-
 kernel/rcutree_plugin.h                            |   18 +-
 kernel/rcutree_trace.c                             |    4 +-
 kernel/rtmutex-tester.c                            |   24 +-
 kernel/sched_autogroup.c                           |    4 +-
 kernel/sched_fair.c                                |    2 +-
 kernel/signal.c                                    |    8 +-
 kernel/smp.c                                       |    8 +-
 kernel/softirq.c                                   |   14 +-
 kernel/sys.c                                       |   12 +-
 kernel/sysctl.c                                    |   37 ++-
 kernel/sysctl_binary.c                             |   14 +-
 kernel/time/alarmtimer.c                           |    2 +-
 kernel/time/tick-broadcast.c                       |    2 +-
 kernel/time/timer_stats.c                          |   10 +-
 kernel/timer.c                                     |    2 +-
 kernel/trace/blktrace.c                            |    6 +-
 kernel/trace/ftrace.c                              |   11 +-
 kernel/trace/trace.c                               |    6 +-
 kernel/trace/trace_events.c                        |   25 +-
 kernel/trace/trace_kprobe.c                        |    8 +-
 kernel/trace/trace_mmiotrace.c                     |    8 +-
 kernel/trace/trace_output.c                        |    2 +-
 kernel/trace/trace_stack.c                         |    2 +-
 kernel/trace/trace_workqueue.c                     |    6 +-
 lib/bitmap.c                                       |    8 +-
 lib/bug.c                                          |    2 +
 lib/debugobjects.c                                 |    2 +-
 lib/devres.c                                       |    4 +-
 lib/dma-debug.c                                    |    2 +-
 lib/extable.c                                      |    3 +
 lib/inflate.c                                      |    2 +-
 lib/kref.c                                         |    2 +-
 lib/radix-tree.c                                   |    2 +-
 lib/vsprintf.c                                     |   12 +-
 mm/Kconfig                                         |    6 +-
 mm/filemap.c                                       |    2 +-
 mm/fremap.c                                        |    5 +
 mm/highmem.c                                       |    7 +-
 mm/huge_memory.c                                   |    2 +-
 mm/hugetlb.c                                       |   54 ++
 mm/internal.h                                      |    1 +
 mm/maccess.c                                       |    4 +-
 mm/madvise.c                                       |   41 ++
 mm/memory-failure.c                                |   18 +-
 mm/memory.c                                        |  358 +++++++++--
 mm/mempolicy.c                                     |   25 +
 mm/mlock.c                                         |   20 +-
 mm/mmap.c                                          |  632 +++++++++++++++++---
 mm/mprotect.c                                      |  137 +++++-
 mm/mremap.c                                        |   45 ++-
 mm/nobootmem.c                                     |   15 +-
 mm/nommu.c                                         |   11 +-
 mm/page_alloc.c                                    |   14 +-
 mm/percpu.c                                        |    2 +-
 mm/process_vm_access.c                             |   12 +-
 mm/rmap.c                                          |   41 ++-
 mm/shmem.c                                         |    5 +-
 mm/slab.c                                          |   81 ++-
 mm/slob.c                                          |  180 +++++-
 mm/slub.c                                          |   74 ++-
 mm/swap.c                                          |    3 +
 mm/swapfile.c                                      |   12 +-
 mm/util.c                                          |    8 +
 mm/vmalloc.c                                       |   92 +++-
 mm/vmstat.c                                        |    6 +-
 net/8021q/vlan.c                                   |    3 +-
 net/9p/trans_fd.c                                  |    2 +-
 net/atm/atm_misc.c                                 |    8 +-
 net/atm/lec.h                                      |    2 +-
 net/atm/mpc.h                                      |    2 +-
 net/atm/proc.c                                     |    6 +-
 net/atm/resources.c                                |    4 +-
 net/batman-adv/bat_iv_ogm.c                        |    6 +-
 net/batman-adv/hard-interface.c                    |    4 +-
 net/batman-adv/soft-interface.c                    |    4 +-
 net/batman-adv/types.h                             |    6 +-
 net/batman-adv/unicast.c                           |    2 +-
 net/bluetooth/hci_conn.c                           |    2 +-
 net/bluetooth/l2cap_core.c                         |   12 +-
 net/bridge/br_multicast.c                          |    2 +-
 net/bridge/netfilter/ebtables.c                    |    2 +-
 net/caif/caif_socket.c                             |   43 +-
 net/caif/cfctrl.c                                  |   11 +-
 net/can/gw.c                                       |    2 +-
 net/compat.c                                       |   32 +-
 net/core/datagram.c                                |    2 +-
 net/core/dev.c                                     |    6 +-
 net/core/flow.c                                    |    8 +-
 net/core/iovec.c                                   |    4 +-
 net/core/rtnetlink.c                               |    2 +-
 net/core/scm.c                                     |    8 +-
 net/core/sock.c                                    |   16 +-
 net/decnet/sysctl_net_decnet.c                     |    4 +-
 net/ipv4/fib_frontend.c                            |    6 +-
 net/ipv4/fib_semantics.c                           |    2 +-
 net/ipv4/inetpeer.c                                |    4 +-
 net/ipv4/ip_fragment.c                             |    2 +-
 net/ipv4/ip_sockglue.c                             |    2 +-
 net/ipv4/ipconfig.c                                |    6 +-
 net/ipv4/netfilter/nf_nat_snmp_basic.c             |    2 +-
 net/ipv4/ping.c                                    |    2 +-
 net/ipv4/raw.c                                     |   14 +-
 net/ipv4/route.c                                   |    6 +-
 net/ipv4/tcp_probe.c                               |    2 +-
 net/ipv4/udp.c                                     |    8 +-
 net/ipv6/addrconf.c                                |    2 +-
 net/ipv6/inet6_connection_sock.c                   |    4 +-
 net/ipv6/ipv6_sockglue.c                           |    2 +-
 net/ipv6/raw.c                                     |   19 +-
 net/ipv6/udp.c                                     |    8 +-
 net/irda/ircomm/ircomm_tty.c                       |   38 +-
 net/iucv/af_iucv.c                                 |    4 +-
 net/key/af_key.c                                   |    4 +-
 net/mac80211/ieee80211_i.h                         |    3 +-
 net/mac80211/iface.c                               |   12 +-
 net/mac80211/main.c                                |    2 +-
 net/mac80211/pm.c                                  |    6 +-
 net/mac80211/rate.c                                |    2 +-
 net/mac80211/rc80211_pid_debugfs.c                 |    2 +-
 net/mac80211/util.c                                |    2 +-
 net/netfilter/ipvs/ip_vs_conn.c                    |    6 +-
 net/netfilter/ipvs/ip_vs_core.c                    |    4 +-
 net/netfilter/ipvs/ip_vs_ctl.c                     |   10 +-
 net/netfilter/ipvs/ip_vs_sync.c                    |    4 +-
 net/netfilter/ipvs/ip_vs_xmit.c                    |    4 +-
 net/netfilter/nfnetlink_log.c                      |    4 +-
 net/netfilter/xt_statistic.c                       |    8 +-
 net/netlink/af_netlink.c                           |    4 +-
 net/packet/af_packet.c                             |    8 +-
 net/phonet/pep.c                                   |    6 +-
 net/phonet/socket.c                                |    2 +-
 net/rds/cong.c                                     |    6 +-
 net/rds/ib.h                                       |    2 +-
 net/rds/ib_cm.c                                    |    2 +-
 net/rds/ib_recv.c                                  |    4 +-
 net/rds/iw.h                                       |    2 +-
 net/rds/iw_cm.c                                    |    2 +-
 net/rds/iw_recv.c                                  |    4 +-
 net/rds/tcp.c                                      |    2 +-
 net/rds/tcp_send.c                                 |    2 +-
 net/rxrpc/af_rxrpc.c                               |    2 +-
 net/rxrpc/ar-ack.c                                 |   14 +-
 net/rxrpc/ar-call.c                                |    2 +-
 net/rxrpc/ar-connection.c                          |    2 +-
 net/rxrpc/ar-connevent.c                           |    2 +-
 net/rxrpc/ar-input.c                               |    4 +-
 net/rxrpc/ar-internal.h                            |    8 +-
 net/rxrpc/ar-local.c                               |    2 +-
 net/rxrpc/ar-output.c                              |    4 +-
 net/rxrpc/ar-peer.c                                |    2 +-
 net/rxrpc/ar-proc.c                                |    4 +-
 net/rxrpc/ar-transport.c                           |    2 +-
 net/rxrpc/rxkad.c                                  |    4 +-
 net/sctp/socket.c                                  |    2 +-
 net/socket.c                                       |   34 +-
 net/sunrpc/sched.c                                 |    4 +-
 net/sunrpc/svcsock.c                               |    2 +-
 net/sunrpc/xprtrdma/svc_rdma.c                     |   38 +-
 net/sunrpc/xprtrdma/svc_rdma_recvfrom.c            |    6 +-
 net/sunrpc/xprtrdma/svc_rdma_sendto.c              |    2 +-
 net/sunrpc/xprtrdma/svc_rdma_transport.c           |   10 +-
 net/tipc/link.c                                    |    6 +-
 net/tipc/msg.c                                     |    2 +-
 net/tipc/subscr.c                                  |    2 +-
 net/wireless/core.h                                |    2 +-
 net/wireless/wext-core.c                           |   19 +-
 net/xfrm/xfrm_policy.c                             |   16 +-
 scripts/Makefile.build                             |    4 +-
 scripts/Makefile.clean                             |    3 +-
 scripts/Makefile.host                              |    2 +
 scripts/basic/fixdep.c                             |   12 +-
 scripts/gcc-plugin.sh                              |    2 +
 scripts/mod/file2alias.c                           |   14 +-
 scripts/mod/modpost.c                              |   25 +-
 scripts/mod/modpost.h                              |    6 +-
 scripts/mod/sumversion.c                           |    2 +-
 scripts/pnmtologo.c                                |    6 +-
 security/Kconfig                                   |  617 +++++++++++++++++++-
 security/integrity/ima/ima.h                       |    4 +-
 security/integrity/ima/ima_api.c                   |    2 +-
 security/integrity/ima/ima_fs.c                    |    4 +-
 security/integrity/ima/ima_queue.c                 |    2 +-
 security/keys/compat.c                             |    2 +-
 security/keys/keyctl.c                             |    8 +-
 security/keys/keyring.c                            |    6 +-
 security/security.c                                |    8 +-
 security/selinux/hooks.c                           |    2 +-
 security/selinux/include/xfrm.h                    |    2 +-
 security/smack/smack_lsm.c                         |    2 +-
 security/tomoyo/tomoyo.c                           |    2 +-
 sound/aoa/codecs/onyx.c                            |    7 +-
 sound/aoa/codecs/onyx.h                            |    1 +
 sound/core/oss/pcm_oss.c                           |   18 +-
 sound/core/pcm_compat.c                            |    2 +-
 sound/core/pcm_native.c                            |    4 +-
 sound/core/seq/seq_device.c                        |    8 +-
 sound/drivers/mts64.c                              |   14 +-
 sound/drivers/opl4/opl4_lib.c                      |    2 +-
 sound/drivers/portman2x4.c                         |    3 +-
 sound/firewire/amdtp.c                             |    4 +-
 sound/firewire/amdtp.h                             |    2 +-
 sound/firewire/isight.c                            |   10 +-
 sound/isa/cmi8330.c                                |    2 +-
 sound/oss/sb_audio.c                               |    2 +-
 sound/oss/swarm_cs4297a.c                          |    6 +-
 sound/pci/hda/hda_codec.h                          |    7 +-
 sound/pci/ice1712/ice1712.h                        |    4 +-
 sound/pci/ymfpci/ymfpci_main.c                     |   12 +-
 sound/soc/soc-pcm.c                                |    2 +-
 sound/usb/card.h                                   |    3 +-
 tools/gcc/Makefile                                 |   21 +
 tools/gcc/checker_plugin.c                         |  171 ++++++
 tools/gcc/constify_plugin.c                        |  303 ++++++++++
 tools/gcc/kallocstat_plugin.c                      |  167 +++++
 tools/gcc/kernexec_plugin.c                        |  348 +++++++++++
 tools/gcc/stackleak_plugin.c                       |  291 +++++++++
 tools/perf/util/include/asm/alternative-asm.h      |    3 +
 usr/gen_init_cpio.c                                |    7 +-
 virt/kvm/kvm_main.c                                |   20 +-
 1228 files changed, 18021 insertions(+), 5950 deletions(-)
